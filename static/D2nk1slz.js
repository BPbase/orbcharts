import{S as v,d as g,m,e as P,o as y,p as x,at as W,s as T,Q as ee,x as re}from"./BmSCDJil.js";import{c as j,k as te,d as ie,g as H}from"./DQaJP6Gt.js";import{m as ae}from"./jlA76nUU.js";const R=.3;function U({axisWidth:a,groupAmount:l,barAmountOfGroup:n,barPadding:i=0,barGroupPadding:o=0}){const u=(a/(l-1)-o)/n-i;return u>1?u:1}function ne(a,l,n){const i=a/2,o=a*l.length+n.barPadding*l.length;return te().domain(l).range([-o/2+i,o/2-i])}function se(a,l){return a<=1?0:l/(a-1)*R}function oe(a,l){return a<=1?l:l*(1-R)}function pe({graphicGSelection:a,pathGClassName:l,pathClassName:n,visibleComputedLayoutData:i,linearGradientIds:o,zeroYArr:p,groupLabels:u,barScale:$,params:O,chartParams:M,barWidth:d,delayGroup:S,transitionItem:B,isSeriesSeprate:L}){const G=d/2;return a.each((z,h,f)=>{T(f[h]).selectAll(`g.${l}`).data(i[h]??[]).join(s=>{const b=s.append("g").classed(l,!0).attr("cursor","pointer");return b.append("path").classed(n,!0).style("vector-effect","non-scaling-stroke").attr("d",I=>{const D=-G,w=p[h],A=p[h];return`M${D},${w} L${D+d/2},${A} ${D+d},${w}`}),b},s=>s,s=>s.remove()).attr("transform",s=>`translate(${L?0:$(s.seriesLabel)}, 0)`).select(`path.${n}`).attr("height",s=>Math.abs(s.axisYFromZero)).attr("y",s=>s.axisY<p[h]?s.axisY:p[h]).attr("x",s=>L?0:$(s.seriesLabel)).style("fill",s=>`url(#${o[s.seriesIndex]})`).attr("stroke",s=>s.color).attr("transform",s=>`translate(${s?s.axisX:0}, 0)`).transition().duration(B).ease(ie(M.transitionEase)).delay((s,b)=>s.groupIndex*S).attr("d",s=>{const b=-G,I=p[h],D=s.axisY;return`M${b},${I} L${b+d/2},${D} ${b+d},${I}`})}),a.selectAll(`path.${n}`)}function le({defsSelection:a,computedData:l,linearGradientIds:n,params:i}){a.selectAll("linearGradient").data(l??[]).join(o=>o.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),o=>o,o=>o.remove()).attr("id",(o,p)=>o[0]?n[o[0].seriesIndex]:"").html((o,p)=>{const u=o[0]?o[0].color:"";return`
        <stop offset="0%"   stop-color="${u}" stop-opacity="${i.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${u}" stop-opacity="${i.linearGradientOpacity[1]}"/>
      `})}function ce({defsSelection:a,clipPathData:l}){a.selectAll("clipPath").data(l).join(n=>n.append("clipPath"),n=>n,n=>n.remove()).attr("id",n=>n.id).each((n,i,o)=>{T(o[i]).selectAll("rect").data([n]).join(p=>p.append("rect"),p=>p,p=>p.remove()).attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height)})}function ge({selection:a,ids:l,fullChartParams:n}){a.interrupt("highlight");const i=()=>{a.transition("highlight").duration(200).style("opacity",1)};if(!l.length){i();return}a.each((o,p,u)=>{l.includes(o.id)?T(u[p]).style("opacity",1):T(u[p]).style("opacity",n.styles.unhighlightedOpacity)})}const ue=(a,{selection:l,computedData$:n,computedLayoutData$:i,visibleComputedData$:o,visibleComputedLayoutData$:p,fullDataFormatter$:u,seriesLabels$:$,SeriesDataMap$:O,GroupDataMap$:M,fullParams$:d,fullChartParams$:S,gridAxesTransform$:B,gridGraphicTransform$:L,gridAxesSize$:G,gridHighlight$:k,gridContainerPosition$:z,isSeriesSeprate$:h,event$:f})=>{const c=new v,s=j(a,"clipPath-box"),b=H(a,"pathG"),I=H(a,"path"),{seriesSelection$:D,axesSelection$:w,defsSelection$:A,graphicGSelection$:Q}=ae({selection:l,pluginName:a,clipPathID:s,seriesLabels$:$,gridContainerPosition$:z,gridAxesTransform$:B,gridGraphicTransform$:L});L.pipe(g(c),m(e=>-e.translate[1]/e.scale[1]));const Z=p.pipe(m(e=>e.map(t=>t[0]?t[0].axisY-t[0].axisYFromZero:0)),P()),E=y({computedData:n,visibleComputedData:o,params:d,gridAxesSize:G,isSeriesSeprate:h}).pipe(g(c),x(async e=>e),m(e=>e.params.barWidth?e.params.barWidth:e.isSeriesSeprate?U({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):U({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}))),C=o.pipe(g(c),m(e=>{const t=new Set;return e.forEach(r=>{r.forEach(N=>{t.add(N.groupLabel)})}),Array.from(t)})),X=new W(e=>{y({seriesLabels:$,barWidth:E,params:d}).pipe(g(c),x(async t=>t)).subscribe(t=>{const r=ne(t.barWidth,t.seriesLabels,t.params);e.next(r)})}),F=S.pipe(g(c),m(e=>e.transitionDuration),P()),q=new W(e=>{y({groupLabels:C,transitionDuration:F}).pipe(x(async t=>t)).subscribe(t=>{const r=se(t.groupLabels.length,t.transitionDuration);e.next(r)})}).pipe(g(c),P()),J=new W(e=>{y({groupLabels:C,transitionDuration:F}).pipe(x(async t=>t)).subscribe(t=>{const r=oe(t.groupLabels.length,t.transitionDuration);e.next(r)})}).pipe(g(c),P());y({defsSelection:A,gridAxesSize:G}).pipe(g(c),x(async e=>e)).subscribe(e=>{const t=[{id:s,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];ce({defsSelection:e.defsSelection,clipPathData:t})});const K=S.pipe(g(c),m(e=>e.highlightTarget),P()),V=$.pipe(g(c),m(e=>e.map((t,r)=>j(a,`lineargradient-${t}`)))),Y=y({graphicGSelection:Q,defsSelection:A,computedData:n,visibleComputedLayoutData:p,linearGradientIds:V,zeroYArr:Z,groupLabels:C,barScale:X,params:d,chartParams:S,barWidth:E,delayGroup:q,transitionItem:J,isSeriesSeprate:h}).pipe(g(c),x(async e=>e),m(e=>(le({defsSelection:e.defsSelection,computedData:e.computedData,linearGradientIds:e.linearGradientIds,params:e.params}),pe({graphicGSelection:e.graphicGSelection,pathGClassName:b,pathClassName:I,visibleComputedLayoutData:e.visibleComputedLayoutData,linearGradientIds:e.linearGradientIds,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesSeprate:e.isSeriesSeprate}))));return y({barSelection:Y,computedData:n,highlightTarget:K,SeriesDataMap:O,GroupDataMap:M}).subscribe(e=>{e.barSelection.on("mouseover",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"mouseover",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("mousemove",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"mousemove",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("mouseout",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"mouseout",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("click",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"click",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})})}),y({barSelection:Y,highlight:k.pipe(m(e=>e.map(t=>t.id))),fullChartParams:S}).pipe(g(c),x(async e=>e)).subscribe(e=>{ge({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}},_="BarsTriangle",he={name:_,defaultParams:re,layerIndex:5,validator:(a,{validateColumns:l})=>l(a,{barWidth:{toBeTypes:["number"]},barPadding:{toBeTypes:["number"]},barGroupPadding:{toBeTypes:["number"]},linearGradientOpacity:{toBe:"[number, number]",test:i=>Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"}})},ye=ee(he)(({selection:a,name:l,subject:n,observer:i})=>{const o=new v,p=ue(_,{selection:a,computedData$:i.computedData$,computedLayoutData$:i.computedLayoutData$,visibleComputedData$:i.visibleComputedData$,visibleComputedLayoutData$:i.visibleComputedLayoutData$,fullDataFormatter$:i.fullDataFormatter$,seriesLabels$:i.seriesLabels$,SeriesDataMap$:i.SeriesDataMap$,GroupDataMap$:i.GroupDataMap$,fullParams$:i.fullParams$,fullChartParams$:i.fullChartParams$,gridAxesTransform$:i.gridAxesTransform$,gridGraphicTransform$:i.gridGraphicTransform$,gridAxesSize$:i.gridAxesSize$,gridHighlight$:i.gridHighlight$,gridContainerPosition$:i.gridContainerPosition$,isSeriesSeprate$:i.isSeriesSeprate$,event$:n.event$});return()=>{o.next(void 0),p()}});export{ye as B,ue as c};
