import{K as J,g as E,h as ie,m as T,I as re,L as ne,a0 as se,a1 as oe,a2 as ae,S as G,e as b,d as O,t as d,s as $,b as _,O as X,J as le,j as ce,a3 as ge}from"./pf1r-l3X.js";import{c as z,j as ue,p as ee,g as P,k as pe,l as fe,n as xe,o as U}from"./DSAQ5uLE.js";import{f as K}from"./BdegRq93.js";import{E as de}from"./OXZoKtl2.js";function me(s,l,g,i,a,x,u,S){var c=[],A=0,D=0,o=!1,y=function(){o&&!c.length&&!A&&l.complete()},h=function(v){return A<i?n(v):c.push(v)},n=function(v){A++;var k=!1;E(g(v,D++)).subscribe(J(l,function(m){l.next(m)},function(){k=!0},void 0,function(){if(k)try{A--;for(var m=function(){var F=c.shift();u||n(F)};c.length&&A<i;)m();y()}catch(F){l.error(F)}}))};return s.subscribe(J(l,h,function(){o=!0,y()})),function(){}}function te(s,l,g){return g===void 0&&(g=1/0),ie(l)?te(function(i,a){return T(function(x,u){return l(i,x,a,u)})(E(s(i,a)))},g):(typeof l=="number"&&(g=l),re(function(i,a){return me(i,a,s,g)}))}function Ae(s){return s===void 0&&(s=1/0),te(ne,s)}function q(){for(var s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];var g=se(s),i=oe(s,1/0),a=s;return a.length?a.length===1?E(a[0]):Ae(i)(ae(a,g)):de}const N=6;function he({selection:s,xAxisClassName:l,groupingLabelClassName:g,params:i,tickTextAlign:a,axisLabelAlign:x,gridAxesSize:u,fullDataFormatter:S,chartParams:c,groupScale:A,textTransform:D}){const o=s.selectAll(`g.${l}`).data([i]).join("g").classed(l,!0);s.selectAll(`g.${g}`).data([i]).join("g").classed(g,!0).each((n,v,k)=>{_(k[v]).selectAll("text").data([n]).join(m=>m.append("text").style("font-weight","bold"),m=>m,m=>m.remove()).attr("text-anchor",x.textAnchor).attr("dominant-baseline",x.dominantBaseline).style("font-size",`${c.styles.textSize}px`).style("fill",z(i.labelColorType,c)).style("transform",D).text(m=>S.grid.groupAxis.label)}).attr("transform",n=>`translate(${u.width+n.tickPadding+i.labelOffset[0]}, ${-n.tickPadding-N-i.labelOffset[1]})`);const y=ue(A).scale(A).tickSize(i.tickFullLine==!0?-u.height:N).tickSizeOuter(0).tickFormat(n=>ee(n,i.tickFormat)).tickPadding(i.tickPadding),h=o.transition().duration(100).call(y);return h.selectAll("line").style("fill","none").style("stroke",i.tickLineVisible==!0?z(i.tickColorType,c):"none").style("stroke-dasharray",i.tickFullLineDasharray).attr("pointer-events","none"),h.selectAll("path").style("fill","none").style("stroke",i.axisLineVisible==!0?z(i.axisLineColorType,c):"none").style("shape-rendering","crispEdges"),o.selectAll("text").style("font-family","sans-serif").style("font-size",`${c.styles.textSize}px`).style("color",z(i.tickTextColorType,c)).attr("text-anchor",a.textAnchor).attr("dominant-baseline",a.dominantBaseline).attr("transform-origin",`0 -${i.tickPadding+N}`).style("transform",D),o}const Re=(s,{selection:l,computedData$:g,fullParams$:i,fullDataFormatter$:a,fullChartParams$:x,gridAxesTransform$:u,gridAxesReverseTransform$:S,gridAxesSize$:c,gridContainer$:A,isSeriesPositionSeprate$:D})=>{const o=new G,y=P(s,"container"),h=P(s,"xAxisG"),n=P(s,"xAxis"),v=P(s,"groupingLabel"),k=b({computedData:g.pipe(O((t,e)=>t.length===e.length)),isSeriesPositionSeprate:D}).pipe(d(o),$(async t=>t),T(t=>t.isSeriesPositionSeprate?t.computedData:[t.computedData[0]]),T((t,e)=>l.selectAll(`g.${y}`).data(t,r=>r[0]?r[0].seriesIndex:e).join("g").classed(y,!0))),m=k.pipe(d(o),T((t,e)=>t.selectAll(`g.${h}`).data([h]).join("g").classed(h,!0)));b({containerSelection:k,gridContainer:A}).pipe(d(o),$(async t=>t)).subscribe(t=>{t.containerSelection.attr("transform",(e,r)=>{const f=t.gridContainer[r]??t.gridContainer[0],C=f.translate,R=f.scale;return`translate(${C[0]}, ${C[1]}) scale(${R[0]}, ${R[1]})`})}),b({axisSelection:m,gridAxesTransform:u}).pipe(d(o),$(async t=>t)).subscribe(t=>{t.axisSelection.style("transform",t.gridAxesTransform.value)});const F=b({fullParams:i,fullDataFormatter:a,gridAxesReverseTransform:S,gridContainer:A}).pipe(d(o),$(async t=>t),T(t=>{const e=`translate(${t.gridAxesReverseTransform.translate[0]}px, ${t.gridAxesReverseTransform.translate[1]}px)`,r=`rotate(${t.gridAxesReverseTransform.rotate}deg) rotateX(${t.gridAxesReverseTransform.rotateX}deg) rotateY(${t.gridAxesReverseTransform.rotateY}deg)`,f=`scale(${1/t.gridContainer[0].scale[0]}, ${1/t.gridContainer[0].scale[1]})`,R=`rotate(${t.fullDataFormatter.grid.groupAxis.position==="left"&&t.fullDataFormatter.grid.valueAxis.position==="top"||t.fullDataFormatter.grid.groupAxis.position==="right"&&t.fullDataFormatter.grid.valueAxis.position==="bottom"?t.fullParams.tickTextRotate+180:t.fullParams.tickTextRotate}deg)`;return`${e} ${r} ${f} ${R}`}),O()),L=new X(t=>{b({fullDataFormatter:a,gridAxesSize:c,computedData:g}).pipe(d(o),$(async e=>e)).subscribe(e=>{const f=e.computedData[0]?e.computedData[0].length-1:0,C=e.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-e.fullDataFormatter.grid.groupAxis.scalePadding:e.fullDataFormatter.grid.groupAxis.scaleDomain[0]-e.fullDataFormatter.grid.groupAxis.scalePadding,R=e.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?f+e.fullDataFormatter.grid.groupAxis.scalePadding:e.fullDataFormatter.grid.groupAxis.scaleDomain[1]+e.fullDataFormatter.grid.groupAxis.scalePadding,w=e.computedData[0]?e.computedData[0].length:0;let j=(e.computedData[0]??[]).map(V=>V.groupLabel);const Y=new Array(w).fill(0).map((V,M)=>j[M]!=null?j[M]:String(M)).filter((V,M)=>M>=C&&M<=R),I=e.fullDataFormatter.grid.groupAxis.scalePadding,H=le({axisLabels:Y,axisWidth:e.gridAxesSize.width,padding:I});t.next(H)})}),p=b({fullDataFormatter:a,fullParams:i}).pipe(d(o),$(async t=>t),T(t=>{let e="middle",r="hanging";return t.fullDataFormatter.grid.groupAxis.position==="bottom"?(e=t.fullParams.tickTextRotate?"end":"middle",r="hanging"):t.fullDataFormatter.grid.groupAxis.position==="top"?(e=t.fullParams.tickTextRotate?"end":"middle",r="auto"):t.fullDataFormatter.grid.groupAxis.position==="left"?(e="end",r="middle"):t.fullDataFormatter.grid.groupAxis.position==="right"&&(e="start",r="middle"),{textAnchor:e,dominantBaseline:r}})),B=a.pipe(d(o),T(t=>{let e="start",r="hanging";return t.grid.groupAxis.position==="bottom"?r="hanging":t.grid.groupAxis.position==="top"?r="auto":t.grid.groupAxis.position==="left"?e="end":t.grid.groupAxis.position==="right"&&(e="start"),t.grid.valueAxis.position==="left"?e="start":t.grid.valueAxis.position==="right"?e="end":t.grid.valueAxis.position==="bottom"?r="auto":t.grid.valueAxis.position==="top"&&(r="hanging"),{textAnchor:e,dominantBaseline:r}}));return b({axisSelection:m,params:i,tickTextAlign:p,axisLabelAlign:B,gridAxesSize:c,fullDataFormatter:a,chartParams:x,groupScale:L,textTransform:F}).pipe(d(o),$(async t=>t)).subscribe(t=>{he({selection:t.axisSelection,xAxisClassName:n,groupingLabelClassName:v,params:t.params,tickTextAlign:t.tickTextAlign,axisLabelAlign:t.axisLabelAlign,gridAxesSize:t.gridAxesSize,fullDataFormatter:t.fullDataFormatter,chartParams:t.chartParams,groupScale:t.groupScale,textTransform:t.textTransform})}),()=>{o.next(void 0)}},Q=6;function ye({selection:s,yAxisClassName:l,textClassName:g,fullParams:i,tickTextAlign:a,axisLabelAlign:x,gridAxesSize:u,fullDataFormatter:S,fullChartParams:c,valueScale:A,textTransform:D,minAndMax:o}){const y=s.selectAll(`g.${l}`).data([i]).join("g").classed(l,!0);s.selectAll(`g.${g}`).data([i]).join("g").classed(g,!0).each((m,F,L)=>{_(L[F]).selectAll("text").data([m]).join(p=>p.append("text").style("font-weight","bold"),p=>p,p=>p.remove()).attr("text-anchor",x.textAnchor).attr("dominant-baseline",x.dominantBaseline).style("font-size",`${c.styles.textSize}px`).style("fill",z(i.labelColorType,c)).style("transform",D).text(p=>S.grid.valueAxis.label)}).attr("transform",m=>`translate(${-m.tickPadding+i.labelOffset[0]}, ${u.height+m.tickPadding+i.labelOffset[1]})`);const h=o[1]-o[0],n=pe(A).scale(A).ticks(h>i.ticks?i.ticks:o[0]===0&&o[1]===0?1:Math.ceil(h)).tickFormat(m=>ee(m,i.tickFormat)).tickSize(i.tickFullLine==!0?-u.width:Q).tickPadding(i.tickPadding),v=y.transition().duration(100).call(n);return v.selectAll("line").style("fill","none").style("stroke",i.tickLineVisible==!0?z(i.tickColorType,c):"none").style("stroke-dasharray",i.tickFullLineDasharray).attr("pointer-events","none"),v.selectAll("path").style("fill","none").style("stroke",i.axisLineVisible==!0?z(i.axisLineColorType,c):"none").style("shape-rendering","crispEdges"),y.selectAll("text").style("font-family","sans-serif").style("font-size",`${c.styles.textSize}px`).style("color",z(i.tickTextColorType,c)).attr("text-anchor",a.textAnchor).attr("dominant-baseline",a.dominantBaseline).attr("transform-origin",`-${i.tickPadding+Q} 0`).style("transform",D),y}const Pe=(s,{selection:l,computedData$:g,fullParams$:i,fullDataFormatter$:a,fullChartParams$:x,gridAxesTransform$:u,gridAxesReverseTransform$:S,gridAxesSize$:c,gridContainer$:A,isSeriesPositionSeprate$:D})=>{const o=new G,y=P(s,"container"),h=P(s,"yAxisG"),n=P(s,"yAxis"),v=P(s,"text"),k=b({computedData:g.pipe(O((e,r)=>e.length===r.length)),isSeriesPositionSeprate:D}).pipe(d(o),$(async e=>e),T(e=>e.isSeriesPositionSeprate?e.computedData:[e.computedData[0]]),T((e,r)=>l.selectAll(`g.${y}`).data(e,f=>f[0]?f[0].seriesIndex:r).join("g").classed(y,!0))),m=k.pipe(d(o),T((e,r)=>e.selectAll(`g.${h}`).data([h]).join("g").classed(h,!0)));b({containerSelection:k,gridContainer:A}).pipe(d(o),$(async e=>e)).subscribe(e=>{e.containerSelection.attr("transform",(r,f)=>{const C=e.gridContainer[f]??e.gridContainer[0],R=C.translate,w=C.scale;return`translate(${R[0]}, ${R[1]}) scale(${w[0]}, ${w[1]})`})}),b({axisSelection:m,gridAxesTransform:u}).pipe(d(o),$(async e=>e)).subscribe(e=>{e.axisSelection.style("transform",e.gridAxesTransform.value)});const F=b({fullParams:i,fullDataFormatter:a,gridAxesReverseTransform:S,gridContainer:A}).pipe(d(o),$(async e=>e),T(e=>{const r=`translate(${e.gridAxesReverseTransform.translate[0]}px, ${e.gridAxesReverseTransform.translate[1]}px)`,f=`rotate(${e.gridAxesReverseTransform.rotate}deg) rotateX(${e.gridAxesReverseTransform.rotateX}deg) rotateY(${e.gridAxesReverseTransform.rotateY}deg)`,C=`scale(${1/e.gridContainer[0].scale[0]}, ${1/e.gridContainer[0].scale[1]})`,w=`rotate(${e.fullDataFormatter.grid.groupAxis.position==="left"&&e.fullDataFormatter.grid.valueAxis.position==="top"||e.fullDataFormatter.grid.groupAxis.position==="right"&&e.fullDataFormatter.grid.valueAxis.position==="bottom"?e.fullParams.tickTextRotate+180:e.fullParams.tickTextRotate}deg)`;return`${r} ${f} ${C} ${w}`}),O()),L=new X(e=>{b({fullDataFormatter:a,gridAxesSize:c,computedData:g}).pipe(d(o),$(async r=>r)).subscribe(r=>{const C=r.computedData[0]?r.computedData[0].length-1:0,R=r.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-r.fullDataFormatter.grid.groupAxis.scalePadding:r.fullDataFormatter.grid.groupAxis.scaleDomain[0]-r.fullDataFormatter.grid.groupAxis.scalePadding,w=r.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?C+r.fullDataFormatter.grid.groupAxis.scalePadding:r.fullDataFormatter.grid.groupAxis.scaleDomain[1]+r.fullDataFormatter.grid.groupAxis.scalePadding,j=r.computedData.map((I,H)=>I.filter((V,M)=>M>=R&&M<=w)),Y=fe(j.flat());e.next(Y)})}),p=new X(e=>{b({fullDataFormatter:a,gridAxesSize:c,minAndMax:L}).pipe(d(o),$(async r=>r)).subscribe(r=>{const f=ce({maxValue:r.minAndMax[1],minValue:r.minAndMax[0],axisWidth:r.gridAxesSize.height,scaleDomain:r.fullDataFormatter.grid.valueAxis.scaleDomain,scaleRange:r.fullDataFormatter.grid.valueAxis.scaleRange});e.next(f)})}),B=a.pipe(d(o),T(e=>{let r="start",f="hanging";return e.grid.valueAxis.position==="left"?(r="end",f="middle"):e.grid.valueAxis.position==="right"?(r="start",f="middle"):e.grid.valueAxis.position==="bottom"?(r="middle",f="hanging"):e.grid.valueAxis.position==="top"&&(r="middle",f="auto"),{textAnchor:r,dominantBaseline:f}})),t=a.pipe(d(o),T(e=>{let r="start",f="hanging";return e.grid.groupAxis.position==="bottom"?f="auto":e.grid.groupAxis.position==="top"?f="hanging":e.grid.groupAxis.position==="left"?r="start":e.grid.groupAxis.position==="right"&&(r="end"),e.grid.valueAxis.position==="left"?r="end":e.grid.valueAxis.position==="right"?r="start":e.grid.valueAxis.position==="bottom"?f="hanging":e.grid.valueAxis.position==="top"&&(f="auto"),{textAnchor:r,dominantBaseline:f}}));return b({axisSelection:m,fullParams:i,tickTextAlign:B,axisLabelAlign:t,computedData:g,gridAxesSize:c,fullDataFormatter:a,fullChartParams:x,valueScale:p,textTransform:F,minAndMax:L}).pipe(d(o),$(async e=>e)).subscribe(e=>{ye({selection:e.axisSelection,yAxisClassName:n,textClassName:v,fullParams:e.fullParams,tickTextAlign:e.tickTextAlign,axisLabelAlign:e.axisLabelAlign,gridAxesSize:e.gridAxesSize,fullDataFormatter:e.fullDataFormatter,fullChartParams:e.fullChartParams,valueScale:e.valueScale,textTransform:e.textTransform,minAndMax:e.minAndMax})}),()=>{o.next(void 0)}},ve={backgroundColorType:"background",strokeColorType:"primary",backgroundOpacity:.8,textColorType:"primary",offset:[20,5],padding:10,textRenderFn:s=>{if(s.highlightTarget==="datum"&&s.datum)return[`${s.datum.label}: ${s.datum.value}`];if(s.highlightTarget==="series"){const l=s.seriesLabel,g=s.series.map(i=>i.value).join(",");return[l,g]}else if(s.highlightTarget==="group"){const l=s.groupLabel,g=s.groups.map(i=>i.value).join(",");return[l,g]}return[]},svgRenderFn:null},W="Tooltip",Z=P(W,"g"),be=P(W,"box");function $e(s,l){const g=l.textSize*1.5;return s.filter(i=>i!="").map((i,a)=>{const x=a*g;return`<text font-size="${l.textSize}" fill="${l.textColor}" x="0" y="${x}" style="dominant-baseline:text-before-edge">${i}</text>`}).join()}function Te({rootSelection:s,pluginName:l,rootWidth:g,rootHeight:i,svgString:a,tooltipStyle:x,event:u}){s.interrupt("fadeout");const S=5,c=a?[a]:[],A=a?[x]:[],o=s.selectAll(`g.${Z}`).data(c).join(p=>p.append("g").classed(Z,!0).attr("pointer-events","none"),p=>p,p=>p.style("opacity",0).remove()).attr("transform",()=>`translate(${u.offsetX}, ${u.offsetY})`).selectAll(`g.${be}`).data(A).join(p=>p.append("g").classed(P(l,"box"),!0)),y=o.selectAll("rect").data(A).join(p=>p.append("rect").attr("rx",S).attr("ry",S)).attr("fill",p=>p.backgroundColor).attr("stroke",p=>p.strokeColor).attr("opacity",p=>p.backgroundOpacity),h=o.selectAll("g").data(c).join(p=>p.append("g").classed(P(l,"content"),!0).attr("transform",()=>`translate(${x.padding}, ${x.padding})`));c.length&&xe(h,c[0]);const n=h!=null&&h.node()?U(h):{width:0,height:0};y.attr("width",n.width+x.padding*2).attr("height",n.height+x.padding*2);const v=o!=null&&o.node()?U(o):{width:0,height:0},k=g-v.width,m=i-v.height,F=u.offsetX+x.offset[0]>k?k-u.offsetX:x.offset[0],L=u.offsetY+x.offset[1]>m?m-u.offsetY:x.offset[1];o.attr("transform",p=>`translate(${F}, ${L})`),o.attr("transform",p=>`translate(${F}, ${L})`)}const ze=ge(W,ve)(({selection:s,rootSelection:l,name:g,chartType:i,observer:a,subject:x})=>{const u=new G,S=x.event$.pipe(d(u),K(n=>n.eventName==="mouseover"||n.eventName==="mousemove")),c=x.event$.pipe(d(u),K(n=>n.eventName==="mouseout")),A=b({fullChartParams:a.fullChartParams$,fullParams:a.fullParams$}).pipe(d(u),$(async n=>n),T(n=>({backgroundColor:z(n.fullParams.backgroundColorType,n.fullChartParams),backgroundOpacity:n.fullParams.backgroundOpacity,strokeColor:z(n.fullParams.strokeColorType,n.fullChartParams),offset:n.fullParams.offset,padding:n.fullParams.padding,textSize:n.fullChartParams.styles.textSize,textColor:z(n.fullParams.textColorType,n.fullChartParams)}))),D=b({fullParams:a.fullParams$,tooltipStyle:A}).pipe(d(u),$(async n=>n),T(n=>n.fullParams.svgRenderFn?n.fullParams.svgRenderFn:v=>{const k=n.fullParams.textRenderFn(v);return $e(k,n.tooltipStyle)})),o=b({event:S,contentRenderFn:D}).pipe(d(u),$(async n=>n),T(n=>n.contentRenderFn(n.event))),y=c.pipe(d(u),T(n=>"")),h=q(S,c).pipe(d(u),T(n=>n.event));return b({svgString:q(o,y),event:h,layout:a.layout$,tooltipStyle:A}).pipe(d(u),$(async n=>n)).subscribe(n=>{Te({rootSelection:l,pluginName:g,rootWidth:n.layout.rootWidth,rootHeight:n.layout.rootHeight,svgString:n.svgString,tooltipStyle:n.tooltipStyle,event:n.event})}),function(){u.next(void 0)}});export{ze as T,Re as a,q as b,Pe as c,te as m};
