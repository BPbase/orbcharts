import{Q as R,h as S,j as I,m as x,P as M,R as Y,as as X,at as L,au as E,av as H,S as G,t as g,e as b,s as P}from"./BILlwXT2.js";import{g as T,u as W,v as z,c as k}from"./C39DfsNA.js";import{f as w}from"./DopzhtH9.js";import{E as Q}from"./CS1bynfi.js";function U(e,r,s,o,n,l,a,h){var f=[],c=0,C=0,u=!1,v=function(){u&&!f.length&&!c&&r.complete()},p=function(m){return c<o?t(m):f.push(m)},t=function(m){c++;var d=!1;S(s(m,C++)).subscribe(R(r,function(y){r.next(y)},function(){d=!0},void 0,function(){if(d)try{c--;for(var y=function(){var $=f.shift();a||t($)};f.length&&c<o;)y();v()}catch($){r.error($)}}))};return e.subscribe(R(r,p,function(){u=!0,v()})),function(){}}function O(e,r,s){return s===void 0&&(s=1/0),I(r)?O(function(o,n){return x(function(l,a){return r(o,l,n,a)})(S(e(o,n)))},s):(typeof r=="number"&&(s=r),M(function(o,n){return U(o,n,e,s)}))}function V(e){return e===void 0&&(e=1/0),O(Y,e)}function A(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var s=X(e),o=L(e,1/0),n=e;return n.length?n.length===1?S(n[0]):V(o)(E(n,s)):Q}const q={backgroundColorType:"background",strokeColorType:"primary",backgroundOpacity:.8,textColorType:"primary",offset:[20,5],padding:10,textRenderFn:e=>{if(e.highlightTarget==="datum"&&e.datum)return[`${e.datum.label}: ${e.datum.value}`];if(e.highlightTarget==="series"){const r=e.seriesLabel,s=e.series.map(o=>o.value).join(",");return[r,s]}else if(e.highlightTarget==="group"){const r=e.groupLabel,s=e.groups.map(o=>o.value).join(",");return[r,s]}return[]},svgRenderFn:null},F="Tooltip",j=T(F,"g"),B=T(F,"box");function J(e,r){const s=r.textSize*1.5;return e.filter(o=>o!="").map((o,n)=>{const l=n*s;return`<text font-size="${r.textSize}" fill="${r.textColor}" x="0" y="${l}" style="dominant-baseline:text-before-edge">${o}</text>`}).join()}function K({rootSelection:e,pluginName:r,rootWidth:s,rootHeight:o,svgString:n,tooltipStyle:l,event:a}){e.interrupt("fadeout");const h=5,f=n?[n]:[],c=n?[l]:[],u=e.selectAll(`g.${j}`).data(f).join(i=>i.append("g").classed(j,!0).attr("pointer-events","none"),i=>i,i=>i.style("opacity",0).remove()).attr("transform",()=>`translate(${a.offsetX}, ${a.offsetY})`).selectAll(`g.${B}`).data(c).join(i=>i.append("g").classed(T(r,"box"),!0)),v=u.selectAll("rect").data(c).join(i=>i.append("rect").attr("rx",h).attr("ry",h)).attr("fill",i=>i.backgroundColor).attr("stroke",i=>i.strokeColor).attr("opacity",i=>i.backgroundOpacity),p=u.selectAll("g").data(f).join(i=>i.append("g").classed(T(r,"content"),!0).attr("transform",()=>`translate(${l.padding}, ${l.padding})`));f.length&&W(p,f[0]);const t=p!=null&&p.node()?z(p):{width:0,height:0};v.attr("width",t.width+l.padding*2).attr("height",t.height+l.padding*2);const m=u!=null&&u.node()?z(u):{width:0,height:0},d=s-m.width,y=o-m.height,$=a.offsetX+l.offset[0]>d?d-a.offsetX:l.offset[0],N=a.offsetY+l.offset[1]>y?y-a.offsetY:l.offset[1];u.attr("transform",i=>`translate(${$}, ${N})`),u.attr("transform",i=>`translate(${$}, ${N})`)}const rt=H(F,q)(({selection:e,rootSelection:r,name:s,chartType:o,observer:n,subject:l})=>{const a=new G,h=l.event$.pipe(g(a),w(t=>t.eventName==="mouseover"||t.eventName==="mousemove")),f=l.event$.pipe(g(a),w(t=>t.eventName==="mouseout")),c=b({fullChartParams:n.fullChartParams$,fullParams:n.fullParams$}).pipe(g(a),P(async t=>t),x(t=>({backgroundColor:k(t.fullParams.backgroundColorType,t.fullChartParams),backgroundOpacity:t.fullParams.backgroundOpacity,strokeColor:k(t.fullParams.strokeColorType,t.fullChartParams),offset:t.fullParams.offset,padding:t.fullParams.padding,textSize:t.fullChartParams.styles.textSize,textColor:k(t.fullParams.textColorType,t.fullChartParams)}))),C=b({fullParams:n.fullParams$,tooltipStyle:c}).pipe(g(a),P(async t=>t),x(t=>t.fullParams.svgRenderFn?t.fullParams.svgRenderFn:m=>{const d=t.fullParams.textRenderFn(m);return J(d,t.tooltipStyle)})),u=b({event:h,contentRenderFn:C}).pipe(g(a),P(async t=>t),x(t=>t.contentRenderFn(t.event))),v=f.pipe(g(a),x(t=>"")),p=A(h,f).pipe(g(a),x(t=>t.event));return b({svgString:A(u,v),event:p,layout:n.layout$,tooltipStyle:c}).pipe(g(a),P(async t=>t)).subscribe(t=>{K({rootSelection:r,pluginName:s,rootWidth:t.layout.rootWidth,rootHeight:t.layout.rootHeight,svgString:t.svgString,tooltipStyle:t.tooltipStyle,event:t.event})}),function(){a.next(void 0)}});export{rt as T,A as a,O as m};
