import{g as K,l as Q,d as R}from"./goxUyvVz.js";import{S as V,p as Z,m as f,d as E,j as M,t as m,k as y,s as v,aN as ee,g as te}from"./DXm0Mz1x.js";import{n as ie,o as re}from"./XQIDYrRR.js";import{f as se}from"./BuQ8Ff8B.js";function oe(r="curveLinear"){return Q().x(a=>a.axisX).y(a=>a.axisY).curve(R[r])}function ae(r){let a=[[]],g=0;for(let l in r){if(r[l].visible==!1||r[l].value===void 0||r[l].value===null){a[g].length&&(g++,a[g]=[]);continue}a[g].push(r[l])}return a}function ne({selection:r,pathClassName:a,segmentData:g,linePath:l,params:n}){return r.selectAll("path").data(g,(o,c)=>o.length?`${o[0].id}_${o[o.length-1].id}`:c).join(o=>o.append("path").classed(a,!0).attr("fill","none").attr("pointer-events","visibleStroke").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),o=>o,o=>o.remove()).attr("stroke-width",n.lineWidth).attr("stroke",(o,c)=>o[0]&&o[0].color).attr("d",o=>l(o))}function ge({selection:r,seriesLabel:a,fullChartParams:g}){if(r.interrupt("highlight"),!a){r.transition("highlight").duration(200).style("opacity",1);return}r.each((l,n,d)=>{l===a?v(d[n]).style("opacity",1):v(d[n]).style("opacity",g.styles.unhighlightedOpacity)})}function pe({defsSelection:r,clipPathData:a,transitionDuration:g,transitionEase:l}){r.selectAll("clipPath").data(a).join(n=>n.append("clipPath"),n=>n,n=>n.remove()).attr("id",n=>n.id).each((n,d,o)=>{v(o[d]).selectAll("rect").data([n]).join(c=>{const u=c.append("rect");return u.transition().duration(g).ease(K(l)).tween("tween",(P,C,D)=>w=>{const T=P.width*w;u.attr("x",0).attr("y",0).attr("width",I=>T).attr("height",I=>I.height)}),u},c=>c.attr("x",0).attr("y",0).attr("width",u=>u.width).attr("height",u=>u.height),c=>c.remove())})}const De=(r,{selection:a,computedData$:g,computedLayoutData$:l,visibleComputedData$:n,visibleComputedLayoutData$:d,seriesLabels$:o,SeriesDataMap$:c,GroupDataMap$:u,fullParams$:P,fullDataFormatter$:C,fullChartParams$:D,gridAxesTransform$:w,gridGraphicTransform$:T,gridAxesSize$:I,gridHighlight$:j,gridContainerPosition$:$,allContainerPosition$:z,layout$:O,event$:G})=>{const b=new V,F=Z(r,"clipPath-box"),B=te(r,"path"),{seriesSelection$:le,axesSelection$:ce,defsSelection$:H,graphicGSelection$:A}=ie({selection:a,pluginName:r,clipPathID:F,seriesLabels$:o,gridContainerPosition$:$,gridAxesTransform$:w,gridGraphicTransform$:T}),U=new ee(e=>{const p=P.pipe(m(b)).subscribe(i=>{if(!i)return;const s=oe(i.lineCurve);e.next(s)});return()=>{p.unsubscribe()}}),W=D.pipe(f(e=>e.transitionDuration),E()),N=D.pipe(f(e=>e.transitionEase),E());M({defsSelection:H,seriesLabels:o,axisSize:I,transitionDuration:W,transitionEase:N}).pipe(m(b),y(async e=>e)).subscribe(e=>{const i=[{id:F,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(s=>({id:`orbcharts__clipPath_${s}`,width:e.axisSize.width,height:e.axisSize.height})));pe({defsSelection:e.defsSelection,clipPathData:i,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const X=g.pipe(f(e=>{const p=new Map;return e.flat().forEach(i=>p.set(i.id,i)),p})),Y=re({fullDataFormatter$:C,gridAxesSize$:I,computedData$:g,fullChartParams$:D,gridContainerPosition$:z,layout$:O}),q=D.pipe(m(b),f(e=>e.highlightTarget),E()),J=M({graphicGSelection:A,visibleComputedLayoutData:d,linePath:U,params:P}).pipe(m(b),y(async e=>e),f(e=>{let p=[];return e.graphicGSelection.each((i,s,h)=>{const S=ae(e.visibleComputedLayoutData[s]??[]);p[s]=ne({selection:v(h[s]),pathClassName:B,linePath:e.linePath,segmentData:S,params:e.params})}),p}));return M({pathSelectionArr:J,computedData:g,SeriesDataMap:c,GroupDataMap:u,highlightTarget:q,gridGroupPositionFn:Y}).pipe(m(b),y(async e=>e)).subscribe(e=>{e.pathSelectionArr.forEach(p=>{p.on("mouseover",(i,s)=>{i.stopPropagation();const h=s[0]?s[0].seriesLabel:"",{groupIndex:S,groupLabel:L}=e.gridGroupPositionFn(i),t=e.GroupDataMap.get(L).find(x=>x.seriesLabel===h)??s[0];G.next({type:"grid",eventName:"mouseover",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:i,data:e.computedData})}).on("mousemove",(i,s)=>{i.stopPropagation();const h=s[0]?s[0].seriesLabel:"",{groupIndex:S,groupLabel:L}=e.gridGroupPositionFn(i),t=e.GroupDataMap.get(L).find(x=>x.seriesLabel===h)??s[0];G.next({type:"grid",eventName:"mousemove",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:i,data:e.computedData})}).on("mouseout",(i,s)=>{i.stopPropagation();const h=s[0]?s[0].seriesLabel:"",{groupIndex:S,groupLabel:L}=e.gridGroupPositionFn(i),t=e.GroupDataMap.get(L).find(x=>x.seriesLabel===h)??s[0];G.next({type:"grid",eventName:"mouseout",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:i,data:e.computedData})}).on("click",(i,s)=>{i.stopPropagation();const h=s[0]?s[0].seriesLabel:"",{groupIndex:S,groupLabel:L}=e.gridGroupPositionFn(i),t=e.GroupDataMap.get(L).find(x=>x.seriesLabel===h)??s[0];G.next({type:"grid",eventName:"click",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:i,data:e.computedData})})})}),D.pipe(m(b),se(e=>e.highlightTarget==="series"),y(e=>M({graphicGSelection:A,gridHighlight:j,DataMap:X,fullChartParams:D}).pipe(m(b),y(async p=>p)))).subscribe(e=>{const p=e.gridHighlight[0]?e.gridHighlight[0].seriesLabel:null;ge({selection:e.graphicGSelection,seriesLabel:p,fullChartParams:e.fullChartParams})}),()=>{b.next(void 0)}};export{De as c};
