import{ar as P,by as ie,ax as re,av as le,bz as oe,aA as C,aC as v,aB as I,aF as z,ay as se,br as ue,aE as ce,bL as G,aI as q,aJ as me,az as d,aK as xe,aL as pe,bA as fe,aM as ye,bM as De,bN as _,bO as ge,bP as he,bQ as de,bR as be,bS as ve,bT as $e,bU as Ae,C as Z,a as E,t as B,m as b,X as Me,aO as Se,Y as Xe,aq as Ye,b as Y,k as M,l as A,d as R,s as w,aT as Ce,bV as J,bf as Ie,bW as Ve,g as L,bd as H,bo as Fe,bX as Le,bc as Te,bp as Oe}from"./DthhAFdh.js";import{c as T,d as ke}from"./BHI5Q38u.js";import{c as Re}from"./DutSHzz9.js";import{c as Pe}from"./Dk-w_uFh.js";const Be=r=>{const n=P(r,{visibleFilter:{toBeTypes:["Function"]},container:{toBeTypes:["object"]},categoryLabels:{toBeTypes:["string[]"]},valueLabels:{toBeTypes:["string[]"]},xAxis:{toBeTypes:["object"]},yAxis:{toBeTypes:["object"]},separateCategory:{toBeTypes:["boolean"]}});if(n.status==="error")return n;if(r.yAxis){const a=P(r.yAxis,{scaleDomain:{toBe:'[number | "min" | "auto", number | "max" | "auto"]',test:e=>Array.isArray(e)&&e.length===2&&(typeof e[0]=="number"||e[0]==="min"||e[0]==="auto")&&(typeof e[1]=="number"||e[1]==="max"||e[1]==="auto")},scaleRange:{toBe:"[number, number]",test:e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"},label:{toBeTypes:["string"]},valueIndex:{toBeTypes:["number"]}});if(a.status==="error")return a}if(r.xAxis){const a=P(r.xAxis,{scaleDomain:{toBe:'[number | "min" | "auto", number | "max" | "auto"]',test:e=>Array.isArray(e)&&e.length===2&&(typeof e[0]=="number"||e[0]==="min"||e[0]==="auto")&&(typeof e[1]=="number"||e[1]==="max"||e[1]==="auto")},scaleRange:{toBe:"[number, number]",test:e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"},label:{toBeTypes:["string"]},valueIndex:{toBeTypes:["number"]}});if(a.status==="error")return a}if(r.container){const a=P(r.container,{gap:{toBeTypes:["number"]},rowAmount:{toBeTypes:["number"]},columnAmount:{toBeTypes:["number"]}});if(a.status==="error")return a}return n},we=r=>{const{data:n,dataFormatter:a,chartParams:e}=r;if(!n.length)return[];const t=oe();let o=[];try{const s=n.map((i,c)=>Array.isArray(i)?{id:"",label:"",description:"",data:{},categoryLabel:t,value:i}:ie(i)?{id:i.id??"",label:i.label??"",description:i.description??"",data:i.data??{},categoryLabel:i.categoryLabel??t,value:i.value}:{id:"",label:"",description:"",data:{},categoryLabel:t,value:[]}),u=(()=>{const i=new Set(a.categoryLabels);for(let c of s){const x=c.categoryLabel??t;i.add(x)}return Array.from(i)})(),l=new Map(u.map((i,c)=>[i,c]));let m=0;s.forEach((i,c)=>{const x=m;m++;const p=re(a.type,c),D=l.get(i.categoryLabel)??0,f=le(D,e),g={id:i.id?i.id:p,index:x,label:i.label?i.label:p,description:i.description??"",data:i.data,datumIndex:c,value:i.value,categoryIndex:D,categoryLabel:i.categoryLabel,xValueIndex:a.xAxis.valueIndex,yValueIndex:a.yAxis.valueIndex,visible:!0,color:f,_visibleValue:i.value};g.visible=a.visibleFilter(g,r),o[D]||(o[D]=[]),o[D].push(g)})}catch(s){throw Error(s)}return o},He=r=>P({data:r},{data:{toBe:"(DataMultiValueDatum | DataMultiValueValue[])[]",test:a=>Array.isArray(a)}}),ze=({computedData$:r,xyValueIndex$:n})=>C({computedData:r,xyValueIndex:n}).pipe(v(a=>{const e=a.computedData.flat(),[t,o]=G(e.map(l=>l.value[a.xyValueIndex[0]])),[s,u]=G(e.map(l=>l.value[a.xyValueIndex[1]]));return{minX:t,maxX:o,minY:s,maxY:u}})),_e=({computedData$:r,xyMinMax$:n,xyValueIndex$:a,fullDataFormatter$:e,layout$:t})=>{function o(u,l){let m=u.maxX,i=u.minX;return i===m&&m===0&&(m=1),T({maxValue:m,minValue:i,axisWidth:l.width,scaleDomain:["auto","auto"],scaleRange:[0,1]})}function s(u,l){let m=u.maxY,i=u.minY;return i===m&&m===0&&(m=1),T({maxValue:m,minValue:i,axisWidth:l.height,scaleDomain:["auto","auto"],scaleRange:[0,1],reverse:!0})}return C({computedData:r,xyMinMax:n,xyValueIndex:a,fullDataFormatter:e,layout:t}).pipe(I(async u=>u),v(u=>{const l=o(u.xyMinMax,u.layout),m=s(u.xyMinMax,u.layout);return u.computedData.map((i,c)=>i.map((x,p)=>({...x,axisX:l(x.value[u.xyValueIndex[0]]??0),axisY:m(x.value[u.xyValueIndex[1]]??0)})))}))},Ee=({computedData$:r,fullDataFormatter$:n})=>r.pipe(v(a=>a.map(e=>e[0]?e[0].categoryLabel:"")),z((a,e)=>JSON.stringify(a).length===JSON.stringify(e).length)),We=({computedData$:r})=>r.pipe(v(n=>n.map(a=>a.filter(e=>e.visible==!0)).filter(a=>a.length>0))),je=({visibleComputedData$:r})=>r.pipe(v(n=>n.map(a=>a.map(e=>{let t=e;return t.sum=t.value.reduce((o,s)=>o+s,0),t})))),Ue=({xyValueIndex$:r,isCategorySeprate$:n,visibleComputedData$:a})=>C({isCategorySeprate:n,xyValueIndex:r,visibleComputedData:a}).pipe(I(async e=>e),v(e=>{const t=e.xyValueIndex[0];return e.isCategorySeprate?e.visibleComputedData.map(o=>o.sort((s,u)=>{const l=u.value[t]??-1/0,m=s.value[t]??-1/0;return l-m})):[e.visibleComputedData.flat().sort((o,s)=>{const u=s.value[t]??-1/0,l=o.value[t]??-1/0;return u-l})]})),Ne=({isCategorySeprate$:r,visibleComputedSumData$:n})=>C({isCategorySeprate:r,visibleComputedSumData:n}).pipe(I(async a=>a),v(a=>a.isCategorySeprate?a.visibleComputedSumData.map(e=>e.sort((t,o)=>o.sum-t.sum)):[a.visibleComputedSumData.flat().sort((e,t)=>t.sum-e.sum)])),Ge=({computedXYData$:r})=>r.pipe(v(n=>n.map(a=>a.filter(e=>e.visible==!0)).filter(a=>a.length>0))),qe=({computedData$:r,fullDataFormatter$:n,layout$:a})=>C({computedData:r,fullDataFormatter:n,layout:a}).pipe(I(async t=>t),v(t=>{if(t.fullDataFormatter.separateCategory)return q(t.layout,t.fullDataFormatter.container,t.computedData.length);{const o=q(t.layout,t.fullDataFormatter.container,1);return t.computedData.map((s,u)=>o[0])}})),Je=({visibleComputedXYData$:r,xyMinMax$:n,xyValueIndex$:a,fullDataFormatter$:e})=>C({visibleComputedXYData:r,xyMinMax:n,xyValueIndex:a,fullDataFormatter:e}).pipe(v(t=>{const{minX:o,maxX:s,minY:u,maxY:l}=(()=>{let{minX:D,maxX:f,minY:g,maxY:h}=t.xyMinMax;return t.fullDataFormatter.xAxis.scaleDomain[0]==="auto"&&D>0?D=0:typeof t.fullDataFormatter.xAxis.scaleDomain[0]=="number"&&(D=t.fullDataFormatter.xAxis.scaleDomain[0]),t.fullDataFormatter.xAxis.scaleDomain[1]==="auto"&&f<0?f=0:typeof t.fullDataFormatter.xAxis.scaleDomain[1]=="number"&&(f=t.fullDataFormatter.xAxis.scaleDomain[1]),t.fullDataFormatter.yAxis.scaleDomain[0]==="auto"&&g>0?g=0:typeof t.fullDataFormatter.yAxis.scaleDomain[0]=="number"&&(g=t.fullDataFormatter.yAxis.scaleDomain[0]),t.fullDataFormatter.yAxis.scaleDomain[1]==="auto"&&h<0?h=0:typeof t.fullDataFormatter.yAxis.scaleDomain[1]=="number"&&(h=t.fullDataFormatter.yAxis.scaleDomain[1]),{minX:D,maxX:f,minY:g,maxY:h}})();let m=[],i=null,c=null,x=null,p=null;for(let D of t.visibleComputedXYData)for(let f of D){const g=f.value[t.xyValueIndex[0]],h=f.value[t.xyValueIndex[1]];g>=o&&g<=s&&h>=u&&h<=l&&(m.push(f),(i==null||g<i.value[t.xyValueIndex[0]])&&(i=f),(c==null||g>c.value[t.xyValueIndex[0]])&&(c=f),(x==null||h<x.value[t.xyValueIndex[1]])&&(x=f),(p==null||h>p.value[t.xyValueIndex[1]])&&(p=f))}return{datumList:m,minXDatum:i,maxXDatum:c,minYDatum:x,maxYDatum:p}})),Ke=({xyMinMax$:r,xyValueIndex$:n,filteredXYMinMaxData$:a,fullDataFormatter$:e,layout$:t})=>{const o=new se;function s({xyMinMax:u,xyValueIndex:l,filteredXYMinMaxData:m,xAxis:i,yAxis:c,width:x,height:p}){let D=0,f=0,g=0,h=0,{minX:y,maxX:$,minY:O,maxY:S}=u,V=m.minXDatum.value[l[0]]??0,k=m.maxXDatum.value[l[0]]??0,X=m.minYDatum.value[l[1]]??0,F=m.maxYDatum.value[l[1]]??0;V===k&&k===0&&(k=1),X===F&&F===0&&(F=1),y===$&&$===0&&($=1),O===S&&S===0&&(S=1);const W=T({maxValue:k,minValue:V,axisWidth:x,scaleDomain:i.scaleDomain,scaleRange:i.scaleRange}),j=W(y>0?0:y),ae=W($<0?0:$);D=j,g=(ae-j)/x;const U=T({maxValue:F,minValue:X,axisWidth:p,scaleDomain:c.scaleDomain,scaleRange:c.scaleRange,reverse:!0}),ne=U(O>0?0:O),N=U(S<0?0:S);return f=N,h=(ne-N)/p,{translate:[D,f],scale:[g,h],rotate:0,rotateX:0,rotateY:0,value:`translate(${D}px, ${f}px) scale(${g}, ${h})`}}return new ue(u=>(C({xyMinMax:r,xyValueIndex:n,filteredXYMinMaxData:a,fullDataFormatter:e,layout:t}).pipe(ce(o),I(async l=>l)).subscribe(l=>{if(!l.filteredXYMinMaxData.minXDatum||!l.filteredXYMinMaxData.maxXDatum||l.filteredXYMinMaxData.minXDatum.value[l.xyValueIndex[0]]==null||l.filteredXYMinMaxData.maxXDatum.value[l.xyValueIndex[0]]==null||!l.filteredXYMinMaxData.minYDatum||!l.filteredXYMinMaxData.maxYDatum||l.filteredXYMinMaxData.minYDatum.value[l.xyValueIndex[1]]==null||l.filteredXYMinMaxData.maxYDatum.value[l.xyValueIndex[1]]==null)return;const m=s({xyMinMax:l.xyMinMax,xyValueIndex:l.xyValueIndex,filteredXYMinMaxData:l.filteredXYMinMaxData,xAxis:l.fullDataFormatter.xAxis,yAxis:l.fullDataFormatter.yAxis,width:l.layout.width,height:l.layout.height});u.next(m)}),function(){o.next(void 0)}))},Qe=({containerPosition$:r,graphicTransform$:n})=>C({containerPosition:r,graphicTransform:n}).pipe(I(async a=>a),v(a=>a.containerPosition.map((e,t)=>[1/a.graphicTransform.scale[0]/a.containerPosition[t].scale[0],1/a.graphicTransform.scale[1]/a.containerPosition[t].scale[1]]))),Ze=({visibleComputedSumData$:r,fullDataFormatter$:n,filteredXYMinMaxData$:a,containerSize$:e})=>C({visibleComputedSumData:r,fullDataFormatter:n,containerSize:e,filteredXYMinMaxData:a}).pipe(I(async t=>t),v(t=>{const o=t.fullDataFormatter.xAxis.valueIndex;if(!t.filteredXYMinMaxData.minXDatum||!t.filteredXYMinMaxData.maxXDatum)return;let s=t.filteredXYMinMaxData.maxXDatum.value[o],u=t.filteredXYMinMaxData.minXDatum.value[o];return s===u&&s===0&&(s=1),T({maxValue:s,minValue:u,axisWidth:t.containerSize.width,scaleDomain:t.fullDataFormatter.xAxis.scaleDomain,scaleRange:t.fullDataFormatter.xAxis.scaleRange})})),et=({fullDataFormatter$:r,filteredXYMinMaxData$:n,containerSize$:a})=>C({fullDataFormatter:r,containerSize:a,filteredXYMinMaxData:n}).pipe(I(async e=>e),v(e=>{const t=e.fullDataFormatter.xAxis.valueIndex;if(!e.filteredXYMinMaxData.minXDatum||!e.filteredXYMinMaxData.maxXDatum)return;let o=e.filteredXYMinMaxData.maxXDatum.value[t],s=e.filteredXYMinMaxData.minXDatum.value[t];return o===s&&o===0&&(o=1),T({maxValue:o,minValue:s,axisWidth:e.containerSize.width,scaleDomain:e.fullDataFormatter.xAxis.scaleDomain,scaleRange:e.fullDataFormatter.xAxis.scaleRange})})),tt=({fullDataFormatter$:r,filteredXYMinMaxData$:n,containerSize$:a})=>C({fullDataFormatter:r,containerSize:a,filteredXYMinMaxData:n}).pipe(I(async e=>e),v(e=>{const t=e.fullDataFormatter.yAxis.valueIndex;if(!e.filteredXYMinMaxData.minYDatum||!e.filteredXYMinMaxData.maxYDatum||e.filteredXYMinMaxData.minYDatum.value[t]==null||e.filteredXYMinMaxData.maxYDatum.value[t]==null)return;let o=e.filteredXYMinMaxData.maxYDatum.value[t],s=e.filteredXYMinMaxData.minYDatum.value[t];return o===s&&o===0&&(o=1),T({maxValue:o,minValue:s,axisWidth:e.containerSize.height,scaleDomain:e.fullDataFormatter.yAxis.scaleDomain,scaleRange:e.fullDataFormatter.yAxis.scaleRange,reverse:!0})})),at=({subject:r,observer:n})=>{const a=me(n.fullChartParams$).pipe(d(1)),e=n.fullDataFormatter$.pipe(v(X=>X.separateCategory),z(),d(1)),t=qe({computedData$:n.computedData$,fullDataFormatter$:n.fullDataFormatter$,layout$:n.layout$}).pipe(d(1)),o=xe({layout$:n.layout$,containerPosition$:t}).pipe(d(1)),s=n.fullDataFormatter$.pipe(v(X=>[X.xAxis.valueIndex,X.yAxis.valueIndex]),z((X,F)=>X[0]===F[0]&&X[1]===F[1]),d(1)),u=n.computedData$.pipe(v(X=>X.flat().flat())).pipe(d(1)),l=pe({datumList$:u,fullChartParams$:n.fullChartParams$,event$:r.event$}).pipe(d(1)),m=Ee({computedData$:n.computedData$,fullDataFormatter$:n.fullDataFormatter$}).pipe(d(1)),i=fe({datumList$:u}).pipe(d(1)),c=ze({computedData$:n.computedData$,xyValueIndex$:s}).pipe(d(1)),x=We({computedData$:n.computedData$}).pipe(d(1)),p=je({visibleComputedData$:x}).pipe(d(1)),D=Ue({xyValueIndex$:s,isCategorySeprate$:e,visibleComputedData$:x}).pipe(d(1)),f=Ne({isCategorySeprate$:e,visibleComputedSumData$:p}).pipe(d(1)),g=_e({computedData$:n.computedData$,xyMinMax$:c,xyValueIndex$:s,fullDataFormatter$:n.fullDataFormatter$,layout$:n.layout$}).pipe(d(1)),h=Ge({computedXYData$:g}).pipe(d(1)),y=Je({visibleComputedXYData$:h,xyMinMax$:c,xyValueIndex$:s,fullDataFormatter$:n.fullDataFormatter$}).pipe(d(1)),$=Ke({xyMinMax$:c,xyValueIndex$:s,filteredXYMinMaxData$:y,fullDataFormatter$:n.fullDataFormatter$,layout$:n.layout$}).pipe(d(1)),O=Qe({containerPosition$:t,graphicTransform$:$}).pipe(d(1)),S=Ze({visibleComputedSumData$:p,fullDataFormatter$:n.fullDataFormatter$,filteredXYMinMaxData$:y,containerSize$:o}).pipe(d(1)),V=et({fullDataFormatter$:n.fullDataFormatter$,filteredXYMinMaxData$:y,containerSize$:o}).pipe(d(1)),k=tt({fullDataFormatter$:n.fullDataFormatter$,filteredXYMinMaxData$:y,containerSize$:o}).pipe(d(1));return{fullParams$:n.fullParams$,fullChartParams$:n.fullChartParams$,fullDataFormatter$:n.fullDataFormatter$,computedData$:n.computedData$,layout$:n.layout$,textSizePx$:a,isCategorySeprate$:e,containerPosition$:t,containerSize$:o,highlight$:l,categoryLabels$:m,CategoryDataMap$:i,xyMinMax$:c,xyValueIndex$:s,visibleComputedData$:x,visibleComputedSumData$:p,visibleComputedRankingByIndexData$:D,visibleComputedRankingBySumData$:f,visibleComputedXYData$:h,filteredXYMinMaxData$:y,graphicTransform$:$,graphicReverseScale$:O,xScale$:S,xSumScale$:V,yScale$:k}};class Mt extends ye{constructor(n,a){super({defaultDataFormatter:De,dataFormatterValidator:Be,computedDataFn:we,dataValidator:He,contextObserverCallback:at},n,a)}}var nt=function(r){_(n,r);function n(a,e){return r.call(this)||this}return n.prototype.schedule=function(a,e){return this},n}(ge),K={setInterval:function(r,n){for(var a=[],e=2;e<arguments.length;e++)a[e-2]=arguments[e];return setInterval.apply(void 0,he([r,n],de(a)))},clearInterval:function(r){return clearInterval(r)},delegate:void 0},it=function(r){_(n,r);function n(a,e){var t=r.call(this,a,e)||this;return t.scheduler=a,t.work=e,t.pending=!1,t}return n.prototype.schedule=function(a,e){var t;if(e===void 0&&(e=0),this.closed)return this;this.state=a;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,e)),this.pending=!0,this.delay=e,this.id=(t=this.id)!==null&&t!==void 0?t:this.requestAsyncId(s,this.id,e),this},n.prototype.requestAsyncId=function(a,e,t){return t===void 0&&(t=0),K.setInterval(a.flush.bind(a,this),t)},n.prototype.recycleAsyncId=function(a,e,t){if(t===void 0&&(t=0),t!=null&&this.delay===t&&this.pending===!1)return e;e!=null&&K.clearInterval(e)},n.prototype.execute=function(a,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var t=this._execute(a,e);if(t)return t;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(a,e){var t=!1,o;try{this.work(a)}catch(s){t=!0,o=s||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),o},n.prototype.unsubscribe=function(){if(!this.closed){var a=this,e=a.id,t=a.scheduler,o=t.actions;this.work=this.state=this.scheduler=null,this.pending=!1,be(o,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},n}(nt),Q=function(){function r(n,a){a===void 0&&(a=r.now),this.schedulerActionCtor=n,this.now=a}return r.prototype.schedule=function(n,a,e){return a===void 0&&(a=0),new this.schedulerActionCtor(this,n).schedule(e,a)},r.now=ve.now,r}(),rt=function(r){_(n,r);function n(a,e){e===void 0&&(e=Q.now);var t=r.call(this,a,e)||this;return t.actions=[],t._active=!1,t}return n.prototype.flush=function(a){var e=this.actions;if(this._active){e.push(a);return}var t;this._active=!0;do if(t=a.execute(a.state,a.delay))break;while(a=e.shift());if(this._active=!1,t){for(;a=e.shift();)a.unsubscribe();throw t}},n}(Q),lt=new rt(it);function ot(r,n){return n===void 0&&(n=lt),$e(function(a,e){var t=null,o=null,s=null,u=function(){if(t){t.unsubscribe(),t=null;var m=o;o=null,e.next(m)}};function l(){var m=s+r,i=n.now();if(i<m){t=this.schedule(void 0,m-i),e.add(t);return}u()}a.subscribe(Ae(e,function(m){o=m,s=n.now(),t||(t=n.schedule(l,r),e.add(t))},function(){u(),e.complete()},void 0,function(){o=t=null}))})}const ee="MultiValueLegend",st={name:ee,defaultParams:Me,layerIndex:Se,validator:(r,{validateColumns:n})=>n(r,{placement:{toBe:'"top" | "top-start" | "top-end" | "bottom" | "bottom-start" | "bottom-end" | "left" | "left-start" | "left-end" | "right" | "right-start" | "right-end"',test:e=>["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"].includes(e)},padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},St=Z(st)(({selection:r,rootSelection:n,observer:a,subject:e})=>{const t=new E,o=a.CategoryDataMap$.pipe(B(t),b(l=>Array.from(l.keys()))),s=a.fullParams$.pipe(B(t),b(l=>{const m=[{listRectWidth:l.listRectWidth,listRectHeight:l.listRectHeight,listRectRadius:l.listRectRadius}];return{...l,labelList:m}})),u=Re(ee,{rootSelection:n,legendLabels$:o,fullParams$:s,layout$:a.layout$,fullChartParams$:a.fullChartParams$,textSizePx$:a.textSizePx$});return()=>{t.next(void 0),u()}}),te="MultiValueTooltip",ut={name:te,defaultParams:Xe,layerIndex:Ye,validator:(r,{validateColumns:n})=>n(r,{backgroundColorType:{toBeOption:"ColorType"},backgroundOpacity:{toBeTypes:["number"]},strokeColorType:{toBeOption:"ColorType"},offset:{toBe:"[number, number]",test:e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"},padding:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"},renderFn:{toBeTypes:["Function"]}})},Xt=Z(ut)(({selection:r,rootSelection:n,name:a,subject:e,observer:t})=>{const o=new E,s=Pe(te,{rootSelection:n,fullParams$:t.fullParams$,fullChartParams$:t.fullChartParams$,layout$:t.layout$,event$:e.event$});return()=>{o.next(void 0),s()}}),Yt=({selection:r,pluginName:n,clipPathID:a,categoryLabels$:e,containerPosition$:t,graphicTransform$:o})=>{const s=L(n,"category"),u=L(n,"axes"),l=L(n,"graphic"),m=e.pipe(b((p,D)=>r.selectAll(`g.${s}`).data(p,f=>f).join(f=>f.append("g").classed(s,!0).each((g,h,y)=>{w(y[h]).selectAll(`g.${u}`).data([h]).join($=>$.append("g").classed(u,!0).attr("clip-path",`url(#${a})`).each((O,S,V)=>{w(V[S]).selectAll("defs").data([S]).join("defs"),w(V[S]).selectAll("g").data([S]).join("g").classed(l,!0)}),$=>$,$=>$.remove())}),f=>f,f=>f.remove())),Y(1));M({categorySelection:m,containerPosition:t}).pipe(A(async p=>p)).subscribe(p=>{p.categorySelection.transition().attr("transform",(D,f)=>{const g=p.containerPosition[f]??p.containerPosition[0],h=g.translate,y=g.scale;return`translate(${h[0]}, ${h[1]}) scale(${y[0]}, ${y[1]})`})});const i=m.pipe(b(p=>p.select(`g.${u}`)),Y(1)),c=i.pipe(b(p=>p.select("defs")),Y(1)),x=M({axesSelection:i,graphicTransform:o}).pipe(A(async p=>p),b(p=>{const D=p.axesSelection.select(`g.${l}`);return D.transition().duration(50).style("transform",p.graphicTransform.value),D}),Y(1));return{categorySelection$:m,axesSelection$:i,defsSelection$:c,graphicGSelection$:x}},ct=({selection:r,pluginName:n,clipPathID:a,computedData$:e,containerPosition$:t,isCategorySeprate$:o})=>{const s=L(n,"container"),u=M({computedData:e.pipe(R((l,m)=>l.length===m.length)),isCategorySeprate:o}).pipe(A(async l=>l),b(l=>l.isCategorySeprate?l.computedData:[l.computedData[0]]),b((l,m)=>r.selectAll(`g.${s}`).data(l,i=>i[0]?i[0].categoryIndex:m).join("g").classed(s,!0).attr("clip-path",i=>a?`url(#${a})`:"none")),Y(1));return M({containerSelection:u,gridContainerPosition:t}).pipe(A(async l=>l)).subscribe(l=>{l.containerSelection.attr("transform",(m,i)=>{const c=l.gridContainerPosition[i]??l.gridContainerPosition[0],x=c.translate;return c.scale,`translate(${x[0]}, ${x[1]})`})}),u},Ct=({rootSelection:r,fullDataFormatter$:n,filteredXYMinMaxData$:a,containerPosition$:e,layout$:t})=>{const o=ke(r,"mousemove").pipe(ot(2)),s=e.pipe(b(i=>i.reduce((x,p)=>p.columnIndex>x?p.columnIndex:x,0)+1),R(),Y(1)),u=e.pipe(b(i=>i.reduce((x,p)=>p.rowIndex>x?p.rowIndex:x,0)+1),R(),Y(1)),l=new Ce(i=>{M({layout:t,filteredXYMinMaxData:a,fullDataFormatter:n,columnAmount:s,rowAmount:u}).pipe(A(async c=>c)).subscribe(c=>{const x=c.fullDataFormatter.xAxis.valueIndex,p=c.fullDataFormatter.yAxis.valueIndex;if(!c.filteredXYMinMaxData.minXDatum||!c.filteredXYMinMaxData.maxXDatum||c.filteredXYMinMaxData.minXDatum.value[x]==null||c.filteredXYMinMaxData.maxXDatum.value[x]==null||!c.filteredXYMinMaxData.minYDatum||!c.filteredXYMinMaxData.maxYDatum||c.filteredXYMinMaxData.minYDatum.value[p]==null||c.filteredXYMinMaxData.maxYDatum.value[p]==null)return;const D=J({maxValue:c.filteredXYMinMaxData.maxXDatum.value[x],minValue:c.filteredXYMinMaxData.minXDatum.value[x],axisWidth:c.layout.width,scaleDomain:c.fullDataFormatter.xAxis.scaleDomain,scaleRange:c.fullDataFormatter.xAxis.scaleRange}),f=J({maxValue:c.filteredXYMinMaxData.maxYDatum.value[p],minValue:c.filteredXYMinMaxData.minYDatum.value[p],axisWidth:c.layout.height,scaleDomain:c.fullDataFormatter.yAxis.scaleDomain,scaleRange:c.fullDataFormatter.yAxis.scaleRange,reverse:!0});i.next({xScale:D,yScale:f})})}),m=M({fullDataFormatter:n,rootMousemove:o,columnAmount:s,rowAmount:u,layout:t,containerPosition:e}).pipe(A(async i=>i),b(i=>({x:(i.rootMousemove.offsetX-i.layout.left)/i.containerPosition[0].scale[0]%(i.layout.rootWidth/i.columnAmount/i.containerPosition[0].scale[0]),y:(i.rootMousemove.offsetY-i.layout.top)/i.containerPosition[0].scale[1]%(i.layout.rootHeight/i.rowAmount/i.containerPosition[0].scale[1])})));return M({xyScale:l,axisValue:m}).pipe(A(async i=>i),b(i=>({x:i.axisValue.x,y:i.axisValue.y,xValue:i.xyScale.xScale(i.axisValue.x),yValue:i.xyScale.yScale(i.axisValue.y)})))},It=({containerSize$:r,visibleComputedData$:n,textSizePx$:a,rankingAmount$:e})=>{const t=({textSizePx$:i})=>i.pipe(b(c=>c*2),Y(1)),o=({minLineHeight$:i,containerSize$:c})=>M({minLineHeight:i,containerSize:c}).pipe(A(async x=>x),b(x=>x.containerSize.height>x.minLineHeight?x.containerSize.height:x.minLineHeight),R(),Y(1)),s=({minLineHeight$:i,containerHeight$:c})=>M({minLineHeight:i,containerHeight:c}).pipe(A(async x=>x),b(x=>Math.floor(x.containerHeight/x.minLineHeight)),R(),Y(1)),u=t({textSizePx$:a}),l=o({minLineHeight$:u,containerSize$:r}),m=s({containerHeight$:l,minLineHeight$:u});return e.pipe(A(i=>Ie(()=>i==="auto",M({visibleComputedData:n,rankingAmountLimit:m}).pipe(A(async c=>c),b(c=>{const x=c.visibleComputedData.map(p=>Math.min(c.rankingAmountLimit,p.length));return Math.max(...x)})),e)))},Vt=({containerSize$:r,textSizePx$:n,computedRankingAmount$:a})=>{const e=({textSizePx$:u})=>u.pipe(b(l=>l*2),Y(1)),t=({minLineHeight$:u,containerSize$:l})=>M({minLineHeight:u,containerSize:l}).pipe(A(async m=>m),b(m=>m.containerSize.height>m.minLineHeight?m.containerSize.height:m.minLineHeight),R(),Y(1)),o=e({textSizePx$:n}),s=t({minLineHeight$:o,containerSize$:r});return M({containerHeight:s,computedRankingAmount:a}).pipe(A(async u=>u),b(u=>u.containerHeight/u.computedRankingAmount))},Ft=({visibleComputedRankingData$:r,rankingItemHeight$:n})=>M({visibleComputedRankingData:r,rankingItemHeight:n}).pipe(A(async a=>a),b(a=>a.visibleComputedRankingData.map((e,t)=>{const o=e.length,s=a.rankingItemHeight*o;return Ve({axisLabels:e.map(u=>u.label),axisWidth:s,padding:.5})}))),mt=6,xt="middle",pt="hanging",ft="start",yt="hanging";function Dt({selection:r,position:n,xLabelClassName:a,fullParams:e,containerSize:t,fullDataFormatter:o,fullChartParams:s}){let l=e.tickPadding+e.labelOffset[0],m,i;n==="top"?(m=0,i=-e.tickPadding-e.labelOffset[1]):(m=t.height,i=e.tickPadding+e.labelOffset[1]);let c=i;r.selectAll(`g.${a}`).data([e]).join("g").classed(a,!0).each((x,p,D)=>{w(D[p]).selectAll("text").data([x]).join(f=>f.append("text").style("font-weight","bold"),f=>f,f=>f.remove()).attr("text-anchor",ft).attr("dominant-baseline",yt).attr("font-size",s.styles.textSize).style("fill",H(e.labelColorType,s)).attr("x",l).attr("y",c).text(f=>o.xAxis.label)}).attr("transform",x=>`translate(${t.width}, ${m})`)}function gt({selection:r,position:n,xAxisClassName:a,fullParams:e,containerSize:t,fullChartParams:o,xScale:s,transitionDuration:u}){let l,m;n==="top"?(l=0,m=Fe(s)):(l=t.height,m=Le(s));const i=r.selectAll(`g.${a}`).data([e]).join("g").classed(a,!0).attr("transform",`translate(0, ${l})`);let c=e.tickPadding;const x=m.scale(s).ticks(e.ticks).tickFormat(f=>Te(f,e.tickFormat)).tickSize(e.tickFullLine==!0?-t.height:mt).tickSizeOuter(-t.height).tickPadding(c),p=i.transition().duration(u).ease(Oe).call(x);return p.selectAll("line").style("fill","none").style("stroke",e.tickLineVisible==!0?H(e.tickColorType,o):"none").style("stroke-dasharray",e.tickFullLineDasharray).attr("pointer-events","none"),p.selectAll("path").style("fill","none").style("stroke",e.axisLineVisible==!0?H(e.axisLineColorType,o):"none").style("shape-rendering","crispEdges"),i.selectAll("text").attr("font-size",o.styles.textSize).style("color",H(e.tickTextColorType,o)).attr("text-anchor",xt).attr("dominant-baseline",pt).attr("dy",0),i}const Lt=(r,{selection:n,position$:a,computedData$:e,fullParams$:t,fullDataFormatter$:o,fullChartParams$:s,isCategorySeprate$:u,containerPosition$:l,containerSize$:m,xScale$:i,transitionDuration$:c})=>{const x=new E,p=L(r,"xAxisG"),D=L(r,"xAxis"),f=L(r,"xLabel"),h=ct({selection:n,pluginName:r,clipPathID:null,computedData$:e,containerPosition$:l,isCategorySeprate$:u}).pipe(B(x)).pipe(B(x),b((y,$)=>y.selectAll(`g.${p}`).data([p]).join("g").classed(p,!0)));return M({axisSelection:h,position:a,fullParams:t,computedData:e,containerSize:m,fullDataFormatter:o,fullChartParams:s,xScale:i,transitionDuration:c}).pipe(B(x),A(async y=>y)).subscribe(y=>{gt({selection:y.axisSelection,position:y.position,xAxisClassName:D,fullParams:y.fullParams,containerSize:y.containerSize,fullChartParams:y.fullChartParams,xScale:y.xScale,transitionDuration:y.transitionDuration}),Dt({selection:y.axisSelection,position:y.position,xLabelClassName:f,fullParams:y.fullParams,containerSize:y.containerSize,fullDataFormatter:y.fullDataFormatter,fullChartParams:y.fullChartParams})}),()=>{x.next(void 0)}};export{St as M,Xt as a,Mt as b,Lt as c,Ct as d,ct as e,It as f,Ft as g,Yt as m,Vt as r};
