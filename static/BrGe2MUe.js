import{ad as E,S as x,t as m,s as S,m as $,Y as D,ae as b,b as C,k as d,l as A}from"./Dh2HIxf9.js";import{g as N}from"./2zdWaanV.js";import{s as F}from"./CUoRVxLn.js";const h="PieEventTexts",P=N(h,"text"),L={name:h,defaultParams:D,layerIndex:b,validator:(i,{validateColumns:s})=>s(i,{eventFn:{toBeTypes:["Function"]},textAttrs:{toBeTypes:["object[]"]},textStyles:{toBeTypes:["object[]"]}})};function f(i,s){const t=i.selectAll(`text.${P}`).data(s),o=t.enter().append("text").classed(P,!0),r=t.merge(o);return r.each((e,l,c)=>{const n=S(c[l]).text(e.text);Object.keys(e.attr).forEach(a=>{n.attr(a,e.attr[a])}),Object.keys(e.style).forEach(a=>{n.style(a,e.style[a])})}),t.exit().remove(),r}function g({eventData:i,eventName:s,t,eventFn:o,textAttrs:r,textStyles:e}){return o(i,s,t).map((c,n)=>({text:c,attr:r[n],style:e[n]}))}function M(i,s){const t=new x;let o;const r=s.fullChartParams$.pipe(m(t),$(e=>e.highlightTarget),C());return d({computedData:s.computedData$,fullParams:s.fullParams$,fullChartParams:s.fullChartParams$,highlightTarget:r}).pipe(m(t),A(async e=>e)).subscribe(e=>{s.containerSelection.transition("move").duration(e.fullChartParams.transitionDuration).tween("move",(l,c)=>n=>{const a=g({eventData:{type:"series",pluginName:i,eventName:"transitionMove",event:l,highlightTarget:e.highlightTarget,data:e.computedData,series:[],seriesIndex:-1,seriesLabel:"",datum:null},eventName:"transitionMove",t:n,eventFn:e.fullParams.eventFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles});f(s.containerSelection,a)}).on("end",(l,c)=>{const n=g({eventData:{type:"series",pluginName:i,eventName:"transitionEnd",event:l,highlightTarget:e.highlightTarget,data:e.computedData,series:[],seriesIndex:-1,seriesLabel:"",datum:null},eventName:"transitionMove",t:1,eventFn:e.fullParams.eventFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles});f(s.containerSelection,n),o&&o.unsubscribe(),o=s.event$.subscribe(a=>{const p=g({eventData:a,eventName:a.eventName,t:1,eventFn:e.fullParams.eventFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles});f(s.containerSelection,p)})})}),()=>{t.next(void 0)}}const w=E(L)(({selection:i,name:s,observer:t,subject:o})=>{const r=new x,{seriesCenterSelection$:e}=F({selection:i,pluginName:h,separateSeries$:t.separateSeries$,seriesLabels$:t.seriesLabels$,seriesContainerPosition$:t.seriesContainerPosition$}),l=[];return e.pipe(m(r)).subscribe(c=>{l.forEach(n=>n()),c.each((n,a,p)=>{const v=S(p[a]),y=t.computedLayoutData$.pipe(m(r),$(u=>u[a]??u[0])),T=t.seriesContainerPosition$.pipe(m(r),$(u=>u[a]??u[0]));l[a]=M(h,{containerSelection:v,computedData$:t.computedData$,containerComputedLayoutData$:y,SeriesDataMap$:t.SeriesDataMap$,fullParams$:t.fullParams$,fullChartParams$:t.fullChartParams$,seriesHighlight$:t.seriesHighlight$,seriesContainerPosition$:T,event$:o.event$})})}),()=>{r.next(void 0),l.forEach(c=>c())}});export{w as P};
