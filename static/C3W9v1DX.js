import{S as V,t as m,m as y,h as v,o as T,p as b,s as U,_ as ge,b as X,E as pe,w as ce,X as de,y as me,i as he,ax as xe}from"./PGufJ0Z3.js";import{c as ee,d as $e,e as De,f as fe,g as j,h as J,i as Se,j as Ae}from"./C1EDXMJI.js";import{l as se,m as ye,n as te,o as Le}from"./CbUy5BQ6.js";import{f as Pe}from"./BPJ4d9ab.js";import{c as Te}from"./LI2X7NA5.js";import{c as Ge}from"./CKUmkpVv.js";function Ie(r="curveLinear",n){return De().x(t=>t.axisX).y0(t=>n).y1(t=>t.axisY).curve(fe[r])}function Ce(r){let n=[[]],t=0;for(let s in r){if(r[s].visible==!1||r[s].value===void 0||r[s].value===null){n[t].length&&(t++,n[t]=[]);continue}n[t].push(r[s])}return n}function be({selection:r,pathClassName:n,segmentData:t,areaPath:s,linearGradientIds:a,params:l}){return r.selectAll("path").data(t,(o,x)=>o.length?`${o[0].id}_${o[o.length-1].id}`:x).join(o=>o.append("path").classed(n,!0).attr("fill","none").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),o=>o,o=>o.remove()).attr("fill",(o,x)=>o[0]?`url(#${a[o[0].seriesIndex]})`:"").attr("d",o=>s(o))}function Me({selection:r,seriesLabel:n,fullChartParams:t}){if(r.interrupt("highlight"),!n){r.transition("highlight").duration(200).style("opacity",1);return}r.each((s,a,l)=>{s===n?U(l[a]).style("opacity",1):U(l[a]).style("opacity",t.styles.unhighlightedOpacity)})}function Re({defsSelection:r,computedData:n,linearGradientIds:t,params:s}){r.selectAll("linearGradient").data(n??[]).join(a=>a.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),a=>a,a=>a.remove()).attr("id",(a,l)=>a[0]?t[a[0].seriesIndex]:"").html((a,l)=>{const h=a[0]?a[0].color:"";return`
        <stop offset="0%"   stop-color="${h}" stop-opacity="${s.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${h}" stop-opacity="${s.linearGradientOpacity[1]}"/>
      `})}function we({defsSelection:r,clipPathData:n,transitionDuration:t,transitionEase:s}){r.selectAll("clipPath").data(n).join(a=>a.append("clipPath"),a=>a,a=>a.remove()).attr("id",a=>a.id).each((a,l,h)=>{U(h[l]).selectAll("rect").data([a]).join(o=>{const x=o.append("rect");return x.transition().duration(t).ease($e(s)).tween("tween",(g,k,$)=>G=>{const M=g.width*G;x.attr("x",0).attr("y",0).attr("width",S=>M).attr("height",S=>S.height)}),x},o=>o.attr("x",0).attr("y",0).attr("width",x=>x.width).attr("height",x=>x.height),o=>o.remove())})}const Fe=(r,{selection:n,computedData$:t,computedLayoutData$:s,visibleComputedData$:a,visibleComputedLayoutData$:l,seriesLabels$:h,SeriesDataMap$:o,GroupDataMap$:x,fullParams$:g,fullDataFormatter$:k,fullChartParams$:$,gridAxesTransform$:G,gridGraphicTransform$:M,gridAxesSize$:S,gridHighlight$:I,gridContainerPosition$:L,layout$:z,event$:w})=>{const D=new V,N=ee(r,"clipPath-box"),F=j(r,"path"),{seriesSelection$:i,axesSelection$:P,defsSelection$:c,graphicGSelection$:A}=se({selection:n,pluginName:r,clipPathID:N,seriesLabels$:h,gridContainerPosition$:L,gridAxesTransform$:G,gridGraphicTransform$:M}),B=M.pipe(m(D),y(e=>-e.translate[1]/e.scale[1])),Y=new ge(e=>{const f=T({fullParams:g,valueAxisStart:B}).pipe(m(D)).subscribe(d=>{const p=Ie(d.fullParams.lineCurve,d.valueAxisStart);e.next(p)});return()=>{f.unsubscribe()}}),Z=$.pipe(y(e=>e.transitionDuration),v()),C=$.pipe(y(e=>e.transitionEase),v());T({defsSelection:c,seriesLabels:h,axisSize:S,transitionDuration:Z,transitionEase:C}).pipe(m(D),b(async e=>e)).subscribe(e=>{const d=[{id:N,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(p=>({id:`orbcharts__clipPath_${p}`,width:e.axisSize.width,height:e.axisSize.height})));we({defsSelection:e.defsSelection,clipPathData:d,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const O=t.pipe(y(e=>{const f=new Map;return e.flat().forEach(d=>f.set(d.id,d)),f})),oe=ye({fullDataFormatter$:k,gridAxesSize$:S,computedData$:t,fullChartParams$:$,gridContainerPosition$:L,layout$:z}),ne=$.pipe(m(D),y(e=>e.highlightTarget),v()),le=h.pipe(m(D),y(e=>e.map((f,d)=>ee(r,`lineargradient-${f}`)))),ue=T({graphicGSelection:A,defsSelection:c,visibleComputedLayoutData:l,linearGradientIds:le,areaPath:Y,params:g}).pipe(m(D),b(async e=>e),y(e=>{let f=[];return e.graphicGSelection.each((d,p,R)=>{const H=Ce(e.visibleComputedLayoutData[p]??[]);f[p]=be({selection:U(R[p]),pathClassName:F,areaPath:e.areaPath,segmentData:H,linearGradientIds:e.linearGradientIds,params:e.params}),Re({defsSelection:e.defsSelection,computedData:e.visibleComputedLayoutData,linearGradientIds:e.linearGradientIds,params:e.params})}),f}));return T({pathSelectionArr:ue,computedData:t,SeriesDataMap:o,GroupDataMap:x,highlightTarget:ne,gridGroupPositionFn:oe}).pipe(m(D),b(async e=>e)).subscribe(e=>{e.pathSelectionArr.forEach(f=>{f.on("mouseover",(d,p)=>{const R=p[0]?p[0].seriesLabel:"",{groupIndex:H,groupLabel:_}=e.gridGroupPositionFn(d),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??p[0];w.next({type:"grid",eventName:"mouseover",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:e.computedData})}).on("mousemove",(d,p)=>{const R=p[0]?p[0].seriesLabel:"",{groupIndex:H,groupLabel:_}=e.gridGroupPositionFn(d),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??p[0];w.next({type:"grid",eventName:"mousemove",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:e.computedData})}).on("mouseout",(d,p)=>{const R=p[0]?p[0].seriesLabel:"",{groupIndex:H,groupLabel:_}=e.gridGroupPositionFn(d),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??p[0];w.next({type:"grid",eventName:"mouseout",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:e.computedData})}).on("click",(d,p)=>{const R=p[0]?p[0].seriesLabel:"",{groupIndex:H,groupLabel:_}=e.gridGroupPositionFn(d),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??p[0];w.next({type:"grid",eventName:"click",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:e.computedData})})})}),$.pipe(m(D),Pe(e=>e.highlightTarget==="series"),b(e=>T({graphicGSelection:A,gridHighlight:I,DataMap:O,fullChartParams:$}).pipe(m(D),b(async f=>f)))).subscribe(e=>{const f=e.gridHighlight[0]?e.gridHighlight[0].seriesLabel:null;Me({selection:e.graphicGSelection,seriesLabel:f,fullChartParams:e.fullChartParams})}),()=>{D.next(void 0)}},ae="LineAreas",Xe=X(ae,pe)(({selection:r,name:n,observer:t,subject:s})=>{const a=new V,l=Fe(ae,{selection:r,computedData$:t.computedData$,visibleComputedData$:t.visibleComputedData$,computedLayoutData$:t.computedLayoutData$,visibleComputedLayoutData$:t.visibleComputedLayoutData$,seriesLabels$:t.seriesLabels$,SeriesDataMap$:t.SeriesDataMap$,GroupDataMap$:t.GroupDataMap$,fullParams$:t.fullParams$,fullDataFormatter$:t.fullDataFormatter$,fullChartParams$:t.fullChartParams$,gridAxesTransform$:t.gridAxesTransform$,gridGraphicTransform$:t.gridGraphicTransform$,gridAxesSize$:t.gridAxesSize$,gridHighlight$:t.gridHighlight$,gridContainerPosition$:t.gridContainerPosition$,allContainerPosition$:t.gridContainerPosition$,layout$:t.layout$,event$:s.event$});return()=>{a.next(void 0),l()}}),ie="Dots",je=X(ie,ce)(({selection:r,name:n,subject:t,observer:s})=>{const a=new V,l=Te(ie,{selection:r,computedData$:s.computedData$,computedLayoutData$:s.computedLayoutData$,visibleComputedData$:s.visibleComputedData$,visibleComputedLayoutData$:s.visibleComputedLayoutData$,seriesLabels$:s.seriesLabels$,SeriesDataMap$:s.SeriesDataMap$,GroupDataMap$:s.GroupDataMap$,fullParams$:s.fullParams$,fullChartParams$:s.fullChartParams$,gridAxesTransform$:s.gridAxesTransform$,gridGraphicTransform$:s.gridGraphicTransform$,gridGraphicReverseScale$:s.gridGraphicReverseScale$,gridAxesSize$:s.gridAxesSize$,gridHighlight$:s.gridHighlight$,gridContainerPosition$:s.gridContainerPosition$,event$:t.event$});return()=>{a.next(void 0),l()}}),re="ValueStackAxis",Ye=X(re,de)(({selection:r,name:n,observer:t,subject:s})=>{const a=new V,l=Ge(re,{selection:r,computedData$:t.computedStackedData$,fullParams$:t.fullParams$,fullDataFormatter$:t.fullDataFormatter$,fullChartParams$:t.fullChartParams$,gridAxesTransform$:t.gridAxesTransform$,gridAxesReverseTransform$:t.gridAxesReverseTransform$,gridAxesSize$:t.gridAxesSize$,gridContainerPosition$:t.gridContainerPosition$,isSeriesSeprate$:t.isSeriesSeprate$});return()=>{a.next(void 0),l()}}),W="GroupAux",Q=j(W,"label-box");function ze({groupLabel:r,axisX:n,axisHeight:t,fullParams:s}){return s.showLine&&r?[{id:r,x1:n,x2:n,y1:0,y2:t}]:[]}function _e({selection:r,pluginName:n,lineData:t,fullParams:s,fullChartParams:a}){const l=j(n,"auxline"),h=r.selectAll(`line.${l}`).data(t),o=h.enter().append("line").classed(l,!0).style("stroke",g=>J(s.lineColorType,a)).style("stroke-width",1).style("stroke-dasharray",s.lineDashArray??"none").style("pointer-events","none"),x=h.merge(o);return h.exit().remove(),o.attr("x1",g=>g.x1).attr("y1",g=>g.y1).attr("x2",g=>g.x2).attr("y2",g=>g.y2),h.transition().duration(50).attr("x1",g=>g.x1).attr("y1",g=>g.y1).attr("x2",g=>g.x2).attr("y2",g=>g.y2),x}function Ee(r){r.selectAll("line").data([]).exit().remove()}function ve({groupLabel:r,axisX:n,fullParams:t}){return t.showLabel&&r?[{id:r,x:n,y:-t.labelPadding,text:Se(r,t.labelTextFormat)}]:[]}function ke({selection:r,labelData:n,fullParams:t,fullDataFormatter:s,fullChartParams:a,textReverseTransformWithRotate:l,textSizePx:h}){const o=h+6,x=r.selectAll(`g.${Q}`).data(n),g=x.enter().append("g").classed(Q,!0).style("cursor","pointer"),k=g.merge(x);return g.attr("transform",($,G)=>`translate(${$.x}, ${$.y})`),x.transition().duration(50).attr("transform",($,G)=>`translate(${$.x}, ${$.y})`),x.exit().remove(),k.each(($,G,M)=>{const S=Ae($.text,h)+12;let I=-S/2,L=-2;s.grid.groupAxis.position==="bottom"?(I=t.labelRotate?-S+o:-S/2,L=2):s.grid.groupAxis.position==="left"?(I=-S+2,L=-o/2):s.grid.groupAxis.position==="right"?(I=-2,L=-o/2):s.grid.groupAxis.position==="top"&&(I=t.labelRotate?-S+o:-S/2,L=-o+2);const z=U(M[G]).selectAll("rect").data([$]),w=z.enter().append("rect").attr("height",`${o}px`).attr("fill",F=>J(t.labelColorType,a)).attr("x",I).attr("y",L-2).attr("rx",5).attr("ry",5).style("cursor","pointer");z.merge(w).attr("width",F=>`${S}px`).style("transform",l),z.exit().remove();const D=U(M[G]).selectAll("text").data([$]),N=D.enter().append("text").style("dominant-baseline","hanging").style("cursor","pointer");D.merge(N).text(F=>F.text).style("transform",l).attr("fill",F=>J(t.labelTextColorType,a)).attr("font-size",a.styles.textSize).attr("x",I+6).attr("y",L),D.exit().remove()}),k}function Ne(r){r.selectAll(`g.${Q}`).data([]).exit().remove()}const Ke=X(W,me)(({selection:r,rootSelection:n,name:t,subject:s,observer:a})=>{const l=new V;let h=!1;const o=n.insert("rect","g").classed(j(W,"rect"),!0).attr("opacity",0),{seriesSelection$:x,axesSelection$:g,defsSelection$:k,graphicGSelection$:$}=se({selection:r,pluginName:W,clipPathID:"test",seriesLabels$:a.seriesLabels$,gridContainerPosition$:a.gridContainerPosition$,gridAxesTransform$:a.gridAxesTransform$,gridGraphicTransform$:a.gridGraphicTransform$});a.layout$.pipe(m(l)).subscribe(i=>{o.attr("width",i.rootWidth).attr("height",i.rootHeight)});const G=T({fullDataFormatter:a.fullDataFormatter$,gridAxesSize:a.gridAxesSize$,computedData:a.computedData$}).pipe(m(l),b(async i=>i),y(i=>{const c=i.computedData[0]?i.computedData[0].length-1:0,A=i.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-i.fullDataFormatter.grid.groupAxis.scalePadding:i.fullDataFormatter.grid.groupAxis.scaleDomain[0]-i.fullDataFormatter.grid.groupAxis.scalePadding,B=i.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?c+i.fullDataFormatter.grid.groupAxis.scalePadding:i.fullDataFormatter.grid.groupAxis.scaleDomain[1]+i.fullDataFormatter.grid.groupAxis.scalePadding;return[A,B]}),he(1)),M=T({groupScaleDomain:G,gridAxesSize:a.gridAxesSize$}).pipe(m(l),b(async i=>i),y(i=>xe().domain(i.groupScaleDomain).range([0,i.gridAxesSize.width]))),S=a.fullChartParams$.pipe(m(l),y(i=>i.highlightTarget),v()),I=te(n,"mousemove").pipe(m(l)),L=T({gridAxesReverseTransform:a.gridAxesReverseTransform$,gridContainerPosition:a.gridContainerPosition$}).pipe(m(l),b(async i=>i),y(i=>{const P=`rotateX(${i.gridAxesReverseTransform.rotateX}deg) rotateY(${i.gridAxesReverseTransform.rotateY}deg)`,c=`rotate(${i.gridAxesReverseTransform.rotate}deg)`,A=`scale(${1/i.gridContainerPosition[0].scale[0]}, ${1/i.gridContainerPosition[0].scale[1]})`;return`${P} ${c} ${A}`}),v()),z=T({textReverseTransform:L,fullParams:a.fullParams$}).pipe(m(l),b(async i=>i),y(i=>`${i.textReverseTransform} rotate(${i.fullParams.labelRotate}deg)`)),w=a.gridContainerPosition$.pipe(m(l),y(i=>i.reduce((c,A)=>A.columnIndex>c?A.columnIndex:c,0)+1),v()),D=a.gridContainerPosition$.pipe(m(l),y(i=>i.reduce((c,A)=>A.rowIndex>c?A.rowIndex:c,0)+1),v()),N=Le({rootSelection:n,fullDataFormatter$:a.fullDataFormatter$,gridAxesSize$:a.gridAxesSize$,computedData$:a.computedData$,fullChartParams$:a.fullChartParams$,gridContainerPosition$:a.gridContainerPosition$,layout$:a.layout$}).pipe(m(l));T({axesSelection:g,columnAmount:w,rowAmount:D,layout:a.layout$,rootMousemove:I,gridGroupPosition:N,computedData:a.computedData$,groupScale:M,gridAxesSize:a.gridAxesSize$,fullParams:a.fullParams$,fullDataFormatter:a.fullDataFormatter$,fullChartParams:a.fullChartParams$,highlightTarget:S,textReverseTransformWithRotate:z,GroupDataMap:a.GroupDataMap$,textSizePx:a.textSizePx$}).subscribe(i=>{const{groupIndex:P,groupLabel:c}=i.gridGroupPosition,A=i.groupScale(P)??0,B=ze({groupLabel:c,axisX:A,axisHeight:i.gridAxesSize.height,fullParams:i.fullParams});_e({selection:i.axesSelection,pluginName:t,lineData:B,fullParams:i.fullParams,fullChartParams:i.fullChartParams});const Y=ve({groupLabel:c,axisX:A,fullParams:i.fullParams});ke({selection:i.axesSelection,labelData:Y,fullParams:i.fullParams,fullDataFormatter:i.fullDataFormatter,fullChartParams:i.fullChartParams,textReverseTransformWithRotate:i.textReverseTransformWithRotate,textSizePx:i.textSizePx}).on("mouseover",(C,O)=>{C.stopPropagation(),h=!0,s.event$.next({type:"grid",pluginName:t,eventName:"mouseover",highlightTarget:i.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:i.GroupDataMap.get(c)??[],groupIndex:P,groupLabel:c,event:C,data:i.computedData})}).on("mousemove",(C,O)=>{C.stopPropagation(),s.event$.next({type:"grid",pluginName:t,eventName:"mousemove",highlightTarget:i.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:i.GroupDataMap.get(c)??[],groupIndex:P,groupLabel:c,event:C,data:i.computedData})}).on("click",(C,O)=>{C.stopPropagation(),s.event$.next({type:"grid",pluginName:t,eventName:"click",highlightTarget:i.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:i.GroupDataMap.get(c)??[],groupIndex:P,groupLabel:c,event:C,data:i.computedData})})});const F=te(o,"mouseout").pipe(m(l));return T({rootRectMouseout:F,axesSelection:g}).pipe(m(l),b(async i=>i)).subscribe(i=>{setTimeout(()=>{h!=!0&&(Ee(i.axesSelection),Ne(i.axesSelection))})}),()=>{l.next(void 0),o.remove()}});export{je as D,Ke as G,Xe as L,Ye as V,Fe as c};
