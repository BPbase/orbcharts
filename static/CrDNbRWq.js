import{a5 as F,h as S,j as I,m as x,a4 as M,a6 as Y,at as L,au as X,av as E,aw as H,S as G,t as m,e as C,s as P}from"./CjdleEie.js";import{g as T,u as W,v as N,c as k}from"./CzUzxl8i.js";import{f as w}from"./5rDUwiLZ.js";import{E as U}from"./Degl7Xeb.js";function V(t,r,n,a,o,l,s,h){var f=[],c=0,b=0,u=!1,v=function(){u&&!f.length&&!c&&r.complete()},p=function(g){return c<a?e(g):f.push(g)},e=function(g){c++;var d=!1;S(n(g,b++)).subscribe(F(r,function(y){r.next(y)},function(){d=!0},void 0,function(){if(d)try{c--;for(var y=function(){var $=f.shift();s||e($)};f.length&&c<a;)y();v()}catch($){r.error($)}}))};return t.subscribe(F(r,p,function(){u=!0,v()})),function(){}}function O(t,r,n){return n===void 0&&(n=1/0),I(r)?O(function(a,o){return x(function(l,s){return r(a,l,o,s)})(S(t(a,o)))},n):(typeof r=="number"&&(n=r),M(function(a,o){return V(a,o,t,n)}))}function q(t){return t===void 0&&(t=1/0),O(Y,t)}function z(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=L(t),a=X(t,1/0),o=t;return o.length?o.length===1?S(o[0]):q(a)(E(o,n)):U}const B={backgroundColorType:"background",strokeColorType:"primary",backgroundOpacity:.8,textColorType:"primary",offset:[20,5],padding:10,textRenderFn:t=>{if(t.highlightTarget==="datum"&&t.datum)return[`${t.datum.label}: ${t.datum.value}`];if(t.highlightTarget==="series"){const r=t.seriesLabel,n=t.series.map(o=>o.value),a=n.length>5?n.slice(0,5).join(",")+"...":n.join(",");return[r,a]}else if(t.highlightTarget==="group"){const r=t.groupLabel,n=t.series.map(o=>o.value),a=n.length>5?n.slice(0,5).join(",")+"...":n.join(",");return[r,a]}else if(t.highlightTarget==="category"){const r=t.categoryLabel,n=t.category.map(o=>o.value),a=n.length>5?n.slice(0,5).join(",")+"...":n.join(",");return[r,a]}return[]},svgRenderFn:null},j="Tooltip",R=T(j,"g"),J=T(j,"box");function K(t,r){const n=r.textSize*1.5;return t.filter(a=>a!="").map((a,o)=>{const l=o*n;return`<text font-size="${r.textSize}" fill="${r.textColor}" x="0" y="${l}" style="dominant-baseline:text-before-edge">${a}</text>`}).join()}function Q({rootSelection:t,pluginName:r,rootWidth:n,rootHeight:a,svgString:o,tooltipStyle:l,event:s}){t.interrupt("fadeout");const h=5,f=o?[o]:[],c=o?[l]:[],u=t.selectAll(`g.${R}`).data(f).join(i=>i.append("g").classed(R,!0).attr("pointer-events","none"),i=>i,i=>i.style("opacity",0).remove()).attr("transform",()=>`translate(${s.offsetX}, ${s.offsetY})`).selectAll(`g.${J}`).data(c).join(i=>i.append("g").classed(T(r,"box"),!0)),v=u.selectAll("rect").data(c).join(i=>i.append("rect").attr("rx",h).attr("ry",h)).attr("fill",i=>i.backgroundColor).attr("stroke",i=>i.strokeColor).attr("opacity",i=>i.backgroundOpacity),p=u.selectAll("g").data(f).join(i=>i.append("g").classed(T(r,"content"),!0).attr("transform",()=>`translate(${l.padding}, ${l.padding})`));f.length&&W(p,f[0]);const e=p!=null&&p.node()?N(p):{width:0,height:0};v.attr("width",e.width+l.padding*2).attr("height",e.height+l.padding*2);const g=u!=null&&u.node()?N(u):{width:0,height:0},d=n-g.width,y=a-g.height,$=s.offsetX+l.offset[0]>d?d-s.offsetX:l.offset[0],A=s.offsetY+l.offset[1]>y?y-s.offsetY:l.offset[1];u.attr("transform",i=>`translate(${$}, ${A})`),u.attr("transform",i=>`translate(${$}, ${A})`)}const re=H(j,B)(({selection:t,rootSelection:r,name:n,chartType:a,observer:o,subject:l})=>{const s=new G,h=l.event$.pipe(m(s),w(e=>e.eventName==="mouseover"||e.eventName==="mousemove")),f=l.event$.pipe(m(s),w(e=>e.eventName==="mouseout")),c=C({fullChartParams:o.fullChartParams$,fullParams:o.fullParams$}).pipe(m(s),P(async e=>e),x(e=>({backgroundColor:k(e.fullParams.backgroundColorType,e.fullChartParams),backgroundOpacity:e.fullParams.backgroundOpacity,strokeColor:k(e.fullParams.strokeColorType,e.fullChartParams),offset:e.fullParams.offset,padding:e.fullParams.padding,textSize:e.fullChartParams.styles.textSize,textColor:k(e.fullParams.textColorType,e.fullChartParams)}))),b=C({fullParams:o.fullParams$,tooltipStyle:c}).pipe(m(s),P(async e=>e),x(e=>e.fullParams.svgRenderFn?e.fullParams.svgRenderFn:g=>{const d=e.fullParams.textRenderFn(g);return K(d,e.tooltipStyle)})),u=C({event:h,contentRenderFn:b}).pipe(m(s),P(async e=>e),x(e=>e.contentRenderFn(e.event))),v=f.pipe(m(s),x(e=>"")),p=z(h,f).pipe(m(s),x(e=>e.event));return C({svgString:z(u,v),event:p,layout:o.layout$,tooltipStyle:c}).pipe(m(s),P(async e=>e)).subscribe(e=>{Q({rootSelection:r,pluginName:n,rootWidth:e.layout.rootWidth,rootHeight:e.layout.rootHeight,svgString:e.svgString,tooltipStyle:e.tooltipStyle,event:e.event})}),function(){s.next(void 0)}});export{re as T,z as a,O as m};
