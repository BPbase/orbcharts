import"./DimhisTc.js";import{T as j}from"./C1JpWaGB.js";import{a9 as z,aa as F,S as A,t as g,m,ab as B,c as C,b as D,d as H,s as x}from"./Bj-Bl9V3.js";import{T as U}from"./BpkNfDjM.js";import{c as q}from"./C6aT9cyB.js";import{r as O,s as W,t as v,h as _,g as E}from"./wVpfmAyl.js";import{o as G}from"./ZxgOq4P4.js";import J from"./J2xznaE4.js";import{e as K,f as Q,o as V,c as X}from"./D8ccWnmM.js";import"./CLcyYSDM.js";const M="TreeLegend",Y=z(M,F)(({selection:n,rootSelection:c,observer:l,subject:a})=>{const o=new A,s=l.CategoryDataMap$.pipe(g(o),m(t=>Array.from(t.keys()))),p=l.fullParams$.pipe(g(o),m(t=>{const i=[{listRectWidth:t.listRectWidth,listRectHeight:t.listRectHeight,listRectRadius:t.listRectRadius}];return{...t,seriesList:i}})),u=q(M,{rootSelection:c,seriesLabels$:s,fullParams$:p,layout$:l.layout$,fullChartParams$:l.fullChartParams$,textSizePx$:l.textSizePx$});return()=>{o.next(void 0),u()}}),h="TreeMap",w=E(h,"tree"),R=E(h,"tile");function Z({selection:n,treeData:c,fullParams:l,fullChartParams:a,textSizePx:o}){const s=o/2,p=o,u=n.selectAll(`g.${w}`).data(c,t=>t.data.id).join("g").attr("class",w);return u.attr("transform",t=>!t.x0||!t.y0?null:`translate(${t.x0},${t.y0})`).each((t,i,e)=>{const L=x(e[i]);L.selectAll(`rect.${R}`).data([t],r=>r.data.id).join("rect").attr("id",r=>r.data.id).attr("class",R).attr("cursor","pointer").attr("width",r=>r.x1-r.x0).attr("height",r=>r.y1-r.y0).attr("fill",r=>r.data.color).attr("data-name",r=>r.data.label).attr("data-category",r=>r.data.categoryLabel).attr("data-value",r=>r.data.value),L.selectAll("g").data([t]).join("g").each((r,I,N)=>{x(N[I]).selectAll("text").data([r]).join("text").text(y=>y.data.label).attr("dominant-baseline","hanging").attr("x",s).attr("y",s).attr("font-size",a.styles.textSize).each(function(y){const f=x(this),k=y.data.label.split(/\s+/).reverse();let $,d=[];const T=f.attr("x");let S=f.attr("y"),b=0,P=f.text(null).append("tspan").attr("cursor","pointer").attr("fill",_(l.labelColorType,a)).attr("font-size",a.styles.textSize).attr("x",T).attr("y",S);for(;$=k.pop();)d.push($),P.text(d.join(" ")),P.node().getComputedTextLength()>y.x1-y.x0-s&&(d.pop(),P.text(d.join(" ")),d=[$],b+=p,P=f.append("tspan").attr("cursor","pointer").attr("fill",_(l.labelColorType,a)).attr("font-size",a.styles.textSize).attr("x",T).attr("y",S).attr("dy",b+"px").text($))})})}),u}function tt({selection:n,ids:c,fullChartParams:l}){if(n.interrupt("highlight"),!c.length){n.transition("highlight").duration(200).style("opacity",1);return}n.each((a,o,s)=>{c.includes(a.data.id)?x(s[o]).style("opacity",1):x(s[o]).style("opacity",l.styles.unhighlightedOpacity)})}const at=z(h,B)(({selection:n,name:c,subject:l,observer:a})=>{const o=new A,s=C({layout:a.layout$,visibleComputedData:a.visibleComputedData$,fullParams:a.fullParams$,fullDataFormatter:a.fullDataFormatter$,fullChartParams:a.fullChartParams$}).pipe(g(o),D(async t=>t),m(t=>{const i=O().size([t.layout.width,t.layout.height]).paddingInner(t.fullParams.paddingInner).paddingOuter(t.fullParams.paddingOuter).round(!0).tile(W.ratio(t.fullParams.squarifyRatio)),e=v(t.visibleComputedData).sum(r=>r.value).sort(t.fullParams.sort);return i(e),e.leaves()})),p=C({selection:G(n),treeData:s,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,textSizePx:a.textSizePx$}).pipe(g(o),D(async t=>t),m(t=>Z({selection:n,treeData:t.treeData,fullParams:t.fullParams,fullChartParams:t.fullChartParams,textSizePx:t.textSizePx}))),u=a.fullChartParams$.pipe(g(o),m(t=>t.highlightTarget),H());return C({cellSelection:p,computedData:a.computedData$,treeData:s,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,highlightTarget:u,CategoryDataMap:a.CategoryDataMap$}).pipe(g(o),D(async t=>t)).subscribe(t=>{t.cellSelection.on("mouseover",(i,e)=>{i.stopPropagation(),l.event$.next({type:"tree",eventName:"mouseover",pluginName:h,highlightTarget:t.highlightTarget,datum:e.data,category:t.CategoryDataMap.get(e.data.categoryLabel),categoryIndex:e.data.categoryIndex,categoryLabel:e.data.categoryLabel,event:i,data:t.computedData})}).on("mousemove",(i,e)=>{i.stopPropagation(),l.event$.next({type:"tree",eventName:"mousemove",pluginName:h,highlightTarget:t.highlightTarget,datum:e.data,category:t.CategoryDataMap.get(e.data.categoryLabel),categoryIndex:e.data.categoryIndex,categoryLabel:e.data.categoryLabel,event:i,data:t.computedData})}).on("mouseout",(i,e)=>{i.stopPropagation(),l.event$.next({type:"tree",eventName:"mouseout",pluginName:h,highlightTarget:t.highlightTarget,datum:e.data,category:t.CategoryDataMap.get(e.data.categoryLabel),categoryIndex:e.data.categoryIndex,categoryLabel:e.data.categoryLabel,event:i,data:t.computedData})}).on("click",(i,e)=>{i.stopPropagation(),l.event$.next({type:"tree",eventName:"click",pluginName:h,highlightTarget:t.highlightTarget,datum:e.data,category:t.CategoryDataMap.get(e.data.categoryLabel),categoryIndex:e.data.categoryIndex,categoryLabel:e.data.categoryLabel,event:i,data:t.computedData})})}),C({cellSelection:p,highlight:a.treeHighlight$.pipe(m(t=>t.map(i=>i.id))),fullChartParams:a.fullChartParams$}).pipe(g(o),D(async t=>t)).subscribe(t=>{tt({selection:t.cellSelection,ids:t.highlight,fullChartParams:t.fullChartParams})}),()=>{o.next(void 0)}}),et={id:"chart",style:{width:"100%",height:"100%"}},mt=K({__name:"index",setup(n){return Q(()=>{const c=document.querySelector("#chart"),l=new j(c),a=new at,o=new Y,s=new U;l.plugins$.next([a,o,s]),o.params$.next({}),a.params$.next({}),l.chartParams$.next({highlightTarget:"category"}),l.data$.next(J)}),(c,l)=>(V(),X("div",et))}});export{mt as default};
