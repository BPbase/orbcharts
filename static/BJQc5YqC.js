import{at as k,az as re,aS as se,ax as ne,aE as v,aH as E,aC as H,aD as q,aT as le,aL as oe,aB as A,aN as ue,aI as ce,aO as he,aU as pe,ap as O,S as x,t as S,m as y,d as D,a as L,j as C,k as P,aV as ge,x as me,L as z,aW as de,s as T,aX as j,aY as G,aZ as fe,a_ as be,a$ as Se,b0 as $e,b1 as ye,b2 as Pe,r as B,b3 as Ce,b4 as De,b5 as xe,g as R,a2 as Te,ar as X,b6 as F,a1 as Ae,aq as K,b7 as ee,a9 as Le,b8 as ve,b9 as Re,ba as we,bb as te,a8 as Be,ab as Me,aQ as Ye}from"./CUAujy1K.js";import{o as Oe}from"./DXMUCJyL.js";import{c as Ne}from"./CiHcmOf_.js";const Xe=u=>{const e=k(u,{visibleFilter:{toBeTypes:["Function"]},sort:{toBeTypes:["Function","null"]},seriesLabels:{toBeTypes:["string[]"]},container:{toBeTypes:["object"]},separateSeries:{toBeTypes:["boolean"]},sumSeries:{toBeTypes:["boolean"]}});if(u.container){const a=k(u.container,{columnAmount:{toBeTypes:["number"]},rowAmount:{toBeTypes:["number"]},columnGap:{toBe:'"auto" | number',test:o=>o==="auto"||typeof o=="number"},rowGap:{toBe:'"auto" | number',test:o=>o==="auto"||typeof o=="number"}});if(a.status==="error")return a}return e},Fe=u=>{const{data:e=[],dataFormatter:a,chartParams:o}=u;if(!e.length)return[];let s=[];try{const i=(t,n,l,c)=>{const g=re(a.type,n,l),h=a.seriesLabels[n]||se("series",n),m=ne(n,o);return typeof t=="number"?{id:g,index:c,seq:0,label:g,description:"",data:{},value:t,seriesIndex:n,seriesLabel:h,color:m,visible:!0}:{id:t.id?t.id:g,index:c,seq:0,label:t.label?t.label:g,description:t.description,data:t.data??{},value:t.value,seriesIndex:n,seriesLabel:h,color:m,visible:!0}};s=e.map((t,n)=>Array.isArray(t)?t.map((l,c)=>i(l,n,c,s.length+c)):i(t,n,0,s.length)).flat().sort(a.sort??void 0).map((t,n)=>(t.seq=n,t)).map(t=>(t.visible=a.visibleFilter(t,u),t)).sort((t,n)=>t.index-n.index).reduce((t,n)=>(t[n.seriesIndex]||(t[n.seriesIndex]=[]),t[n.seriesIndex].push(n),t),[])}catch(i){throw Error(i)}return s},Ee=u=>k({data:u},{data:{toBe:"(DataSeriesDatum | DataSeriesValue)[][] | (DataSeriesDatum | DataSeriesValue)[]",test:a=>Array.isArray(a)}}),We=({computedData$:u})=>{const e=new Set;return u.pipe(v(a=>(a.forEach(o=>{o.forEach(s=>{e.add(s.label)})}),Array.from(e))))},ke=({fullDataFormatter$:u})=>u.pipe(v(e=>e.separateSeries),E()),Ie=({fullDataFormatter$:u})=>u.pipe(v(e=>e.separateLabel),E()),Ve=({fullDataFormatter$:u})=>u.pipe(v(e=>e.sumSeries),E()),_e=({computedData$:u})=>u.pipe(v(e=>e.filter(a=>a.length).map(a=>a[0].seriesLabel)),E((e,a)=>JSON.stringify(e)===JSON.stringify(a))),He=({computedData$:u})=>u.pipe(v(e=>e.map(a=>a.filter(o=>o.visible!=!1)))),qe=({computedData$:u,separateSeries$:e,separateLabel$:a,sumSeries$:o,datumLabels$:s})=>H({computedData:u,separateSeries:e,separateLabel:a,sumSeries:o,datumLabels:s}).pipe(q(async i=>i),v(i=>{const t=i.sumSeries==!0?i.computedData.map(c=>[c.reduce((g,h)=>g==null?h:(g.value=g.value+h.value,g),null)]):i.computedData,n=i.separateSeries==!0?t:[t.flat()],l=i.separateLabel==!0?(()=>{const c=i.datumLabels.reduce((g,h,m)=>(g[h]=m,g),{});return n.map(g=>g.reduce((h,m)=>{const r=c[m.label];return h[r]==null&&(h[r]=[]),h[r].push(m),h},[])).flat()})():n;return i.separateSeries==!0&&i.separateLabel==!0?l.sort((c,g)=>c[0].seq-g[0].seq):l.map(c=>c.sort((g,h)=>g.seq-h.seq))})),ze=({computedSortedData$:u,fullDataFormatter$:e,layout$:a})=>H({computedSortedData:u,fullDataFormatter:e,layout:a}).pipe(q(async s=>s),v(s=>{const i=s.computedSortedData.length;return le(s.layout,s.fullDataFormatter.container,i)})),je=({seriesContainerPosition$:u,computedSortedData$:e})=>H({seriesContainerPosition:u,computedSortedData:e}).pipe(q(async a=>a),v(a=>new Map(a.computedSortedData.map((o,s)=>o.map(i=>[i.id,a.seriesContainerPosition[s]])).flat()))),Ge=({subject:u,observer:e})=>{const a=oe(e.fullChartParams$).pipe(A(1)),o=We({computedData$:e.computedData$}).pipe(A(1)),s=ke({fullDataFormatter$:e.fullDataFormatter$}).pipe(A(1)),i=Ie({fullDataFormatter$:e.fullDataFormatter$}).pipe(A(1)),t=Ve({fullDataFormatter$:e.fullDataFormatter$}).pipe(A(1)),n=qe({computedData$:e.computedData$,separateSeries$:s,separateLabel$:i,sumSeries$:t,datumLabels$:o}).pipe(A(1)),l=He({computedData$:n}).pipe(A(1)),c=e.computedData$.pipe(v(b=>b.flat())).pipe(A(1)),g=ue({datumList$:c,fullChartParams$:e.fullChartParams$,event$:u.event$}).pipe(A(1)),h=_e({computedData$:e.computedData$}).pipe(A(1)),m=ce({datumList$:c}).pipe(A(1)),r=ze({computedSortedData$:n,fullDataFormatter$:e.fullDataFormatter$,layout$:e.layout$}).pipe(A(1)),p=je({seriesContainerPosition$:r,computedSortedData$:n}).pipe(A(1));return{fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,fullDataFormatter$:e.fullDataFormatter$,computedData$:e.computedData$,layout$:e.layout$,textSizePx$:a,visibleComputedSortedData$:l,separateSeries$:s,separateLabel$:i,sumSeries$:t,computedSortedData$:n,seriesHighlight$:g,seriesLabels$:h,SeriesDataMap$:m,seriesContainerPosition$:r,DatumContainerPositionMap$:p}};class Xt extends he{constructor(e,a){super({defaultDataFormatter:pe,dataFormatterValidator:Xe,computedDataFn:Fe,dataValidator:Ee,contextObserverCallback:Ge},e,a)}}const Je="Bubbles",J=12,Ue={name:Je,defaultParams:me,layerIndex:z,validator:(u,{validateColumns:e})=>{const a=e(u,{force:{toBeTypes:["object"]},bubbleLabel:{toBeTypes:["object"]},arcScaleType:{toBe:'"area" | "radius"',test:o=>o==="area"||o==="radius"}});if(u.force){const o=e(u.force,{velocityDecay:{toBeTypes:["number"]},collisionSpacing:{toBeTypes:["number"]},strength:{toBeTypes:["number"]}});if(o.status==="error")return o}if(u.bubbleLabel){const o=e(u.bubbleLabel,{labelFn:{toBeTypes:["Function"]},colorType:{toBeOption:"ColorType"},fillRate:{toBeTypes:["number"]},lineHeight:{toBeTypes:["number"]},maxLineLength:{toBeTypes:["number"]}});if(o.status==="error")return o}return a}};function Qe(u,e){return Se().velocityDecay(e.force.velocityDecay).force("collision",$e().radius(a=>a.r+e.force.collisionSpacing)).force("charge",ye().strength(a=>-Math.pow(a.r,2)*e.force.strength)).on("tick",()=>{u.attr("transform",a=>`translate(${a.x},${a.y})`)})}function Ze({selection:u,bubblesData:e,fullParams:a,fullChartParams:o}){const s=u.selectAll("g").data(e,i=>i.id).join(i=>{const t=i.append("g").attr("cursor","pointer").attr("font-size",J).style("fill","#ffffff").attr("text-anchor","middle");return t.append("circle").attr("class","node").attr("cx",0).attr("cy",0).attr("fill",n=>n.color),t.append("text").style("opacity",.8).attr("pointer-events","none"),t},i=>i,i=>i.remove()).attr("transform",i=>`translate(${i.x},${i.y})`);return s.select("circle").transition().duration(200).attr("r",i=>i.r).attr("fill",i=>i.color),s.each((i,t,n)=>{const l=T(n[t]),c=i.renderLabel;l.call(Pe,{text:c,radius:i.r*a.bubbleLabel.fillRate,lineHeight:J*a.bubbleLabel.lineHeight,isBreakAll:c.length<=a.bubbleLabel.maxLineLength?!1:a.bubbleLabel.wordBreakAll}),l.select("text").attr("fill",g=>B({datum:i,colorType:a.bubbleLabel.colorType,fullChartParams:o}))}),s}function Ke(u){return de().on("start",(e,a)=>{e.active||u.alpha(1).restart(),a.fx=a.x,a.fy=a.y}).on("drag",(e,a)=>{e.active||u.alphaTarget(0),a.fx=e.x,a.fy=e.y}).on("end",(e,a)=>{a.fx=null,a.fy=null,u.alpha(1).restart()})}function et({_simulation:u,fullParams:e,DatumContainerPositionMap:a}){u.force("x",Ce().strength(e.force.strength).x(o=>a.get(o.id).centerX)).force("y",De().strength(e.force.strength).y(o=>a.get(o.id).centerY))}function tt({bubblesSelection:u,highlightIds:e,fullChartParams:a}){if(u.interrupt("highlight"),!e.length){u.transition("highlight").style("opacity",1);return}u.each((o,s,i)=>{const t=T(i[s]);e.includes(o.id)?t.style("opacity",1).transition("highlight").ease(j).duration(500):t.style("opacity",a.styles.unhighlightedOpacity)})}const Ft=O(Ue)(({selection:u,name:e,observer:a,subject:o})=>{const s=new x;let i;const t=a.fullParams$.pipe(S(s),y(d=>d.arcScaleType),D(),L(1)),n=a.layout$.pipe(S(s),y(d=>Math.min(d.width,d.height)/2),D(),L(1)),l=a.visibleComputedSortedData$.pipe(S(s),y(d=>d.flat().reduce(($,f)=>$+f.value,0)),D(),L(1)),c=C({totalR:n,totalValue:l,scaleType:t}).pipe(S(s),P(async d=>d),y(d=>G().domain([0,d.totalValue]).range([0,d.totalR]).exponent(d.scaleType==="area"?.5:1)),L(1)),g=t.pipe(S(s),P(d=>fe(()=>d==="area",Oe(1),C({totalR:n,radiusScale:c,visibleComputedSortedData:a.visibleComputedSortedData$}).pipe(P(async $=>$),y($=>{const f=$.totalR*$.totalR*Math.PI;return Math.sqrt(f/be($.visibleComputedSortedData.flat(),w=>Math.PI*Math.pow($.radiusScale(w.value),2)))}))))),h=C({visibleComputedSortedData:a.visibleComputedSortedData$,radiusScale:c,scaleFactor:g}).pipe(S(s),P(async d=>d),y(d=>new Map(d.visibleComputedSortedData.flat().map(f=>[f.id,d.radiusScale(f.value??0)*d.scaleFactor*.9]))),L(1)),m=a.DatumContainerPositionMap$.pipe(S(s),y(d=>new Map(Array.from(d).map(([$,f])=>[$,{x:f.startX+f.width*Math.random(),y:f.startY+f.height*Math.random()}]))),ge(),L(1)),r=C({visibleComputedSortedData:a.visibleComputedSortedData$,DatumRMap:h,DatumInitXYMap:m,fullParams:a.fullParams$}).pipe(S(s),P(async d=>d),y(d=>d.visibleComputedSortedData.flat().map($=>{const f=$;if(f.x===void 0||f.y===void 0){const{x:w,y:N}=d.DatumInitXYMap.get(f.id);f.x=w,f.y=N}return f.r=d.DatumRMap.get(f.id),f._originR=f.r,f.renderLabel=d.fullParams.bubbleLabel.labelFn(f),f})),L(1)),p=a.fullChartParams$.pipe(S(s),y(d=>d.highlightTarget),D()),b=C({bubblesData:r,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,DatumContainerPositionMap:a.DatumContainerPositionMap$}).pipe(S(s),P(async d=>d),y(d=>{i&&i.stop();const $=Ze({selection:u,bubblesData:d.bubblesData,fullParams:d.fullParams,fullChartParams:d.fullChartParams});return i=Qe($,d.fullParams),i.nodes(d.bubblesData),et({_simulation:i,fullParams:d.fullParams,DatumContainerPositionMap:d.DatumContainerPositionMap}),i.alpha(1).restart(),$}),L(1));return C({bubblesSelection:b,computedData:a.computedData$,SeriesDataMap:a.SeriesDataMap$,highlightTarget:p}).pipe(S(s),P(async d=>d)).subscribe(d=>{d.bubblesSelection.on("mouseover",($,f)=>{o.event$.next({type:"series",eventName:"mouseover",pluginName:e,highlightTarget:d.highlightTarget,datum:f,series:d.SeriesDataMap.get(f.seriesLabel),seriesIndex:f.seriesIndex,seriesLabel:f.seriesLabel,event:$,data:d.computedData})}).on("mousemove",($,f)=>{o.event$.next({type:"series",eventName:"mousemove",pluginName:e,highlightTarget:d.highlightTarget,datum:f,series:d.SeriesDataMap.get(f.seriesLabel),seriesIndex:f.seriesIndex,seriesLabel:f.seriesLabel,event:$,data:d.computedData})}).on("mouseout",($,f)=>{o.event$.next({type:"series",eventName:"mouseout",pluginName:e,highlightTarget:d.highlightTarget,datum:f,series:d.SeriesDataMap.get(f.seriesLabel),seriesIndex:f.seriesIndex,seriesLabel:f.seriesLabel,event:$,data:d.computedData})}).on("click",($,f)=>{o.event$.next({type:"series",eventName:"click",pluginName:e,highlightTarget:d.highlightTarget,datum:f,series:d.SeriesDataMap.get(f.seriesLabel),seriesIndex:f.seriesIndex,seriesLabel:f.seriesLabel,event:$,data:d.computedData})}).call(Ke(i))}),C({bubblesSelection:b,highlight:a.seriesHighlight$.pipe(y(d=>d.map($=>$.id))),fullChartParams:a.fullChartParams$}).pipe(S(s),P(async d=>d)).subscribe(d=>{tt({bubblesSelection:d.bubblesSelection,highlightIds:d.highlight,fullChartParams:d.fullChartParams})}),()=>{s.next(void 0),i&&(i.stop(),i=void 0)}});function ie({data:u,startAngle:e,endAngle:a}){return xe().startAngle(e).endAngle(a).value(i=>i.value).sort((i,t)=>i.seq-t.seq)(u).map((i,t)=>{let n=i;return n.id=i.data.id,n})}function it({selection:u,pluginName:e,visibleComputedSortedData$:a}){const o=R(e,"series");return a.pipe(y(s=>s.map(i=>i[0]?`${i[0].seriesLabel}_${i[0].label}`:"")),D((s,i)=>JSON.stringify(s)===JSON.stringify(i)),y(s=>u.selectAll(`g.${o}`).data(s,i=>i).join(i=>i.append("g").classed(o,!0),i=>i,i=>i.remove())),L(1))}const W=({selection:u,pluginName:e,visibleComputedSortedData$:a,seriesContainerPosition$:o})=>{const s=it({selection:u,pluginName:e,visibleComputedSortedData$:a});return C({seriesCenterSelection:s,seriesContainerPosition:o}).pipe(P(async i=>i),D((i,t)=>i.seriesContainerPosition.length===t.seriesContainerPosition.length)).subscribe(i=>{i.seriesCenterSelection.attr("transform",(t,n)=>{const l=i.seriesContainerPosition[n]??i.seriesContainerPosition[0];return`translate(${l.centerX}, ${l.centerY})`})}),C({seriesCenterSelection:s,seriesContainerPosition:o}).pipe(P(async i=>i)).subscribe(i=>{i.seriesCenterSelection.transition().attr("transform",(t,n)=>{const l=i.seriesContainerPosition[n]??i.seriesContainerPosition[0];return`translate(${l.centerX}, ${l.centerY})`})}),{seriesCenterSelection$:s}},I="Pie",at={name:I,defaultParams:Te,layerIndex:z,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},innerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeTypes:["string"]},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]}})};function rt({enter:u,exit:e,data:a,lastTweenData:o,fullParams:s}){return!u.size()&&!e.size()?i=>{const t=a.map((n,l)=>{const c=o[l]??{startAngle:0,endAngle:0,value:0};return{...n,startAngle:n.startAngle*i+c.startAngle*(1-i),endAngle:n.endAngle*i+c.endAngle*(1-i),value:n.value*i+c.value*(1-i)}});return V(t,s.startAngle,s.endAngle,1)}:i=>V(a,s.startAngle,s.endAngle,i)}function V(u,e,a,o){return u.map((s,i)=>{const t=e+(s.startAngle-e)*o,n=t+(s.endAngle-s.startAngle)*o;return{...s,startAngle:t,endAngle:n}})}function U({selection:u,data:e,arc:a,pathClassName:o,fullParams:s,fullChartParams:i}){return u.selectAll("path").data(e,n=>n.id).join("path").classed(o,!0).style("cursor","pointer").attr("fill",(n,l)=>n.data.color).attr("stroke",(n,l)=>B({datum:n.data,colorType:s.strokeColorType,fullChartParams:i})).attr("stroke-width",s.strokeWidth).attr("d",(n,l)=>a(n))}function st({pathSelection:u,ids:e,fullChartParams:a,arc:o,arcHighlight:s}){if(u.interrupt("highlight"),!e.length){u.transition("highlight").style("opacity",1).attr("d",i=>o(i));return}u.each((i,t,n)=>{const l=T(n[t]);e.includes(i.data.id)?l.style("opacity",1).transition("highlight").ease(j).duration(500).attr("d",c=>s(c)):l.style("opacity",a.styles.unhighlightedOpacity).transition("highlight").attr("d",c=>o(c))})}function nt(u,e){const a=new x,o=R(u,"path");let s=[],i=[];const t=e.seriesContainerPosition$.pipe(S(a),y(m=>m.width<m.height?m.width:m.height),D()),n=new X(m=>{C({containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$}).pipe(S(a),P(async r=>r)).subscribe(r=>{const p=ie({data:r.containerVisibleComputedSortedData,startAngle:r.fullParams.startAngle,endAngle:r.fullParams.endAngle});m.next(p)})}),l=new X(m=>{C({shorterSideWith:t,fullParams:e.fullParams$}).pipe(S(a),P(async r=>r)).subscribe(r=>{const p=F({axisWidth:r.shorterSideWith,innerRadius:r.fullParams.innerRadius,outerRadius:r.fullParams.outerRadius,padAngle:r.fullParams.padAngle,cornerRadius:r.fullParams.cornerRadius});m.next(p)})}),c=new X(m=>{C({shorterSideWith:t,fullParams:e.fullParams$}).pipe(S(a),P(async r=>r)).subscribe(r=>{const p=F({axisWidth:r.shorterSideWith,innerRadius:r.fullParams.innerRadius,outerRadius:r.fullParams.outerRadiusWhileHighlight,padAngle:r.fullParams.padAngle,cornerRadius:r.fullParams.cornerRadius});m.next(p)})}),g=e.fullChartParams$.pipe(S(a),y(m=>m.highlightTarget),D()),h=new X(m=>{C({pieData:n,arc:l,computedData:e.computedData$,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,highlightTarget:g}).pipe(S(a),P(async r=>r)).subscribe(r=>{e.containerSelection.interrupt("graphicMove");const p=e.containerSelection.selectAll("path").data(r.pieData,f=>f.id),b=p.enter(),d=p.exit(),$=rt({enter:b,exit:d,data:r.pieData,lastTweenData:s,fullParams:r.fullParams});e.containerSelection.transition("graphicMove").duration(r.fullChartParams.transitionDuration).tween("move",(f,w)=>N=>{i=$(N),U({selection:e.containerSelection,data:i,arc:r.arc,pathClassName:o,fullParams:r.fullParams,fullChartParams:r.fullChartParams})}).on("end",(f,w)=>{i=V(r.pieData,r.fullParams.startAngle,r.fullParams.endAngle,1);const N=U({selection:e.containerSelection,data:i,arc:r.arc,pathClassName:o,fullParams:r.fullParams,fullChartParams:r.fullChartParams});m.next(N),s=Object.assign([],r.pieData),e.event$.next({type:"series",pluginName:u,eventName:"transitionEnd",event:void 0,highlightTarget:r.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:r.computedData})})})}).pipe(L(1));return C({pathSelection:h,SeriesDataMap:e.SeriesDataMap$,computedData:e.computedData$,highlightTarget:g}).pipe(S(a),P(async m=>m)).subscribe(m=>{m.pathSelection.on("mouseover",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"mouseover",pluginName:u,highlightTarget:m.highlightTarget,datum:p.data,series:m.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:m.computedData})}).on("mousemove",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"mousemove",pluginName:u,highlightTarget:m.highlightTarget,datum:p.data,series:m.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:m.computedData})}).on("mouseout",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"mouseout",pluginName:u,highlightTarget:m.highlightTarget,datum:p.data,series:m.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:m.computedData})}).on("click",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"click",pluginName:u,highlightTarget:m.highlightTarget,datum:p.data,series:m.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:m.computedData})})}),C({pathSelection:h,highlight:e.seriesHighlight$.pipe(y(m=>m.map(r=>r.id))),fullChartParams:e.fullChartParams$,arc:l,arcHighlight:c}).pipe(S(a),P(async m=>m)).subscribe(m=>{st({pathSelection:m.pathSelection,ids:m.highlight,fullChartParams:m.fullChartParams,arc:m.arc,arcHighlight:m.arcHighlight})}),()=>{a.next(void 0)}}const Et=O(at)(({selection:u,name:e,subject:a,observer:o})=>{const s=new x,{seriesCenterSelection$:i}=W({selection:u,pluginName:I,visibleComputedSortedData$:o.visibleComputedSortedData$,seriesContainerPosition$:o.seriesContainerPosition$}),t=[];return i.pipe(S(s)).subscribe(n=>{t.forEach(l=>l()),n.each((l,c,g)=>{const h=T(g[c]),m=o.visibleComputedSortedData$.pipe(S(s),y(p=>p[c]??p[0])),r=o.seriesContainerPosition$.pipe(S(s),y(p=>p[c]??p[0]));t[c]=nt(I,{containerSelection:h,computedData$:o.computedData$,containerVisibleComputedSortedData$:m,SeriesDataMap$:o.SeriesDataMap$,fullParams$:o.fullParams$,fullChartParams$:o.fullChartParams$,seriesHighlight$:o.seriesHighlight$,seriesContainerPosition$:r,event$:a.event$})})}),()=>{s.next(void 0),t.forEach(n=>n())}}),M="PieLabels",lt=R(M,"label-g"),ot=R(M,"line-g"),ut=R(M,"text"),Q=2,ct={name:M,defaultParams:Ae,layerIndex:K,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},labelCentroid:{toBeTypes:["number"]},labelFn:{toBeTypes:["Function"]},labelColorType:{toBeOption:"ColorType"}})};function ht({pieData:u,arc:e,arcMouseover:a,labelCentroid:o,lineStartCentroid:s,fullParams:i}){return u.map((t,n)=>{const[l,c]=e.centroid(t),[g,h]=a.centroid(t),m=i.labelFn(t.data);return{pieDatum:t,arcIndex:n,arcLabels:m.split(`
`),lineStartX:l*s,lineStartY:c*s,lineStartMouseoverX:g*s,lineStartMouseoverY:h*s,x:l*o,y:c*o,mouseoverX:g*o,mouseoverY:h*o,textWidth:0,collisionShiftX:0,collisionShiftY:0,quadrant:l>=0&&c<=0?1:l<0&&c<=0?2:l<0&&c>0?3:4}}).filter(t=>t.pieDatum.data.visible)}function pt({labelGSelection:u,data:e,fullParams:a,fullChartParams:o,textSizePx:s}){const i=u.selectAll("text").data(e,t=>t.pieDatum.id).join("text").classed(ut,!0).attr("font-weight","bold").attr("text-anchor",t=>t.quadrant==1||t.quadrant==4?"start":"end").style("dominant-baseline",t=>t.quadrant==1||t.quadrant==2?"auto":"hanging").style("cursor",t=>o.highlightTarget&&o.highlightTarget!="none"?"pointer":"none").attr("font-size",o.styles.textSize).attr("x",0).attr("y",0).attr("fill",(t,n)=>B({datum:t.pieDatum.data,colorType:a.labelColorType,fullChartParams:o})).each((t,n,l)=>{ee(T(l[n]),{textArr:t.arcLabels,textSizePx:s,quadrant:t.quadrant})});return i.transition().attr("transform",t=>"translate("+t.x+","+t.y+")"),i}function gt(u,e,a){const o=u.nodes(),s=a,i=o.map((t,n)=>{const l=t.getBBox(),c=[e[n].x,e[n].y];return{node:t,x:c[0],y:c[1],width:l.width,height:l.height}});for(let t=0;t<i.length;t++){const n=i[t];for(let l=t+1;l<i.length;l++){const c=i[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,m=c.x+e[l].collisionShiftX,r=c.y+e[l].collisionShiftY;if(!(g+n.width/2<m-c.width/2||g-n.width/2>m+c.width/2||h+n.height/2<r-c.height/2||h-n.height/2>r+c.height/2)){if(e[l].quadrant==2){const p=r>h?-s*2:-s;e[l].collisionShiftY+=p}else if(e[l].quadrant==4){const p=r>h?s:s*2;e[l].collisionShiftY+=p}}}}for(let t=i.length-1;t>=0;t--){const n=i[t];for(let l=t-1;l>=0;l--){const c=i[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,m=c.x+e[l].collisionShiftX,r=c.y+e[l].collisionShiftY;if(!(g+n.width/2<m-c.width/2||g-n.width/2>m+c.width/2||h+n.height/2<r-c.height/2||h-n.height/2>r+c.height/2)){if(e[l].quadrant==1){const p=r>h?-s*2:-s;e[l].collisionShiftY+=p}else if(e[l].quadrant==3){const p=r>h?s:s*2;e[l].collisionShiftY+=p}}}}u.data(e).transition().attr("transform",t=>`translate(${t.x+t.collisionShiftX},${t.y+t.collisionShiftY})`)}function mt({lineGSelection:u,data:e,fullParams:a,fullChartParams:o}){const s=e.filter(t=>t.collisionShiftX||t.collisionShiftY),i=u.selectAll("polyline").data(s,t=>t.pieDatum.id).join("polyline").attr("stroke",t=>B({datum:t.pieDatum.data,colorType:a.labelColorType,fullChartParams:o})).attr("stroke-width",1).attr("fill","none").attr("points",t=>[[t.lineStartX,t.lineStartY],[t.lineStartX,t.lineStartY]]);return i.transition().attr("points",t=>{let n=t.x+t.collisionShiftX,l=t.y+t.collisionShiftY;return[[n,l],[t.lineStartX,t.lineStartY]]}),i}function dt({textSelection:u,lineSelection:e,ids:a,fullChartParams:o}){if(u.interrupt("highlight"),e.interrupt("highlight"),!a.length){u.transition("highlight").duration(200).attr("transform",s=>`translate(${s.x+s.collisionShiftX},${s.y+s.collisionShiftY})`).style("opacity",1),e.transition("highlight").duration(200).style("opacity",1);return}u.each((s,i,t)=>{const n=T(t[i]);a.includes(s.pieDatum.id)?n.style("opacity",1).transition("highlight").duration(200).attr("transform",l=>l.collisionShiftX||l.collisionShiftY?`translate(${l.x+l.collisionShiftX},${l.y+l.collisionShiftY})`:`translate(${l.mouseoverX+l.collisionShiftX},${l.mouseoverY+l.collisionShiftY})`):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200).attr("transform",l=>`translate(${l.x+l.collisionShiftX},${l.y+l.collisionShiftY})`)}),e.each((s,i,t)=>{const n=T(t[i]);a.includes(s.pieDatum.data.id)?n.style("opacity",1).transition("highlight").duration(200):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function ft(u,e){const a=new x;e.containerSelection.selectAll("g").remove();const o=e.containerSelection.append("g");o.classed(ot,!0);const s=e.containerSelection.append("g");s.classed(lt,!0);const i=new x,t=new x;let n=[];const l=e.seriesContainerPosition$.pipe(S(a),y(g=>g.width<g.height?g.width:g.height),D()),c=e.fullParams$.pipe(S(a),y(g=>g.labelCentroid>=Q?Q:g.labelCentroid));return C({shorterSideWith:l,containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,textSizePx:e.textSizePx$,lineStartCentroid:c}).pipe(S(a),P(async g=>g)).subscribe(g=>{const h=F({axisWidth:g.shorterSideWith,innerRadius:0,outerRadius:g.fullParams.outerRadius,padAngle:0,cornerRadius:0}),m=F({axisWidth:g.shorterSideWith,innerRadius:0,outerRadius:g.fullParams.outerRadiusWhileHighlight,padAngle:0,cornerRadius:0}),r=ie({data:g.containerVisibleComputedSortedData,startAngle:g.fullParams.startAngle,endAngle:g.fullParams.endAngle});n=ht({pieData:r,arc:h,arcMouseover:m,labelCentroid:g.fullParams.labelCentroid,lineStartCentroid:g.lineStartCentroid,fullParams:g.fullParams}),o.selectAll("polyline").remove();const p=pt({labelGSelection:s,data:n,fullParams:g.fullParams,fullChartParams:g.fullChartParams,textSizePx:g.textSizePx});setTimeout(()=>{gt(p,n,g.textSizePx);const b=mt({lineGSelection:o,data:n,fullParams:g.fullParams,fullChartParams:g.fullChartParams});t.next(b)},1e3),i.next(p)}),C({textSelection:i,lineSelection:t,highlight:e.seriesHighlight$.pipe(y(g=>g.map(h=>h.id))),fullChartParams:e.fullChartParams$}).pipe(S(a),P(async g=>g)).subscribe(g=>{dt({textSelection:g.textSelection,lineSelection:g.lineSelection,ids:g.highlight,fullChartParams:g.fullChartParams})}),()=>{a.next(void 0)}}const Wt=O(ct)(({selection:u,observer:e,subject:a})=>{const o=new x,{seriesCenterSelection$:s}=W({selection:u,pluginName:M,visibleComputedSortedData$:e.visibleComputedSortedData$,seriesContainerPosition$:e.seriesContainerPosition$}),i=[];return s.pipe(S(o)).subscribe(t=>{i.forEach(n=>n()),t.each((n,l,c)=>{const g=T(c[l]),h=e.visibleComputedSortedData$.pipe(S(o),y(r=>r[l]??r[0])),m=e.seriesContainerPosition$.pipe(S(o),y(r=>r[l]??r[0]));i[l]=ft(M,{containerSelection:g,containerVisibleComputedSortedData$:h,fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,textSizePx$:e.textSizePx$,seriesHighlight$:e.seriesHighlight$,seriesContainerPosition$:m,event$:a.event$})})}),()=>{o.next(void 0)}}),_="Rose",bt=Math.PI*2,St={name:_,defaultParams:Le,layerIndex:z,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeOption:"ColorType"},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]},arcScaleType:{toBe:'"area" | "radius"',test:o=>o==="area"||o==="radius"},angleIncreaseWhileHighlight:{toBeTypes:["number"]}})};function $t({cornerRadius:u,outerRadius:e,axisWidth:a,maxValue:o,arcScaleType:s,fullParams:i}){const t=a/2*e,n=s==="area"?.5:1,l=G().domain([0,o]).range([0,t]).exponent(n);return c=>{const g=l(c.prevValue),h=l(c.value),m=we(g,h);return r=>{const p=m(r);return te().innerRadius(0).outerRadius(p).padAngle(i.padAngle).padRadius(p).cornerRadius(u)(c)}}}function yt({pathSelection:u,ids:e,fullParams:a,fullChartParams:o,tweenArc:s}){if(u.interrupt("highlight"),!e.length){u.transition("highlight").style("opacity",1).attr("d",i=>s(i)(1));return}u.each((i,t,n)=>{const l=T(n[t]);e.includes(i.data.id)?l.style("opacity",1).transition("highlight").ease(j).duration(500).attr("d",c=>s({...c,startAngle:c.startAngle-a.angleIncreaseWhileHighlight,endAngle:c.endAngle+a.angleIncreaseWhileHighlight})(1)):l.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").attr("d",c=>s(c)(1))})}function Pt(u,e){const a=new x,o=R(u,"path");let s=[];const i=e.seriesContainerPosition$.pipe(S(a),y(r=>r.width<r.height?r.width:r.height),D()),t=C({containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$}).pipe(S(a),P(async r=>r),y(r=>{const p=bt/r.containerVisibleComputedSortedData.length;return r.containerVisibleComputedSortedData.map((b,d)=>({id:b.id,data:b,index:d,value:b.value,startAngle:p*d,endAngle:p*(d+1),padAngle:r.fullParams.padAngle,prevValue:s[d]&&s[d].id===b.id?s[d].value:0}))})),n=e.fullChartParams$.pipe(S(a),y(r=>r.highlightTarget),D()),l=e.visibleComputedSortedData$.pipe(y(r=>Math.max(...r.flat().map(p=>p.value))),D()),c=C({fullParams:e.fullParams$,axisWidth:i,maxValue:l}).pipe(S(a),P(async r=>r),y(r=>$t({cornerRadius:r.fullParams.cornerRadius,outerRadius:r.fullParams.outerRadius,axisWidth:r.axisWidth,maxValue:r.maxValue,arcScaleType:r.fullParams.arcScaleType,fullParams:r.fullParams}))),g=e.fullChartParams$.pipe(S(a),y(r=>r.transitionDuration),D()),h=new ve(!1),m=new X(r=>{C({pieData:t,tweenArc:c,transitionDuration:g,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$}).pipe(S(a),P(async p=>p)).subscribe(p=>{const b=p.pieData.map(($,f)=>($.prevValue=s[f]&&s[f].id===$.id?s[f].value:0,$));h.next(!0);const d=e.containerSelection.selectAll("path").data(b,$=>$.id).join("path").classed(o,!0).style("cursor","pointer").attr("fill",($,f)=>$.data.color).attr("stroke",($,f)=>B({datum:$.data,colorType:p.fullParams.strokeColorType,fullChartParams:p.fullChartParams})).attr("stroke-width",p.fullParams.strokeWidth);d.interrupt("graphicMove"),d.transition("graphicMove").duration(p.transitionDuration).attrTween("d",p.tweenArc).on("end",()=>{r.next(d),h.next(!1)}),s=Object.assign([],b)})}).pipe(L(1));return C({pathSelection:m,SeriesDataMap:e.SeriesDataMap$,computedData:e.computedData$,highlightTarget:n}).pipe(S(a),P(async r=>r)).subscribe(r=>{r.pathSelection.on("mouseover",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"mouseover",pluginName:u,highlightTarget:r.highlightTarget,datum:b.data,series:r.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:r.computedData})}).on("mousemove",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"mousemove",pluginName:u,highlightTarget:r.highlightTarget,datum:b.data,series:r.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:r.computedData})}).on("mouseout",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"mouseout",pluginName:u,highlightTarget:r.highlightTarget,datum:b.data,series:r.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:r.computedData})}).on("click",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"click",pluginName:u,highlightTarget:r.highlightTarget,datum:b.data,series:r.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:r.computedData})})}),C({pathSelection:m,highlight:e.seriesHighlight$.pipe(y(r=>r.map(p=>p.id))),fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,tweenArc:c,isTransitionMoving:h}).pipe(S(a),P(async r=>r),Re(r=>!r.isTransitionMoving)).subscribe(r=>{yt({pathSelection:r.pathSelection,ids:r.highlight,fullParams:r.fullParams,fullChartParams:r.fullChartParams,tweenArc:r.tweenArc})}),()=>{a.next(void 0)}}const kt=O(St)(({selection:u,name:e,subject:a,observer:o})=>{const s=new x,{seriesCenterSelection$:i}=W({selection:u,pluginName:_,visibleComputedSortedData$:o.visibleComputedSortedData$,seriesContainerPosition$:o.seriesContainerPosition$}),t=[];return i.pipe(S(s)).subscribe(n=>{t.forEach(l=>l()),n.each((l,c,g)=>{const h=T(g[c]),m=o.visibleComputedSortedData$.pipe(S(s),y(p=>JSON.parse(JSON.stringify(p[c]??p[0])))),r=o.seriesContainerPosition$.pipe(S(s),y(p=>JSON.parse(JSON.stringify(p[c]??p[0]))));t[c]=Pt(_,{containerSelection:h,computedData$:o.computedData$,visibleComputedSortedData$:o.visibleComputedSortedData$,containerVisibleComputedSortedData$:m,SeriesDataMap$:o.SeriesDataMap$,fullParams$:o.fullParams$,fullChartParams$:o.fullChartParams$,seriesHighlight$:o.seriesHighlight$,seriesContainerPosition$:r,event$:a.event$})})}),()=>{s.next(void 0),t.forEach(n=>n())}}),Y="RoseLabels",Ct=R(Y,"label-g"),Dt=R(Y,"line-g"),xt=R(Y,"text"),Z=2,Tt={name:Y,defaultParams:Be,layerIndex:K,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},labelCentroid:{toBeTypes:["number"]},labelFn:{toBeTypes:["Function"]},labelColorType:{toBeOption:"ColorType"},arcScaleType:{toBe:'"area" | "radius"',test:o=>o==="area"||o==="radius"}})};function At({pieData:u,labelCentroid:e,arcScaleType:a,maxValue:o,axisWidth:s,outerRadius:i,lineStartCentroid:t,fullParams:n}){const l=s/2*i,c=a==="area"?.5:1,g=G().domain([0,o]).range([0,l]).exponent(c);return u.map((h,m)=>{const r=g(h.value),p=te().innerRadius(0).outerRadius(r).padAngle(0).padRadius(r).cornerRadius(0),[b,d]=p.centroid(h),[$,f]=[b,d],w=n.labelFn(h.data);return{pieDatum:h,arcIndex:m,arcLabels:w.split(`
`),lineStartX:b*t,lineStartY:d*t,lineStartMouseoverX:$*t,lineStartMouseoverY:f*t,x:b*e,y:d*e,mouseoverX:$*e,mouseoverY:f*e,textWidth:0,collisionShiftX:0,collisionShiftY:0,quadrant:b>=0&&d<=0?1:b<0&&d<=0?2:b<0&&d>0?3:4}}).filter(h=>h.pieDatum.data.visible)}function Lt({labelGSelection:u,data:e,fullParams:a,fullChartParams:o,textSizePx:s}){const i=u.selectAll("text").data(e,t=>t.pieDatum.id).join("text").classed(xt,!0).attr("font-weight","bold").attr("text-anchor",t=>t.quadrant==1||t.quadrant==4?"start":"end").style("dominant-baseline",t=>t.quadrant==1||t.quadrant==2?"auto":"hanging").style("cursor",t=>o.highlightTarget&&o.highlightTarget!="none"?"pointer":"none").attr("font-size",o.styles.textSize).attr("fill",(t,n)=>B({datum:t.pieDatum.data,colorType:a.labelColorType,fullChartParams:o})).each((t,n,l)=>{ee(T(l[n]),{textArr:t.arcLabels,textSizePx:s,quadrant:t.quadrant})});return i.transition().attr("transform",t=>"translate("+t.x+","+t.y+")"),i}function vt(u,e,a){const o=u.nodes(),s=a,i=o.map((t,n)=>{const l=t.getBBox(),c=[e[n].x,e[n].y];return{node:t,x:c[0],y:c[1],width:l.width,height:l.height}});for(let t=0;t<i.length;t++){const n=i[t];for(let l=t+1;l<i.length;l++){const c=i[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,m=c.x+e[l].collisionShiftX,r=c.y+e[l].collisionShiftY;if(!(g+n.width/2<m-c.width/2||g-n.width/2>m+c.width/2||h+n.height/2<r-c.height/2||h-n.height/2>r+c.height/2)){if(e[l].quadrant==2){const p=r>h?-s*2:-s;e[l].collisionShiftY+=p}else if(e[l].quadrant==4){const p=r>h?s:s*2;e[l].collisionShiftY+=p}}}}for(let t=i.length-1;t>=0;t--){const n=i[t];for(let l=t-1;l>=0;l--){const c=i[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,m=c.x+e[l].collisionShiftX,r=c.y+e[l].collisionShiftY;if(!(g+n.width/2<m-c.width/2||g-n.width/2>m+c.width/2||h+n.height/2<r-c.height/2||h-n.height/2>r+c.height/2)){if(e[l].quadrant==1){const p=r>h?-s*2:-s;e[l].collisionShiftY+=p}else if(e[l].quadrant==3){const p=r>h?s:s*2;e[l].collisionShiftY+=p}}}}u.data(e).transition().attr("transform",t=>`translate(${t.x+t.collisionShiftX},${t.y+t.collisionShiftY})`)}function Rt({lineGSelection:u,data:e,fullParams:a,fullChartParams:o}){const s=e.filter(t=>t.collisionShiftX||t.collisionShiftY),i=u.selectAll("polyline").data(s,t=>t.pieDatum.id).join("polyline").attr("stroke",t=>B({datum:t.pieDatum.data,colorType:a.labelColorType,fullChartParams:o})).attr("stroke-width",1).attr("fill","none").attr("points",t=>[[t.lineStartX,t.lineStartY],[t.lineStartX,t.lineStartY]]);return i.transition().attr("points",t=>{let n=t.x+t.collisionShiftX,l=t.y+t.collisionShiftY;return[[n,l],[t.lineStartX,t.lineStartY]]}),i}function wt({textSelection:u,lineSelection:e,ids:a,fullChartParams:o}){if(u.interrupt("highlight"),e.interrupt("highlight"),!a.length){u.transition("highlight").duration(200).attr("transform",s=>`translate(${s.x+s.collisionShiftX},${s.y+s.collisionShiftY})`).style("opacity",1),e.transition("highlight").duration(200).style("opacity",1);return}u.each((s,i,t)=>{const n=T(t[i]);a.includes(s.pieDatum.data.id)?n.style("opacity",1).transition("highlight").duration(200).attr("transform",l=>`translate(${l.mouseoverX+l.collisionShiftX},${l.mouseoverY+l.collisionShiftY})`):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200).attr("transform",l=>`translate(${l.x+l.collisionShiftX},${l.y+l.collisionShiftY})`)}),e.each((s,i,t)=>{const n=T(t[i]);a.includes(s.pieDatum.data.id)?n.style("opacity",1).transition("highlight").duration(200):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function Bt(u,e){const a=new x;e.containerSelection.selectAll("g").remove();const o=e.containerSelection.append("g");o.classed(Dt,!0);const s=e.containerSelection.append("g");s.classed(Ct,!0);const i=new x,t=new x;let n=[];const l=e.seriesContainerPosition$.pipe(S(a),y(h=>h.width<h.height?h.width:h.height),D()),c=e.visibleComputedSortedData$.pipe(y(h=>Math.max(...h.flat().map(m=>m.value))),D()),g=e.fullParams$.pipe(S(a),y(h=>h.labelCentroid>=Z?Z:h.labelCentroid));return C({shorterSideWith:l,containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,maxValue:c,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,textSizePx:e.textSizePx$,lineStartCentroid:g}).pipe(S(a),P(async h=>h)).subscribe(h=>{const m=Math.PI*2/h.containerVisibleComputedSortedData.length,r=h.containerVisibleComputedSortedData.map((b,d)=>({id:b.id,data:b,index:d,value:b.value,startAngle:m*d,endAngle:m*(d+1),padAngle:0}));n=At({pieData:r,labelCentroid:h.fullParams.labelCentroid,arcScaleType:h.fullParams.arcScaleType,maxValue:h.maxValue,axisWidth:h.shorterSideWith,outerRadius:h.fullParams.outerRadius,lineStartCentroid:h.lineStartCentroid,fullParams:h.fullParams}),o.selectAll("polyline").remove();const p=Lt({labelGSelection:s,data:n,fullParams:h.fullParams,fullChartParams:h.fullChartParams,textSizePx:h.textSizePx});setTimeout(()=>{vt(p,n,h.textSizePx);const b=Rt({lineGSelection:o,data:n,fullParams:h.fullParams,fullChartParams:h.fullChartParams});t.next(b)},1e3),i.next(p)}),C({textSelection:i,lineSelection:t,highlight:e.seriesHighlight$.pipe(y(h=>h.map(m=>m.id))),fullChartParams:e.fullChartParams$}).pipe(S(a),P(async h=>h)).subscribe(h=>{wt({textSelection:h.textSelection,lineSelection:h.lineSelection,ids:h.highlight,fullChartParams:h.fullChartParams})}),()=>{a.next(void 0)}}const It=O(Tt)(({selection:u,observer:e,subject:a})=>{const o=new x,{seriesCenterSelection$:s}=W({selection:u,pluginName:Y,visibleComputedSortedData$:e.visibleComputedSortedData$,seriesContainerPosition$:e.seriesContainerPosition$}),i=[];return s.pipe(S(o)).subscribe(t=>{i.forEach(n=>n()),t.each((n,l,c)=>{const g=T(c[l]),h=e.visibleComputedSortedData$.pipe(S(o),y(r=>JSON.parse(JSON.stringify(r[l]??r[0])))),m=e.seriesContainerPosition$.pipe(S(o),y(r=>JSON.parse(JSON.stringify(r[l]??r[0]))));i[l]=Bt(Y,{containerSelection:g,visibleComputedSortedData$:e.visibleComputedSortedData$,containerVisibleComputedSortedData$:h,fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,textSizePx$:e.textSizePx$,seriesHighlight$:e.seriesHighlight$,seriesContainerPosition$:m,event$:a.event$})})}),()=>{o.next(void 0)}}),ae="SeriesLegend",Mt={name:ae,defaultParams:Me,layerIndex:Ye,validator:(u,{validateColumns:e})=>e(u,{placement:{toBe:'"top" | "top-start" | "top-end" | "bottom" | "bottom-start" | "bottom-end" | "left" | "left-start" | "left-end" | "right" | "right-start" | "right-end"',test:o=>["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"].includes(o)},padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},Vt=O(Mt)(({selection:u,rootSelection:e,observer:a,subject:o})=>{const s=new x,i=a.SeriesDataMap$.pipe(S(s),y(l=>Array.from(l.keys()))),t=a.fullParams$.pipe(S(s),y(l=>{const c=[{listRectWidth:l.listRectWidth,listRectHeight:l.listRectHeight,listRectRadius:l.listRectRadius}];return{...l,labelList:c}})),n=Ne(ae,{rootSelection:e,legendLabels$:i,fullParams$:t,layout$:a.layout$,fullChartParams$:a.fullChartParams$,textSizePx$:a.textSizePx$});return()=>{s.next(void 0),n()}});export{Ft as B,Et as P,kt as R,Vt as S,Wt as a,It as b,Xt as c,W as s};
