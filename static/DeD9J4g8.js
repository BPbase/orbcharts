import{S as k,t as h,m as x,d as P,e as f,s as m,O as C,c as B,y as V,o as N}from"./DNpuBO6_.js";import{e as F,a as ee,g as R,f as re}from"./D8yrUiOY.js";import{a as te}from"./CdoJceY_.js";const Z=.3;function _({axisWidth:t,groupAmount:c,barAmountOfGroup:s,barPadding:i=0,barGroupPadding:n=0}){const u=(t/(c-1)-n)/s-i;return u>1?u:1}function ie(t,c,s){const i=t/2,n=t*c.length+s.barPadding*c.length;return re().domain(c).range([-n/2+i,n/2-i])}function ae(t,c){return t<=1?0:c/(t-1)*Z}function se(t,c){return t<=1?c:c*(1-Z)}function ne({graphicGSelection:t,pathGClassName:c,pathClassName:s,computedData:i,linearGradientIds:n,zeroYArr:p,groupLabels:u,barScale:L,params:D,chartParams:W,barWidth:b,delayGroup:A,transitionItem:O,isSeriesPositionSeprate:T}){const G=b/2;return t.each((g,d,E)=>{B(E[d]).selectAll(`g.${c}`).data(i[d]??[]).join(o=>{const S=o.append("g").classed(c,!0).attr("cursor","pointer");return S.append("path").classed(s,!0).style("vector-effect","non-scaling-stroke").attr("d",y=>{const $=-G,M=p[d],w=p[d];return`M${$},${M} L${$+b/2},${w} ${$+b},${M}`}),S},o=>o,o=>o.remove()).attr("transform",o=>`translate(${T?0:L(o.seriesLabel)}, 0)`).select(`path.${s}`).attr("height",o=>Math.abs(o.axisYFromZero)).attr("y",o=>o.axisY<p[d]?o.axisY:p[d]).attr("x",o=>T?0:L(o.seriesLabel)).style("fill",o=>`url(#${n[o.seriesIndex]})`).attr("stroke",o=>o.color).attr("transform",o=>`translate(${o?o.axisX:0}, 0)`).transition().duration(O).ease(ee(W.transitionEase)).delay((o,S)=>o.groupIndex*A).attr("d",o=>{const S=-G,y=p[d],$=o.axisY;return`M${S},${y} L${S+b/2},${$} ${S+b},${y}`})}),t.selectAll(`path.${s}`)}function oe({defsSelection:t,computedData:c,linearGradientIds:s,params:i}){t.selectAll("linearGradient").data(c??[]).join(n=>n.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),n=>n,n=>n.remove()).attr("id",(n,p)=>n[0]?s[n[0].seriesIndex]:"").html((n,p)=>{const u=n[0]?n[0].color:"";return`
        <stop offset="0%"   stop-color="${u}" stop-opacity="${i.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${u}" stop-opacity="${i.linearGradientOpacity[1]}"/>
      `})}function pe({defsSelection:t,clipPathData:c}){t.selectAll("clipPath").data(c).join(s=>s.append("clipPath"),s=>s,s=>s.remove()).attr("id",s=>s.id).each((s,i,n)=>{B(n[i]).selectAll("rect").data([s]).join(p=>p.append("rect"),p=>p,p=>p.remove()).attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height)})}function ce({selection:t,ids:c,fullChartParams:s}){t.interrupt("highlight");const i=()=>{t.transition("highlight").duration(200).style("opacity",1)};if(!c.length){i();return}t.each((n,p,u)=>{c.includes(n.id)?B(u[p]).style("opacity",1):B(u[p]).style("opacity",s.styles.unhighlightedOpacity)})}const le=(t,{selection:c,computedData$:s,visibleComputedData$:i,existSeriesLabels$:n,SeriesDataMap$:p,GroupDataMap$:u,fullParams$:L,fullChartParams$:D,gridAxesTransform$:W,gridGraphicTransform$:b,gridAxesSize$:A,gridHighlight$:O,gridContainer$:T,isSeriesPositionSeprate$:G,event$:I})=>{const g=new k,d=F(t,"clipPath-box"),E=R(t,"pathG"),Y=R(t,"path"),{seriesSelection$:o,axesSelection$:S,defsSelection$:y,graphicGSelection$:$}=te({selection:c,pluginName:t,clipPathID:d,existSeriesLabels$:n,gridContainer$:T,gridAxesTransform$:W,gridGraphicTransform$:b});b.pipe(h(g),x(e=>-e.translate[1]/e.scale[1]));const M=i.pipe(x(e=>e.map(a=>a[0]?a[0].axisY-a[0].axisYFromZero:0)),P()),w=f({computedData:s,visibleComputedData:i,params:L,gridAxesSize:A,isSeriesPositionSeprate:G}).pipe(h(g),m(async e=>e),x(e=>e.params.barWidth?e.params.barWidth:e.isSeriesPositionSeprate?_({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):_({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}))),j=i.pipe(h(g),x(e=>{const a=new Set;return e.forEach(l=>{l.forEach(r=>{a.add(r.seriesLabel)})}),Array.from(a)})),z=i.pipe(h(g),x(e=>{const a=new Set;return e.forEach(l=>{l.forEach(r=>{a.add(r.groupLabel)})}),Array.from(a)})),X=new C(e=>{f({seriesLabels:j,barWidth:w,params:L}).pipe(h(g),m(async a=>a)).subscribe(a=>{const l=ie(a.barWidth,a.seriesLabels,a.params);e.next(l)})}),H=D.pipe(h(g),x(e=>e.transitionDuration),P()),q=new C(e=>{f({groupLabels:z,transitionDuration:H}).pipe(m(async a=>a)).subscribe(a=>{const l=ae(a.groupLabels.length,a.transitionDuration);e.next(l)})}).pipe(h(g),P()),J=new C(e=>{f({groupLabels:z,transitionDuration:H}).pipe(m(async a=>a)).subscribe(a=>{const l=se(a.groupLabels.length,a.transitionDuration);e.next(l)})}).pipe(h(g),P());f({defsSelection:y,gridAxesSize:A}).pipe(h(g),m(async e=>e)).subscribe(e=>{const a=[{id:d,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];pe({defsSelection:e.defsSelection,clipPathData:a})});const K=D.pipe(h(g),x(e=>e.highlightTarget),P()),U=new k,Q=j.pipe(h(g),x(e=>e.map((a,l)=>F(t,`lineargradient-${a}`))));return f({graphicGSelection:$,defsSelection:y,computedData:s,linearGradientIds:Q,zeroYArr:M,groupLabels:z,barScale:X,params:L,chartParams:D,highlightTarget:K,barWidth:w,delayGroup:q,transitionItem:J,SeriesDataMap:p,GroupDataMap:u,isSeriesPositionSeprate:G}).pipe(h(g),m(async e=>e)).subscribe(e=>{const a=ne({graphicGSelection:e.graphicGSelection,pathGClassName:E,pathClassName:Y,computedData:e.computedData,linearGradientIds:e.linearGradientIds,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesPositionSeprate:e.isSeriesPositionSeprate});oe({defsSelection:e.defsSelection,computedData:e.computedData,linearGradientIds:e.linearGradientIds,params:e.params}),a.on("mouseover",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"mouseover",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}).on("mousemove",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"mousemove",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}).on("mouseout",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"mouseout",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}).on("click",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"click",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}),U.next(a)}),f({barSelection:U,highlight:O,fullChartParams:D}).pipe(h(g),m(async e=>e)).subscribe(e=>{ce({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{g.next(void 0)}},v="BarsTriangle",de=V(v,N)(({selection:t,name:c,subject:s,observer:i})=>{const n=new k,p=le(v,{selection:t,computedData$:i.computedData$,visibleComputedData$:i.visibleComputedData$,existSeriesLabels$:i.existSeriesLabels$,SeriesDataMap$:i.SeriesDataMap$,GroupDataMap$:i.GroupDataMap$,fullParams$:i.fullParams$,fullChartParams$:i.fullChartParams$,gridAxesTransform$:i.gridAxesTransform$,gridGraphicTransform$:i.gridGraphicTransform$,gridAxesSize$:i.gridAxesSize$,gridHighlight$:i.gridHighlight$,gridContainer$:i.gridContainer$,isSeriesPositionSeprate$:i.isSeriesPositionSeprate$,event$:s.event$});return()=>{n.next(void 0),p()}});export{de as B,le as c};
