import{a6 as F,g as S,h as I,m as $,a5 as M,a7 as Y,au as L,av as X,aw as E,ax as H,S as G,t as m,ay as W,e as b,s as C}from"./Bt7wG3zu.js";import{g as T,u as U,v as N,c as k}from"./vANVmeqg.js";import{f as j}from"./0jurvOgS.js";import{E as V}from"./BnHHrt-t.js";function q(t,r,o,a,n,l,s,v){var f=[],c=0,P=0,u=!1,x=function(){u&&!f.length&&!c&&r.complete()},p=function(e){return c<a?d(e):f.push(e)},d=function(e){c++;var h=!1;S(o(e,P++)).subscribe(F(r,function(g){r.next(g)},function(){h=!0},void 0,function(){if(h)try{c--;for(var g=function(){var y=f.shift();s||d(y)};f.length&&c<a;)g();x()}catch(y){r.error(y)}}))};return t.subscribe(F(r,p,function(){u=!0,x()})),function(){}}function O(t,r,o){return o===void 0&&(o=1/0),I(r)?O(function(a,n){return $(function(l,s){return r(a,l,n,s)})(S(t(a,n)))},o):(typeof r=="number"&&(o=r),M(function(a,n){return q(a,n,t,o)}))}function B(t){return t===void 0&&(t=1/0),O(Y,t)}function w(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=L(t),a=X(t,1/0),n=t;return n.length?n.length===1?S(n[0]):B(a)(E(n,o)):V}const J={backgroundColorType:"background",strokeColorType:"primary",backgroundOpacity:.8,textColorType:"primary",offset:[20,5],padding:10,textRenderFn:t=>{if(t.highlightTarget==="datum"&&t.datum)return[`${t.datum.label}: ${t.datum.value}`];if(t.highlightTarget==="series"){const r=t.seriesLabel,o=t.series.map(n=>n.value),a=o.length>5?o.slice(0,5).join(",")+"...":o.join(",");return[r,a]}else if(t.highlightTarget==="group"){const r=t.groupLabel,o=t.series.map(n=>n.value),a=o.length>5?o.slice(0,5).join(",")+"...":o.join(",");return[r,a]}else if(t.highlightTarget==="category"){const r=t.categoryLabel,o=t.category.map(n=>n.value),a=o.length>5?o.slice(0,5).join(",")+"...":o.join(",");return[r,a]}return[]},svgRenderFn:null},z="Tooltip",R=T(z,"g"),K=T(z,"box");function Q(t,r){const o=r.textSizePx*1.5;return t.filter(a=>a!="").map((a,n)=>{const l=n*o;return`<text font-size="${r.textSize}" fill="${r.textColor}" x="0" y="${l}" style="dominant-baseline:text-before-edge">${a}</text>`}).join()}function Z({rootSelection:t,pluginName:r,rootWidth:o,rootHeight:a,svgString:n,tooltipStyle:l,event:s}){t.interrupt("fadeout");const v=5,f=n?[n]:[],c=n?[l]:[],u=t.selectAll(`g.${R}`).data(f).join(i=>i.append("g").classed(R,!0).attr("pointer-events","none"),i=>i,i=>i.style("opacity",0).remove()).attr("transform",()=>`translate(${s.offsetX}, ${s.offsetY})`).selectAll(`g.${K}`).data(c).join(i=>i.append("g").classed(T(r,"box"),!0)),x=u.selectAll("rect").data(c).join(i=>i.append("rect").attr("rx",v).attr("ry",v)).attr("fill",i=>i.backgroundColor).attr("stroke",i=>i.strokeColor).attr("opacity",i=>i.backgroundOpacity),p=u.selectAll("g").data(f).join(i=>i.append("g").classed(T(r,"content"),!0).attr("transform",()=>`translate(${l.padding}, ${l.padding})`));f.length&&U(p,f[0]);const d=p!=null&&p.node()?N(p):{width:0,height:0};x.attr("width",d.width+l.padding*2).attr("height",d.height+l.padding*2);const e=u!=null&&u.node()?N(u):{width:0,height:0},h=o-e.width,g=a-e.height,y=s.offsetX+l.offset[0]>h?h-s.offsetX:l.offset[0],A=s.offsetY+l.offset[1]>g?g-s.offsetY:l.offset[1];u.attr("transform",i=>`translate(${y}, ${A})`),u.attr("transform",i=>`translate(${y}, ${A})`)}const ne=H(z,J)(({selection:t,rootSelection:r,name:o,chartType:a,observer:n,subject:l})=>{const s=new G,v=l.event$.pipe(m(s),j(e=>e.eventName==="mouseover"||e.eventName==="mousemove")),f=l.event$.pipe(m(s),j(e=>e.eventName==="mouseout")),c=W(n.fullChartParams$),P=b({fullChartParams:n.fullChartParams$,fullParams:n.fullParams$,textSizePx:c}).pipe(m(s),C(async e=>e),$(e=>({backgroundColor:k(e.fullParams.backgroundColorType,e.fullChartParams),backgroundOpacity:e.fullParams.backgroundOpacity,strokeColor:k(e.fullParams.strokeColorType,e.fullChartParams),offset:e.fullParams.offset,padding:e.fullParams.padding,textSize:e.fullChartParams.styles.textSize,textSizePx:e.textSizePx,textColor:k(e.fullParams.textColorType,e.fullChartParams)}))),u=b({fullParams:n.fullParams$,tooltipStyle:P}).pipe(m(s),C(async e=>e),$(e=>e.fullParams.svgRenderFn?e.fullParams.svgRenderFn:h=>{const g=e.fullParams.textRenderFn(h);return Q(g,e.tooltipStyle)})),x=b({event:v,contentRenderFn:u}).pipe(m(s),C(async e=>e),$(e=>e.contentRenderFn(e.event))),p=f.pipe(m(s),$(e=>"")),d=w(v,f).pipe(m(s),$(e=>e.event));return b({svgString:w(x,p),event:d,layout:n.layout$,tooltipStyle:P}).pipe(m(s),C(async e=>e)).subscribe(e=>{Z({rootSelection:r,pluginName:o,rootWidth:e.layout.rootWidth,rootHeight:e.layout.rootHeight,svgString:e.svgString,tooltipStyle:e.tooltipStyle,event:e.event})}),function(){s.next(void 0)}});export{ne as T,w as a,O as m};
