import{S as O,o as x,t as d,p as D,m as L,h as M,s as I}from"./E1orKXwV.js";import{c as _,a as P,g as $}from"./EQqw3RI0.js";import{m as B}from"./BBDoJeVy.js";function E({graphicGSelection:r,circleGClassName:g,circleClassName:i,visibleComputedLayoutData:b,fullParams:l,fullChartParams:a,graphicReverseScale:h}){const S=y=>{const p=y.size();return a.transitionDuration/p};let f=0;return r.each((y,p,v)=>{I(v[p]).selectAll("g").data(b[p],s=>s.id).join(s=>(f=S(s),s.append("g").classed(g,!0)),s=>s,s=>s.remove()).attr("transform",s=>`translate(${s.axisX}, ${s.axisY})`).each((s,C,G)=>{I(G[C]).selectAll("circle").data([s]).join(c=>c.append("circle").style("cursor","pointer").style("vector-effect","non-scaling-stroke").classed(i,!0).attr("opacity",0).transition().delay((u,n)=>C*f).attr("opacity",1),c=>c.transition().duration(50).attr("opacity",1),c=>c.remove()).attr("r",l.radius).attr("fill",(c,u)=>P({datum:c,colorType:l.fillColorType,fullChartParams:a})).attr("stroke",(c,u)=>P({datum:c,colorType:l.strokeColorType,fullChartParams:a})).attr("stroke-width",l.strokeWidth).attr("transform",`scale(${h[p][0]??1}, ${h[p][1]??1})`)})}),r.selectAll(`circle.${i}`)}function W({selection:r,ids:g,onlyShowHighlighted:i,fullChartParams:b}){if(r.interrupt("highlight"),!g.length){r.transition("highlight").duration(200).style("opacity",i===!0?0:1);return}r.each((l,a,h)=>{g.includes(l.id)?I(h[a]).style("opacity",1).transition("highlight").duration(200):I(h[a]).style("opacity",i===!0?0:b.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function X({defsSelection:r,clipPathData:g}){r.selectAll("clipPath").data(g).join(i=>i.append("clipPath"),i=>i,i=>i.remove()).attr("id",i=>i.id).each((i,b,l)=>{I(l[b]).selectAll("rect").data([i]).join("rect").attr("x",0).attr("y",0).attr("width",a=>a.width).attr("height",a=>a.height)})}const Q=(r,{selection:g,computedData$:i,computedLayoutData$:b,visibleComputedData$:l,visibleComputedLayoutData$:a,seriesLabels$:h,SeriesDataMap$:S,GroupDataMap$:f,fullParams$:T,fullChartParams$:y,gridAxesTransform$:p,gridGraphicTransform$:v,gridGraphicReverseScale$:s,gridAxesSize$:C,gridHighlight$:G,gridContainerPosition$:c,event$:u})=>{const n=new O,m=_(r,"clipPath-box"),k=$(r,"circleG"),A=$(r,"circle"),{seriesSelection$:Y,axesSelection$:q,defsSelection$:j,graphicGSelection$:z}=B({selection:g,pluginName:r,clipPathID:m,seriesLabels$:h,gridContainerPosition$:c,gridAxesTransform$:p,gridGraphicTransform$:v}),R=x({computedData:i,gridGraphicReverseScale:s}).pipe(d(n),D(async e=>e),L(e=>e.computedData.map((o,t)=>e.gridGraphicReverseScale[t])));x({defsSelection:j,gridAxesSize:C}).pipe(d(n),D(async e=>e)).subscribe(e=>{const o=[{id:m,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];X({defsSelection:e.defsSelection,clipPathData:o})});const H=y.pipe(d(n),L(e=>e.highlightTarget),M()),w=x({graphicGSelection:z,visibleComputedLayoutData:a,graphicReverseScale:R,fullChartParams:y,fullParams:T}).pipe(d(n),D(async e=>e),L(e=>E({graphicGSelection:e.graphicGSelection,circleGClassName:k,circleClassName:A,visibleComputedLayoutData:e.visibleComputedLayoutData,fullParams:e.fullParams,fullChartParams:e.fullChartParams,graphicReverseScale:e.graphicReverseScale})));x({graphicSelection:w,computedData:i,SeriesDataMap:S,GroupDataMap:f,highlightTarget:H}).pipe(d(n),D(async e=>e)).subscribe(e=>{e.graphicSelection.on("mouseover",(o,t)=>{o.stopPropagation(),u.next({type:"grid",eventName:"mouseover",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})}).on("mousemove",(o,t)=>{o.stopPropagation(),u.next({type:"grid",eventName:"mousemove",pluginName:r,highlightTarget:e.highlightTarget,data:e.computedData,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o})}).on("mouseout",(o,t)=>{o.stopPropagation(),u.next({type:"grid",eventName:"mouseout",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})}).on("click",(o,t)=>{o.stopPropagation(),u.next({type:"grid",eventName:"click",pluginName:r,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})})});const U=T.pipe(d(n),L(e=>e.onlyShowHighlighted),M());return x({graphicSelection:w,highlight:G.pipe(L(e=>e.map(o=>o.id))),onlyShowHighlighted:U,fullChartParams:y}).pipe(d(n),D(async e=>e)).subscribe(e=>{W({selection:e.graphicSelection,ids:e.highlight,onlyShowHighlighted:e.onlyShowHighlighted,fullChartParams:e.fullChartParams})}),()=>{n.next(void 0)}};export{Q as c};
