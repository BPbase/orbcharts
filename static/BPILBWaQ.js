import{y as N,S as D,t as d,m as $,d as W,e as f,s as P,c as O,z as _,O as y}from"./Bt7wG3zu.js";import{c as U,d as z}from"./CWQM6zHe.js";import{h as F,a as H,m as v,g as B}from"./vANVmeqg.js";import{f as G}from"./DiaHYm7N.js";import{c as q}from"./rbJIPsOw.js";function J({computedDataSeries:g,startAngle:n,endAngle:t}){return F().startAngle(n).endAngle(t).value(a=>a.visible==!1?0:a.value).sort((a,h)=>a.sortedIndex-h.sortedIndex)(g).map((a,h)=>{let r=a;return r.id=a.data.id,r})}const b="Pie",K=B(b,"path");function Q({enter:g,exit:n,data:t,lastData:l,fullParams:s}){return!g.size()&&!n.size()?a=>{const h=t.map((r,u)=>{const c=l[u]??{startAngle:0,endAngle:0,value:0};return{...r,startAngle:r.startAngle*a+c.startAngle*(1-a),endAngle:r.endAngle*a+c.endAngle*(1-a),value:r.value*a+c.value*(1-a)}});return S(h,s.startAngle,s.endAngle,1)}:a=>S(t,s.startAngle,s.endAngle,a)}function S(g,n,t,l){return g.map((s,a)=>{const h=n+(s.startAngle-n)*l,r=h+(s.endAngle-s.startAngle)*l;return{...s,startAngle:h,endAngle:r}})}function M({selection:g,renderData:n,arc:t}){let l=g.selectAll("path").data(n,r=>r.id),s=l.enter().append("path").classed(K,!0),a=l.exit();s.append("path");const h=l.merge(s);return h.style("cursor","pointer").attr("fill",(r,u)=>r.data.color).attr("d",(r,u)=>t(r)),a.remove(),h}function V({pathSelection:g,ids:n,fullChartParams:t,arc:l,arcMouseover:s}){if(g.interrupt("highlight"),!n.length){g.transition("highlight").style("opacity",1).attr("d",a=>l(a));return}g.each((a,h,r)=>{const u=O(r[h]);n.includes(a.data.id)?u.style("opacity",1).transition("highlight").ease(_).duration(500).attr("d",c=>s(c)):u.style("opacity",t.styles.unhighlightedOpacity).transition("highlight").attr("d",c=>l(c))})}const te=N(b,U)(({selection:g,name:n,observer:t,subject:l})=>{const s=new D,a=g.append("g"),h=new D;let r=[],u=[];t.layout$.pipe(G()).subscribe(e=>{g.attr("transform",`translate(${e.width/2}, ${e.height/2})`),t.layout$.pipe(d(s)).subscribe(i=>{g.transition().attr("transform",`translate(${i.width/2}, ${i.height/2})`)})});const c=t.layout$.pipe(d(s),$(e=>e.width<e.height?e.width:e.height)),w=new y(e=>{f({computedData:t.computedData$,fullParams:t.fullParams$}).pipe(d(s),P(async i=>i)).subscribe(i=>{const m=J({computedDataSeries:i.computedData,startAngle:i.fullParams.startAngle,endAngle:i.fullParams.endAngle});e.next(m)})}),R=new y(e=>{f({shorterSideWith:c,fullParams:t.fullParams$}).pipe(d(s),P(async i=>i)).subscribe(i=>{const m=v({axisWidth:i.shorterSideWith,innerRadius:i.fullParams.innerRadius,outerRadius:i.fullParams.outerRadius,padAngle:i.fullParams.padAngle,cornerRadius:i.fullParams.cornerRadius});e.next(m)})}),L=new y(e=>{f({shorterSideWith:c,fullParams:t.fullParams$}).pipe(d(s),P(async i=>i)).subscribe(i=>{const m=v({axisWidth:i.shorterSideWith,innerRadius:i.fullParams.innerRadius,outerRadius:i.fullParams.outerMouseoverRadius,padAngle:i.fullParams.padAngle,cornerRadius:i.fullParams.cornerRadius});e.next(m)})}),C=t.fullChartParams$.pipe(d(s),$(e=>e.highlightTarget),W());return f({pieData:w,SeriesDataMap:t.SeriesDataMap$,arc:R,arcMouseover:L,computedData:t.computedData$,fullParams:t.fullParams$,fullChartParams:t.fullChartParams$,highlightTarget:C}).pipe(d(s),P(async e=>e)).subscribe(e=>{a.interrupt("graphicMove");let i=g.selectAll("path").data(e.pieData,x=>x.data.id),m=i.enter(),I=i.exit();const E=Q({enter:m,exit:I,data:e.pieData,lastData:r,fullParams:e.fullParams});a.transition("graphicMove").duration(e.fullChartParams.transitionDuration).ease(H(e.fullChartParams.transitionEase)).tween("move",(x,k)=>A=>{u=E(A),M({selection:a,renderData:u,arc:e.arc}),l.event$.next({type:"series",pluginName:n,eventName:"transitionMove",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})}).on("end",(x,k)=>{u=S(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const A=M({selection:a,renderData:u,arc:e.arc});h.next(A),r=Object.assign([],e.pieData),l.event$.next({type:"series",pluginName:n,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData}),A.on("mouseover",(p,o)=>{p.stopPropagation(),l.event$.next({type:"series",eventName:"mouseover",pluginName:n,highlightTarget:e.highlightTarget,datum:o.data,series:e.SeriesDataMap.get(o.data.seriesLabel),seriesIndex:o.data.seriesIndex,seriesLabel:o.data.seriesLabel,event:p,data:e.computedData})}).on("mousemove",(p,o)=>{p.stopPropagation(),l.event$.next({type:"series",eventName:"mousemove",pluginName:n,highlightTarget:e.highlightTarget,datum:o.data,series:e.SeriesDataMap.get(o.data.seriesLabel),seriesIndex:o.data.seriesIndex,seriesLabel:o.data.seriesLabel,event:p,data:e.computedData})}).on("mouseout",(p,o)=>{p.stopPropagation(),l.event$.next({type:"series",eventName:"mouseout",pluginName:n,highlightTarget:e.highlightTarget,datum:o.data,series:e.SeriesDataMap.get(o.data.seriesLabel),seriesIndex:o.data.seriesIndex,seriesLabel:o.data.seriesLabel,event:p,data:e.computedData})}).on("click",(p,o)=>{p.stopPropagation(),l.event$.next({type:"series",eventName:"click",pluginName:n,highlightTarget:e.highlightTarget,datum:o.data,series:e.SeriesDataMap.get(o.data.seriesLabel),seriesIndex:o.data.seriesIndex,seriesLabel:o.data.seriesLabel,event:p,data:e.computedData})})})}),f({pathSelection:h,highlight:t.seriesHighlight$.pipe($(e=>e.map(i=>i.id))),fullChartParams:t.fullChartParams$,arc:R,arcMouseover:L}).pipe(d(s),P(async e=>e)).subscribe(e=>{V({pathSelection:e.pathSelection,ids:e.highlight,fullChartParams:e.fullChartParams,arc:e.arc,arcMouseover:e.arcMouseover})}),()=>{s.next(void 0)}}),T="SeriesLegend",ae=N(T,z)(({selection:g,rootSelection:n,observer:t,subject:l})=>{const s=new D,a=t.SeriesDataMap$.pipe(d(s),$(u=>Array.from(u.keys()))),h=t.fullParams$.pipe(d(s),$(u=>{const c=[{listRectWidth:u.listRectWidth,listRectHeight:u.listRectHeight,listRectRadius:u.listRectRadius}];return{...u,seriesList:c}})),r=q(T,{rootSelection:n,seriesLabels$:a,fullParams$:h,layout$:t.layout$,fullChartParams$:t.fullChartParams$,textSizePx$:t.textSizePx$});return()=>{s.next(void 0),r()}});export{te as P,ae as S,J as m};
