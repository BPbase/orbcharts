import{aO as w,aP as p,aQ as f,aR as O,Z as P,S as I,m,d as R,n as y,t as M,o as A,F as T,aS as _,aT as V}from"./CllDRATP.js";import{z as h}from"./CWRPK8C-.js";import{E as Z}from"./3f-LgFZK.js";var S=w(function(o){return function(){o(this),this.name="EmptyError",this.message="no elements in sequence"}});function v(o){return p(function(e,a){var n=!1;e.subscribe(f(a,function(u){n=!0,a.next(u)},function(){n||a.next(o),a.complete()}))})}function C(o){return o<=0?function(){return Z}:p(function(e,a){var n=0;e.subscribe(f(a,function(u){++n<=o&&(a.next(u),o<=n&&a.complete())}))})}function L(o){return o===void 0&&(o=N),p(function(e,a){var n=!1;e.subscribe(f(a,function(u){n=!0,a.next(u)},function(){return n?a.complete():a.error(o())}))})}function N(){return new S}function U(o,e){var a=arguments.length>=2;return function(n){return n.pipe(O,C(1),a?v(e):L(function(){return new S}))}}const Y="GridZoom",X={name:Y,defaultParams:T,layerIndex:_,validator:(o,{validateColumns:e})=>({status:"success",columnName:"",expectToBe:""})},W=P(X)(({selection:o,rootSelection:e,name:a,observer:n,subject:u})=>{const c=new I;let r={k:1,x:0,y:0};const x=n.computedData$.pipe(m(t=>t[0]?t[0].length-1:0),R()),E=n.fullDataFormatter$.pipe(m(t=>t.grid.groupAxis),U()),F=y({initGroupAxis:E,fullDataFormatter:n.fullDataFormatter$,groupMax:x,layout:n.layout$,axisSize:n.gridAxesSize$}).pipe(M(c),A(async t=>t),m(t=>{const g=t.initGroupAxis.scaleDomain[0]-t.initGroupAxis.scalePadding,l=t.initGroupAxis.scaleDomain[1]==="max"?t.groupMax+t.initGroupAxis.scalePadding:t.initGroupAxis.scaleDomain[1]+t.initGroupAxis.scalePadding;return V({maxValue:t.groupMax,minValue:0,axisWidth:t.axisSize.width,scaleDomain:[g,l],scaleRange:[0,1]})}));return y({groupScale:F,fullDataFormatter:n.fullDataFormatter$,groupMax:x}).pipe(M(c),A(async t=>t)).subscribe(t=>{const l=t.groupScale.copy(),d=h().on("zoom",function(k){const i=k.transform,D=$=>{const z=Math.round($);return Math.min(t.groupMax,Math.max(0,z))},s=t.fullDataFormatter.grid.groupAxis.position==="bottom"||t.fullDataFormatter.grid.groupAxis.position==="top"?i.rescaleX(l).domain().map(D):i.rescaleY(l).domain().map(D);s[0]<=0&&s[1]>=t.groupMax?i.k<r.k&&(i.k=r.k,i.x=r.x,i.y=r.y):s[1]-s[0]<=1&&i.k>r.k&&(i.k=r.k,i.x=r.x,i.y=r.y),r.k=i.k,r.x=i.x,r.y=i.y;const G={...t.fullDataFormatter,grid:{...t.fullDataFormatter.grid,groupAxis:{...t.fullDataFormatter.grid.groupAxis,scaleDomain:s}}};u.dataFormatter$.next(G)});e.call(d)}),()=>{c.next(void 0),e.call(h().on("zoom",null))}});export{W as G};
