import{i as m,j as d,d as D,m as P,c as T,k as I,S as R,t as p,s as w,O as S,U as j}from"./DCTRfcdh.js";import{f as E}from"./B5HR0ePV.js";import{p as O,g as M,m as L}from"./DuZmw3Fq.js";function U({data:c,startAngle:i,endAngle:o}){return O().startAngle(i).endAngle(o).value(t=>t.value).sort((t,r)=>t.seq-r.seq)(c).map((t,r)=>{let h=t;return h.id=t.data.id,h})}function V({selection:c,pluginName:i,separateSeries$:o,seriesLabels$:n}){const l=M(i,"series");return m({seriesLabels:n,separateSeries:o}).pipe(d(async t=>t),P((t,r)=>{const h=t.separateSeries?t.seriesLabels:[t.seriesLabels.join("")];return c.selectAll(`g.${l}`).data(h,u=>u).join(u=>u.append("g").classed(l,!0),u=>u,u=>u.remove())}),T(1))}const F=({selection:c,pluginName:i,separateSeries$:o,seriesLabels$:n,seriesContainerPosition$:l})=>{const t=V({selection:c,pluginName:i,separateSeries$:o,seriesLabels$:n});return m({seriesCenterSelection:t,seriesContainerPosition:l}).pipe(d(async r=>r),D((r,h)=>r.seriesContainerPosition.length===h.seriesContainerPosition.length)).subscribe(r=>{r.seriesCenterSelection.attr("transform",(h,u)=>{const g=r.seriesContainerPosition[u]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:t,seriesContainerPosition:l}).pipe(d(async r=>r)).subscribe(r=>{r.seriesCenterSelection.transition().attr("transform",(h,u)=>{const g=r.seriesContainerPosition[u]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:t}},A="Pie";function q({enter:c,exit:i,data:o,lastTweenData:n,fullParams:l}){return!c.size()&&!i.size()?t=>{const r=o.map((h,u)=>{const g=n[u]??{startAngle:0,endAngle:0,value:0};return{...h,startAngle:h.startAngle*t+g.startAngle*(1-t),endAngle:h.endAngle*t+g.endAngle*(1-t),value:h.value*t+g.value*(1-t)}});return y(r,l.startAngle,l.endAngle,1)}:t=>y(o,l.startAngle,l.endAngle,t)}function y(c,i,o,n){return c.map((l,t)=>{const r=i+(l.startAngle-i)*n,h=r+(l.endAngle-l.startAngle)*n;return{...l,startAngle:r,endAngle:h}})}function v({selection:c,data:i,arc:o,pathClassName:n}){return c.selectAll("path").data(i,t=>t.id).join("path").classed(n,!0).style("cursor","pointer").attr("fill",(t,r)=>t.data.color).attr("d",(t,r)=>o(t))}function z({pathSelection:c,ids:i,fullChartParams:o,arc:n,arcHighlight:l}){if(c.interrupt("highlight"),!i.length){c.transition("highlight").style("opacity",1).attr("d",t=>n(t));return}c.each((t,r,h)=>{const u=w(h[r]);i.includes(t.data.id)?u.style("opacity",1).transition("highlight").ease(j).duration(500).attr("d",g=>l(g)):u.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>n(g))})}function X(c,i){const o=new R,n=M(c,"path");let l=[],t=[];const r=i.seriesContainerPosition$.pipe(p(o),P(s=>s.width<s.height?s.width:s.height),D()),h=new S(s=>{m({containerVisibleComputedLayoutData:i.containerVisibleComputedLayoutData$,fullParams:i.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const a=U({data:e.containerVisibleComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s.next(a)})}),u=new S(s=>{m({shorterSideWith:r,fullParams:i.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const a=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(a)})}),g=new S(s=>{m({shorterSideWith:r,fullParams:i.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const a=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadiusWhileHighlight,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(a)})}),$=i.fullChartParams$.pipe(p(o),P(s=>s.highlightTarget),D()),f=new S(s=>{m({pieData:h,arc:u,computedData:i.computedData$,fullParams:i.fullParams$,fullChartParams:i.fullChartParams$,highlightTarget:$}).pipe(p(o),d(async e=>e)).subscribe(e=>{i.containerSelection.interrupt("graphicMove");const a=i.containerSelection.selectAll("path").data(e.pieData,b=>b.id),k=a.enter(),H=a.exit(),N=q({enter:k,exit:H,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});i.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",(b,W)=>C=>{t=N(C),v({selection:i.containerSelection,data:t,arc:e.arc,pathClassName:n})}).on("end",(b,W)=>{t=y(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const C=v({selection:i.containerSelection,data:t,arc:e.arc,pathClassName:n});s.next(C),l=Object.assign([],e.pieData),i.event$.next({type:"series",pluginName:c,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})})})}).pipe(T(1));return m({pathSelection:f,SeriesDataMap:i.SeriesDataMap$,computedData:i.computedData$,highlightTarget:$}).pipe(p(o),d(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(e,a)=>{e.stopPropagation(),i.event$.next({type:"series",eventName:"mouseover",pluginName:c,highlightTarget:s.highlightTarget,datum:a.data,series:s.SeriesDataMap.get(a.data.seriesLabel),seriesIndex:a.data.seriesIndex,seriesLabel:a.data.seriesLabel,event:e,data:s.computedData})}).on("mousemove",(e,a)=>{e.stopPropagation(),i.event$.next({type:"series",eventName:"mousemove",pluginName:c,highlightTarget:s.highlightTarget,datum:a.data,series:s.SeriesDataMap.get(a.data.seriesLabel),seriesIndex:a.data.seriesIndex,seriesLabel:a.data.seriesLabel,event:e,data:s.computedData})}).on("mouseout",(e,a)=>{e.stopPropagation(),i.event$.next({type:"series",eventName:"mouseout",pluginName:c,highlightTarget:s.highlightTarget,datum:a.data,series:s.SeriesDataMap.get(a.data.seriesLabel),seriesIndex:a.data.seriesIndex,seriesLabel:a.data.seriesLabel,event:e,data:s.computedData})}).on("click",(e,a)=>{e.stopPropagation(),i.event$.next({type:"series",eventName:"click",pluginName:c,highlightTarget:s.highlightTarget,datum:a.data,series:s.SeriesDataMap.get(a.data.seriesLabel),seriesIndex:a.data.seriesIndex,seriesLabel:a.data.seriesLabel,event:e,data:s.computedData})})}),m({pathSelection:f,highlight:i.seriesHighlight$.pipe(P(s=>s.map(e=>e.id))),fullChartParams:i.fullChartParams$,arc:u,arcHighlight:g}).pipe(p(o),d(async s=>s)).subscribe(s=>{z({pathSelection:s.pathSelection,ids:s.highlight,fullChartParams:s.fullChartParams,arc:s.arc,arcHighlight:s.arcHighlight})}),()=>{o.next(void 0)}}const B=I(A,E)(({selection:c,name:i,subject:o,observer:n})=>{const l=new R,{seriesCenterSelection$:t}=F({selection:c,pluginName:A,separateSeries$:n.separateSeries$,seriesLabels$:n.seriesLabels$,seriesContainerPosition$:n.seriesContainerPosition$}),r=[];return t.pipe(p(l)).subscribe(h=>{r.forEach(u=>u()),h.each((u,g,$)=>{const f=w($[g]),s=n.visibleComputedLayoutData$.pipe(p(l),P(a=>a[g]??a[0])),e=n.seriesContainerPosition$.pipe(p(l),P(a=>a[g]??a[0]));r[g]=X(A,{containerSelection:f,computedData$:n.computedData$,containerVisibleComputedLayoutData$:s,SeriesDataMap$:n.SeriesDataMap$,fullParams$:n.fullParams$,fullChartParams$:n.fullChartParams$,seriesHighlight$:n.seriesHighlight$,seriesContainerPosition$:e,event$:o.event$})})}),()=>{l.next(void 0),r.forEach(h=>h())}});export{B as P,U as m,F as s};
