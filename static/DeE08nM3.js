import{S as O,f as x,t as h,s as S,d as D,e as P,g as L}from"./_HanNZE-.js";import{f as _,c as k,g as m}from"./InbBT3x0.js";import{l as B}from"./CD6lHqiY.js";function E({graphicGSelection:o,circleGClassName:n,circleClassName:t,visibleComputedLayoutData:y,fullParams:g,fullChartParams:a,graphicReverseScale:u}){const T=d=>{const p=d.size();return a.transitionDuration/p};let I=0;return o.each((d,p,f)=>{L(f[p]).selectAll("g").data(y[p],s=>s.id).join(s=>(I=T(s),s.append("g").classed(n,!0)),s=>s,s=>s.remove()).attr("transform",s=>`translate(${s.axisX}, ${s.axisY})`).each((s,v,G)=>{L(G[v]).selectAll("circle").data([s]).join(l=>l.append("circle").style("cursor","pointer").style("vector-effect","non-scaling-stroke").classed(t,!0).attr("opacity",0).transition().delay((b,c)=>v*I).attr("opacity",1),l=>l.transition().duration(50).attr("opacity",1),l=>l.remove()).attr("r",g.radius).attr("fill",(l,b)=>k({datum:l,colorType:g.fillColorType,fullChartParams:a})).attr("stroke",(l,b)=>k({datum:l,colorType:g.strokeColorType,fullChartParams:a})).attr("stroke-width",g.strokeWidth).attr("transform",`scale(${u[p][0]??1}, ${u[p][1]??1})`)})}),o.selectAll(`circle.${t}`)}function W({selection:o,ids:n,onlyShowHighlighted:t,fullChartParams:y}){if(o.interrupt("highlight"),!n.length){o.transition("highlight").duration(200).style("opacity",t===!0?0:1);return}o.each((g,a,u)=>{n.includes(g.id)?L(u[a]).style("opacity",1).transition("highlight").duration(200):L(u[a]).style("opacity",t===!0?0:y.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function X({defsSelection:o,clipPathData:n}){o.selectAll("clipPath").data(n).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,y,g)=>{L(g[y]).selectAll("rect").data([t]).join("rect").attr("x",0).attr("y",0).attr("width",a=>a.width).attr("height",a=>a.height)})}const Q=(o,{selection:n,computedData$:t,computedLayoutData$:y,visibleComputedData$:g,visibleComputedLayoutData$:a,seriesLabels$:u,SeriesDataMap$:T,GroupDataMap$:I,fullParams$:C,fullChartParams$:d,gridAxesTransform$:p,gridGraphicTransform$:f,gridGraphicReverseScale$:s,gridAxesSize$:v,gridHighlight$:G,gridContainerPosition$:l,event$:b})=>{const c=new O,w=_(o,"clipPath-box"),A=m(o,"circleG"),$=m(o,"circle"),{seriesSelection$:Y,axesSelection$:q,defsSelection$:j,graphicGSelection$:z}=B({selection:n,pluginName:o,clipPathID:w,seriesLabels$:u,gridContainerPosition$:l,gridAxesTransform$:p,gridGraphicTransform$:f}),R=x({computedData:t,gridGraphicReverseScale:s}).pipe(h(c),S(async e=>e),D(e=>e.computedData.map((r,i)=>e.gridGraphicReverseScale[i])));x({defsSelection:j,gridAxesSize:v}).pipe(h(c),S(async e=>e)).subscribe(e=>{const r=[{id:w,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];X({defsSelection:e.defsSelection,clipPathData:r})});const H=d.pipe(h(c),D(e=>e.highlightTarget),P()),M=x({graphicGSelection:z,visibleComputedLayoutData:a,graphicReverseScale:R,fullChartParams:d,fullParams:C}).pipe(h(c),S(async e=>e),D(e=>E({graphicGSelection:e.graphicGSelection,circleGClassName:A,circleClassName:$,visibleComputedLayoutData:e.visibleComputedLayoutData,fullParams:e.fullParams,fullChartParams:e.fullChartParams,graphicReverseScale:e.graphicReverseScale})));x({graphicSelection:M,computedData:t,SeriesDataMap:T,GroupDataMap:I,highlightTarget:H}).pipe(h(c),S(async e=>e)).subscribe(e=>{e.graphicSelection.on("mouseover",(r,i)=>{r.stopPropagation(),b.next({type:"grid",eventName:"mouseover",pluginName:o,highlightTarget:e.highlightTarget,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:r,data:e.computedData})}).on("mousemove",(r,i)=>{r.stopPropagation(),b.next({type:"grid",eventName:"mousemove",pluginName:o,highlightTarget:e.highlightTarget,data:e.computedData,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:r})}).on("mouseout",(r,i)=>{r.stopPropagation(),b.next({type:"grid",eventName:"mouseout",pluginName:o,highlightTarget:e.highlightTarget,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:r,data:e.computedData})}).on("click",(r,i)=>{r.stopPropagation(),b.next({type:"grid",eventName:"click",pluginName:o,highlightTarget:e.highlightTarget,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:r,data:e.computedData})})});const U=C.pipe(h(c),D(e=>e.onlyShowHighlighted),P());return d.pipe(h(c),S(e=>x({graphicSelection:M,highlight:G.pipe(D(r=>r.map(i=>i.id))),onlyShowHighlighted:U,fullChartParams:d}).pipe(h(c),S(async r=>r)))).subscribe(e=>{W({selection:e.graphicSelection,ids:e.highlight,onlyShowHighlighted:e.onlyShowHighlighted,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}};export{Q as c};
