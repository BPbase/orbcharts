import{g as B,b as R,k as V,o as X,q as Y}from"./B7hZ1RX6.js";import{o as Z,c as q,S as O,O as T,k as A,t as b,s as M,H as J,Z as K,m as I,j as F,l as N}from"./kGF9pzg7.js";import{i as Q}from"./Bz_gD2gR.js";function ee(o,n){return Z(function(t,l){var r=0;t.subscribe(q(l,function(s){return o.call(n,s,r++)&&l.next(s)}))})}function te({fullDataFormatter$:o,gridAxesSize$:n,computedData$:t,fullChartParams$:l}){const r=new O,s=new T(h=>{A({dataFormatter:o,computedData:t}).pipe(b(r),M(async a=>a)).subscribe(a=>{const D=a.computedData[0]?a.computedData[0].length-1:0,G=a.dataFormatter.groupAxis.scaleDomain[0]==="auto"?0-a.dataFormatter.groupAxis.scalePadding:a.dataFormatter.groupAxis.scaleDomain[0]-a.dataFormatter.groupAxis.scalePadding,f=a.dataFormatter.groupAxis.scaleDomain[1]==="auto"?D+a.dataFormatter.groupAxis.scalePadding:a.dataFormatter.groupAxis.scaleDomain[1]+a.dataFormatter.groupAxis.scalePadding,P=(a.dataFormatter.grid.seriesType==="row"?(a.computedData[0]??[]).map(m=>m.groupLabel):a.computedData.map(m=>m[0].groupLabel)).filter((m,w)=>w>=G&&w<=f);h.next(P)})});return new T(h=>{A({dataFormatter:o,axisSize:n,fullChartParams:l,scaleRangeGroupLabels:s}).pipe(b(r),M(async a=>a)).subscribe(a=>{const c=a.dataFormatter.valueAxis.position==="right"||a.dataFormatter.valueAxis.position==="bottom",D=J({axisLabels:a.scaleRangeGroupLabels,axisWidth:a.axisSize.width,reverse:c}),G=x=>a.dataFormatter.groupAxis.position==="bottom"||a.dataFormatter.groupAxis.position==="top"?x.offsetX-a.fullChartParams.padding.left:x.offsetY-a.fullChartParams.padding.top,f=x=>{const P=G(x),m=D(P);return{groupIndex:m,groupLabel:a.scaleRangeGroupLabels[m]??""}};return h.next(f),function(){r.next(void 0)}})})}const k="Lines",ae=R(k,"g"),ie=R(k,"path");function re(o="curveLinear"){return X().x(n=>n.axisX).y(n=>n.axisY).curve(Y[o])}function se(o){let n=[[]],t=0;for(let l in o){if(o[l].visible==!1||o[l].value===void 0||o[l].value===null){n[t].length&&(t++,n[t]=[]);continue}n[t].push(o[l])}return n}function ne({selection:o,segmentData:n,linePath:t,params:l}){return o.selectAll("path").data(n,(s,h)=>s.length?`${s[0].id}_${s[s.length-1].id}`:h).join(s=>s.append("path").classed(ie,!0).attr("fill","none").attr("pointer-events","visibleStroke").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),s=>s,s=>s.remove()).attr("stroke-width",l.lineWidth).attr("stroke",(s,h)=>s[0]&&s[0].color).attr("d",s=>t(s))}function oe({selection:o,seriesLabel:n,fullChartParams:t}){if(o.interrupt("highlight"),!n){o.transition("highlight").duration(200).style("opacity",1);return}o.each((l,r,s)=>{l===n?N(s[r]).style("opacity",1):N(s[r]).style("opacity",t.styles.unhighlightedOpacity)})}function pe({defsSelection:o,clipPathData:n,transitionDuration:t,transitionEase:l}){o.selectAll("clipPath").data(n).join(r=>r.append("clipPath"),r=>r,r=>r.remove()).attr("id",r=>r.id).each((r,s,h)=>{N(h[s]).selectAll("rect").data([r]).join(a=>{const c=a.append("rect");return c.transition().duration(t).ease(V(l)).tween("tween",(D,G,f)=>x=>{const P=D.width*x;c.attr("x",0).attr("y",0).attr("width",m=>P).attr("height",m=>m.height)}),c},a=>a.attr("x",0).attr("y",0).attr("width",c=>c.width).attr("height",c=>c.height),a=>a.remove())})}const he=K(k,Q)(({selection:o,name:n,observer:t,subject:l})=>{const r=new O,s=B(k,"clipPath-box"),h=o.append("g").attr("clip-path",`url(#${s})`),a=h.append("defs"),c=h.append("g"),D=new O;t.gridAxesTransform$.pipe(b(r),I(e=>e.value),F()).subscribe(e=>{h.style("transform",e)}),t.gridGraphicTransform$.pipe(b(r),I(e=>e.value),F()).subscribe(e=>{c.transition().duration(50).style("transform",e)});const G=new T(e=>{const p=t.fullParams$.pipe(b(r)).subscribe(d=>{if(!d)return;const L=re(d.lineCurve);e.next(L)});return()=>{p.unsubscribe()}}),f=new T(e=>{t.computedData$.pipe(b(r),M(async p=>p)).subscribe(p=>{const d=p[0]&&p[0][0]?p.map(L=>L[0].seriesLabel):[];e.next(d)})}),x=t.fullChartParams$.pipe(I(e=>e.transitionDuration),F()),P=t.fullChartParams$.pipe(I(e=>e.transitionEase),F());A({seriesLabels:f,axisSize:t.gridAxesSize$,transitionDuration:x,transitionEase:P}).pipe(b(r),M(async e=>e)).subscribe(e=>{const d=[{id:s,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(L=>({id:`orbcharts__clipPath_${L}`,width:e.axisSize.width,height:e.axisSize.height})));pe({defsSelection:a,clipPathData:d,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const m=t.computedData$.pipe(I(e=>{const p=new Map;return e.flat().forEach(d=>p.set(d.id,d)),p})),w=te({fullDataFormatter$:t.fullDataFormatter$,gridAxesSize$:t.gridAxesSize$,computedData$:t.computedData$,fullChartParams$:t.fullChartParams$}),U=t.fullChartParams$.pipe(b(r),I(e=>e.highlightTarget),F());A({seriesLabels:f,computedData:t.computedData$,SeriesDataMap:t.SeriesDataMap$,GroupDataMap:t.GroupDataMap$,linePath:G,params:t.fullParams$,highlightTarget:U,gridGroupPositionFn:w}).pipe(b(r),M(async e=>e)).subscribe(e=>{const p=c.selectAll("g").data(e.seriesLabels,(C,_)=>C),d=p.enter().append("g").classed(ae,!0);p.exit().remove();const L=p.merge(d).attr("clip-path",(C,_)=>`url(#orbcharts__clipPath_${C})`);L.each((C,_,W)=>{const j=se(e.computedData[_]??[]);ne({selection:N(W[_]),linePath:e.linePath,segmentData:j,params:e.params}).on("mouseover",(u,g)=>{u.stopPropagation();const $=g[0]?g[0].seriesLabel:"",{groupIndex:z,groupLabel:S}=e.gridGroupPositionFn(u),i=e.GroupDataMap.get(S).find(y=>y.seriesLabel===$)??g[0];l.event$.next({type:"grid",eventName:"mouseover",pluginName:n,highlightTarget:e.highlightTarget,datum:i,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:u,data:e.computedData})}).on("mousemove",(u,g)=>{u.stopPropagation();const $=g[0]?g[0].seriesLabel:"",{groupIndex:z,groupLabel:S}=e.gridGroupPositionFn(u),i=e.GroupDataMap.get(S).find(y=>y.seriesLabel===$)??g[0];l.event$.next({type:"grid",eventName:"mousemove",pluginName:n,highlightTarget:e.highlightTarget,datum:i,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:u,data:e.computedData})}).on("mouseout",(u,g)=>{u.stopPropagation();const $=g[0]?g[0].seriesLabel:"",{groupIndex:z,groupLabel:S}=e.gridGroupPositionFn(u),i=e.GroupDataMap.get(S).find(y=>y.seriesLabel===$)??g[0];l.event$.next({type:"grid",eventName:"mouseout",pluginName:n,highlightTarget:e.highlightTarget,datum:i,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:u,data:e.computedData})}).on("click",(u,g)=>{u.stopPropagation();const $=g[0]?g[0].seriesLabel:"",{groupIndex:z,groupLabel:S}=e.gridGroupPositionFn(u),i=e.GroupDataMap.get(S).find(y=>y.seriesLabel===$)??g[0];l.event$.next({type:"grid",eventName:"click",pluginName:n,highlightTarget:e.highlightTarget,datum:i,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,groups:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:u,data:e.computedData})})}),D.next(L)});const H=t.gridHighlight$.subscribe();return t.fullChartParams$.pipe(b(r),ee(e=>e.highlightTarget==="series"),M(e=>A({graphicSelection:D,highlight:t.gridHighlight$,DataMap:m,fullChartParams:t.fullChartParams$}).pipe(b(r),M(async p=>p)))).subscribe(e=>{const p=e.DataMap.get(e.highlight[0]);oe({selection:e.graphicSelection,seriesLabel:p&&p.seriesLabel?p.seriesLabel:null,fullChartParams:e.fullChartParams})}),()=>{H.unsubscribe(),r.next(void 0)}});export{he as L,ee as f,te as g};
