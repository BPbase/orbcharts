import{a as _,p as N,t as b,l as T,m as D,d as L,k as R,s as B,bd as U,bp as v,u as Y,g as z,bf as J,bJ as K,bK as q,bc as Q,b as w,C as G,a2 as Z,L as tt,a3 as et,ap as at,a4 as nt,j as it}from"./Cc0KHcL0.js";import{e as M,f as rt,r as ot,g as lt,c as st}from"./B9Xde_Gs.js";import{o as H}from"./DYxtxmRw.js";const ct="end",ut="middle",pt="end",gt="auto";function ht({selection:a,textClassName:o,fullParams:t,containerSize:i,fullDataFormatter:l,fullChartParams:n,textReverseTransform:x}){const h=t.barLabel.padding-t.axisLabel.offset[0],d=-t.barLabel.padding-t.axisLabel.offset[1];let e=-h,c=-d;a.attr("transform",s=>`translate(0, ${i.height})`).selectAll("text").data([t]).join(s=>s.append("text").style("font-weight","bold"),s=>s,s=>s.remove()).attr("text-anchor",pt).attr("dominant-baseline",gt).attr("font-size",n.styles.textSize).style("fill",U(t.axisLabel.colorType,n)).attr("x",e).attr("y",c).text(s=>l.yAxis.label)}function bt({selection:a,fullParams:o,fullChartParams:t,rankingScale:i,valueScale:l,categoryData:n}){const x=o.barLabel.position==="none"?[]:n;return a.selectAll("text").data(x,d=>d.id).join(d=>d.append("text").style("font-weight","bold").attr("x",e=>l(e.value[e.xValueIndex]??0)-o.barLabel.padding).attr("y",e=>i(e.label)),d=>d.transition().duration(t.transitionDuration).ease(v).attr("x",e=>l(e.value[e.xValueIndex]??0)-o.barLabel.padding).attr("y",e=>i(e.label)),d=>d.remove()).attr("text-anchor",ct).attr("dominant-baseline",ut).attr("font-size",t.styles.textSize).style("fill",d=>Y({colorType:o.barLabel.colorType,fullChartParams:t,datum:d})).text(d=>d.label)}function dt({defsSelection:a,clipPathData:o}){a.selectAll("clipPath").data(o).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,i,l)=>{B(l[i]).selectAll("rect").data([t]).join(n=>n.append("rect"),n=>n,n=>n.remove()).attr("x",n=>-n.width).attr("y",0).attr("width",n=>n.width*2).attr("height",n=>n.height)})}const xt=(a,{selection:o,computedData$:t,visibleComputedRankingData$:i,rankingScaleList$:l,xScale$:n,fullParams$:x,fullDataFormatter$:h,fullChartParams$:d,containerPosition$:e,containerSize$:c,isCategorySeprate$:s})=>{const f=new _,$=z(a,"box"),u=z(a,"text"),m=N(a,"clipPath-box"),S=M({selection:o,pluginName:a,clipPathID:null,computedData$:t,containerPosition$:e,isCategorySeprate$:s}).pipe(b(f)),k=e.pipe(b(f),T(async p=>p),D(p=>`${`scale(${1/p[0].scale[0]}, ${1/p[0].scale[1]})`}`),L()),P=x.pipe(D(p=>p.barLabel.position),L(),T(p=>J(()=>p==="inside",n,H(()=>0))));return c.subscribe(p=>{const A=o.selectAll("defs").data([m]).join("defs"),y=[{id:m,width:p.width,height:p.height}];dt({defsSelection:A,clipPathData:y})}),R({containerSelection:S,fullParams:x,containerSize:c,fullDataFormatter:h,fullChartParams:d,visibleComputedRankingData:i,rankingScaleList:l,valueScale:P,textReverseTransform:k}).pipe(b(f),T(async p=>p)).subscribe(p=>{p.containerSelection.each((A,y,I)=>{const V=B(I[y]),r=p.rankingScaleList[y];if(!r)return;const C=V.selectAll(`g.${$}`).data([y]).join("g").attr("class",$).attr("clip-path",`url(#${m})`),g=V.selectAll(`g.${u}`).data([p.fullParams]).join("g").classed(u,!0);bt({selection:C,fullParams:p.fullParams,fullChartParams:p.fullChartParams,rankingScale:r,categoryData:p.visibleComputedRankingData[y],valueScale:p.valueScale}),ht({selection:g,textClassName:u,fullParams:p.fullParams,containerSize:p.containerSize,fullDataFormatter:p.fullDataFormatter,fullChartParams:p.fullChartParams,textReverseTransform:p.textReverseTransform})})}),()=>{f.next(void 0)}},yt="start",$t="middle";function mt({selection:a,fullParams:o,fullChartParams:t,rankingScale:i,xScale:l,categoryData:n,computedRankingAmount:x}){const h=n.slice(0,x+1);return a.selectAll("g").data(h,c=>c.id).join(c=>c.append("g").attr("transform",s=>`translate(${l(s.value[s.xValueIndex]??0)+o.padding}, ${i(s.label)})`),c=>c.transition().duration(t.transitionDuration).ease(v).attr("transform",s=>`translate(${l(s.value[s.xValueIndex]??0)+o.padding}, ${i(s.label)})`),c=>c.remove()).each((c,s,f)=>{B(f[s]).selectAll("text").data([c]).join(u=>u.append("text"),u=>u,u=>u.remove()).attr("text-anchor",yt).attr("dominant-baseline",$t).attr("font-size",t.styles.textSize).style("fill",U(o.colorType,t)).transition().duration(t.transitionDuration).ease(v).textTween(u=>{const m=u.xValueIndex,S=m===0?0:m-1,k=u.value[S],P=u.value[m];return p=>{const A=p===1?K(k,P)(p):q(k,P)(p);return Q(A,o.format)}})}).selectAll("text")}function ft({defsSelection:a,clipPathData:o}){a.selectAll("clipPath").data(o).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,i,l)=>{B(l[i]).selectAll("rect").data([t]).join(n=>n.append("rect"),n=>n,n=>n.remove()).attr("x",n=>0).attr("y",0).attr("width",n=>n.width*1.5).attr("height",n=>n.height)})}const St=(a,{selection:o,computedData$:t,visibleComputedRankingData$:i,rankingScaleList$:l,xScale$:n,computedRankingAmount$:x,fullParams$:h,fullChartParams$:d,containerPosition$:e,containerSize$:c,isCategorySeprate$:s})=>{const f=new _,$=z(a,"box"),u=N(a,"clipPath-box"),m=M({selection:o,pluginName:a,clipPathID:null,computedData$:t,containerPosition$:e,isCategorySeprate$:s}).pipe(b(f));return c.subscribe(S=>{const k=o.selectAll("defs").data([u]).join("defs"),P=[{id:u,width:S.width,height:S.height}];ft({defsSelection:k,clipPathData:P})}),R({containerSelection:m,fullParams:h,fullChartParams:d,visibleComputedRankingData:i,rankingScaleList:l,xScale:n,computedRankingAmount:x}).pipe(b(f),T(async S=>S)).subscribe(S=>{S.containerSelection.each((k,P,p)=>{const A=B(p[P]),y=S.rankingScaleList[P];if(!y)return;const I=A.selectAll(`g.${$}`).data([P]).join("g").attr("class",$).attr("clip-path",`url(#${u})`);mt({selection:I,fullParams:S.fullParams,fullChartParams:S.fullChartParams,rankingScale:y,categoryData:S.visibleComputedRankingData[P],xScale:S.xScale,computedRankingAmount:S.computedRankingAmount})})}),()=>{f.next(void 0)}};function Dt({containerSelection:a,visibleComputedRankingData:o,rankingScaleList:t,transitionDuration:i}){return a.each((n,x,h)=>{B(h[x]).selectAll("g").data(o[x]??[],e=>e.id).join(e=>e.append("g").attr("cursor","pointer").attr("transform",c=>`translate(0, ${t[x]&&t[x](c.label)})`),e=>e.transition().duration(i).ease(v).attr("transform",c=>`translate(0, ${t[x]&&t[x](c.label)})`),e=>e.remove())}),a.selectAll("g")}function Ct({graphicGSelection:a,rectClassName:o,xScale:t,fullParams:i,barWidth:l,transitionDuration:n}){return a.each((h,d,e)=>{const c=l/2,s=i.bar.barRadius===!0?c:i.bar.barRadius===!1?0:typeof i.bar.barRadius=="number"?i.bar.barRadius:0;B(e[d]).selectAll(`rect.${o}`).data([h],$=>$.id).join($=>$.append("rect").classed(o,!0).attr("cursor","pointer").attr("width",u=>t(u.value[u.xValueIndex])??1).attr("height",l),$=>$.transition().duration(n).ease(v).attr("width",u=>t(u.value[u.xValueIndex])??1).attr("height",l),$=>$.remove()).attr("transform",`translate(0, ${-c})`).attr("fill",$=>$.color).attr("rx",s).attr("ry",s)}),a.selectAll(`rect.${o}`)}function At({defsSelection:a,clipPathData:o}){a.selectAll("clipPath").data(o).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,i,l)=>{B(l[i]).selectAll("rect").data([t]).join(n=>n.append("rect"),n=>n,n=>n.remove()).attr("x",0).attr("y",0).attr("width",n=>n.width).attr("height",n=>n.height)})}function Pt({selection:a,ids:o,fullChartParams:t}){if(a.interrupt("highlight"),!o.length){a.transition("highlight").duration(200).style("opacity",1);return}a.each((i,l,n)=>{o.includes(i.id)?B(n[l]).style("opacity",1):B(n[l]).style("opacity",t.styles.unhighlightedOpacity)})}const Tt=(a,{selection:o,computedData$:t,visibleComputedRankingData$:i,CategoryDataMap$:l,fullParams$:n,fullChartParams$:x,highlight$:h,rankingItemHeight$:d,rankingScaleList$:e,containerPosition$:c,containerSize$:s,xScale$:f,isCategorySeprate$:$,event$:u})=>{const m=new _,S=N(a,"clipPath-box"),k=z(a,"rect"),P=M({selection:o,pluginName:a,clipPathID:S,computedData$:t,containerPosition$:c,isCategorySeprate$:$}).pipe(b(m));s.subscribe(r=>{const C=o.selectAll("defs").data([S]).join("defs"),g=[{id:S,width:r.width,height:r.height}];At({defsSelection:C,clipPathData:g})});const p=R({fullParams:n,rankingItemHeight:d}).pipe(b(m),T(async r=>r),D(r=>r.fullParams.bar.barWidth?r.fullParams.bar.barWidth:r.rankingItemHeight-r.fullParams.bar.barPadding),L()),A=x.pipe(b(m),D(r=>r.transitionDuration),L()),y=R({containerSelection:P,visibleComputedRankingData:i,rankingScaleList:e,transitionDuration:A}).pipe(b(m),T(async r=>r),D(r=>Dt({containerSelection:r.containerSelection,visibleComputedRankingData:r.visibleComputedRankingData,rankingScaleList:r.rankingScaleList,transitionDuration:r.transitionDuration}))),I=R({graphicGSelection:y,xScale:f,barWidth:p,transitionDuration:A,fullParams:n}).pipe(b(m),T(async r=>r),D(r=>Ct({graphicGSelection:r.graphicGSelection,rectClassName:k,xScale:r.xScale,fullParams:r.fullParams,barWidth:r.barWidth,transitionDuration:r.transitionDuration})),w(1)),V=x.pipe(b(m),D(r=>r.highlightTarget),L());return R({graphicSelection:I,computedData:t,CategoryDataMap:l,highlightTarget:V}).pipe(b(m),T(async r=>r)).subscribe(r=>{r.graphicSelection.on("mouseover",(C,g)=>{g._visibleValue=[g.value[g.xValueIndex]],u.next({type:"multiValue",eventName:"mouseover",pluginName:a,highlightTarget:r.highlightTarget,datum:g,category:r.CategoryDataMap.get(g.categoryLabel),categoryIndex:g.categoryIndex,categoryLabel:g.categoryLabel,data:r.computedData,event:C})}).on("mousemove",(C,g)=>{g._visibleValue=[g.value[g.xValueIndex]],u.next({type:"multiValue",eventName:"mousemove",pluginName:a,highlightTarget:r.highlightTarget,datum:g,category:r.CategoryDataMap.get(g.categoryLabel),categoryIndex:g.categoryIndex,categoryLabel:g.categoryLabel,data:r.computedData,event:C})}).on("mouseout",(C,g)=>{u.next({type:"multiValue",eventName:"mouseout",pluginName:a,highlightTarget:r.highlightTarget,datum:g,category:r.CategoryDataMap.get(g.categoryLabel),categoryIndex:g.categoryIndex,categoryLabel:g.categoryLabel,data:r.computedData,event:C})}).on("click",(C,g)=>{g._visibleValue=[g.value[g.xValueIndex]],u.next({type:"multiValue",eventName:"click",pluginName:a,highlightTarget:r.highlightTarget,datum:g,category:r.CategoryDataMap.get(g.categoryLabel),categoryIndex:g.categoryIndex,categoryLabel:g.categoryLabel,data:r.computedData,event:C})})}),R({graphicSelection:I,highlight:h.pipe(D(r=>r.map(C=>C.id))),fullChartParams:x}).pipe(b(m),T(async r=>r)).subscribe(r=>{Pt({selection:r.graphicSelection,ids:r.highlight,fullChartParams:r.fullChartParams})}),()=>{m.next(void 0)}},j="RacingBars",Lt={name:j,defaultParams:Z,layerIndex:tt,validator:(a,{validateColumns:o})=>{const t=o(a,{bar:{toBeTypes:["object"]},barLabel:{toBeTypes:["object"]},valueLabel:{toBeTypes:["object"]},axisLabel:{toBeTypes:["object"]},rankingAmount:{toBe:'number | "auto"',test:i=>typeof i=="number"||i==="auto"},autorun:{toBeTypes:["boolean"]},loop:{toBeTypes:["boolean"]}});if(a.bar){const i=o(a.bar,{barWidth:{toBeTypes:["number"]},barPadding:{toBeTypes:["number"]},barRadius:{toBeTypes:["number","boolean"]}});if(i.status==="error")return i}if(a.barLabel){const i=o(a.barLabel,{position:{toBe:'"inside" | "outside" | "none"',test:l=>l==="inside"||l==="outside"||l==="none"},padding:{toBeTypes:["number"]},rotate:{toBeTypes:["number"]},colorType:{toBeOption:"ColorType"}});if(i.status==="error")return i}if(a.valueLabel){const i=o(a.valueLabel,{padding:{toBeTypes:["number"]},colorType:{toBeOption:"ColorType"},format:{toBeTypes:["Function"]}});if(i.status==="error")return i}if(a.axisLabel){const i=o(a.axisLabel,{offset:{toBe:"[number, number]",test:l=>Array.isArray(l)&&l.length===2&&typeof l[0]=="number"&&typeof l[1]=="number"},colorType:{toBeOption:"ColorType"}});if(i.status==="error")return i}return t}},wt=G(Lt)(({selection:a,name:o,observer:t,subject:i})=>{const l=a.append("g").attr("class",`${j}-bars`),n=a.append("g").attr("class",`${j}-labels`),x=a.append("g").attr("class",`${j}-valueLabels`),h=new _,d=t.fullParams$.pipe(b(h),D(y=>y.valueLabel)),e=t.fullParams$.pipe(b(h),D(y=>y.rankingAmount),L()),c=rt({containerSize$:t.containerSize$,visibleComputedData$:t.visibleComputedData$,textSizePx$:t.textSizePx$,rankingAmount$:e}).pipe(b(h),w(1)),s=ot({containerSize$:t.containerSize$,textSizePx$:t.textSizePx$,computedRankingAmount$:c}).pipe(b(h),w(1)),f=lt({visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,rankingItemHeight$:s}).pipe(b(h),w(1)),$=xt(`${j}-labels`,{selection:n,computedData$:t.computedData$,visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,rankingScaleList$:f,xScale$:t.xScale$,fullParams$:t.fullParams$,fullDataFormatter$:t.fullDataFormatter$,fullChartParams$:t.fullChartParams$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,isCategorySeprate$:t.isCategorySeprate$}),u=St(`${j}-valueLabels`,{selection:x,computedData$:t.computedData$,visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,rankingScaleList$:f,xScale$:t.xScale$,computedRankingAmount$:c,fullParams$:d,fullChartParams$:t.fullChartParams$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,isCategorySeprate$:t.isCategorySeprate$}),m=Tt(`${j}-bars`,{selection:l,computedData$:t.computedData$,visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,CategoryDataMap$:t.CategoryDataMap$,fullParams$:t.fullParams$,fullChartParams$:t.fullChartParams$,highlight$:t.highlight$,rankingItemHeight$:s,rankingScaleList$:f,xScale$:t.xScale$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,isCategorySeprate$:t.isCategorySeprate$,event$:i.event$}),S=t.visibleComputedRankingByIndexData$.pipe(b(h),D(y=>(y[0]&&y[0][0]&&y[0][0].value.length)??0),L()),k=t.fullParams$.pipe(b(h),D(y=>y.autorun),L()),P=t.fullParams$.pipe(b(h),D(y=>y.loop),L()),p=t.fullChartParams$.pipe(b(h),D(y=>y.transitionDuration),L());let A=!0;return R({autorun:k,loop:P,valueAmount:S,tickDurationPeriod:p,fullDataFormatter:t.fullDataFormatter$}).pipe(b(h),T(async y=>y)).subscribe(({autorun:y,loop:I,valueAmount:V,tickDurationPeriod:r,fullDataFormatter:C})=>{if(A!=!1&&y){const g=C.xAxis.valueIndex+1;g<V?(A=!1,setTimeout(()=>{i.dataFormatter$.next({...C,xAxis:{...C.xAxis,valueIndex:g}}),A=!0},r)):g>=V&&I&&(A=!1,setTimeout(()=>{i.dataFormatter$.next({...C,xAxis:{...C.xAxis,valueIndex:0}}),A=!0},r))}}),()=>{h.next(void 0),$(),u(),m()}}),E="RacingCounterTexts",X=z(E,"container"),F=z(E,"box"),O=z(E,"text"),Rt={name:E,defaultParams:et,layerIndex:at,validator:(a,{validateColumns:o})=>o(a,{renderFn:{toBeTypes:["Function"]},textAttrs:{toBeTypes:["object[]"]},textStyles:{toBeTypes:["object[]"]},paddingRight:{toBeTypes:["number"]},paddingBottom:{toBeTypes:["number"]}})};function Bt({selection:a,data:o,fullParams:t,containerSize:i}){const l=i.width-t.paddingRight,n=i.height-t.paddingBottom;return a.selectAll(`g.${F}`).data([F]).join("g").classed(F,!0).attr("transform",`translate(${l}, ${n})`).each((h,d,e)=>{B(e[d]).selectAll(`text.${O}`).data(o).join("text").classed(O,!0).each((s,f,$)=>{const u=B($[f]).text(s.text);Object.keys(s.attr).forEach(m=>{u.attr(m,s.attr[m])}),Object.keys(s.style).forEach(m=>{u.style(m,s.style[m])})})}).selectAll(`text.${O}`)}function kt({computedData:a,valueLabel:o,valueIndex:t,renderFn:i,textAttrs:l,textStyles:n}){const x=o||String(t),h=i(x,t,a);return(Array.isArray(h)?h:[h]).map((e,c)=>({text:e,attr:l[c],style:n[c]}))}function It(a,o){const t=new _;return R({textData:o.textData$,fullParams:o.fullParams$,containerSize:o.containerSize$}).pipe(b(t)).subscribe(i=>{Bt({selection:o.containerSelection,data:i.textData,fullParams:i.fullParams,containerSize:i.containerSize})}),()=>{t.next(void 0)}}const Ft=G(Rt)(({selection:a,name:o,observer:t,subject:i})=>{const l=new _,n=R({computedData:t.computedData$.pipe(L((e,c)=>e.length===c.length)),isCategorySeprate:t.isCategorySeprate$}).pipe(b(l),T(async e=>e),D(e=>e.isCategorySeprate?e.computedData:[e.computedData[0]]),D((e,c)=>a.selectAll(`g.${X}`).data(e,s=>s[0]?s[0].categoryIndex:c).join("g").classed(X,!0)));n.pipe(b(l),D((e,c)=>e.selectAll(`g.${F}`).data([F]).join("g").classed(F,!0))),R({containerSelection:n,gridContainerPosition:t.containerPosition$}).pipe(b(l),T(async e=>e)).subscribe(e=>{e.containerSelection.attr("transform",(c,s)=>{const f=e.gridContainerPosition[s]??e.gridContainerPosition[0],$=f.translate;return f.scale,`translate(${$[0]}, ${$[1]})`})});const x=R({xyValueIndex:t.xyValueIndex$,fullDataFormatter:t.fullDataFormatter$}).pipe(b(l),T(async e=>e),D(e=>e.fullDataFormatter.valueLabels[e.xyValueIndex[0]]??""),L(),w(1)),h=R({xyValueIndex:t.xyValueIndex$,valueLabel:x,computedData:t.computedData$,fullParams:t.fullParams$}).pipe(b(l),T(async e=>e),D(e=>kt({valueIndex:e.xyValueIndex[0],valueLabel:e.valueLabel,computedData:e.computedData,renderFn:e.fullParams.renderFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles})),w(1)),d=[];return n.pipe(b(l)).subscribe(e=>{d.forEach(c=>c()),e.each((c,s,f)=>{const $=B(f[s]);t.visibleComputedRankingByIndexData$.pipe(b(l),D(u=>u[s]??u[0])),t.containerPosition$.pipe(b(l),D(u=>u[s]??u[0])),d[s]=It(E,{containerSelection:$,textData$:h,fullParams$:t.fullParams$,valueLabel$:x,xyValueIndex$:t.xyValueIndex$,containerSize$:t.containerSize$})})}),()=>{l.next(void 0),d.forEach(e=>e())}}),W="RacingValueAxis",Vt={name:W,defaultParams:nt,layerIndex:it,validator:(a,{validateColumns:o})=>{const t=o(a,{labelOffset:{toBe:"[number, number]",test:i=>Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"},labelColorType:{toBeOption:"ColorType"},axisLineVisible:{toBeTypes:["boolean"]},axisLineColorType:{toBeOption:"ColorType"},ticks:{toBeTypes:["number","null"]},tickFormat:{toBeTypes:["string","Function"]},tickLineVisible:{toBeTypes:["boolean"]},tickPadding:{toBeTypes:["number"]},tickFullLine:{toBeTypes:["boolean"]},tickFullLineDasharray:{toBeTypes:["string"]},tickColorType:{toBeOption:"ColorType"},tickTextColorType:{toBeOption:"ColorType"}});return t.status==="error",t}},vt=G(Vt)(({selection:a,name:o,observer:t,subject:i})=>{const l=new _,n=t.fullChartParams$.pipe(b(l),D(h=>h.transitionDuration),L()),x=st(W,{selection:a,position$:H("top"),transitionDuration$:n,computedData$:t.computedData$,fullParams$:t.fullParams$,fullDataFormatter$:t.fullDataFormatter$,fullChartParams$:t.fullChartParams$,isCategorySeprate$:t.isCategorySeprate$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,xScale$:t.xScale$});return()=>{l.next(void 0),x()}});export{wt as R,Ft as a,vt as b};
