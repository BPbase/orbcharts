import{L as C,s as x,m,l as $,j as O,k as v,r as P,i as p,h as S,M as A,A as F,N as E}from"./DimhisTc.js";const M=n=>{const{data:e=[],dataFormatter:i,chartParams:t}=n,a=new Map(i.categoryLabels.map((r,u)=>[r,u]));let o={id:"",index:0,label:"",description:"",categoryIndex:0,categoryLabel:"",color:"",visible:!0,data:{},value:0,level:0,seq:0,children:[]};try{const r=function(){if(C(e)===!0)return JSON.parse(JSON.stringify(e));if(Array.isArray(e)===!1)return{id:""};let s;const d=new Map;e.forEach(l=>{if(!l.parent)s=l;else{const c=d.get(l.parent)??[];c.push(l),d.set(l.parent,c)}});const f=l=>({id:l.id,label:l.label,data:l.data,value:l.value,categoryLabel:l.categoryLabel,children:(d.get(l.id)??[]).map(c=>f(c))});return s?f(s):{id:""}}();let u=0;const y=(s,d,f)=>{const l=d+1,c=s.categoryLabel??null;let h=0;c!=null&&(a.has(c)||a.set(c,a.size),h=a.get(c)??0);const b=u;u++;const g={id:s.id,index:b,level:d,seq:f,label:s.label??"",description:s.description??"",categoryIndex:h,categoryLabel:c,color:x(h,t),data:s.data??{},value:s.value,visible:!0,children:(s.children??[]).map((D,L)=>y(D,l,L))};return g.visible=i.visibleFilter(g,n),g};o=y(r,0,0)}catch(r){throw Error(r)}return o},T=({computedData$:n})=>n.pipe(m(e=>{function i(t,a){return t.push(a),a.children&&a.children.forEach(o=>{t=i(t,o)}),t}return i([],e)})),w=({nodeList$:n,fullDataFormatter$:e})=>{const i=e.pipe(m(t=>t.categoryLabels),$((t,a)=>JSON.stringify(t).length===JSON.stringify(a).length));return O({nodeList:n,categoryLabels:i}).pipe(v(async t=>t),m(t=>{const a=new Set(t.categoryLabels),o=new Set(t.nodeList.filter(r=>r.visible).map(r=>r.categoryLabel));return Array.from(o).forEach(r=>{a.has(r)||a.add(r)}),Array.from(a).forEach(r=>{o.has(r)||o.delete(r)}),Array.from(a)}),$((t,a)=>JSON.stringify(t).length===JSON.stringify(a).length))},J=({computedData$:n})=>n.pipe(m(e=>{function i(t){return t.children&&(t.children=t.children.filter(a=>a.visible).map(a=>i(a))),t}return i(e)})),N=({subject:n,observer:e})=>{const i=P(e.fullChartParams$).pipe(p(1)),t=T({computedData$:e.computedData$}).pipe(p(1)),a=S({datumList$:t,fullChartParams$:e.fullChartParams$,event$:n.event$}).pipe(p(1)),o=w({nodeList$:t,fullDataFormatter$:e.fullDataFormatter$}).pipe(p(1)),r=A({datumList$:t}).pipe(p(1)),u=J({computedData$:e.computedData$}).pipe(p(1));return{fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,fullDataFormatter$:e.fullDataFormatter$,computedData$:e.computedData$,layout$:e.layout$,textSizePx$:i,treeHighlight$:a,existCategoryLabels$:o,CategoryDataMap$:r,visibleComputedData$:u}};class I extends F{constructor(e,i){super({defaultDataFormatter:E,computedDataFn:M,contextObserverFn:N},e,i)}}export{I as T};
