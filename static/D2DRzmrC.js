import{S as ee,e as h,t as u,s as g,m as f,c as w}from"./BILlwXT2.js";import{s as B,t as te,d as le,c as F,g as $}from"./C39DfsNA.js";const se={listRectWidth:14,listRectHeight:14,listRectRadius:0},oe=(b,{rootSelection:I,seriesLabels$:z,fullParams$:c,layout$:Y,fullChartParams$:L})=>{const H=$(b,"root-position"),U=$(b,"legend-card"),q=$(b,"legend-list"),M=$(b,"legend-item"),a=new ee,G=h({seriesLabels:z,fullChartParams:L}).pipe(u(a),g(async e=>e),f(e=>{const l=new Map;let t=0;return e.seriesLabels.forEach((s,i)=>{if(!l.has(s)){const o=te(t,e.fullChartParams);l.set(s,o),t++}}),l})),J=z.pipe(u(a),f(e=>{const l=new Set;let t=[];return e.forEach(s=>{l.has(s)?t.push(!1):t.push(!0),l.add(s)}),t})),A=c.pipe(u(a),f(e=>e.position==="bottom"||e.position==="top"?"row":"column")),K=h({fullParams:c,layout:Y}).pipe(u(a),g(async e=>e),f(e=>{const l=e.fullParams.padding*2+e.fullParams.gap*2;return e.fullParams.position==="bottom"||e.fullParams.position==="top"?e.layout.rootWidth-l:e.layout.rootHeight-l})),O=h({layout:Y,fullParams:c}).pipe(u(a),g(async e=>e),f(e=>{let l=0,t=0;return e.fullParams.position==="bottom"?(t=e.layout.rootHeight,e.fullParams.justify==="start"?l=0:e.fullParams.justify==="center"?l=e.layout.rootWidth/2:e.fullParams.justify==="end"&&(l=e.layout.rootWidth)):e.fullParams.position==="right"?(l=e.layout.rootWidth,e.fullParams.justify==="start"?t=0:e.fullParams.justify==="center"?t=e.layout.rootHeight/2:e.fullParams.justify==="end"&&(t=e.layout.rootHeight)):e.fullParams.position==="top"?(t=0,e.fullParams.justify==="start"?l=0:e.fullParams.justify==="center"?l=e.layout.rootWidth/2:e.fullParams.justify==="end"&&(l=e.layout.rootWidth)):e.fullParams.position==="left"&&(l=0,e.fullParams.justify==="start"?t=0:e.fullParams.justify==="center"?t=e.layout.rootHeight/2:e.fullParams.justify==="end"&&(t=e.layout.rootHeight)),{x:l,y:t}})).pipe(u(a),f(e=>I.selectAll(`g.${H}`).data([e]).join(l=>l.append("g").classed(H,!0).attr("transform",t=>`translate(${t.x}, ${t.y})`),l=>l.transition().attr("transform",t=>`translate(${t.x}, ${t.y})`),l=>l.remove()))),Q=c.pipe(u(a),f(e=>e.seriesList[0]?e.seriesList[0]:se)),D=h({visibleList:J,fullParams:c,fullChartParams:L,seriesLabels:z,lineDirection:A,lineMaxSize:K,defaultListStyle:Q,SeriesLabelColorMap:G}).pipe(u(a),g(async e=>e),f(e=>e.seriesLabels.reduce((l,t,s)=>{if(!e.visibleList[s])return l;const i=le(t,e.fullChartParams.styles.textSize),o=e.fullChartParams.styles.textSize*1.5+i,P=e.SeriesLabelColorMap.get(t),p=l[0]&&l[0][0]?l[l.length-1][l[l.length-1].length-1]:null,{translateX:r,translateY:X,lineIndex:y,itemIndex:d}=((m,T,n)=>{let C=0,R=0,S=0,j=0;if(m.lineDirection==="column"){let W=n?n.translateY+m.fullChartParams.styles.textSize+m.fullParams.gap:0;if(W+m.fullChartParams.styles.textSize>m.lineMaxSize){S=n.lineIndex+1,j=0,R=0;const _=T[T.length-1].reduce((E,N)=>N.itemWidth>E?N.itemWidth:E,0);C=n.translateX+_+m.fullParams.gap}else S=n?n.lineIndex:0,j=n?n.itemIndex+1:0,R=W,C=n?n.translateX:0}else{let W=n?n.translateX+n.itemWidth+m.fullParams.gap:0;W+o>m.lineMaxSize?(S=n.lineIndex+1,j=0,C=0):(S=n?n.lineIndex:0,j=n?n.itemIndex+1:0,C=W),R=(m.fullChartParams.styles.textSize+m.fullParams.gap)*S}return{translateX:C,translateY:R,lineIndex:S,itemIndex:j}})(e,l,p);l[y]||(l[y]=[]);const x=e.fullParams.seriesList[d]?e.fullParams.seriesList[d]:e.defaultListStyle;return l[y].push({id:t,seriesLabel:t,seriesIndex:s,lineIndex:y,itemIndex:d,text:t,itemWidth:o,translateX:r,translateY:X,color:P,listRectWidth:x.listRectWidth,listRectHeight:x.listRectHeight,listRectRadius:x.listRectRadius}),l},[])),B(1)),k=h({fullParams:c,fullChartParams:L,lineDirection:A,lengendItems:D}).pipe(u(a),g(async e=>e),f(e=>{const{width:l,height:t}=((s,i)=>{let o=0,P=0;if(!i.length||!i[0].length)return{width:o,height:P};const p=i[0][i[0].length-1];return s.lineDirection==="column"?(o=i.reduce((r,X)=>{const y=X.reduce((d,x)=>x.itemWidth>d?x.itemWidth:d,0);return r+y},0),o+=s.fullParams.gap*(i.length-1),P=p.translateY+s.fullChartParams.styles.textSize):(o=p.translateX+p.itemWidth,P=s.fullChartParams.styles.textSize*i.length+s.fullParams.gap*(i.length-1)),{width:o,height:P}})(e,e.lengendItems);return{direction:e.lineDirection,width:l,height:t,translateX:e.fullParams.gap,translateY:e.fullParams.gap}}),B(1)),V=h({fullParams:c,lengendList:k}).pipe(u(a),g(async e=>e),f(e=>{const l=e.lengendList.width+e.fullParams.gap*2,t=e.lengendList.height+e.fullParams.gap*2;let s=0,i=0;return e.fullParams.position==="left"?e.fullParams.justify==="start"?(s=e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="center"?(s=e.fullParams.padding,i=-t/2):e.fullParams.justify==="end"&&(s=e.fullParams.padding,i=-t-e.fullParams.padding):e.fullParams.position==="right"?e.fullParams.justify==="start"?(s=-l-e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="center"?(s=-l-e.fullParams.padding,i=-t/2):e.fullParams.justify==="end"&&(s=-l-e.fullParams.padding,i=-t-e.fullParams.padding):e.fullParams.position==="top"?e.fullParams.justify==="start"?(s=e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="center"?(s=-l/2,i=e.fullParams.padding):e.fullParams.justify==="end"&&(s=-l-e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="start"?(s=e.fullParams.padding,i=-t-e.fullParams.padding):e.fullParams.justify==="center"?(s=-l/2,i=-t-e.fullParams.padding):e.fullParams.justify==="end"&&(s=-l-e.fullParams.padding,i=-t-e.fullParams.padding),{width:l,height:t,translateX:s,translateY:i}})),Z=h({rootPositionSelection:O,fullParams:c,fullChartParams:L,legendCard:V}).pipe(u(a),g(async e=>e),f(e=>e.rootPositionSelection.selectAll("g").data([e.legendCard]).join(l=>l.append("g").classed(U,!0).attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.transition().attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.remove()).each((l,t,s)=>{w(s[t]).selectAll("rect").data([l]).join("rect").attr("width",i=>i.width).attr("height",i=>i.height).attr("fill",F(e.fullParams.backgroundFill,e.fullChartParams)).attr("stroke",F(e.fullParams.backgroundStroke,e.fullChartParams))}))),v=h({lengendCardSelection:Z,fullParams:c,lengendList:k}).pipe(u(a),g(async e=>e),f(e=>e.lengendCardSelection.selectAll("g").data([e.lengendList]).join(l=>l.append("g").classed(q,!0).attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.transition().attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.remove())));return h({lengendListSelection:v,fullParams:c,fullChartParams:L,lengendItems:D}).pipe(u(a),g(async e=>e),f(e=>{const l=e.lengendItems[0]?e.lengendItems.flat():[];return e.lengendListSelection.selectAll(`g.${M}`).data(l).join(t=>t.append("g").classed(M,!0).attr("cursor","default"),t=>t,t=>t.remove()).attr("transform",(t,s)=>`translate(${t.translateX}, ${t.translateY})`).each((t,s,i)=>{const o=e.fullChartParams.styles.textSize/2,P=-t.listRectWidth/2,p=-t.listRectHeight/2;w(i[s]).selectAll("rect").data([t]).join("rect").attr("x",o).attr("y",o).attr("width",r=>r.listRectWidth).attr("height",r=>r.listRectHeight).attr("transform",r=>`translate(${P}, ${p})`).attr("fill",r=>r.color).attr("rx",r=>r.listRectRadius),w(i[s]).selectAll("text").data([t]).join(r=>r.append("text").attr("dominant-baseline","hanging"),r=>r,r=>r.remove()).attr("x",e.fullChartParams.styles.textSize*1.5).attr("font-size",e.fullChartParams.styles.textSize).text(r=>r.text)})})).subscribe(),()=>{a.next(void 0)}};export{oe as c};
