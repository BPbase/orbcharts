import{g as m,s as d,f as M,e as P,x as E,S as T,t as p,h as R,O as A,N as O}from"./DexWA3gZ.js";import{d as j}from"./a99IznNJ.js";import{d as z,s as w,g as N,b as L}from"./EQPZLwmk.js";function F({data:c,startAngle:a,endAngle:o}){return z().startAngle(a).endAngle(o).value(t=>t.visible==!1?0:t.value).sort((t,r)=>t.seq-r.seq)(c).map((t,r)=>{let u=t;return u.id=t.data.id,u})}function H({selection:c,pluginName:a,separateSeries$:o,seriesLabels$:n}){const l=N(a,"series");return m({seriesLabels:n,separateSeries:o}).pipe(d(async t=>t),P((t,r)=>{const u=t.separateSeries?t.seriesLabels:[t.seriesLabels.join("")];return c.selectAll(`g.${l}`).data(u,h=>h).join(h=>h.append("g").classed(l,!0),h=>h,h=>h.remove())}),w(1))}const U=({selection:c,pluginName:a,separateSeries$:o,seriesLabels$:n,seriesContainerPosition$:l})=>{const t=H({selection:c,pluginName:a,separateSeries$:o,seriesLabels$:n});return m({seriesCenterSelection:t,seriesContainerPosition:l}).pipe(d(async r=>r),M((r,u)=>r.seriesContainerPosition.length===u.seriesContainerPosition.length)).subscribe(r=>{r.seriesCenterSelection.attr("transform",(u,h)=>{const g=r.seriesContainerPosition[h]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:t,seriesContainerPosition:l}).pipe(d(async r=>r)).subscribe(r=>{r.seriesCenterSelection.transition().attr("transform",(u,h)=>{const g=r.seriesContainerPosition[h]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:t}},b="Pie";function q({enter:c,exit:a,data:o,lastTweenData:n,fullParams:l}){return!c.size()&&!a.size()?t=>{const r=o.map((u,h)=>{const g=n[h]??{startAngle:0,endAngle:0,value:0};return{...u,startAngle:u.startAngle*t+g.startAngle*(1-t),endAngle:u.endAngle*t+g.endAngle*(1-t),value:u.value*t+g.value*(1-t)}});return y(r,l.startAngle,l.endAngle,1)}:t=>y(o,l.startAngle,l.endAngle,t)}function y(c,a,o,n){return c.map((l,t)=>{const r=a+(l.startAngle-a)*n,u=r+(l.endAngle-l.startAngle)*n;return{...l,startAngle:r,endAngle:u}})}function D({selection:c,data:a,arc:o,pathClassName:n}){return c.selectAll("path").data(a,t=>t.id).join("path").classed(n,!0).style("cursor","pointer").attr("fill",(t,r)=>t.data.color).attr("d",(t,r)=>o(t))}function x({pathSelection:c,ids:a,fullChartParams:o,arc:n,arcMouseover:l}){if(c.interrupt("highlight"),!a.length){c.transition("highlight").style("opacity",1).attr("d",t=>n(t));return}c.each((t,r,u)=>{const h=R(u[r]);a.includes(t.data.id)?h.style("opacity",1).transition("highlight").ease(O).duration(500).attr("d",g=>l(g)):h.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>n(g))})}function X(c,a){const o=new T,n=N(c,"path");let l=[],t=[];const r=a.seriesContainerPosition$.pipe(p(o),P(s=>s.width<s.height?s.width:s.height)),u=new A(s=>{m({containerComputedLayoutData:a.containerComputedLayoutData$,fullParams:a.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const i=F({data:e.containerComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s.next(i)})}),h=new A(s=>{m({shorterSideWith:r,fullParams:a.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const i=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(i)})}),g=new A(s=>{m({shorterSideWith:r,fullParams:a.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const i=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerMouseoverRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(i)})}),f=a.fullChartParams$.pipe(p(o),P(s=>s.highlightTarget),M()),S=new A(s=>{m({pieData:u,arc:h,computedData:a.computedData$,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,highlightTarget:f}).pipe(p(o),d(async e=>e)).subscribe(e=>{a.containerSelection.interrupt("graphicMove");const i=a.containerSelection.selectAll("path").data(e.pieData,$=>$.id),v=i.enter(),k=i.exit(),I=q({enter:v,exit:k,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});if(a.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",($,W)=>C=>{t=I(C),D({selection:a.containerSelection,data:t,arc:e.arc,pathClassName:n})}).on("end",($,W)=>{t=y(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const C=D({selection:a.containerSelection,data:t,arc:e.arc,pathClassName:n});s.next(C),l=Object.assign([],e.pieData),a.event$.next({type:"series",pluginName:c,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})}),!v.size()&&i.size()>0){const $=D({selection:a.containerSelection,data:e.pieData,arc:e.arc,pathClassName:n});s.next($)}})}).pipe(w(1));return m({pathSelection:S,SeriesDataMap:a.SeriesDataMap$,computedData:a.computedData$,highlightTarget:f}).pipe(p(o),d(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mouseover",pluginName:c,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})}).on("mousemove",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mousemove",pluginName:c,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})}).on("mouseout",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mouseout",pluginName:c,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})}).on("click",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"click",pluginName:c,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})})}),m({pathSelection:S,highlight:a.seriesHighlight$.pipe(P(s=>s.map(e=>e.id))),fullChartParams:a.fullChartParams$,arc:h,arcMouseover:g}).pipe(p(o),d(async s=>s)).subscribe(s=>{x({pathSelection:s.pathSelection,ids:s.highlight,fullChartParams:s.fullChartParams,arc:s.arc,arcMouseover:s.arcMouseover})}),()=>{o.next(void 0)}}const G=E(b,j)(({selection:c,name:a,subject:o,observer:n})=>{const l=new T,{seriesCenterSelection$:t}=U({selection:c,pluginName:b,separateSeries$:n.separateSeries$,seriesLabels$:n.seriesLabels$,seriesContainerPosition$:n.seriesContainerPosition$}),r=[];return t.pipe(p(l)).subscribe(u=>{r.forEach(h=>h()),u.each((h,g,f)=>{const S=R(f[g]),s=n.computedLayoutData$.pipe(p(l),P(i=>i[g]??i[0])),e=n.seriesContainerPosition$.pipe(p(l),P(i=>i[g]??i[0]));r[g]=X(b,{containerSelection:S,computedData$:n.computedData$,containerComputedLayoutData$:s,SeriesDataMap$:n.SeriesDataMap$,fullParams$:n.fullParams$,fullChartParams$:n.fullChartParams$,seriesHighlight$:n.seriesHighlight$,seriesContainerPosition$:e,event$:o.event$})})}),()=>{l.next(void 0),r.forEach(u=>u())}});export{G as P,F as m,U as s};
