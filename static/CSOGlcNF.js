import{b4 as W,k as m,l as d,d as y,m as P,b as B,g as k,ao as v,a as D,t as p,s as w,a1 as O,L as _,aT as b,u as x,aU as F,aQ as R,aa as j,aO as U}from"./Bh8imPUI.js";import{c as z}from"./DUZwUmoI.js";function V({data:h,startAngle:t,endAngle:n}){return W().startAngle(t).endAngle(n).value(a=>a.value).sort((a,i)=>a.seq-i.seq)(h).map((a,i)=>{let o=a;return o.id=a.data.id,o})}function X({selection:h,pluginName:t,separateSeries$:n,seriesLabels$:c}){const l=k(t,"series");return m({seriesLabels:c,separateSeries:n}).pipe(d(async a=>a),P((a,i)=>{const o=a.separateSeries?a.seriesLabels:[a.seriesLabels.join("")];return h.selectAll(`g.${l}`).data(o,u=>u).join(u=>u.append("g").classed(l,!0),u=>u,u=>u.remove())}),B(1))}const Y=({selection:h,pluginName:t,separateSeries$:n,seriesLabels$:c,seriesContainerPosition$:l})=>{const a=X({selection:h,pluginName:t,separateSeries$:n,seriesLabels$:c});return m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async i=>i),y((i,o)=>i.seriesContainerPosition.length===o.seriesContainerPosition.length)).subscribe(i=>{i.seriesCenterSelection.attr("transform",(o,u)=>{const g=i.seriesContainerPosition[u]??i.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async i=>i)).subscribe(i=>{i.seriesCenterSelection.transition().attr("transform",(o,u)=>{const g=i.seriesContainerPosition[u]??i.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:a}},A="Pie",q={name:A,defaultParams:O,layerIndex:_,validator:(h,{validateColumns:t})=>t(h,{outerRadius:{toBeTypes:["number"]},innerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeTypes:["string"]},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]}})};function G({enter:h,exit:t,data:n,lastTweenData:c,fullParams:l}){return!h.size()&&!t.size()?a=>{const i=n.map((o,u)=>{const g=c[u]??{startAngle:0,endAngle:0,value:0};return{...o,startAngle:o.startAngle*a+g.startAngle*(1-a),endAngle:o.endAngle*a+g.endAngle*(1-a),value:o.value*a+g.value*(1-a)}});return T(i,l.startAngle,l.endAngle,1)}:a=>T(n,l.startAngle,l.endAngle,a)}function T(h,t,n,c){return h.map((l,a)=>{const i=t+(l.startAngle-t)*c,o=i+(l.endAngle-l.startAngle)*c;return{...l,startAngle:i,endAngle:o}})}function L({selection:h,data:t,arc:n,pathClassName:c,fullParams:l,fullChartParams:a}){return h.selectAll("path").data(t,o=>o.id).join("path").classed(c,!0).style("cursor","pointer").attr("fill",(o,u)=>o.data.color).attr("stroke",(o,u)=>x({datum:o.data,colorType:l.strokeColorType,fullChartParams:a})).attr("stroke-width",l.strokeWidth).attr("d",(o,u)=>n(o))}function Q({pathSelection:h,ids:t,fullChartParams:n,arc:c,arcHighlight:l}){if(h.interrupt("highlight"),!t.length){h.transition("highlight").style("opacity",1).attr("d",a=>c(a));return}h.each((a,i,o)=>{const u=w(o[i]);t.includes(a.data.id)?u.style("opacity",1).transition("highlight").ease(F).duration(500).attr("d",g=>l(g)):u.style("opacity",n.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>c(g))})}function J(h,t){const n=new D,c=k(h,"path");let l=[],a=[];const i=t.seriesContainerPosition$.pipe(p(n),P(s=>s.width<s.height?s.width:s.height),y()),o=new b(s=>{m({containerVisibleComputedSortedData:t.containerVisibleComputedSortedData$,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=V({data:e.containerVisibleComputedSortedData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s.next(r)})}),u=new b(s=>{m({shorterSideWith:i,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=R({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(r)})}),g=new b(s=>{m({shorterSideWith:i,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=R({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadiusWhileHighlight,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(r)})}),f=t.fullChartParams$.pipe(p(n),P(s=>s.highlightTarget),y()),$=new b(s=>{m({pieData:o,arc:u,computedData:t.computedData$,fullParams:t.fullParams$,fullChartParams:t.fullChartParams$,highlightTarget:f}).pipe(p(n),d(async e=>e)).subscribe(e=>{t.containerSelection.interrupt("graphicMove");const r=t.containerSelection.selectAll("path").data(e.pieData,C=>C.id),N=r.enter(),H=r.exit(),I=G({enter:N,exit:H,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});t.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",(C,M)=>S=>{a=I(S),L({selection:t.containerSelection,data:a,arc:e.arc,pathClassName:c,fullParams:e.fullParams,fullChartParams:e.fullChartParams})}).on("end",(C,M)=>{a=T(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const S=L({selection:t.containerSelection,data:a,arc:e.arc,pathClassName:c,fullParams:e.fullParams,fullChartParams:e.fullChartParams});s.next(S),l=Object.assign([],e.pieData),t.event$.next({type:"series",pluginName:h,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})})})}).pipe(B(1));return m({pathSelection:$,SeriesDataMap:t.SeriesDataMap$,computedData:t.computedData$,highlightTarget:f}).pipe(p(n),d(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mouseover",pluginName:h,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("mousemove",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mousemove",pluginName:h,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("mouseout",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mouseout",pluginName:h,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("click",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"click",pluginName:h,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})})}),m({pathSelection:$,highlight:t.seriesHighlight$.pipe(P(s=>s.map(e=>e.id))),fullChartParams:t.fullChartParams$,arc:u,arcHighlight:g}).pipe(p(n),d(async s=>s)).subscribe(s=>{Q({pathSelection:s.pathSelection,ids:s.highlight,fullChartParams:s.fullChartParams,arc:s.arc,arcHighlight:s.arcHighlight})}),()=>{n.next(void 0)}}const te=v(q)(({selection:h,name:t,subject:n,observer:c})=>{const l=new D,{seriesCenterSelection$:a}=Y({selection:h,pluginName:A,separateSeries$:c.separateSeries$,seriesLabels$:c.seriesLabels$,seriesContainerPosition$:c.seriesContainerPosition$}),i=[];return a.pipe(p(l)).subscribe(o=>{i.forEach(u=>u()),o.each((u,g,f)=>{const $=w(f[g]),s=c.visibleComputedSortedData$.pipe(p(l),P(r=>r[g]??r[0])),e=c.seriesContainerPosition$.pipe(p(l),P(r=>r[g]??r[0]));i[g]=J(A,{containerSelection:$,computedData$:c.computedData$,containerVisibleComputedSortedData$:s,SeriesDataMap$:c.SeriesDataMap$,fullParams$:c.fullParams$,fullChartParams$:c.fullChartParams$,seriesHighlight$:c.seriesHighlight$,seriesContainerPosition$:e,event$:n.event$})})}),()=>{l.next(void 0),i.forEach(o=>o())}}),E="SeriesLegend",K={name:E,defaultParams:j,layerIndex:U,validator:(h,{validateColumns:t})=>t(h,{placement:{toBe:'"top" | "top-start" | "top-end" | "bottom" | "bottom-start" | "bottom-end" | "left" | "left-start" | "left-end" | "right" | "right-start" | "right-end"',test:c=>["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"].includes(c)},padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},se=v(K)(({selection:h,rootSelection:t,observer:n,subject:c})=>{const l=new D,a=n.SeriesDataMap$.pipe(p(l),P(u=>Array.from(u.keys()))),i=n.fullParams$.pipe(p(l),P(u=>{const g=[{listRectWidth:u.listRectWidth,listRectHeight:u.listRectHeight,listRectRadius:u.listRectRadius}];return{...u,labelList:g}})),o=z(E,{rootSelection:t,legendLabels$:a,fullParams$:i,layout$:n.layout$,fullChartParams$:n.fullChartParams$,textSizePx$:n.textSizePx$});return()=>{l.next(void 0),o()}});export{te as P,se as S,V as m,Y as s};
