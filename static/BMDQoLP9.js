import{f as W,_ as H,i as V,h as X,O as w,j as F,y as U,k as q,S as _,t as A,m as G,d as N,e as M,s as T,l as J,n as Q,c as C,o as Y}from"./BILlwXT2.js";import{z as B,g as b,c as z,p as K,d as Z}from"./C39DfsNA.js";import{f as j}from"./BQZk2i3U.js";import{m as ee,a as te}from"./CSGGqpdb.js";import{g as re}from"./D5nkmhym.js";import{f as oe}from"./DopzhtH9.js";var ie=["addListener","removeListener"],ae=["addEventListener","removeEventListener"],ne=["on","off"];function k(r,l,a,i){if(F(a)&&(i=a,a=void 0),i)return k(r,l,a).pipe(W(i));var n=H(ue(r)?ae.map(function(s){return function(d){return r[s](l,d,a)}}):se(r)?ie.map(R(r,l)):le(r)?ne.map(R(r,l)):[],2),g=n[0],c=n[1];if(!g&&V(r))return ee(function(s){return k(s,l,a)})(X(r));if(!g)throw new TypeError("Invalid event target");return new w(function(s){var d=function(){for(var t=[],h=0;h<arguments.length;h++)t[h]=arguments[h];return s.next(1<t.length?t:t[0])};return g(d),function(){return c(d)}})}function R(r,l){return function(a){return function(i){return r[a](l,i)}}}function se(r){return F(r.addListener)&&F(r.removeListener)}function le(r){return F(r.on)&&F(r.off)}function ue(r){return F(r.addEventListener)&&F(r.removeEventListener)}const O="ScalingArea",ge=b(O,"rect"),Se=U(O,q)(({selection:r,rootSelection:l,name:a,observer:i,subject:n})=>{const g=new _,c=l.insert("rect","g").classed(ge,!0).attr("opacity",0);let s={k:1,x:0,y:0};i.layout$.pipe(A(g)).subscribe(t=>{c.attr("width",t.width).attr("height",t.height).attr("x",t.left).attr("y",t.top)});const d=i.computedData$.pipe(G(t=>t[0]?t[0].length-1:0),N());return M({initGroupAxis:i.fullDataFormatter$.pipe(G(t=>t.grid.groupAxis),j()),fullDataFormatter:i.fullDataFormatter$,groupMaxIndex:d,layout:i.layout$,axisSize:i.gridAxesSize$}).pipe(A(g),T(async t=>t)).subscribe(t=>{const v=t.groupMaxIndex,e=t.initGroupAxis.scaleDomain[0]==="auto"?0-t.initGroupAxis.scalePadding:t.initGroupAxis.scaleDomain[0]-t.initGroupAxis.scalePadding,o=t.initGroupAxis.scaleDomain[1]==="auto"?v+t.initGroupAxis.scalePadding:t.initGroupAxis.scaleDomain[1]+t.initGroupAxis.scalePadding,f=t.fullDataFormatter.grid.valueAxis.position==="left"||t.fullDataFormatter.grid.valueAxis.position==="top"?[0,1]:[1,0],p=J({maxValue:t.groupMaxIndex,minValue:0,axisWidth:t.axisSize.width,scaleDomain:[e,o],scaleRange:f}).copy(),m=B().on("zoom",function(D){const u=D.transform,P=S=>{const $=Math.round(S);return Math.min(v,Math.max(0,$))},L=t.fullDataFormatter.grid.groupAxis.position==="bottom"||t.fullDataFormatter.grid.groupAxis.position==="top"?u.rescaleX(p).domain().map(P):u.rescaleY(p).domain().map(P);L[0]<=0&&L[1]>=v?u.k<s.k&&(u.k=s.k,u.x=s.x,u.y=s.y):L[1]-L[0]<=1&&u.k>s.k&&(u.k=s.k,u.x=s.x,u.y=s.y),s.k=u.k,s.x=u.x,s.y=u.y,n.dataFormatter$.next({...t.fullDataFormatter,grid:{...t.fullDataFormatter.grid,groupAxis:{...t.fullDataFormatter.grid.groupAxis,scaleDomain:L}}})});l.call(m)}),()=>{g.next(void 0),c.remove()}});function pe(r,l){let a=new w(()=>{});return r.each(function(){const i=k(this,l);a=te(a,i)}),a}const I="GroupAux",E=b(I,"label-box");function ce({groupLabel:r,axisX:l,axisHeight:a,fullParams:i}){return i.showLine&&r?[{id:r,x1:l,x2:l,y1:0,y2:a}]:[]}function me({selection:r,pluginName:l,lineData:a,fullParams:i,fullChartParams:n}){const g=b(l,"auxline"),c=r.selectAll(`line.${g}`).data(a),s=c.enter().append("line").classed(g,!0).style("stroke",t=>z(i.lineColorType,n)).style("stroke-width",1).style("stroke-dasharray",i.lineDashArray??"none").style("pointer-events","none"),d=c.merge(s);return c.exit().remove(),s.attr("x1",t=>t.x1).attr("y1",t=>t.y1).attr("x2",t=>t.x2).attr("y2",t=>t.y2),c.transition().duration(50).attr("x1",t=>t.x1).attr("y1",t=>t.y1).attr("x2",t=>t.x2).attr("y2",t=>t.y2),d}function de(r){r.selectAll("line").data([]).exit().remove()}function xe({groupLabel:r,axisX:l,fullParams:a}){return a.showLabel&&r?[{id:r,x:l,y:-a.labelPadding,text:K(r,a.labelTextFormat)}]:[]}function he({selection:r,labelData:l,fullParams:a,fullChartParams:i,gridAxesReverseTransformValue:n}){const g=i.styles.textSize+4,c=r.selectAll(`g.${E}`).data(l),s=c.enter().append("g").classed(E,!0).style("cursor","pointer"),d=s.merge(c);return s.attr("transform",(t,h)=>`translate(${t.x}, ${t.y})`),c.transition().duration(50).attr("transform",(t,h)=>`translate(${t.x}, ${t.y})`),c.exit().remove(),d.each((t,h,v)=>{const e=Z(t.text,i.styles.textSize)+12,o=-e/2,f=C(v[h]).selectAll("rect").data([t]),x=f.enter().append("rect").attr("height",`${g}px`).attr("fill",y=>z(a.labelColorType,i)).attr("x",o).attr("y",-2).attr("rx",5).attr("ry",5).style("cursor","pointer");f.merge(x).attr("width",y=>`${e}px`).style("transform",n),f.exit().remove();const p=C(v[h]).selectAll("text").data([t]),m=p.enter().append("text").style("dominant-baseline","hanging").style("cursor","pointer");p.merge(m).text(y=>y.text).style("transform",n).attr("fill",y=>z(a.labelTextColorType,i)).attr("font-size",i.styles.textSize).attr("x",o+6),p.exit().remove()}),d}function fe(r){r.selectAll(`g.${E}`).data([]).exit().remove()}const Fe=U(I,Q)(({selection:r,rootSelection:l,name:a,subject:i,observer:n})=>{const g=new _,c=l.insert("rect","g").classed(b(I,"rect"),!0).attr("opacity",0),s=r.append("g");n.layout$.pipe(A(g)).subscribe(e=>{c.attr("width",e.rootWidth).attr("height",e.rootHeight)}),n.gridAxesTransform$.pipe(A(g),G(e=>e.value),N()).subscribe(e=>{s.style("transform",e)});const d=new w(e=>{M({fullDataFormatter:n.fullDataFormatter$,gridAxesSize:n.gridAxesSize$,computedData:n.computedData$}).pipe(A(g),T(async o=>o)).subscribe(o=>{const x=o.computedData[0]?o.computedData[0].length-1:0,p=o.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-o.fullDataFormatter.grid.groupAxis.scalePadding:o.fullDataFormatter.grid.groupAxis.scaleDomain[0]-o.fullDataFormatter.grid.groupAxis.scalePadding,m=o.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?x+o.fullDataFormatter.grid.groupAxis.scalePadding:o.fullDataFormatter.grid.groupAxis.scaleDomain[1]+o.fullDataFormatter.grid.groupAxis.scalePadding,y=o.computedData[0]?o.computedData[0].length:0;let D=o.fullDataFormatter.grid.gridData.seriesDirection==="row"?(o.computedData[0]??[]).map(S=>S.groupLabel):o.computedData.map(S=>S[0].groupLabel);const u=new Array(y).fill(0).map((S,$)=>D[$]!=null?D[$]:String($)).filter((S,$)=>$>=p&&$<=m),P=o.fullDataFormatter.grid.groupAxis.scalePadding,L=Y({axisLabels:u,axisWidth:o.gridAxesSize.width,padding:P});e.next(L)})}),t=re({fullDataFormatter$:n.fullDataFormatter$,gridAxesSize$:n.gridAxesSize$,computedData$:n.computedData$,fullChartParams$:n.fullChartParams$}),h=n.fullChartParams$.pipe(A(g),G(e=>e.highlightTarget),N());return M({computedData:n.computedData$,gridAxesSize:n.gridAxesSize$,fullParams:n.fullParams$,fullChartParams:n.fullChartParams$,highlightTarget:h,SeriesDataMap:n.SeriesDataMap$,GroupDataMap:n.GroupDataMap$,gridGroupPositionFn:t,groupScale:d}).pipe(A(g),T(async e=>e)).subscribe(e=>{l.on("mouseover",(o,f)=>{const{groupIndex:x,groupLabel:p}=e.gridGroupPositionFn(o);i.event$.next({type:"grid",pluginName:a,eventName:"mouseover",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(p)??[],groupIndex:x,groupLabel:p,event:o,data:e.computedData})}).on("mousemove",(o,f)=>{const{groupIndex:x,groupLabel:p}=e.gridGroupPositionFn(o);i.event$.next({type:"grid",pluginName:a,eventName:"mousemove",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(p)??[],groupIndex:x,groupLabel:p,event:o,data:e.computedData})}).on("mouseout",(o,f)=>{const{groupIndex:x,groupLabel:p}=e.gridGroupPositionFn(o);i.event$.next({type:"grid",pluginName:a,eventName:"mouseout",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(p)??[],groupIndex:x,groupLabel:p,event:o,data:e.computedData})}).on("click",(o,f)=>{o.stopPropagation();const{groupIndex:x,groupLabel:p}=e.gridGroupPositionFn(o);i.event$.next({type:"grid",pluginName:a,eventName:"click",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(p)??[],groupIndex:x,groupLabel:p,event:o,data:e.computedData})})}),M({event:i.event$.pipe(oe(e=>e.eventName==="mouseover"||e.eventName==="mousemove")),computedData:n.computedData$,groupScale:d,gridAxesSize:n.gridAxesSize$,fullParams:n.fullParams$,fullChartParams:n.fullChartParams$,highlightTarget:h,gridAxesReverseTransform:n.gridAxesReverseTransform$,GroupDataMap:n.GroupDataMap$,gridGroupPositionFn:t}).pipe(A(g),T(async e=>e)).subscribe(e=>{const o=e.groupScale(e.event.groupLabel)??0,f=ce({groupLabel:e.event.groupLabel,axisX:o,axisHeight:e.gridAxesSize.height,fullParams:e.fullParams});me({selection:s,pluginName:a,lineData:f,fullParams:e.fullParams,fullChartParams:e.fullChartParams});const x=xe({groupLabel:e.event.groupLabel,axisX:o,fullParams:e.fullParams});he({selection:s,labelData:x,fullParams:e.fullParams,fullChartParams:e.fullChartParams,gridAxesReverseTransformValue:e.gridAxesReverseTransform.value}).on("mouseover",(m,y)=>{const{groupIndex:D,groupLabel:u}=e.gridGroupPositionFn(m);i.event$.next({type:"grid",pluginName:a,eventName:"mouseover",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:D,groupLabel:u,event:m,data:e.computedData})}).on("mousemove",(m,y)=>{const{groupIndex:D,groupLabel:u}=e.gridGroupPositionFn(m);i.event$.next({type:"grid",pluginName:a,eventName:"mousemove",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:D,groupLabel:u,event:m,data:e.computedData})}).on("mouseout",(m,y)=>{const{groupIndex:D,groupLabel:u}=e.gridGroupPositionFn(m);i.event$.next({type:"grid",pluginName:a,eventName:"mouseout",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:D,groupLabel:u,event:m,data:e.computedData})}).on("click",(m,y)=>{const{groupIndex:D,groupLabel:u}=e.gridGroupPositionFn(m);i.event$.next({type:"grid",pluginName:a,eventName:"click",highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:D,groupLabel:u,event:m,data:e.computedData})})}),pe(c,"mouseout").pipe(A(g)).subscribe(e=>{console.log("rootMouseout"),de(s),fe(s)}),()=>{g.next(void 0),c.remove()}}),Pe=[[55,80,50,11,150],[35,40,15,65,120],[75,90,600,50,120],[50,60,445,80,110]];export{Fe as G,Se as S,Pe as g};
