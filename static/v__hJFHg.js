import{l as te,e as ae,w as v,O as N,B as A,x,z as I,U as re,k as w,y as F,C as k,J as se}from"./BOl0c7Gx.js";import{p as ie}from"./CAxiItTp.js";import{g as oe,b as j,k as ne,o as pe,q as le}from"./CXENxt6o.js";function ue(i,n){return te(function(r,l){var o=0;r.subscribe(ae(l,function(s){return i.call(n,s,o++)&&l.next(s)}))})}function ce({fullDataFormatter$:i,gridAxesSize$:n,computedData$:r,fullChartParams$:l}){const o=new v,s=new N(L=>{A({dataFormatter:i,computedData:r}).pipe(x(o),I(async t=>t)).subscribe(t=>{const f=t.computedData[0]?t.computedData[0].length-1:0,P=t.dataFormatter.groupAxis.scaleDomain[0]==="auto"?0-t.dataFormatter.groupAxis.scalePadding:t.dataFormatter.groupAxis.scaleDomain[0]-t.dataFormatter.groupAxis.scalePadding,S=t.dataFormatter.groupAxis.scaleDomain[1]==="auto"?f+t.dataFormatter.groupAxis.scalePadding:t.dataFormatter.groupAxis.scaleDomain[1]+t.dataFormatter.groupAxis.scalePadding,u=(t.dataFormatter.grid.seriesType==="row"?(t.computedData[0]??[]).map(b=>b.groupLabel):t.computedData.map(b=>b[0].groupLabel)).filter((b,$)=>$>=P&&$<=S);L.next(u)})});return new N(L=>{A({dataFormatter:i,axisSize:n,fullChartParams:l,scaleRangeGroupLabels:s}).pipe(x(o),I(async t=>t)).subscribe(t=>{const m=t.dataFormatter.valueAxis.position==="right"||t.dataFormatter.valueAxis.position==="bottom",f=re({axisLabels:t.scaleRangeGroupLabels,axisWidth:t.axisSize.width,reverse:m}),P=h=>t.dataFormatter.groupAxis.position==="bottom"||t.dataFormatter.groupAxis.position==="top"?h.offsetX-t.fullChartParams.padding.left:h.offsetY-t.fullChartParams.padding.top,S=h=>{const u=P(h),b=f(u);return{groupIndex:b,groupLabel:t.scaleRangeGroupLabels[b]??""}};return L.next(S),function(){o.next(void 0)}})})}const W="Lines",ge=j(W,"g"),he=j(W,"path");function be(i="curveLinear"){return pe().x(n=>n.axisX).y(n=>n.axisY).curve(le[i])}function me(i){let n=[[]],r=0;for(let l in i){if(i[l].visible==!1||i[l].value===void 0||i[l].value===null){n[r].length&&(r++,n[r]=[]);continue}n[r].push(i[l])}return n}function de({selection:i,segmentData:n,linePath:r,params:l}){return i.selectAll("path").data(n,(s,L)=>s.length?`${s[0].id}_${s[s.length-1].id}`:L).join(s=>s.append("path").classed(he,!0).attr("fill","none").attr("pointer-events","visibleStroke").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),s=>s,s=>s.remove()).attr("stroke-width",l.lineWidth).attr("stroke",(s,L)=>s[0]&&s[0].color).attr("d",s=>r(s))}function xe({selection:i,seriesLabel:n,fullChartParams:r}){if(i.interrupt("highlight"),!n){i.transition("highlight").duration(200).style("opacity",1);return}i.each((l,o,s)=>{l===n?k(s[o]).style("opacity",1):k(s[o]).style("opacity",r.styles.unhighlightedOpacity)})}function Le({defsSelection:i,clipPathData:n,transitionDuration:r,transitionEase:l}){i.selectAll("clipPath").data(n).join(o=>o.append("clipPath"),o=>o,o=>o.remove()).attr("id",o=>o.id).each((o,s,L)=>{k(L[s]).selectAll("rect").data([o]).join(t=>{const m=t.append("rect");return m.transition().duration(r).ease(ne(l)).tween("tween",(f,P,S)=>h=>{const u=f.width*h;m.attr("x",0).attr("y",0).attr("width",b=>u).attr("height",b=>b.height)}),m},t=>t.attr("x",0).attr("y",0).attr("width",m=>m.width).attr("height",m=>m.height),t=>t.remove())})}const De=(i,{selection:n,computedData$:r,SeriesDataMap$:l,GroupDataMap$:o,fullParams$:s,fullDataFormatter$:L,fullChartParams$:t,gridAxesTransform$:m,gridGraphicTransform$:f,gridAxesSize$:P,gridHighlight$:S,event$:h})=>{const u=new v,b=oe(i,"clipPath-box"),$=n.append("g").attr("clip-path",`url(#${b})`),J=$.append("defs"),U=$.append("g"),B=new v;m.pipe(x(u),w(e=>e.value),F()).subscribe(e=>{$.style("transform",e)}),f.pipe(x(u),w(e=>e.value),F()).subscribe(e=>{U.transition().duration(50).style("transform",e)});const V=new N(e=>{const p=s.pipe(x(u)).subscribe(d=>{if(!d)return;const D=be(d.lineCurve);e.next(D)});return()=>{p.unsubscribe()}}),O=new N(e=>{r.pipe(x(u),I(async p=>p)).subscribe(p=>{const d=p[0]&&p[0][0]?p.map(D=>D[0].seriesLabel):[];e.next(d)})}),X=t.pipe(w(e=>e.transitionDuration),F()),Y=t.pipe(w(e=>e.transitionEase),F());A({seriesLabels:O,axisSize:P,transitionDuration:X,transitionEase:Y}).pipe(x(u),I(async e=>e)).subscribe(e=>{const d=[{id:b,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(D=>({id:`orbcharts__clipPath_${D}`,width:e.axisSize.width,height:e.axisSize.height})));Le({defsSelection:J,clipPathData:d,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const q=r.pipe(w(e=>{const p=new Map;return e.flat().forEach(d=>p.set(d.id,d)),p})),H=ce({fullDataFormatter$:L,gridAxesSize$:P,computedData$:r,fullChartParams$:t}),K=t.pipe(x(u),w(e=>e.highlightTarget),F());A({seriesLabels:O,computedData:r,SeriesDataMap:l,GroupDataMap:o,linePath:V,params:s,highlightTarget:K,gridGroupPositionFn:H}).pipe(x(u),I(async e=>e)).subscribe(e=>{const p=U.selectAll("g").data(e.seriesLabels,(T,_)=>T),d=p.enter().append("g").classed(ge,!0);p.exit().remove();const D=p.merge(d).attr("clip-path",(T,_)=>`url(#orbcharts__clipPath_${T})`);D.each((T,_,Z)=>{const ee=me(e.computedData[_]??[]);de({selection:k(Z[_]),linePath:e.linePath,segmentData:ee,params:e.params}).on("mouseover",(c,g)=>{c.stopPropagation();const y=g[0]?g[0].seriesLabel:"",{groupIndex:C,groupLabel:M}=e.gridGroupPositionFn(c),a=e.GroupDataMap.get(M).find(G=>G.seriesLabel===y)??g[0];h.next({type:"grid",eventName:"mouseover",pluginName:i,highlightTarget:e.highlightTarget,datum:a,series:e.SeriesDataMap.get(a.seriesLabel),seriesIndex:a.seriesIndex,seriesLabel:a.seriesLabel,groups:e.GroupDataMap.get(a.groupLabel),groupIndex:a.groupIndex,groupLabel:a.groupLabel,event:c,data:e.computedData})}).on("mousemove",(c,g)=>{c.stopPropagation();const y=g[0]?g[0].seriesLabel:"",{groupIndex:C,groupLabel:M}=e.gridGroupPositionFn(c),a=e.GroupDataMap.get(M).find(G=>G.seriesLabel===y)??g[0];h.next({type:"grid",eventName:"mousemove",pluginName:i,highlightTarget:e.highlightTarget,datum:a,series:e.SeriesDataMap.get(a.seriesLabel),seriesIndex:a.seriesIndex,seriesLabel:a.seriesLabel,groups:e.GroupDataMap.get(a.groupLabel),groupIndex:a.groupIndex,groupLabel:a.groupLabel,event:c,data:e.computedData})}).on("mouseout",(c,g)=>{c.stopPropagation();const y=g[0]?g[0].seriesLabel:"",{groupIndex:C,groupLabel:M}=e.gridGroupPositionFn(c),a=e.GroupDataMap.get(M).find(G=>G.seriesLabel===y)??g[0];h.next({type:"grid",eventName:"mouseout",pluginName:i,highlightTarget:e.highlightTarget,datum:a,series:e.SeriesDataMap.get(a.seriesLabel),seriesIndex:a.seriesIndex,seriesLabel:a.seriesLabel,groups:e.GroupDataMap.get(a.groupLabel),groupIndex:a.groupIndex,groupLabel:a.groupLabel,event:c,data:e.computedData})}).on("click",(c,g)=>{c.stopPropagation();const y=g[0]?g[0].seriesLabel:"",{groupIndex:C,groupLabel:M}=e.gridGroupPositionFn(c),a=e.GroupDataMap.get(M).find(G=>G.seriesLabel===y)??g[0];h.next({type:"grid",eventName:"click",pluginName:i,highlightTarget:e.highlightTarget,datum:a,series:e.SeriesDataMap.get(a.seriesLabel),seriesIndex:a.seriesIndex,seriesLabel:a.seriesLabel,groups:e.GroupDataMap.get(a.groupLabel),groupIndex:a.groupIndex,groupLabel:a.groupLabel,event:c,data:e.computedData})})}),B.next(D)});const Q=S.subscribe();return t.pipe(x(u),ue(e=>e.highlightTarget==="series"),I(e=>A({graphicSelection:B,highlight:S,DataMap:q,fullChartParams:t}).pipe(x(u),I(async p=>p)))).subscribe(e=>{const p=e.DataMap.get(e.highlight[0]);xe({selection:e.graphicSelection,seriesLabel:p&&p.seriesLabel?p.seriesLabel:null,fullChartParams:e.fullChartParams})}),()=>{u.next(void 0),Q.unsubscribe()}},R="Lines",Me=se(R,ie)(({selection:i,name:n,observer:r,subject:l})=>{const o=new v,s=De(R,{selection:i,computedData$:r.computedData$,SeriesDataMap$:r.SeriesDataMap$,GroupDataMap$:r.GroupDataMap$,fullParams$:r.fullParams$,fullDataFormatter$:r.fullDataFormatter$,fullChartParams$:r.fullChartParams$,gridAxesTransform$:r.gridAxesTransform$,gridGraphicTransform$:r.gridGraphicTransform$,gridAxesSize$:r.gridAxesSize$,gridHighlight$:r.gridHighlight$,event$:l.event$});return()=>{o.next(void 0),s()}});export{Me as L,De as c,ue as f,ce as g};
