import{a as V,p as Z,t as m,m as b,d as k,k as B,l as R,s as E,b8 as ue,aT as ge,b9 as ce,ba as de,g as X,S as W,O as me,h as he,B as xe,r as $e,ad as fe,j as ye,J as De,bb as Ae,bc as Se,bd as J,be as Te,bf as be,bg as Pe}from"./DthhAFdh.js";import{o as te,p as Le,q as Ce}from"./07J1XIoE.js";import{f as Ie}from"./B9lBMzam.js";import{c as Ge}from"./Yp4F3sML.js";import{c as Re}from"./M4r1UP5k.js";import{m as Me}from"./BWsH1ZoA.js";import{d as ee}from"./BHI5Q38u.js";function Be(o="curveLinear",s){return ce().x(e=>e.axisX).y0(e=>s).y1(e=>e.axisY).curve(de[o])}function _e(o){let s=[[]],e=0;for(let r in o){if(o[r].visible==!1||o[r].value===void 0||o[r].value===null){s[e].length&&(e++,s[e]=[]);continue}s[e].push(o[r])}return s}function we({selection:o,pathClassName:s,segmentData:e,areaPath:r,linearGradientIds:i,params:n}){return o.selectAll("path").data(e,(l,p)=>l.length?`${l[0].id}_${l[l.length-1].id}`:p).join(l=>l.append("path").classed(s,!0).attr("fill","none").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),l=>l,l=>l.remove()).attr("fill",(l,p)=>l[0]?`url(#${i[l[0].seriesIndex]})`:"").attr("d",l=>r(l))}function Fe({selection:o,seriesLabel:s,fullChartParams:e}){if(o.interrupt("highlight"),!s){o.transition("highlight").duration(200).style("opacity",1);return}o.each((r,i,n)=>{r===s?E(n[i]).style("opacity",1):E(n[i]).style("opacity",e.styles.unhighlightedOpacity)})}function Oe({defsSelection:o,computedData:s,linearGradientIds:e,params:r}){o.selectAll("linearGradient").data(s??[]).join(i=>i.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),i=>i,i=>i.remove()).attr("id",(i,n)=>i[0]?e[i[0].seriesIndex]:"").html((i,n)=>{const h=i[0]?i[0].color:"";return`
        <stop offset="0%"   stop-color="${h}" stop-opacity="${r.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${h}" stop-opacity="${r.linearGradientOpacity[1]}"/>
      `})}function ke({defsSelection:o,clipPathData:s,transitionDuration:e,transitionEase:r}){o.selectAll("clipPath").data(s).join(i=>i.append("clipPath"),i=>i,i=>i.remove()).attr("id",i=>i.id).each((i,n,h)=>{E(h[n]).selectAll("rect").data([i]).join(l=>{const p=l.append("rect");return p.transition().duration(e).ease(ue(r)).tween("tween",(g,P,x)=>A=>{const S=g.width*A;p.attr("x",0).attr("y",0).attr("width",y=>S).attr("height",y=>y.height)}),p},l=>l.attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height),l=>l.remove())})}const Ee=(o,{selection:s,computedData$:e,computedAxesData$:r,visibleComputedData$:i,visibleComputedAxesData$:n,seriesLabels$:h,SeriesDataMap$:l,GroupDataMap$:p,fullParams$:g,fullDataFormatter$:P,fullChartParams$:x,gridAxesTransform$:A,gridGraphicTransform$:S,gridAxesSize$:y,gridHighlight$:M,gridContainerPosition$:L,layout$:$,event$:w})=>{const T=new V,v=Z(o,"clipPath-box"),a=X(o,"path"),{seriesSelection$:C,axesSelection$:f,defsSelection$:I,graphicGSelection$:H}=te({selection:s,pluginName:o,clipPathID:v,seriesLabels$:h,gridContainerPosition$:L,gridAxesTransform$:A,gridGraphicTransform$:S}),Y=S.pipe(m(T),b(t=>-t.translate[1]/t.scale[1])),Q=new ge(t=>{const D=B({fullParams:g,valueAxisStart:Y}).pipe(m(T)).subscribe(d=>{const c=Be(d.fullParams.lineCurve,d.valueAxisStart);t.next(c)});return()=>{D.unsubscribe()}}),G=x.pipe(b(t=>t.transitionDuration),k()),z=x.pipe(b(t=>t.transitionEase),k());B({defsSelection:I,seriesLabels:h,axisSize:y,transitionDuration:G,transitionEase:z}).pipe(m(T),R(async t=>t)).subscribe(t=>{const d=[{id:v,width:t.axisSize.width,height:t.axisSize.height}].concat(t.seriesLabels.map(c=>({id:`orbcharts__clipPath_${c}`,width:t.axisSize.width,height:t.axisSize.height})));ke({defsSelection:t.defsSelection,clipPathData:d,transitionDuration:t.transitionDuration,transitionEase:t.transitionEase})});const oe=e.pipe(b(t=>{const D=new Map;return t.flat().forEach(d=>D.set(d.id,d)),D})),se=Le({fullDataFormatter$:P,gridAxesSize$:y,computedData$:e,fullChartParams$:x,gridContainerPosition$:L,layout$:$}),ne=x.pipe(m(T),b(t=>t.highlightTarget),k()),le=h.pipe(m(T),b(t=>t.map((D,d)=>Z(o,`lineargradient-${D}`)))),pe=B({graphicGSelection:H,defsSelection:I,visibleComputedAxesData:n,linearGradientIds:le,areaPath:Q,params:g}).pipe(m(T),R(async t=>t),b(t=>{let D=[];return t.graphicGSelection.each((d,c,_)=>{const N=_e(t.visibleComputedAxesData[c]??[]);D[c]=we({selection:E(_[c]),pathClassName:a,areaPath:t.areaPath,segmentData:N,linearGradientIds:t.linearGradientIds,params:t.params}),Oe({defsSelection:t.defsSelection,computedData:t.visibleComputedAxesData,linearGradientIds:t.linearGradientIds,params:t.params})}),D}));return B({pathSelectionArr:pe,computedData:e,SeriesDataMap:l,GroupDataMap:p,highlightTarget:ne,gridGroupPositionFn:se}).pipe(m(T),R(async t=>t)).subscribe(t=>{t.pathSelectionArr.forEach(D=>{D.on("mouseover",(d,c)=>{const _=c[0]?c[0].seriesLabel:"",{groupIndex:N,groupLabel:F}=t.gridGroupPositionFn(d),u=t.GroupDataMap.get(F).find(O=>O.seriesLabel===_)??c[0];w.next({type:"grid",eventName:"mouseover",pluginName:o,highlightTarget:t.highlightTarget,datum:u,gridIndex:u.gridIndex,series:t.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,group:t.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:t.computedData})}).on("mousemove",(d,c)=>{const _=c[0]?c[0].seriesLabel:"",{groupIndex:N,groupLabel:F}=t.gridGroupPositionFn(d),u=t.GroupDataMap.get(F).find(O=>O.seriesLabel===_)??c[0];w.next({type:"grid",eventName:"mousemove",pluginName:o,highlightTarget:t.highlightTarget,datum:u,gridIndex:u.gridIndex,series:t.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,group:t.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:t.computedData})}).on("mouseout",(d,c)=>{const _=c[0]?c[0].seriesLabel:"",{groupIndex:N,groupLabel:F}=t.gridGroupPositionFn(d),u=t.GroupDataMap.get(F).find(O=>O.seriesLabel===_)??c[0];w.next({type:"grid",eventName:"mouseout",pluginName:o,highlightTarget:t.highlightTarget,datum:u,gridIndex:u.gridIndex,series:t.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,group:t.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:t.computedData})}).on("click",(d,c)=>{const _=c[0]?c[0].seriesLabel:"",{groupIndex:N,groupLabel:F}=t.gridGroupPositionFn(d),u=t.GroupDataMap.get(F).find(O=>O.seriesLabel===_)??c[0];w.next({type:"grid",eventName:"click",pluginName:o,highlightTarget:t.highlightTarget,datum:u,gridIndex:u.gridIndex,series:t.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,group:t.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:d,data:t.computedData})})})}),x.pipe(m(T),Ie(t=>t.highlightTarget==="series"),R(t=>B({graphicGSelection:H,gridHighlight:M,DataMap:oe,fullChartParams:x}).pipe(m(T),R(async D=>D)))).subscribe(t=>{const D=t.gridHighlight[0]?t.gridHighlight[0].seriesLabel:null;Fe({selection:t.graphicGSelection,seriesLabel:D,fullChartParams:t.fullChartParams})}),()=>{T.next(void 0)}},ie="LineAreas",ze={name:ie,defaultParams:me,layerIndex:he,validator:(o,{validateColumns:s})=>s(o,{lineCurve:{toBeTypes:["string"]},linearGradientOpacity:{toBe:"[number, number]",test:r=>Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"}})},it=W(ze)(({selection:o,name:s,observer:e,subject:r})=>{const i=new V,n=Ee(ie,{selection:o,computedData$:e.computedData$,visibleComputedData$:e.visibleComputedData$,computedAxesData$:e.computedAxesData$,visibleComputedAxesData$:e.visibleComputedAxesData$,seriesLabels$:e.seriesLabels$,SeriesDataMap$:e.SeriesDataMap$,GroupDataMap$:e.GroupDataMap$,fullParams$:e.fullParams$,fullDataFormatter$:e.fullDataFormatter$,fullChartParams$:e.fullChartParams$,gridAxesTransform$:e.gridAxesTransform$,gridGraphicTransform$:e.gridGraphicTransform$,gridAxesSize$:e.gridAxesSize$,gridHighlight$:e.gridHighlight$,gridContainerPosition$:e.gridContainerPosition$,allContainerPosition$:e.gridContainerPosition$,layout$:e.layout$,event$:r.event$});return()=>{i.next(void 0),n()}}),ae="Dots",Ne={name:ae,defaultParams:xe,layerIndex:$e,validator:(o,{validateColumns:s})=>s(o,{radius:{toBeTypes:["number"]},fillColorType:{toBeOption:"ColorType"},strokeColorType:{toBeOption:"ColorType"},strokeWidth:{toBeTypes:["number"]},onlyShowHighlighted:{toBeTypes:["boolean"]}})},at=W(Ne)(({selection:o,name:s,subject:e,observer:r})=>{const i=new V,n=Ge(ae,{selection:o,computedData$:r.computedData$,computedAxesData$:r.computedAxesData$,visibleComputedData$:r.visibleComputedData$,visibleComputedAxesData$:r.visibleComputedAxesData$,seriesLabels$:r.seriesLabels$,SeriesDataMap$:r.SeriesDataMap$,GroupDataMap$:r.GroupDataMap$,fullParams$:r.fullParams$,fullChartParams$:r.fullChartParams$,gridAxesTransform$:r.gridAxesTransform$,gridGraphicTransform$:r.gridGraphicTransform$,gridGraphicReverseScale$:r.gridGraphicReverseScale$,gridAxesSize$:r.gridAxesSize$,gridHighlight$:r.gridHighlight$,gridContainerPosition$:r.gridContainerPosition$,event$:e.event$});return()=>{i.next(void 0),n()}}),re="StackedValueAxis",Ve={name:re,defaultParams:fe,layerIndex:ye,validator:(o,{validateColumns:s})=>s(o,{labelOffset:{toBe:"[number, number]",test:r=>Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"},labelColorType:{toBeOption:"ColorType"},axisLineVisible:{toBeTypes:["boolean"]},axisLineColorType:{toBeOption:"ColorType"},ticks:{toBeTypes:["number","null"]},tickFormat:{toBeTypes:["string","Function"]},tickLineVisible:{toBeTypes:["boolean"]},tickPadding:{toBeTypes:["number"]},tickFullLine:{toBeTypes:["boolean"]},tickFullLineDasharray:{toBeTypes:["string"]},tickColorType:{toBeOption:"ColorType"},tickTextRotate:{toBeTypes:["number"]},tickTextColorType:{toBeOption:"ColorType"}})},rt=W(Ve)(({selection:o,name:s,observer:e,subject:r})=>{const i=new V,n=Re(re,{selection:o,computedData$:e.computedStackedData$,filteredMinMaxValue$:e.filteredMinMaxValue$,fullParams$:e.fullParams$,fullDataFormatter$:e.fullDataFormatter$,fullChartParams$:e.fullChartParams$,gridAxesTransform$:e.gridAxesTransform$,gridAxesReverseTransform$:e.gridAxesReverseTransform$,gridAxesSize$:e.gridAxesSize$,gridContainerPosition$:e.gridContainerPosition$,isSeriesSeprate$:e.isSeriesSeprate$});return()=>{i.next(void 0),n()}}),U="GroupAux",K=X(U,"label-box"),ve={name:U,defaultParams:De,layerIndex:Ae,validator:(o,{validateColumns:s})=>s(o,{showLine:{toBeTypes:["boolean"]},showLabel:{toBeTypes:["boolean"]},lineDashArray:{toBeTypes:["string"]},lineColorType:{toBeOption:"ColorType"},labelColorType:{toBeOption:"ColorType"},labelTextColorType:{toBeOption:"ColorType"},labelTextFormat:{toBeTypes:["string","Function"]},labelPadding:{toBeTypes:["number"]},labelRotate:{toBeTypes:["number"]}})};function He({groupLabel:o,axisX:s,axisHeight:e,fullParams:r}){return r.showLine&&o?[{id:o,x1:s,x2:s,y1:0,y2:e}]:[]}function Ue({groupLabel:o,axisX:s,fullParams:e,textSizePx:r,rowAmount:i}){const n=Se(o,e.labelTextFormat),h=n.split(`
`),l=h.reduce((P,x)=>x.length>P.length?x:P,""),p=Me(l,r),g=r*h.length;return e.showLabel&&o?[{id:o,x:s,y:-e.labelPadding*i,text:n,textArr:h,textWidth:p,textHeight:g}]:[]}function Xe({selection:o,pluginName:s,lineData:e,fullParams:r,fullChartParams:i}){const n=X(s,"auxline");return o.selectAll(`line.${n}`).data(e).join(l=>l.append("line").classed(n,!0).style("stroke-width",1).style("pointer-events","none").style("vector-effect","non-scaling-stroke").attr("x1",p=>p.x1).attr("y1",p=>p.y1).attr("x2",p=>p.x2).attr("y2",p=>p.y2),l=>l.transition().duration(50).attr("x1",g=>g.x1).attr("y1",g=>g.y1).attr("x2",g=>g.x2).attr("y2",g=>g.y2),l=>l.remove()).style("stroke",l=>J(r.lineColorType,i)).style("stroke-dasharray",r.lineDashArray??"none")}function We(o){o.selectAll("line").data([]).exit().remove()}function Ye({selection:o,labelData:s,fullParams:e,fullDataFormatter:r,fullChartParams:i,textReverseTransformWithRotate:n,textSizePx:h}){return o.selectAll(`g.${K}`).data(s).join(p=>p.append("g").classed(K,!0).style("cursor","pointer").attr("transform",(g,P)=>`translate(${g.x}, ${g.y})`),p=>p.transition().duration(50).attr("transform",(P,x)=>`translate(${P.x}, ${P.y})`),p=>p.remove()).each((p,g,P)=>{const x=p.textWidth+12,A=p.textHeight+6;let S=-x/2,y=-2,M=S,L=y-3;r.groupAxis.position==="bottom"?(S=e.labelRotate?-x+A:-x/2,y=2,M=S,L=y-3):r.groupAxis.position==="left"?(S=-x+2,y=-A/2,M=S,L=y-3,e.labelRotate&&(L+=A)):r.groupAxis.position==="right"?(S=-2,y=-A/2,M=S,L=y-3,e.labelRotate&&(L+=A)):r.groupAxis.position==="top"&&(S=e.labelRotate?-x+A:-x/2,y=-A+6,M=-A,L=y-3),E(P[g]).selectAll("rect").data([p]).join($=>$.append("rect").style("cursor","pointer").attr("rx",5).attr("ry",5),$=>$,$=>$.remove()).attr("width",$=>`${x}px`).attr("height",`${A}px`).attr("fill",$=>J(e.labelColorType,i)).attr("x",M).attr("y",L).style("transform",n),E(P[g]).selectAll("text").data([p]).join($=>$.append("text").style("dominant-baseline","hanging").style("cursor","pointer"),$=>$,$=>$.remove()).style("transform",n).attr("fill",$=>J(e.labelTextColorType,i)).attr("font-size",i.styles.textSize).attr("x",M+6).attr("y",L+3).each(($,w,T)=>{Te(E(T[w]),{textArr:p.textArr,textSizePx:h,groupAxisPosition:r.groupAxis.position,isContainerRotated:!1})})})}function je(o){o.selectAll(`g.${K}`).data([]).exit().remove()}const ot=W(ve)(({selection:o,rootSelection:s,name:e,subject:r,observer:i})=>{const n=new V;let h=!1;const l=s.insert("rect","g").classed(X(U,"rect"),!0).attr("opacity",0),{seriesSelection$:p,axesSelection$:g,defsSelection$:P,graphicGSelection$:x}=te({selection:o,pluginName:U,clipPathID:"test",seriesLabels$:i.isSeriesSeprate$.pipe(R(a=>be(()=>a,i.seriesLabels$,i.seriesLabels$.pipe(b(C=>[C[0]]))))),gridContainerPosition$:i.gridContainerPosition$,gridAxesTransform$:i.gridAxesTransform$,gridGraphicTransform$:i.gridGraphicTransform$});i.layout$.pipe(m(n)).subscribe(a=>{l.attr("width",a.rootWidth).attr("height",a.rootHeight)});const A=B({groupScaleDomainValue:i.groupScaleDomainValue$,gridAxesSize:i.gridAxesSize$}).pipe(m(n),R(async a=>a),b(a=>Pe().domain(a.groupScaleDomainValue).range([0,a.gridAxesSize.width]))),S=i.fullChartParams$.pipe(m(n),b(a=>a.highlightTarget),k()),y=ee(s,"mousemove").pipe(m(n)),M=B({gridAxesReverseTransform:i.gridAxesReverseTransform$,gridContainerPosition:i.gridContainerPosition$}).pipe(m(n),R(async a=>a),b(a=>{const C=`rotateX(${a.gridAxesReverseTransform.rotateX}deg) rotateY(${a.gridAxesReverseTransform.rotateY}deg)`,f=`rotate(${a.gridAxesReverseTransform.rotate}deg)`,I=`scale(${1/a.gridContainerPosition[0].scale[0]}, ${1/a.gridContainerPosition[0].scale[1]})`;return`${C} ${f} ${I}`}),k()),L=B({textReverseTransform:M,fullParams:i.fullParams$}).pipe(m(n),R(async a=>a),b(a=>`${a.textReverseTransform} rotate(${a.fullParams.labelRotate}deg)`)),$=i.gridContainerPosition$.pipe(m(n),b(a=>a.reduce((f,I)=>I.columnIndex>f?I.columnIndex:f,0)+1),k()),w=i.gridContainerPosition$.pipe(m(n),b(a=>a.reduce((f,I)=>I.rowIndex>f?I.rowIndex:f,0)+1),k()),T=Ce({rootSelection:s,fullDataFormatter$:i.fullDataFormatter$,gridAxesSize$:i.gridAxesSize$,computedData$:i.computedData$,fullChartParams$:i.fullChartParams$,gridContainerPosition$:i.gridContainerPosition$,layout$:i.layout$}).pipe(m(n));B({axesSelection:g,columnAmount:$,rowAmount:w,layout:i.layout$,rootMousemove:y,gridGroupPosition:T,computedData:i.computedData$,groupScale:A,gridAxesSize:i.gridAxesSize$,fullParams:i.fullParams$,fullDataFormatter:i.fullDataFormatter$,fullChartParams:i.fullChartParams$,highlightTarget:S,textReverseTransformWithRotate:L,GroupDataMap:i.GroupDataMap$,textSizePx:i.textSizePx$}).pipe(m(n),R(async a=>a)).subscribe(a=>{const{groupIndex:C,groupLabel:f}=a.gridGroupPosition,I=a.groupScale(C)??0,H=He({groupLabel:f,axisX:I,axisHeight:a.gridAxesSize.height,fullParams:a.fullParams});Xe({selection:a.axesSelection,pluginName:e,lineData:H,fullParams:a.fullParams,fullChartParams:a.fullChartParams});const Y=Ue({groupLabel:f,axisX:I,fullParams:a.fullParams,textSizePx:a.textSizePx,rowAmount:a.rowAmount});Ye({selection:a.axesSelection,labelData:Y,fullParams:a.fullParams,fullDataFormatter:a.fullDataFormatter,fullChartParams:a.fullChartParams,textReverseTransformWithRotate:a.textReverseTransformWithRotate,textSizePx:a.textSizePx}).on("mouseover",(G,z)=>{G.stopPropagation(),h=!0,r.event$.next({type:"grid",pluginName:e,eventName:"mouseover",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",group:a.GroupDataMap.get(f)??[],groupIndex:C,groupLabel:f,event:G,data:a.computedData})}).on("mousemove",(G,z)=>{G.stopPropagation(),r.event$.next({type:"grid",pluginName:e,eventName:"mousemove",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",group:a.GroupDataMap.get(f)??[],groupIndex:C,groupLabel:f,event:G,data:a.computedData})}).on("mouseout",(G,z)=>{G.stopPropagation(),h=!1,r.event$.next({type:"grid",pluginName:e,eventName:"mouseout",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",group:a.GroupDataMap.get(f)??[],groupIndex:C,groupLabel:f,event:G,data:a.computedData})}).on("click",(G,z)=>{G.stopPropagation(),r.event$.next({type:"grid",pluginName:e,eventName:"click",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",group:a.GroupDataMap.get(f)??[],groupIndex:C,groupLabel:f,event:G,data:a.computedData})})});const v=ee(l,"mouseout").pipe(m(n));return B({rootRectMouseout:v,axesSelection:g}).pipe(m(n),R(async a=>a)).subscribe(a=>{setTimeout(()=>{h!=!0&&(We(a.axesSelection),je(a.axesSelection))})}),()=>{n.next(void 0),l.remove()}});export{at as D,ot as G,it as L,rt as S,Ee as c};
