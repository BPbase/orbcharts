import{S as G,c as P,t as x,s as b,m as S,d as O,b as I,j as w,O as q}from"./qbpNAjKn.js";import{e as J,b as _,a as C}from"./B2YBZYj8.js";import{a as K,o as Q}from"./1ujJLabB.js";import{e as Z,c as F,f as ee,g as te}from"./BESy59oE.js";import{c as re}from"./DKExitx-.js";import{a as ie,c as se}from"./DEdn1kP6.js";function oe({graphicGSelection:a,circleGClassName:$,circleClassName:n,data:l,fullParams:o,fullChartParams:e,graphicReverseScale:c}){const h=i=>{const t=i.size();return e.transitionDuration/t};let r=0;return a.each((i,t,g)=>{I(g[t]).selectAll("g").data(l[t],d=>d.id).join(d=>(r=h(d),d.append("g").classed($,!0)),d=>d,d=>d.remove()).attr("transform",d=>`translate(${d.axisX}, ${d.axisY})`).each((d,A,D)=>{I(D[A]).selectAll("circle").data([d]).join(f=>f.append("circle").style("cursor","pointer").style("vector-effect","non-scaling-stroke").classed(n,!0).attr("opacity",0).transition().delay((y,R)=>A*r).attr("opacity",1),f=>f.transition().duration(50).attr("opacity",1),f=>f.remove()).attr("r",o.radius).attr("fill",(f,y)=>_({datum:f,colorType:o.fillColorType,fullChartParams:e})).attr("stroke",(f,y)=>_({datum:f,colorType:o.strokeColorType,fullChartParams:e})).attr("stroke-width",o.strokeWidth).attr("transform",`scale(${c[t][0]??1}, ${c[t][1]??1})`)})}),a.selectAll(`circle.${n}`)}function ae({selection:a,ids:$,onlyShowHighlighted:n,fullChartParams:l}){if(a.interrupt("highlight"),!$.length){a.transition("highlight").duration(200).style("opacity",n===!0?0:1);return}a.each((o,e,c)=>{$.includes(o.id)?I(c[e]).style("opacity",1).transition("highlight").duration(200):I(c[e]).style("opacity",n===!0?0:l.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function ne({defsSelection:a,clipPathData:$}){a.selectAll("clipPath").data($).join(n=>n.append("clipPath"),n=>n,n=>n.remove()).attr("id",n=>n.id).each((n,l,o)=>{I(o[l]).selectAll("rect").data([n]).join("rect").attr("x",0).attr("y",0).attr("width",e=>e.width).attr("height",e=>e.height)})}const Se=(a,{selection:$,computedData$:n,visibleComputedData$:l,existedSeriesLabels$:o,SeriesDataMap$:e,GroupDataMap$:c,fullParams$:h,fullChartParams$:r,gridAxesTransform$:u,gridGraphicTransform$:i,gridGraphicReverseScale$:t,gridAxesSize$:g,gridHighlight$:d,gridContainer$:A,event$:D})=>{const f=new G,y=J(a,"clipPath-box"),R=C(a,"circleG"),k=C(a,"circle"),E=new G,{seriesSelection$:pe,axesSelection$:ue,defsSelection$:Y,graphicGSelection$:N}=K({selection:$,pluginName:a,clipPathID:y,existedSeriesLabels$:o,gridContainer$:A,gridAxesTransform$:u,gridGraphicTransform$:i}),H=P({computedData:n,gridGraphicReverseScale:t}).pipe(x(f),b(async s=>s),S(s=>s.computedData.map((L,m)=>s.gridGraphicReverseScale[m])));P({defsSelection:Y,gridAxesSize:g}).pipe(x(f),b(async s=>s)).subscribe(s=>{const L=[{id:y,width:s.gridAxesSize.width,height:s.gridAxesSize.height}];ne({defsSelection:s.defsSelection,clipPathData:L})});const V=r.pipe(x(f),S(s=>s.highlightTarget),O());P({graphicGSelection:N,computedData:n,visibleComputedData:l,SeriesDataMap:e,GroupDataMap:c,graphicReverseScale:H,fullChartParams:r,fullParams:h,highlightTarget:V}).pipe(x(f),b(async s=>s)).subscribe(s=>{const L=oe({graphicGSelection:s.graphicGSelection,circleGClassName:R,circleClassName:k,data:s.visibleComputedData,fullParams:s.fullParams,fullChartParams:s.fullChartParams,graphicReverseScale:s.graphicReverseScale});L.on("mouseover",(m,p)=>{m.stopPropagation(),D.next({type:"grid",eventName:"mouseover",pluginName:a,highlightTarget:s.highlightTarget,datum:p,series:s.SeriesDataMap.get(p.seriesLabel),seriesIndex:p.seriesIndex,seriesLabel:p.seriesLabel,groups:s.GroupDataMap.get(p.groupLabel),groupIndex:p.groupIndex,groupLabel:p.groupLabel,event:m,data:s.computedData})}).on("mousemove",(m,p)=>{m.stopPropagation(),D.next({type:"grid",eventName:"mousemove",pluginName:a,highlightTarget:s.highlightTarget,data:s.computedData,datum:p,series:s.SeriesDataMap.get(p.seriesLabel),seriesIndex:p.seriesIndex,seriesLabel:p.seriesLabel,groups:s.GroupDataMap.get(p.groupLabel),groupIndex:p.groupIndex,groupLabel:p.groupLabel,event:m})}).on("mouseout",(m,p)=>{m.stopPropagation(),D.next({type:"grid",eventName:"mouseout",pluginName:a,highlightTarget:s.highlightTarget,datum:p,series:s.SeriesDataMap.get(p.seriesLabel),seriesIndex:p.seriesIndex,seriesLabel:p.seriesLabel,groups:s.GroupDataMap.get(p.groupLabel),groupIndex:p.groupIndex,groupLabel:p.groupLabel,event:m,data:s.computedData})}).on("click",(m,p)=>{m.stopPropagation(),D.next({type:"grid",eventName:"click",pluginName:a,highlightTarget:s.highlightTarget,datum:p,series:s.SeriesDataMap.get(p.seriesLabel),seriesIndex:p.seriesIndex,seriesLabel:p.seriesLabel,groups:s.GroupDataMap.get(p.groupLabel),groupIndex:p.groupIndex,groupLabel:p.groupLabel,event:m,data:s.computedData})}),E.next(L)});const B=d.subscribe(),W=h.pipe(x(f),S(s=>s.onlyShowHighlighted),O());return r.pipe(x(f),b(s=>P({graphicSelection:E,highlight:d,onlyShowHighlighted:W,fullChartParams:r}).pipe(x(f),b(async L=>L)))).subscribe(s=>{ae({selection:s.graphicSelection,ids:s.highlight,onlyShowHighlighted:s.onlyShowHighlighted,fullChartParams:s.fullChartParams})}),()=>{f.next(void 0),B.unsubscribe()}},T="MultiLines",j=C(T,"grid"),De=w(T,Z)(({selection:a,name:$,subject:n,observer:l})=>{const o=new G,e=[];return F(l).subscribe(h=>{e.forEach(r=>r()),a.selectAll(`g.${j}`).data(h).join("g").attr("class",j).each((r,u,i)=>{const t=I(i[u]);e[u]=re(T,{selection:t,computedData$:r.gridComputedData$,existedSeriesLabels$:r.existedSeriesLabels$,SeriesDataMap$:r.SeriesDataMap$,GroupDataMap$:r.GroupDataMap$,fullDataFormatter$:r.gridDataFormatter$,fullParams$:l.fullParams$,fullChartParams$:l.fullChartParams$,gridAxesTransform$:r.gridAxesTransform$,gridGraphicTransform$:r.gridGraphicTransform$,gridAxesSize$:r.gridAxesSize$,gridHighlight$:r.gridHighlight$,gridContainer$:r.gridContainer$,event$:n.event$})})}),()=>{o.next(void 0),e.forEach(h=>h())}}),v="MultiGroupAxis",z=C(v,"grid"),be=w(v,ee)(({selection:a,name:$,subject:n,observer:l})=>{const o=new G,e=[];return F(l).subscribe(h=>{e.forEach(r=>r()),a.selectAll(`g.${z}`).data(h).join("g").attr("class",z).each((r,u,i)=>{const t=I(i[u]);e[u]=ie(v,{selection:t,computedData$:r.gridComputedData$,fullParams$:l.fullParams$,fullDataFormatter$:r.gridDataFormatter$,fullChartParams$:l.fullChartParams$,gridAxesTransform$:r.gridAxesTransform$,gridAxesReverseTransform$:r.gridAxesReverseTransform$,gridAxesSize$:r.gridAxesSize$,gridContainer$:r.gridContainer$,isSeriesPositionSeprate$:r.isSeriesPositionSeprate$})})}),()=>{o.next(void 0),e.forEach(h=>h())}});function U(a,$,n,l){const{gap:o,rowAmount:e,columnAmount:c}=$,h=(a.width-o*(c-1))/c,r=(a.height-o*(e-1))/e,u=l*h+l*o,i=n*r+n*o,t=[u,i],g=[h/a.width,r/a.height];return{translate:t,scale:g}}const le=({fullDataFormatter$:a,layout$:$})=>{const n=new G;function l({xAxis:o,yAxis:e,width:c,height:h}){if(!o||!e)return{translate:[0,0],scale:[1,1],rotate:0,rotateX:0,rotateY:0,value:""};let r=0,u=0,i=0,t=0,g=0;return o.position==="bottom"?e.position==="left"?(t=180,u=h):e.position==="right"?(t=180,g=180,r=c,u=h):(t=180,u=h):o.position==="top"?e.position==="left"||(e.position==="right"?(g=180,r=c):(t=180,u=h)):o.position==="left"?e.position==="bottom"?(i=-90,u=h):e.position==="top"?(i=-90,g=180):(t=180,u=h):o.position==="right"&&(e.position==="bottom"?(i=-90,t=180,u=h,r=c):e.position==="top"?(i=-90,t=180,g=180,r=c):(t=180,u=h)),{translate:[r,u],scale:[1,1],rotate:i,rotateX:t,rotateY:g,value:`translate(${r}px, ${u}px) rotate(${i}deg) rotateX(${t}deg) rotateY(${g}deg)`}}return new q(o=>(P({fullDataFormatter:a,layout:$}).pipe(x(n),b(async e=>e)).subscribe(e=>{const c=l({xAxis:e.fullDataFormatter.grid.groupAxis,yAxis:e.fullDataFormatter.grid.valueAxis,width:e.layout.width,height:e.layout.height});o.next(c)}),function(){n.next(void 0)}))},ce=({gridAxesTransform$:a})=>a.pipe(S($=>{const n=[0,0],l=[1/$.scale[0],1/$.scale[1]],o=$.rotate*-1,e=$.rotateX*-1,c=$.rotateY*-1;return{translate:n,scale:l,rotate:o,rotateX:e,rotateY:c,value:`translate(${n[0]}px, ${n[1]}px) rotate(${o}deg) rotateX(${e}deg) rotateY(${c}deg)`}})),ge=({computedData$:a,fullDataFormatter$:$,fullChartParams$:n,layout$:l})=>P({computedData:a,fullDataFormatter:$,fullChartParams:n,layout:l}).pipe(b(async e=>e),S(e=>{const c=e.fullDataFormatter.grid;if(!!(c.seriesSlotIndexes&&c.seriesSlotIndexes.length===e.computedData.length))return e.computedData.map((r,u)=>{const i=c.seriesSlotIndexes[u]%e.fullDataFormatter.container.columnAmount,t=Math.floor(c.seriesSlotIndexes[u]/e.fullDataFormatter.container.columnAmount),{translate:g,scale:d}=U(e.layout,e.fullDataFormatter.container,t,i);return{slotIndex:c.seriesSlotIndexes[u],rowIndex:t,columnIndex:i,translate:g,scale:d}});{const r=c.slotIndex%e.fullDataFormatter.container.columnAmount,u=Math.floor(c.slotIndex/e.fullDataFormatter.container.columnAmount);return e.computedData.map((i,t)=>{const{translate:g,scale:d}=U(e.layout,e.fullDataFormatter.container,u,r);return{slotIndex:c.slotIndex,rowIndex:u,columnIndex:r,translate:g,scale:d}})}})),M="OverlappingValueAxes",X=C(M,"grid"),Ae=w(M,te)(({selection:a,name:$,subject:n,observer:l})=>{const o=new G,e=[],c=l.fullParams$.pipe(x(o),S(i=>i.gridIndexes[0])),h=l.fullParams$.pipe(x(o),S(i=>i.gridIndexes[1])),r=P({firstGridIndex:c,secondGridIndex:h}).pipe(x(o),b(i=>l.fullDataFormatter$.pipe(x(o),S(t=>{t.gridList[i.secondGridIndex]||(t.gridList[i.secondGridIndex]=Object.assign({},t.gridList[i.firstGridIndex]));let g="";return t.gridList[i.firstGridIndex].valueAxis.position==="left"?g="right":t.gridList[i.firstGridIndex].valueAxis.position==="bottom"?g="top":t.gridList[i.firstGridIndex].valueAxis.position==="top"?g="bottom":t.gridList[i.firstGridIndex].valueAxis.position==="right"&&(g="left"),console.log("reversePosition",g),{type:"grid",grid:{...t.gridList[i.secondGridIndex],valueAxis:{...t.gridList[i.secondGridIndex].valueAxis,position:g}},container:{...t.container}}}))));return Q(l).pipe(x(o),S(i=>({...i,fullParams$:i.fullParams$.pipe(S(t=>(t.gridIndexes.length>2&&(t.gridIndexes.length=2),t)))})),b(i=>F(i)),S(i=>i.map((t,g)=>{if(g===0)return t;const d=le({fullDataFormatter$:r,layout$:l.layout$}),A=ce({gridAxesTransform$:d}),D=ge({computedData$:t.gridComputedData$,fullDataFormatter$:r,fullChartParams$:l.fullChartParams$,layout$:l.layout$});return{...t,gridAxesTransform$:d,gridAxesReverseTransform$:A,gridContainer$:D}}))).subscribe(i=>{e.forEach(t=>t()),a.selectAll(`g.${X}`).data(i).join("g").attr("class",X).each((t,g,d)=>{if(g>1)return;const A=I(d[g]);e[g]=se(M,{selection:A,computedData$:t.gridComputedData$,fullParams$:l.fullParams$.pipe(S(D=>g===0?D.firstAxis:D.secondAxis)),fullDataFormatter$:t.gridDataFormatter$,fullChartParams$:l.fullChartParams$,gridAxesTransform$:t.gridAxesTransform$,gridAxesReverseTransform$:t.gridAxesReverseTransform$,gridAxesSize$:t.gridAxesSize$,gridContainer$:t.gridContainer$,isSeriesPositionSeprate$:t.isSeriesPositionSeprate$})})}),()=>{o.next(void 0),e.forEach(i=>i())}});export{be as M,Ae as O,De as a,Se as c};
