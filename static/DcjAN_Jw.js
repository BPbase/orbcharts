import{a as v,p as j,t as g,m,d as A,k as x,l as S,aT as W,s as T,bl as ee,b8 as re,g as H,S as te,y as ie}from"./Bh8imPUI.js";import{o as ae}from"./CorttYm4.js";const R=.3;function U({axisWidth:a,groupAmount:p,barAmountOfGroup:n,barPadding:i=0,barGroupPadding:o=0}){const u=((p>1?a/(p-1):a)-o)/n-i;return u>1?u:1}function ne(a,p,n){const i=a/2,o=a*p.length+n.barPadding*p.length;return ee().domain(p).range([-o/2+i,o/2-i])}function se(a,p){return a<=1?0:p/(a-1)*R}function oe(a,p){return a<=1?p:p*(1-R)}function pe({graphicGSelection:a,pathGClassName:p,pathClassName:n,visibleComputedAxesData:i,linearGradientIds:o,zeroYArr:l,groupLabels:u,barScale:$,params:O,chartParams:M,barWidth:d,delayGroup:y,transitionItem:B,isSeriesSeprate:L}){const G=d/2;return a.each((z,h,f)=>{T(f[h]).selectAll(`g.${p}`).data(i[h]??[]).join(s=>{const b=s.append("g").classed(p,!0).attr("cursor","pointer");return b.append("path").classed(n,!0).style("vector-effect","non-scaling-stroke").attr("d",I=>{const D=-G,w=l[h],P=l[h];return`M${D},${w} L${D+d/2},${P} ${D+d},${w}`}),b},s=>s,s=>s.remove()).attr("transform",s=>`translate(${L?0:$(s.seriesLabel)}, 0)`).select(`path.${n}`).attr("height",s=>Math.abs(s.axisYFromZero)||1).attr("y",s=>s.axisY<l[h]?s.axisY:l[h]).attr("x",s=>L?0:$(s.seriesLabel)).style("fill",s=>`url(#${o[s.seriesIndex]})`).attr("stroke",s=>s.color).attr("transform",s=>`translate(${s?s.axisX:0}, 0)`).transition().duration(B).ease(re(M.transitionEase)).delay((s,b)=>s.groupIndex*y).attr("d",s=>{const b=-G,I=l[h],D=s.axisY;return`M${b},${I} L${b+d/2},${D} ${b+d},${I}`})}),a.selectAll(`path.${n}`)}function le({defsSelection:a,computedData:p,linearGradientIds:n,params:i}){a.selectAll("linearGradient").data(p??[]).join(o=>o.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),o=>o,o=>o.remove()).attr("id",(o,l)=>o[0]?n[o[0].seriesIndex]:"").html((o,l)=>{const u=o[0]?o[0].color:"";return`
        <stop offset="0%"   stop-color="${u}" stop-opacity="${i.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${u}" stop-opacity="${i.linearGradientOpacity[1]}"/>
      `})}function ce({defsSelection:a,clipPathData:p}){a.selectAll("clipPath").data(p).join(n=>n.append("clipPath"),n=>n,n=>n.remove()).attr("id",n=>n.id).each((n,i,o)=>{T(o[i]).selectAll("rect").data([n]).join(l=>l.append("rect"),l=>l,l=>l.remove()).attr("x",0).attr("y",0).attr("width",l=>l.width).attr("height",l=>l.height)})}function ge({selection:a,ids:p,fullChartParams:n}){a.interrupt("highlight");const i=()=>{a.transition("highlight").duration(200).style("opacity",1)};if(!p.length){i();return}a.each((o,l,u)=>{p.includes(o.id)?T(u[l]).style("opacity",1):T(u[l]).style("opacity",n.styles.unhighlightedOpacity)})}const ue=(a,{selection:p,computedData$:n,computedAxesData$:i,visibleComputedData$:o,visibleComputedAxesData$:l,fullDataFormatter$:u,seriesLabels$:$,SeriesDataMap$:O,GroupDataMap$:M,fullParams$:d,fullChartParams$:y,gridAxesTransform$:B,gridGraphicTransform$:L,gridAxesSize$:G,gridHighlight$:k,gridContainerPosition$:z,isSeriesSeprate$:h,event$:f})=>{const c=new v,s=j(a,"clipPath-box"),b=H(a,"pathG"),I=H(a,"path"),{seriesSelection$:D,axesSelection$:w,defsSelection$:P,graphicGSelection$:Z}=ae({selection:p,pluginName:a,clipPathID:s,seriesLabels$:$,gridContainerPosition$:z,gridAxesTransform$:B,gridGraphicTransform$:L});L.pipe(g(c),m(e=>-e.translate[1]/e.scale[1]));const X=l.pipe(m(e=>e.map(t=>t[0]?t[0].axisY-t[0].axisYFromZero:0)),A()),E=x({computedData:n,visibleComputedData:o,params:d,gridAxesSize:G,isSeriesSeprate:h}).pipe(g(c),S(async e=>e),m(e=>e.params.barWidth?e.params.barWidth:e.isSeriesSeprate?U({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):U({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}))),C=o.pipe(g(c),m(e=>{const t=new Set;return e.forEach(r=>{r.forEach(N=>{t.add(N.groupLabel)})}),Array.from(t)})),q=new W(e=>{x({seriesLabels:$,barWidth:E,params:d}).pipe(g(c),S(async t=>t)).subscribe(t=>{const r=ne(t.barWidth,t.seriesLabels,t.params);e.next(r)})}),F=y.pipe(g(c),m(e=>e.transitionDuration),A()),J=new W(e=>{x({groupLabels:C,transitionDuration:F}).pipe(S(async t=>t)).subscribe(t=>{const r=se(t.groupLabels.length,t.transitionDuration);e.next(r)})}).pipe(g(c),A()),K=new W(e=>{x({groupLabels:C,transitionDuration:F}).pipe(S(async t=>t)).subscribe(t=>{const r=oe(t.groupLabels.length,t.transitionDuration);e.next(r)})}).pipe(g(c),A());x({defsSelection:P,gridAxesSize:G}).pipe(g(c),S(async e=>e)).subscribe(e=>{const t=[{id:s,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];ce({defsSelection:e.defsSelection,clipPathData:t})});const Q=y.pipe(g(c),m(e=>e.highlightTarget),A()),V=$.pipe(g(c),m(e=>e.map((t,r)=>j(a,`lineargradient-${t}`)))),Y=x({graphicGSelection:Z,defsSelection:P,computedData:n,visibleComputedAxesData:l,linearGradientIds:V,zeroYArr:X,groupLabels:C,barScale:q,params:d,chartParams:y,barWidth:E,delayGroup:J,transitionItem:K,isSeriesSeprate:h}).pipe(g(c),S(async e=>e),m(e=>(le({defsSelection:e.defsSelection,computedData:e.computedData,linearGradientIds:e.linearGradientIds,params:e.params}),pe({graphicGSelection:e.graphicGSelection,pathGClassName:b,pathClassName:I,visibleComputedAxesData:e.visibleComputedAxesData,linearGradientIds:e.linearGradientIds,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesSeprate:e.isSeriesSeprate}))));return x({barSelection:Y,computedData:n,highlightTarget:Q,SeriesDataMap:O,GroupDataMap:M}).subscribe(e=>{e.barSelection.on("mouseover",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"mouseover",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("mousemove",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"mousemove",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("mouseout",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"mouseout",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("click",(t,r)=>{t.stopPropagation(),f.next({type:"grid",eventName:"click",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})})}),x({barSelection:Y,highlight:k.pipe(m(e=>e.map(t=>t.id))),fullChartParams:y}).pipe(g(c),S(async e=>e)).subscribe(e=>{ge({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}},_="BarsTriangle",he={name:_,defaultParams:ie,layerIndex:5,validator:(a,{validateColumns:p})=>p(a,{barWidth:{toBeTypes:["number"]},barPadding:{toBeTypes:["number"]},barGroupPadding:{toBeTypes:["number"]},linearGradientOpacity:{toBe:"[number, number]",test:i=>Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"}})},me=te(he)(({selection:a,name:p,subject:n,observer:i})=>{const o=new v,l=ue(_,{selection:a,computedData$:i.computedData$,computedAxesData$:i.computedAxesData$,visibleComputedData$:i.visibleComputedData$,visibleComputedAxesData$:i.visibleComputedAxesData$,fullDataFormatter$:i.fullDataFormatter$,seriesLabels$:i.seriesLabels$,SeriesDataMap$:i.SeriesDataMap$,GroupDataMap$:i.GroupDataMap$,fullParams$:i.fullParams$,fullChartParams$:i.fullChartParams$,gridAxesTransform$:i.gridAxesTransform$,gridGraphicTransform$:i.gridGraphicTransform$,gridAxesSize$:i.gridAxesSize$,gridHighlight$:i.gridHighlight$,gridContainerPosition$:i.gridContainerPosition$,isSeriesSeprate$:i.isSeriesSeprate$,event$:n.event$});return()=>{o.next(void 0),l()}});export{me as B,ue as c};
