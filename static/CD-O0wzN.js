import{p as F,S as $,m as u,b as z,k as x,t as g,l as d,H as h,aU as _,aV as w}from"./CJz0rwbW.js";import{z as f}from"./D7qTWgnP.js";import{f as O}from"./n653kr_e.js";const P="GridZoom",R={name:P,defaultParams:h,layerIndex:_,validator:(D,{validateColumns:r})=>({status:"success",columnName:"",expectToBe:""})},N=F(R)(({selection:D,rootSelection:r,name:T,observer:n,subject:A})=>{const s=new $;let i={k:1,x:0,y:0};const l=n.computedData$.pipe(u(o=>o[0]?o[0].length-1:0),z()),M=n.fullDataFormatter$.pipe(u(o=>o.grid.groupAxis),O()),G=x({initGroupAxis:M,groupMaxIndex:l,layout:n.layout$,axisSize:n.gridAxesSize$}).pipe(g(s),d(async o=>o),u(o=>{const p=o.initGroupAxis.scaleDomain[0]-o.initGroupAxis.scalePadding,e=o.initGroupAxis.scaleDomain[1]==="max"?o.groupMaxIndex+o.initGroupAxis.scalePadding:o.initGroupAxis.scaleDomain[1]+o.initGroupAxis.scalePadding;return w({maxValue:o.groupMaxIndex,minValue:0,axisWidth:o.axisSize.width,scaleDomain:[p,e],scaleRange:[0,1]})}));return x({initGroupScale:G,fullDataFormatter:n.fullDataFormatter$,groupMaxIndex:l}).pipe(g(s),d(async o=>o)).subscribe(o=>{const e=o.initGroupScale.copy(),m=f().on("zoom",function(y){const a=y.transform,c=I=>{const S=Math.round(I);return Math.min(o.groupMaxIndex,Math.max(0,S))},t=o.fullDataFormatter.grid.groupAxis.position==="bottom"||o.fullDataFormatter.grid.groupAxis.position==="top"?a.rescaleX(e).domain().map(c):a.rescaleY(e).domain().map(c);t[0]<=0&&t[1]>=o.groupMaxIndex?a.k<i.k&&(a.k=i.k,a.x=i.x,a.y=i.y):t[1]-t[0]<=1&&a.k>i.k&&(a.k=i.k,a.x=i.x,a.y=i.y),i.k=a.k,i.x=a.x,i.y=a.y;const k={...o.fullDataFormatter,grid:{...o.fullDataFormatter.grid,groupAxis:{...o.fullDataFormatter.grid.groupAxis,scaleDomain:t}}};A.dataFormatter$.next(k)});r.call(m)}),()=>{s.next(void 0),r.call(f().on("zoom",null))}});export{N as G};
