import{e as K,a as N,g as Q,l as R,j as V}from"./fnY6dSo8.js";import{a as Z,g as ee}from"./4_nDscJ4.js";import{S as te,m as P,d as E,e as F,t as S,s as f,c as y,O as C}from"./BpcKryD-.js";import{f as ie}from"./BxTrv8Ik.js";function re(i="curveLinear"){return R().x(s=>s.axisX).y(s=>s.axisY).curve(V[i])}function se(i){let s=[[]],a=0;for(let c in i){if(i[c].visible==!1||i[c].value===void 0||i[c].value===null){s[a].length&&(a++,s[a]=[]);continue}s[a].push(i[c])}return s}function ne({selection:i,pathClassName:s,segmentData:a,linePath:c,params:n}){return i.selectAll("path").data(a,(r,u)=>r.length?`${r[0].id}_${r[r.length-1].id}`:u).join(r=>r.append("path").classed(s,!0).attr("fill","none").attr("pointer-events","visibleStroke").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),r=>r,r=>r.remove()).attr("stroke-width",n.lineWidth).attr("stroke",(r,u)=>r[0]&&r[0].color).attr("d",r=>c(r))}function oe({selection:i,seriesLabel:s,fullChartParams:a}){if(i.interrupt("highlight"),!s){i.transition("highlight").duration(200).style("opacity",1);return}i.each((c,n,d)=>{c===s?y(d[n]).style("opacity",1):y(d[n]).style("opacity",a.styles.unhighlightedOpacity)})}function ae({defsSelection:i,clipPathData:s,transitionDuration:a,transitionEase:c}){i.selectAll("clipPath").data(s).join(n=>n.append("clipPath"),n=>n,n=>n.remove()).attr("id",n=>n.id).each((n,d,r)=>{y(r[d]).selectAll("rect").data([n]).join(u=>{const l=u.append("rect");return l.transition().duration(a).ease(N(c)).tween("tween",(G,j,M)=>w=>{const v=G.width*w;l.attr("x",0).attr("y",0).attr("width",L=>v).attr("height",L=>L.height)}),l},u=>u.attr("x",0).attr("y",0).attr("width",l=>l.width).attr("height",l=>l.height),u=>u.remove())})}const de=(i,{selection:s,computedData$:a,existSeriesLabels$:c,SeriesDataMap$:n,GroupDataMap$:d,fullParams$:r,fullDataFormatter$:u,fullChartParams$:l,gridAxesTransform$:G,gridGraphicTransform$:j,gridAxesSize$:M,gridHighlight$:w,gridContainer$:v,event$:L})=>{const b=new te,O=K(i,"clipPath-box"),H=Q(i,"path"),{seriesSelection$:ge,axesSelection$:pe,defsSelection$:U,graphicGSelection$:z}=Z({selection:s,pluginName:i,clipPathID:O,existSeriesLabels$:c,gridContainer$:v,gridAxesTransform$:G,gridGraphicTransform$:j}),A=new C(e=>{const o=r.pipe(S(b)).subscribe(h=>{if(!h)return;const x=re(h.lineCurve);e.next(x)});return()=>{o.unsubscribe()}}),B=new C(e=>{a.pipe(S(b),f(async o=>o)).subscribe(o=>{const h=o[0]&&o[0][0]?o.map(x=>x[0].seriesLabel):[];e.next(h)})}),W=l.pipe(P(e=>e.transitionDuration),E()),$=l.pipe(P(e=>e.transitionEase),E());F({defsSelection:U,seriesLabels:B,axisSize:M,transitionDuration:W,transitionEase:$}).pipe(S(b),f(async e=>e)).subscribe(e=>{const h=[{id:O,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(x=>({id:`orbcharts__clipPath_${x}`,width:e.axisSize.width,height:e.axisSize.height})));ae({defsSelection:e.defsSelection,clipPathData:h,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const X=a.pipe(P(e=>{const o=new Map;return e.flat().forEach(h=>o.set(h.id,h)),o})),Y=ee({fullDataFormatter$:u,gridAxesSize$:M,computedData$:a,fullChartParams$:l}),q=l.pipe(S(b),P(e=>e.highlightTarget),E());return F({graphicGSelection:z,seriesLabels:B,computedData:a,SeriesDataMap:n,GroupDataMap:d,linePath:A,params:r,highlightTarget:q,gridGroupPositionFn:Y}).pipe(S(b),f(async e=>e)).subscribe(e=>{e.graphicGSelection.each((o,h,x)=>{const J=se(e.computedData[h]??[]);ne({selection:y(x[h]),pathClassName:H,linePath:e.linePath,segmentData:J,params:e.params}).on("mouseover",(g,p)=>{g.stopPropagation();const D=p[0]?p[0].seriesLabel:"",{groupIndex:T,groupLabel:m}=e.gridGroupPositionFn(g),t=e.GroupDataMap.get(m).find(I=>I.seriesLabel===D)??p[0];L.next({type:"grid",eventName:"mouseover",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:g,data:e.computedData})}).on("mousemove",(g,p)=>{g.stopPropagation();const D=p[0]?p[0].seriesLabel:"",{groupIndex:T,groupLabel:m}=e.gridGroupPositionFn(g),t=e.GroupDataMap.get(m).find(I=>I.seriesLabel===D)??p[0];L.next({type:"grid",eventName:"mousemove",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:g,data:e.computedData})}).on("mouseout",(g,p)=>{g.stopPropagation();const D=p[0]?p[0].seriesLabel:"",{groupIndex:T,groupLabel:m}=e.gridGroupPositionFn(g),t=e.GroupDataMap.get(m).find(I=>I.seriesLabel===D)??p[0];L.next({type:"grid",eventName:"mouseout",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:g,data:e.computedData})}).on("click",(g,p)=>{g.stopPropagation();const D=p[0]?p[0].seriesLabel:"",{groupIndex:T,groupLabel:m}=e.gridGroupPositionFn(g),t=e.GroupDataMap.get(m).find(I=>I.seriesLabel===D)??p[0];L.next({type:"grid",eventName:"click",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:g,data:e.computedData})})})}),l.pipe(S(b),ie(e=>e.highlightTarget==="series"),f(e=>F({graphicGSelection:z,gridHighlight:w,DataMap:X,fullChartParams:l}).pipe(S(b),f(async o=>o)))).subscribe(e=>{const o=e.gridHighlight[0]?e.gridHighlight[0].seriesLabel:null;oe({selection:e.graphicGSelection,seriesLabel:o,fullChartParams:e.fullChartParams})}),()=>{b.next(void 0)}};export{de as c};
