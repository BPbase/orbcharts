import{S as j,t as l,m as b,b as x,c as d,s as S,O as k,a as I}from"./C8v8pqyL.js";import{e as _,a as N,g as ee,f as re}from"./DupVaP3I.js";import{a as ie}from"./BUC-jAqX.js";const H=.3;function $({axisWidth:t,groupAmount:o,barAmountOfGroup:n,barPadding:c=0,barGroupPadding:h=0}){const L=(t/(o-1)-h)/n-c;return L>1?L:1}function te(t,o,n){const c=t/2,h=t*o.length+n.barPadding*o.length;return re().domain(o).range([-h/2+c,h/2-c])}function se(t,o){return t<=1?0:o/(t-1)*H}function ae(t,o){return t<=1?o:o*(1-H)}function oe({graphicGSelection:t,rectClassName:o,computedData:n,zeroYArr:c,groupLabels:h,barScale:p,params:L,chartParams:f,barWidth:m,transformedBarRadius:D,delayGroup:A,transitionItem:W,isSeriesPositionSeprate:G}){const w=m/2;return t.each((R,u,g)=>{I(g[u]).selectAll(`rect.${o}`).data(n[u]??[],s=>s.id).join(s=>s.append("rect").classed(o,!0).attr("cursor","pointer").attr("height",P=>0),s=>s,s=>s.remove()).attr("transform",(s,P)=>`translate(${(s?s.axisX:0)-w}, 0)`).attr("fill",s=>s.color).attr("y",s=>s.axisY<c[u]?s.axisY:c[u]).attr("x",s=>G?0:p(s.seriesLabel)).attr("width",m).attr("rx",D[u][0]??1).attr("ry",D[u][1]??1).transition().duration(W).ease(N(f.transitionEase)).delay((s,P)=>s.groupIndex*A).attr("height",s=>Math.abs(s.axisYFromZero))}),t.selectAll(`rect.${o}`)}function ne({defsSelection:t,clipPathData:o}){t.selectAll("clipPath").data(o).join(n=>n.append("clipPath"),n=>n,n=>n.remove()).attr("id",n=>n.id).each((n,c,h)=>{I(h[c]).selectAll("rect").data([n]).join(p=>p.append("rect"),p=>p,p=>p.remove()).attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height)})}function pe({selection:t,ids:o,fullChartParams:n}){if(t.interrupt("highlight"),!o.length){t.transition("highlight").duration(200).style("opacity",1);return}t.each((c,h,p)=>{o.includes(c.id)?I(p[h]).style("opacity",1):I(p[h]).style("opacity",n.styles.unhighlightedOpacity)})}const be=(t,{selection:o,computedData$:n,visibleComputedData$:c,existedSeriesLabels$:h,SeriesDataMap$:p,GroupDataMap$:L,fullParams$:f,fullChartParams$:m,gridAxesTransform$:D,gridGraphicTransform$:A,gridGraphicReverseScale$:W,gridAxesSize$:G,gridHighlight$:w,gridContainer$:B,isSeriesPositionSeprate$:R,event$:u})=>{const g=new j,s=_(t,"clipPath-box"),P=ee(t,"rect"),{seriesSelection$:ce,axesSelection$:ge,defsSelection$:U,graphicGSelection$:F}=ie({selection:o,pluginName:t,clipPathID:s,existedSeriesLabels$:h,gridContainer$:B,gridAxesTransform$:D,gridGraphicTransform$:A}),Z=c.pipe(l(g),b(e=>e.map(i=>i[0]?i[0].axisY-i[0].axisYFromZero:0)),x()),M=d({computedData:n,visibleComputedData:c,params:f,gridAxesSize:G,isSeriesPositionSeprate:R}).pipe(l(g),S(async e=>e),b(e=>e.params.barWidth?e.params.barWidth:e.isSeriesPositionSeprate?$({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):$({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding})),x()),C=d({computedData:n,barWidth:M,params:f,gridGraphicReverseScale:W}).pipe(l(g),S(async e=>e),b(e=>{const i=e.barWidth/2,a=e.params.barRadius===!0?i:e.params.barRadius===!1?0:typeof e.params.barRadius=="number"?e.params.barRadius:0;return e.computedData.map((r,V)=>{const O=e.gridGraphicReverseScale[V]??e.gridGraphicReverseScale[0];let y=a*O[0],v=a*O[1];if(y>i){const E=i/y;y=y*E,v=v*E}return[y,v]})})),X=c.pipe(l(g),b(e=>{const i=new Set;return e.forEach(a=>{a.forEach(r=>{i.add(r.seriesLabel)})}),Array.from(i)})),T=c.pipe(l(g),b(e=>{const i=new Set;return e.forEach(a=>{a.forEach(r=>{i.add(r.groupLabel)})}),Array.from(i)})),q=d({seriesLabels:X,barWidth:M,params:f}).pipe(l(g),S(async e=>e),b(e=>te(e.barWidth,e.seriesLabels,e.params))),z=m.pipe(l(g),b(e=>e.transitionDuration),x()),J=new k(e=>{d({groupLabels:T,transitionDuration:z}).pipe(S(async i=>i)).subscribe(i=>{const a=se(i.groupLabels.length,i.transitionDuration);e.next(a)})}).pipe(l(g),x()),K=new k(e=>{d({groupLabels:T,transitionDuration:z}).pipe(S(async i=>i)).subscribe(i=>{const a=ae(i.groupLabels.length,i.transitionDuration);e.next(a)})}).pipe(l(g),x());d({defsSelection:U,gridAxesSize:G}).pipe(l(g),S(async e=>e)).subscribe(e=>{const i=[{id:s,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];ne({defsSelection:e.defsSelection,clipPathData:i})});const Q=m.pipe(l(g),b(e=>e.highlightTarget),x()),Y=new j;return d({graphicGSelection:F,computedData:n,zeroYArr:Z,groupLabels:T,barScale:q,params:f,chartParams:m,highlightTarget:Q,barWidth:M,transformedBarRadius:C,delayGroup:J,transitionItem:K,SeriesDataMap:p,GroupDataMap:L,isSeriesPositionSeprate:R}).pipe(l(g),S(async e=>e)).subscribe(e=>{const i=oe({graphicGSelection:e.graphicGSelection,rectClassName:P,computedData:e.computedData,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,transformedBarRadius:e.transformedBarRadius,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesPositionSeprate:e.isSeriesPositionSeprate});i.on("mouseover",(a,r)=>{a.stopPropagation(),u.next({type:"grid",eventName:"mouseover",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:a,data:e.computedData})}).on("mousemove",(a,r)=>{a.stopPropagation(),u.next({type:"grid",eventName:"mousemove",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:a,data:e.computedData})}).on("mouseout",(a,r)=>{a.stopPropagation(),u.next({type:"grid",eventName:"mouseout",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:a,data:e.computedData})}).on("click",(a,r)=>{a.stopPropagation(),u.next({type:"grid",eventName:"click",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:a,data:e.computedData})}),Y.next(i)}),d({barSelection:Y,highlight:w,fullChartParams:m}).pipe(l(g),S(async e=>e)).subscribe(e=>{pe({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{g.next(void 0)}};export{be as c};
