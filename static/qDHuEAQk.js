import{S as k,t as h,m as b,d as P,e as f,s as m,O as C,c as B,y as V,o as N}from"./BpcKryD-.js";import{e as F,a as ee,g as R,f as re}from"./fnY6dSo8.js";import{a as te}from"./4_nDscJ4.js";const Z=.3;function _({axisWidth:i,groupAmount:c,barAmountOfGroup:s,barPadding:a=0,barGroupPadding:n=0}){const u=(i/(c-1)-n)/s-a;return u>1?u:1}function ie(i,c,s){const a=i/2,n=i*c.length+s.barPadding*c.length;return re().domain(c).range([-n/2+a,n/2-a])}function ae(i,c){return i<=1?0:c/(i-1)*Z}function se(i,c){return i<=1?c:c*(1-Z)}function ne({graphicGSelection:i,pathGClassName:c,pathClassName:s,computedData:a,linearGradientIds:n,zeroYArr:p,groupLabels:u,barScale:L,params:D,chartParams:W,barWidth:S,delayGroup:A,transitionItem:O,isSeriesPositionSeprate:T}){const G=S/2;return i.each((g,d,E)=>{B(E[d]).selectAll(`g.${c}`).data(a[d]??[]).join(o=>{const x=o.append("g").classed(c,!0).attr("cursor","pointer");return x.append("path").classed(s,!0).style("vector-effect","non-scaling-stroke").attr("d",y=>{const $=-G,M=p[d],w=p[d];return`M${$},${M} L${$+S/2},${w} ${$+S},${M}`}),x},o=>o,o=>o.remove()).attr("transform",o=>`translate(${T?0:L(o.seriesLabel)}, 0)`).select(`path.${s}`).attr("height",o=>Math.abs(o.axisYFromZero)).attr("y",o=>o.axisY<p[d]?o.axisY:p[d]).attr("x",o=>T?0:L(o.seriesLabel)).style("fill",o=>`url(#${n[o.seriesIndex]})`).attr("stroke",o=>o.color).attr("transform",o=>`translate(${o?o.axisX:0}, 0)`).transition().duration(O).ease(ee(W.transitionEase)).delay((o,x)=>o.groupIndex*A).attr("d",o=>{const x=-G,y=p[d],$=o.axisY;return`M${x},${y} L${x+S/2},${$} ${x+S},${y}`})}),i.selectAll(`path.${s}`)}function oe({defsSelection:i,computedData:c,linearGradientIds:s,params:a}){i.selectAll("linearGradient").data(c??[]).join(n=>n.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),n=>n,n=>n.remove()).attr("id",(n,p)=>n[0]?s[n[0].seriesIndex]:"").html((n,p)=>{const u=n[0]?n[0].color:"";return`
        <stop offset="0%"   stop-color="${u}" stop-opacity="${a.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${u}" stop-opacity="${a.linearGradientOpacity[1]}"/>
      `})}function pe({defsSelection:i,clipPathData:c}){i.selectAll("clipPath").data(c).join(s=>s.append("clipPath"),s=>s,s=>s.remove()).attr("id",s=>s.id).each((s,a,n)=>{B(n[a]).selectAll("rect").data([s]).join(p=>p.append("rect"),p=>p,p=>p.remove()).attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height)})}function ce({selection:i,ids:c,fullChartParams:s}){i.interrupt("highlight");const a=()=>{i.transition("highlight").duration(200).style("opacity",1)};if(!c.length){a();return}i.each((n,p,u)=>{c.includes(n.id)?B(u[p]).style("opacity",1):B(u[p]).style("opacity",s.styles.unhighlightedOpacity)})}const le=(i,{selection:c,computedData$:s,visibleComputedData$:a,existSeriesLabels$:n,SeriesDataMap$:p,GroupDataMap$:u,fullParams$:L,fullChartParams$:D,gridAxesTransform$:W,gridGraphicTransform$:S,gridAxesSize$:A,gridHighlight$:O,gridContainer$:T,isSeriesPositionSeprate$:G,event$:I})=>{const g=new k,d=F(i,"clipPath-box"),E=R(i,"pathG"),Y=R(i,"path"),{seriesSelection$:o,axesSelection$:x,defsSelection$:y,graphicGSelection$:$}=te({selection:c,pluginName:i,clipPathID:d,existSeriesLabels$:n,gridContainer$:T,gridAxesTransform$:W,gridGraphicTransform$:S});S.pipe(h(g),b(e=>-e.translate[1]/e.scale[1]));const M=a.pipe(b(e=>e.map(t=>t[0]?t[0].axisY-t[0].axisYFromZero:0)),P()),w=f({computedData:s,visibleComputedData:a,params:L,gridAxesSize:A,isSeriesPositionSeprate:G}).pipe(h(g),m(async e=>e),b(e=>e.params.barWidth?e.params.barWidth:e.isSeriesPositionSeprate?_({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):_({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}))),j=a.pipe(h(g),b(e=>{const t=new Set;return e.forEach(l=>{l.forEach(r=>{t.add(r.seriesLabel)})}),Array.from(t)})),z=a.pipe(h(g),b(e=>{const t=new Set;return e.forEach(l=>{l.forEach(r=>{t.add(r.groupLabel)})}),Array.from(t)})),X=new C(e=>{f({seriesLabels:j,barWidth:w,params:L}).pipe(h(g),m(async t=>t)).subscribe(t=>{const l=ie(t.barWidth,t.seriesLabels,t.params);e.next(l)})}),H=D.pipe(h(g),b(e=>e.transitionDuration),P()),q=new C(e=>{f({groupLabels:z,transitionDuration:H}).pipe(m(async t=>t)).subscribe(t=>{const l=ae(t.groupLabels.length,t.transitionDuration);e.next(l)})}).pipe(h(g),P()),J=new C(e=>{f({groupLabels:z,transitionDuration:H}).pipe(m(async t=>t)).subscribe(t=>{const l=se(t.groupLabels.length,t.transitionDuration);e.next(l)})}).pipe(h(g),P());f({defsSelection:y,gridAxesSize:A}).pipe(h(g),m(async e=>e)).subscribe(e=>{const t=[{id:d,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];pe({defsSelection:e.defsSelection,clipPathData:t})});const K=D.pipe(h(g),b(e=>e.highlightTarget),P()),U=new k,Q=j.pipe(h(g),b(e=>e.map((t,l)=>F(i,`lineargradient-${t}`))));return f({graphicGSelection:$,defsSelection:y,computedData:s,linearGradientIds:Q,zeroYArr:M,groupLabels:z,barScale:X,params:L,chartParams:D,highlightTarget:K,barWidth:w,delayGroup:q,transitionItem:J,SeriesDataMap:p,GroupDataMap:u,isSeriesPositionSeprate:G}).pipe(h(g),m(async e=>e)).subscribe(e=>{const t=ne({graphicGSelection:e.graphicGSelection,pathGClassName:E,pathClassName:Y,computedData:e.computedData,linearGradientIds:e.linearGradientIds,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesPositionSeprate:e.isSeriesPositionSeprate});oe({defsSelection:e.defsSelection,computedData:e.computedData,linearGradientIds:e.linearGradientIds,params:e.params}),t.on("mouseover",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"mouseover",pluginName:i,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}).on("mousemove",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"mousemove",pluginName:i,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}).on("mouseout",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"mouseout",pluginName:i,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}).on("click",(l,r)=>{l.stopPropagation(),I.next({type:"grid",eventName:"click",pluginName:i,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:l,data:e.computedData})}),U.next(t)}),f({barSelection:U,highlight:O.pipe(b(e=>e.map(t=>t.id))),fullChartParams:D}).pipe(h(g),m(async e=>e)).subscribe(e=>{ce({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{g.next(void 0)}},v="BarsTriangle",de=V(v,N)(({selection:i,name:c,subject:s,observer:a})=>{const n=new k,p=le(v,{selection:i,computedData$:a.computedData$,visibleComputedData$:a.visibleComputedData$,existSeriesLabels$:a.existSeriesLabels$,SeriesDataMap$:a.SeriesDataMap$,GroupDataMap$:a.GroupDataMap$,fullParams$:a.fullParams$,fullChartParams$:a.fullChartParams$,gridAxesTransform$:a.gridAxesTransform$,gridGraphicTransform$:a.gridGraphicTransform$,gridAxesSize$:a.gridAxesSize$,gridHighlight$:a.gridHighlight$,gridContainer$:a.gridContainer$,isSeriesPositionSeprate$:a.isSeriesPositionSeprate$,event$:s.event$});return()=>{n.next(void 0),p()}});export{de as B,le as c};
