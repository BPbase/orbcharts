import{S as V,o as Z,m,d as F,j as w,t as S,k as G,b9 as ie,s as A,bc as re,ar as se,bp as oe,be as ne,g as q,r as Q}from"./CUAujy1K.js";import{r as N,s as ae}from"./CvNJ1Mhf.js";function ge(i="curveLinear"){return oe().x(a=>a.axisX).y(a=>a.axisY).curve(ne[i])}function le(i){let a=[[]],o=0;for(let u in i){if(i[u].visible==!1||i[u].value===void 0||i[u].value===null){a[o].length&&(o++,a[o]=[]);continue}a[o].push(i[u])}return a}function ce({selection:i,pathClassName:a,segmentData:o,linePath:u,params:g}){return i.selectAll("path").data(o,(n,d)=>n.length?`${n[0].id}_${n[n.length-1].id}`:d).join(n=>n.append("path").classed(a,!0).attr("fill","none").attr("pointer-events","visibleStroke").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),n=>n,n=>n.remove()).attr("stroke-width",g.lineWidth).attr("stroke",(n,d)=>n[0]&&n[0].color).attr("d",n=>u(n))}function pe({selection:i,seriesLabel:a,fullChartParams:o}){if(i.interrupt("highlight"),!a){i.transition("highlight").duration(200).style("opacity",1);return}i.each((u,g,c)=>{u===a?A(c[g]).style("opacity",1):A(c[g]).style("opacity",o.styles.unhighlightedOpacity)})}function he({defsSelection:i,clipPathData:a,transitionDuration:o,transitionEase:u}){i.selectAll("clipPath").data(a).join(g=>g.append("clipPath"),g=>g,g=>g.remove()).attr("id",g=>g.id).each((g,c,n)=>{A(n[c]).selectAll("rect").data([g]).join(d=>{const x=d.append("rect");return x.transition().duration(o).ease(re(u)).tween("tween",(C,M,b)=>k=>{const h=C.width*k;x.attr("x",0).attr("y",0).attr("width",f=>h).attr("height",f=>f.height)}),x},d=>d.attr("x",0).attr("y",0).attr("width",x=>x.width).attr("height",x=>x.height),d=>d.remove())})}const Le=(i,{selection:a,computedData$:o,computedAxesData$:u,visibleComputedData$:g,visibleComputedAxesData$:c,seriesLabels$:n,SeriesDataMap$:d,GroupDataMap$:x,fullParams$:C,fullDataFormatter$:M,fullChartParams$:b,gridAxesTransform$:k,gridGraphicTransform$:h,gridAxesSize$:f,gridHighlight$:z,gridContainerPosition$:y,allContainerPosition$:T,layout$:I,event$:$})=>{const v=new V,H=Z(i,"clipPath-box"),J=q(i,"path"),{seriesSelection$:ee,axesSelection$:K,defsSelection$:B,graphicGSelection$:O}=N({selection:a,pluginName:i,clipPathID:H,seriesLabels$:n,gridContainerPosition$:y,gridAxesTransform$:k,gridGraphicTransform$:h}),U=new se(e=>{const L=C.pipe(S(v)).subscribe(p=>{if(!p)return;const l=ge(p.lineCurve);e.next(l)});return()=>{L.unsubscribe()}}),R=b.pipe(m(e=>e.transitionDuration),F()),W=b.pipe(m(e=>e.transitionEase),F());w({defsSelection:B,seriesLabels:n,axisSize:f,transitionDuration:R,transitionEase:W}).pipe(S(v),G(async e=>e)).subscribe(e=>{const p=[{id:H,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(l=>({id:`orbcharts__clipPath_${l}`,width:e.axisSize.width,height:e.axisSize.height})));he({defsSelection:e.defsSelection,clipPathData:p,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const t=o.pipe(m(e=>{const L=new Map;return e.flat().forEach(p=>L.set(p.id,p)),L})),D=ae({fullDataFormatter$:M,gridAxesSize$:f,computedData$:o,fullChartParams$:b,gridContainerPosition$:T,layout$:I}),r=b.pipe(S(v),m(e=>e.highlightTarget),F()),te=w({graphicGSelection:O,visibleComputedAxesData:c,linePath:U,params:C}).pipe(S(v),G(async e=>e),m(e=>{let L=[];return e.graphicGSelection.each((p,l,P)=>{const E=le(e.visibleComputedAxesData[l]??[]);L[l]=ce({selection:A(P[l]),pathClassName:J,linePath:e.linePath,segmentData:E,params:e.params})}),L}));return w({pathSelectionArr:te,computedData:o,SeriesDataMap:d,GroupDataMap:x,highlightTarget:r,gridGroupPositionFn:D}).pipe(S(v),G(async e=>e)).subscribe(e=>{e.pathSelectionArr.forEach(L=>{L.on("mouseover",(p,l)=>{const P=l[0]?l[0].seriesLabel:"",{groupIndex:E,groupLabel:_}=e.gridGroupPositionFn(p),s=e.GroupDataMap.get(_).find(j=>j.seriesLabel===P)??l[0];$.next({type:"grid",eventName:"mouseover",pluginName:i,highlightTarget:e.highlightTarget,datum:s,gridIndex:s.gridIndex,series:e.SeriesDataMap.get(s.seriesLabel),seriesIndex:s.seriesIndex,seriesLabel:s.seriesLabel,group:e.GroupDataMap.get(s.groupLabel),groupIndex:s.groupIndex,groupLabel:s.groupLabel,event:p,data:e.computedData})}).on("mousemove",(p,l)=>{const P=l[0]?l[0].seriesLabel:"",{groupIndex:E,groupLabel:_}=e.gridGroupPositionFn(p),s=e.GroupDataMap.get(_).find(j=>j.seriesLabel===P)??l[0];$.next({type:"grid",eventName:"mousemove",pluginName:i,highlightTarget:e.highlightTarget,datum:s,gridIndex:s.gridIndex,series:e.SeriesDataMap.get(s.seriesLabel),seriesIndex:s.seriesIndex,seriesLabel:s.seriesLabel,group:e.GroupDataMap.get(s.groupLabel),groupIndex:s.groupIndex,groupLabel:s.groupLabel,event:p,data:e.computedData})}).on("mouseout",(p,l)=>{const P=l[0]?l[0].seriesLabel:"",{groupIndex:E,groupLabel:_}=e.gridGroupPositionFn(p),s=e.GroupDataMap.get(_).find(j=>j.seriesLabel===P)??l[0];$.next({type:"grid",eventName:"mouseout",pluginName:i,highlightTarget:e.highlightTarget,datum:s,gridIndex:s.gridIndex,series:e.SeriesDataMap.get(s.seriesLabel),seriesIndex:s.seriesIndex,seriesLabel:s.seriesLabel,group:e.GroupDataMap.get(s.groupLabel),groupIndex:s.groupIndex,groupLabel:s.groupLabel,event:p,data:e.computedData})}).on("click",(p,l)=>{const P=l[0]?l[0].seriesLabel:"",{groupIndex:E,groupLabel:_}=e.gridGroupPositionFn(p),s=e.GroupDataMap.get(_).find(j=>j.seriesLabel===P)??l[0];$.next({type:"grid",eventName:"click",pluginName:i,highlightTarget:e.highlightTarget,datum:s,gridIndex:s.gridIndex,series:e.SeriesDataMap.get(s.seriesLabel),seriesIndex:s.seriesIndex,seriesLabel:s.seriesLabel,group:e.GroupDataMap.get(s.groupLabel),groupIndex:s.groupIndex,groupLabel:s.groupLabel,event:p,data:e.computedData})})})}),b.pipe(S(v),ie(e=>e.highlightTarget==="series"),G(e=>w({graphicGSelection:O,gridHighlight:z,DataMap:t,fullChartParams:b}).pipe(S(v),G(async L=>L)))).subscribe(e=>{const L=e.gridHighlight[0]?e.gridHighlight[0].seriesLabel:null;pe({selection:e.graphicGSelection,seriesLabel:L,fullChartParams:e.fullChartParams})}),()=>{v.next(void 0)}};function ue({graphicGSelection:i,circleGClassName:a,circleClassName:o,visibleComputedAxesData:u,fullParams:g,fullChartParams:c,graphicReverseScale:n}){const d=M=>{const b=M.size();return c.transitionDuration/b};let x=0;return i.each((M,b,k)=>{A(k[b]).selectAll("g").data(u[b],h=>h.id).join(h=>(x=d(h),h.append("g").classed(a,!0)),h=>h,h=>h.remove()).attr("transform",h=>`translate(${h.axisX}, ${h.axisY})`).each((h,f,z)=>{A(z[f]).selectAll("circle").data([h]).join(y=>y.append("circle").style("cursor","pointer").style("vector-effect","non-scaling-stroke").classed(o,!0).attr("opacity",0).transition().delay((T,I)=>f*x).attr("opacity",1),y=>y.transition().duration(50).attr("opacity",1),y=>y.remove()).attr("r",g.radius).attr("fill",(y,T)=>Q({datum:y,colorType:g.fillColorType,fullChartParams:c})).attr("stroke",(y,T)=>Q({datum:y,colorType:g.strokeColorType,fullChartParams:c})).attr("stroke-width",g.strokeWidth).attr("transform",`scale(${n[b][0]??1}, ${n[b][1]??1})`)})}),i.selectAll(`circle.${o}`)}function de({selection:i,ids:a,onlyShowHighlighted:o,fullChartParams:u}){if(i.interrupt("highlight"),!a.length){i.transition("highlight").duration(200).style("opacity",o===!0?0:1);return}i.each((g,c,n)=>{a.includes(g.id)?A(n[c]).style("opacity",1).transition("highlight").duration(200):A(n[c]).style("opacity",o===!0?0:u.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function be({defsSelection:i,clipPathData:a}){i.selectAll("clipPath").data(a).join(o=>o.append("clipPath"),o=>o,o=>o.remove()).attr("id",o=>o.id).each((o,u,g)=>{A(g[u]).selectAll("rect").data([o]).join("rect").attr("x",0).attr("y",0).attr("width",c=>c.width).attr("height",c=>c.height)})}const Se=(i,{selection:a,computedData$:o,computedAxesData$:u,visibleComputedData$:g,visibleComputedAxesData$:c,seriesLabels$:n,SeriesDataMap$:d,GroupDataMap$:x,fullParams$:C,fullChartParams$:M,gridAxesTransform$:b,gridGraphicTransform$:k,gridGraphicReverseScale$:h,gridAxesSize$:f,gridHighlight$:z,gridContainerPosition$:y,event$:T})=>{const I=new V,$=Z(i,"clipPath-box"),v=q(i,"circleG"),H=q(i,"circle"),{seriesSelection$:J,axesSelection$:ee,defsSelection$:K,graphicGSelection$:B}=N({selection:a,pluginName:i,clipPathID:$,seriesLabels$:n,gridContainerPosition$:y,gridAxesTransform$:b,gridGraphicTransform$:k}),O=w({computedData:o,gridGraphicReverseScale:h}).pipe(S(I),G(async t=>t),m(t=>t.computedData.map((D,r)=>t.gridGraphicReverseScale[r])));w({defsSelection:K,gridAxesSize:f}).pipe(S(I),G(async t=>t)).subscribe(t=>{const D=[{id:$,width:t.gridAxesSize.width,height:t.gridAxesSize.height}];be({defsSelection:t.defsSelection,clipPathData:D})});const U=M.pipe(S(I),m(t=>t.highlightTarget),F()),R=w({graphicGSelection:B,visibleComputedAxesData:c,graphicReverseScale:O,fullChartParams:M,fullParams:C}).pipe(S(I),G(async t=>t),m(t=>ue({graphicGSelection:t.graphicGSelection,circleGClassName:v,circleClassName:H,visibleComputedAxesData:t.visibleComputedAxesData,fullParams:t.fullParams,fullChartParams:t.fullChartParams,graphicReverseScale:t.graphicReverseScale})));w({graphicSelection:R,computedData:o,SeriesDataMap:d,GroupDataMap:x,highlightTarget:U}).pipe(S(I),G(async t=>t)).subscribe(t=>{t.graphicSelection.on("mouseover",(D,r)=>{T.next({type:"grid",eventName:"mouseover",pluginName:i,highlightTarget:t.highlightTarget,datum:r,gridIndex:r.gridIndex,series:t.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:t.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:D,data:t.computedData})}).on("mousemove",(D,r)=>{T.next({type:"grid",eventName:"mousemove",pluginName:i,highlightTarget:t.highlightTarget,data:t.computedData,datum:r,gridIndex:r.gridIndex,series:t.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:t.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:D})}).on("mouseout",(D,r)=>{T.next({type:"grid",eventName:"mouseout",pluginName:i,highlightTarget:t.highlightTarget,datum:r,gridIndex:r.gridIndex,series:t.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:t.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:D,data:t.computedData})}).on("click",(D,r)=>{T.next({type:"grid",eventName:"click",pluginName:i,highlightTarget:t.highlightTarget,datum:r,gridIndex:r.gridIndex,series:t.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:t.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:D,data:t.computedData})})});const W=C.pipe(S(I),m(t=>t.onlyShowHighlighted),F());return w({graphicSelection:R,highlight:z.pipe(m(t=>t.map(D=>D.id))),onlyShowHighlighted:W,fullChartParams:M}).pipe(S(I),G(async t=>t)).subscribe(t=>{de({selection:t.graphicSelection,ids:t.highlight,onlyShowHighlighted:t.onlyShowHighlighted,fullChartParams:t.fullChartParams})}),()=>{I.next(void 0)}};export{Se as a,Le as c};
