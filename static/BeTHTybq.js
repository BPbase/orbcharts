import{S as C,m as S,d as y,c as m,t as h,s as $,O as z,b as w,u as N}from"./qbpNAjKn.js";import{i as ee}from"./C7jPiQzS.js";import{e as _,g as re,a as F,j as te}from"./B2YBZYj8.js";import{a as ie}from"./1ujJLabB.js";const Z=.3;function R({axisWidth:a,groupAmount:p,barAmountOfGroup:s,barPadding:r=0,barGroupPadding:g=0}){const u=(a/(p-1)-g)/s-r;return u>1?u:1}function ae(a,p,s){const r=a/2,g=a*p.length+s.barPadding*p.length;return te().domain(p).range([-g/2+r,g/2-r])}function se(a,p){return a<=1?0:p/(a-1)*Z}function ne(a,p){return a<=1?p:p*(1-Z)}function oe({graphicGSelection:a,pathGClassName:p,pathClassName:s,barData:r,zeroYArr:g,groupLabels:l,barScale:u,params:D,chartParams:x,barWidth:f,delayGroup:B,transitionItem:G,isSeriesPositionSeprate:P}){const I=f/2;return a.each((L,c,A)=>{w(A[c]).selectAll(`g.${p}`).data(r[c]??[]).join(n=>{const b=n.append("g").classed(p,!0).attr("cursor","pointer");return b.append("path").classed(s,!0).style("vector-effect","non-scaling-stroke").attr("d",T=>{const d=-I,M=g[c],O=g[c];return`M${d},${M} L${d+f/2},${O} ${d+f},${M}`}),b},n=>n,n=>n.remove()).attr("transform",n=>`translate(${P?0:u(n.seriesLabel)}, 0)`).select(`path.${s}`).attr("height",n=>Math.abs(n.axisYFromZero)).attr("y",n=>n.axisY<g[c]?n.axisY:g[c]).attr("x",n=>P?0:u(n.seriesLabel)).style("fill",n=>`url(#${n.linearGradientId})`).attr("stroke",n=>n.color).attr("transform",n=>`translate(${n?n.axisX:0}, 0)`).transition().duration(G).ease(re(x.transitionEase)).delay((n,b)=>n.groupIndex*B).attr("d",n=>{const b=-I,T=g[c],d=n.axisY;return`M${b},${T} L${b+f/2},${d} ${b+f},${T}`})}),a.selectAll(`path.${s}`)}function pe({defsSelection:a,barData:p,params:s}){a.selectAll("linearGradient").data(p??[]).join(r=>r.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),r=>r,r=>r.remove()).attr("id",(r,g)=>r[0]?r[0].linearGradientId:"").html((r,g)=>{const l=r[0]?r[0].color:"";return`
        <stop offset="0%"   stop-color="${l}" stop-opacity="${s.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${l}" stop-opacity="${s.linearGradientOpacity[1]}"/>
      `})}function ce({defsSelection:a,clipPathData:p}){a.selectAll("clipPath").data(p).join(s=>s.append("clipPath"),s=>s,s=>s.remove()).attr("id",s=>s.id).each((s,r,g)=>{w(g[r]).selectAll("rect").data([s]).join(l=>l.append("rect"),l=>l,l=>l.remove()).attr("x",0).attr("y",0).attr("width",l=>l.width).attr("height",l=>l.height)})}function le({selection:a,ids:p,fullChartParams:s}){a.interrupt("highlight");const r=()=>{a.transition("highlight").duration(200).style("opacity",1)};if(!p.length){r();return}a.each((g,l,u)=>{p.includes(g.id)?w(u[l]).style("opacity",1):w(u[l]).style("opacity",s.styles.unhighlightedOpacity)})}const ge=(a,{selection:p,computedData$:s,visibleComputedData$:r,existedSeriesLabels$:g,SeriesDataMap$:l,GroupDataMap$:u,fullParams$:D,fullChartParams$:x,gridAxesTransform$:f,gridGraphicTransform$:B,gridAxesSize$:G,gridHighlight$:P,gridContainer$:I,isSeriesPositionSeprate$:W,event$:L})=>{const c=new C,A=_(a,"clipPath-box"),j=F(a,"pathG"),n=F(a,"path"),{seriesSelection$:b,axesSelection$:T,defsSelection$:d,graphicGSelection$:M}=ie({selection:p,pluginName:a,clipPathID:A,existedSeriesLabels$:g,gridContainer$:I,gridAxesTransform$:f,gridGraphicTransform$:B}),O=r.pipe(S(e=>e.map(i=>i[0]?i[0].axisY-i[0].axisYFromZero:0)),y()),k=m({computedData:s,visibleComputedData:r,params:D,gridAxesSize:G,isSeriesPositionSeprate:W}).pipe(h(c),$(async e=>e),S(e=>e.params.barWidth?e.params.barWidth:e.isSeriesPositionSeprate?R({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):R({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}))),Y=r.pipe(h(c),S(e=>{const i=new Set;return e.forEach(o=>{o.forEach(t=>{i.add(t.seriesLabel)})}),Array.from(i)})),E=r.pipe(h(c),S(e=>{const i=new Set;return e.forEach(o=>{o.forEach(t=>{i.add(t.groupLabel)})}),Array.from(i)})),X=new z(e=>{m({seriesLabels:Y,barWidth:k,params:D}).pipe(h(c),$(async i=>i)).subscribe(i=>{const o=ae(i.barWidth,i.seriesLabels,i.params);e.next(o)})}),H=x.pipe(h(c),S(e=>e.transitionDuration),y()),q=new z(e=>{m({groupLabels:E,transitionDuration:H}).pipe($(async i=>i)).subscribe(i=>{const o=se(i.groupLabels.length,i.transitionDuration);e.next(o)})}).pipe(h(c),y()),J=new z(e=>{m({groupLabels:E,transitionDuration:H}).pipe($(async i=>i)).subscribe(i=>{const o=ne(i.groupLabels.length,i.transitionDuration);e.next(o)})}).pipe(h(c),y());m({defsSelection:d,gridAxesSize:G}).pipe(h(c),$(async e=>e)).subscribe(e=>{const i=[{id:A,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];ce({defsSelection:e.defsSelection,clipPathData:i})});const K=x.pipe(h(c),S(e=>e.highlightTarget),y()),U=new C,Q=Y.pipe(h(c),S(e=>e.map((i,o)=>_(a,`lineargradient-${i}`)))),V=m({linearGradientIds:Q,computedData:s}).pipe(h(c),$(async e=>e),S(e=>e.computedData.map((i,o)=>i.map((t,he)=>({linearGradientId:e.linearGradientIds[o],...t})))));return m({graphicGSelection:M,defsSelection:d,computedData:s,barData:V,zeroYArr:O,groupLabels:E,barScale:X,params:D,chartParams:x,highlightTarget:K,barWidth:k,delayGroup:q,transitionItem:J,SeriesDataMap:l,GroupDataMap:u,isSeriesPositionSeprate:W}).pipe(h(c),$(async e=>e)).subscribe(e=>{const i=oe({graphicGSelection:e.graphicGSelection,pathGClassName:j,pathClassName:n,barData:e.barData,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesPositionSeprate:e.isSeriesPositionSeprate});pe({defsSelection:e.defsSelection,barData:e.barData,params:e.params}),i.on("mouseover",(o,t)=>{o.stopPropagation(),L.next({type:"grid",eventName:"mouseover",pluginName:a,highlightTarget:e.highlightTarget,datum:t,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})}).on("mousemove",(o,t)=>{o.stopPropagation(),L.next({type:"grid",eventName:"mousemove",pluginName:a,highlightTarget:e.highlightTarget,datum:t,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})}).on("mouseout",(o,t)=>{o.stopPropagation(),L.next({type:"grid",eventName:"mouseout",pluginName:a,highlightTarget:e.highlightTarget,datum:t,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})}).on("click",(o,t)=>{o.stopPropagation(),L.next({type:"grid",eventName:"click",pluginName:a,highlightTarget:e.highlightTarget,datum:t,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:o,data:e.computedData})}),U.next(i)}),m({barSelection:U,highlight:P,fullChartParams:x}).pipe(h(c),$(async e=>e)).subscribe(e=>{le({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}},v="BarsTriangle",me=N(v,ee)(({selection:a,name:p,subject:s,observer:r})=>{const g=new C,l=ge(v,{selection:a,computedData$:r.computedData$,visibleComputedData$:r.visibleComputedData$,existedSeriesLabels$:r.existedSeriesLabels$,SeriesDataMap$:r.SeriesDataMap$,GroupDataMap$:r.GroupDataMap$,fullParams$:r.fullParams$,fullChartParams$:r.fullChartParams$,gridAxesTransform$:r.gridAxesTransform$,gridGraphicTransform$:r.gridGraphicTransform$,gridAxesSize$:r.gridAxesSize$,gridHighlight$:r.gridHighlight$,gridContainer$:r.gridContainer$,isSeriesPositionSeprate$:r.isSeriesPositionSeprate$,event$:s.event$});return()=>{g.next(void 0),l()}});export{me as B};
