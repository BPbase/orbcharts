import{S as O,o as _,k as D,t as d,l as y,m as L,d as M,s as I,r as k,g as $}from"./ZOIXw5Nq.js";import{o as B}from"./wO7_YHzT.js";function E({graphicGSelection:r,circleGClassName:g,circleClassName:t,visibleComputedAxesData:b,fullParams:n,fullChartParams:o,graphicReverseScale:p}){const S=x=>{const h=x.size();return o.transitionDuration/h};let v=0;return r.each((x,h,f)=>{I(f[h]).selectAll("g").data(b[h],s=>s.id).join(s=>(v=S(s),s.append("g").classed(g,!0)),s=>s,s=>s.remove()).attr("transform",s=>`translate(${s.axisX}, ${s.axisY})`).each((s,C,A)=>{I(A[C]).selectAll("circle").data([s]).join(l=>l.append("circle").style("cursor","pointer").style("vector-effect","non-scaling-stroke").classed(t,!0).attr("opacity",0).transition().delay((u,c)=>C*v).attr("opacity",1),l=>l.transition().duration(50).attr("opacity",1),l=>l.remove()).attr("r",n.radius).attr("fill",(l,u)=>k({datum:l,colorType:n.fillColorType,fullChartParams:o})).attr("stroke",(l,u)=>k({datum:l,colorType:n.strokeColorType,fullChartParams:o})).attr("stroke-width",n.strokeWidth).attr("transform",`scale(${p[h][0]??1}, ${p[h][1]??1})`)})}),r.selectAll(`circle.${t}`)}function W({selection:r,ids:g,onlyShowHighlighted:t,fullChartParams:b}){if(r.interrupt("highlight"),!g.length){r.transition("highlight").duration(200).style("opacity",t===!0?0:1);return}r.each((n,o,p)=>{g.includes(n.id)?I(p[o]).style("opacity",1).transition("highlight").duration(200):I(p[o]).style("opacity",t===!0?0:b.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function X({defsSelection:r,clipPathData:g}){r.selectAll("clipPath").data(g).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,b,n)=>{I(n[b]).selectAll("rect").data([t]).join("rect").attr("x",0).attr("y",0).attr("width",o=>o.width).attr("height",o=>o.height)})}const K=(r,{selection:g,computedData$:t,computedAxesData$:b,visibleComputedData$:n,visibleComputedAxesData$:o,seriesLabels$:p,SeriesDataMap$:S,GroupDataMap$:v,fullParams$:T,fullChartParams$:x,gridAxesTransform$:h,gridGraphicTransform$:f,gridGraphicReverseScale$:s,gridAxesSize$:C,gridHighlight$:A,gridContainerPosition$:l,event$:u})=>{const c=new O,G=_(r,"clipPath-box"),m=$(r,"circleG"),P=$(r,"circle"),{seriesSelection$:Y,axesSelection$:q,defsSelection$:j,graphicGSelection$:z}=B({selection:g,pluginName:r,clipPathID:G,seriesLabels$:p,gridContainerPosition$:l,gridAxesTransform$:h,gridGraphicTransform$:f}),R=D({computedData:t,gridGraphicReverseScale:s}).pipe(d(c),y(async e=>e),L(e=>e.computedData.map((a,i)=>e.gridGraphicReverseScale[i])));D({defsSelection:j,gridAxesSize:C}).pipe(d(c),y(async e=>e)).subscribe(e=>{const a=[{id:G,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];X({defsSelection:e.defsSelection,clipPathData:a})});const H=x.pipe(d(c),L(e=>e.highlightTarget),M()),w=D({graphicGSelection:z,visibleComputedAxesData:o,graphicReverseScale:R,fullChartParams:x,fullParams:T}).pipe(d(c),y(async e=>e),L(e=>E({graphicGSelection:e.graphicGSelection,circleGClassName:m,circleClassName:P,visibleComputedAxesData:e.visibleComputedAxesData,fullParams:e.fullParams,fullChartParams:e.fullChartParams,graphicReverseScale:e.graphicReverseScale})));D({graphicSelection:w,computedData:t,SeriesDataMap:S,GroupDataMap:v,highlightTarget:H}).pipe(d(c),y(async e=>e)).subscribe(e=>{e.graphicSelection.on("mouseover",(a,i)=>{u.next({type:"grid",eventName:"mouseover",pluginName:r,highlightTarget:e.highlightTarget,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,group:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:a,data:e.computedData})}).on("mousemove",(a,i)=>{u.next({type:"grid",eventName:"mousemove",pluginName:r,highlightTarget:e.highlightTarget,data:e.computedData,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,group:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:a})}).on("mouseout",(a,i)=>{u.next({type:"grid",eventName:"mouseout",pluginName:r,highlightTarget:e.highlightTarget,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,group:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:a,data:e.computedData})}).on("click",(a,i)=>{u.next({type:"grid",eventName:"click",pluginName:r,highlightTarget:e.highlightTarget,datum:i,gridIndex:i.gridIndex,series:e.SeriesDataMap.get(i.seriesLabel),seriesIndex:i.seriesIndex,seriesLabel:i.seriesLabel,group:e.GroupDataMap.get(i.groupLabel),groupIndex:i.groupIndex,groupLabel:i.groupLabel,event:a,data:e.computedData})})});const U=T.pipe(d(c),L(e=>e.onlyShowHighlighted),M());return D({graphicSelection:w,highlight:A.pipe(L(e=>e.map(a=>a.id))),onlyShowHighlighted:U,fullChartParams:x}).pipe(d(c),y(async e=>e)).subscribe(e=>{W({selection:e.graphicSelection,ids:e.highlight,onlyShowHighlighted:e.onlyShowHighlighted,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}};export{K as c};
