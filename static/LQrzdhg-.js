import{bb as N,S as w,d as p,bc as B,o as x,p as P,m as g,a2 as j,bd as X}from"./BmSCDJil.js";import{g as C,u as Y,v as O,j as v}from"./DQaJP6Gt.js";import{f as F}from"./8Pd8KtZp.js";import{a as R}from"./BRZTqlJD.js";const S="Tooltip",A=C(S,"g"),I=C(S,"box");function L(r,a){const c=a.textSizePx*1.5,s=(r==null?[]:Array.isArray(r)?r:typeof r=="string"?r.split(`
`):[r]).filter(n=>n!="").map((n,o)=>`<tspan x="0" y="${o*c}">${n}</tspan>`).join("");return s?`<text font-size="${a.textSize}" fill="${a.textColor}" x="0" y="0" style="dominant-baseline:text-before-edge">
    ${s}
  </text>`:""}function M({rootSelection:r,pluginName:a,rootWidth:c,rootHeight:i,svgString:s,tooltipStyle:n,event:o}){r.interrupt("fadeout");const m=5,u=s?[s]:[],d=s?[n]:[],l=r.selectAll(`g.${A}`).data(u).join(e=>e.append("g").classed(A,!0).attr("pointer-events","none"),e=>e,e=>e.style("opacity",0).remove()).attr("transform",()=>`translate(${o.offsetX}, ${o.offsetY})`).selectAll(`g.${I}`).data(d).join(e=>e.append("g").classed(C(a,"box"),!0)),b=l.selectAll("rect").data(d).join(e=>e.append("rect").attr("rx",m).attr("ry",m)).attr("fill",e=>e.backgroundColor).attr("stroke",e=>e.strokeColor).attr("opacity",e=>e.backgroundOpacity),f=l.selectAll("g").data(u).join(e=>e.append("g").classed(C(a,"content"),!0).attr("transform",()=>`translate(${n.padding}, ${n.padding})`));u.length&&Y(f,u[0]);const y=f!=null&&f.node()?O(f):{width:0,height:0};b.attr("width",y.width+n.padding*2).attr("height",y.height+n.padding*2);const t=l!=null&&l.node()?O(l):{width:0,height:0},h=c-t.width,$=i-t.height,k=o.offsetX+n.offset[0]>h?h-o.offsetX:n.offset[0],z=o.offsetY+n.offset[1]>$?$-o.offsetY:n.offset[1];l.attr("transform",e=>`translate(${k}, ${z})`),l.attr("transform",e=>`translate(${k}, ${z})`)}const D={name:S,defaultParams:j,layerIndex:X,validator:(r,{validateColumns:a})=>a(r,{backgroundColorType:{toBeOption:"ColorType"},backgroundOpacity:{toBeTypes:["number"]},strokeColorType:{toBeOption:"ColorType"},offset:{toBe:"[number, number]",test:i=>Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"},padding:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"},textRenderFn:{toBeTypes:["Function"]},svgRenderFn:{toBeTypes:["Function"]}})},U=N(D)(({selection:r,rootSelection:a,name:c,chartType:i,observer:s,subject:n})=>{const o=new w,m=n.event$.pipe(p(o),F(t=>t.eventName==="mouseover"||t.eventName==="mousemove")),u=n.event$.pipe(p(o),F(t=>t.eventName==="mouseout")),d=B(s.fullChartParams$),T=x({fullChartParams:s.fullChartParams$,fullParams:s.fullParams$,textSizePx:d}).pipe(p(o),P(async t=>t),g(t=>({backgroundColor:v(t.fullParams.backgroundColorType,t.fullChartParams),backgroundOpacity:t.fullParams.backgroundOpacity,strokeColor:v(t.fullParams.strokeColorType,t.fullChartParams),offset:t.fullParams.offset,padding:t.fullParams.padding,textSize:t.fullChartParams.styles.textSize,textSizePx:t.textSizePx,textColor:v(t.fullParams.textColorType,t.fullChartParams)}))),l=x({fullParams:s.fullParams$,tooltipStyle:T}).pipe(p(o),P(async t=>t),g(t=>t.fullParams.svgRenderFn?t.fullParams.svgRenderFn:h=>{const $=t.fullParams.textRenderFn(h);return L($,t.tooltipStyle)})),b=x({event:m,contentRenderFn:l}).pipe(p(o),P(async t=>t),g(t=>t.contentRenderFn(t.event))),f=u.pipe(p(o),g(t=>"")),y=R(m,u).pipe(p(o),g(t=>t.event));return x({svgString:R(b,f),event:y,layout:s.layout$,tooltipStyle:T}).pipe(p(o),P(async t=>t)).subscribe(t=>{M({rootSelection:a,pluginName:c,rootWidth:t.layout.rootWidth,rootHeight:t.layout.rootHeight,svgString:t.svgString,tooltipStyle:t.tooltipStyle,event:t.event})}),function(){o.next(void 0)}});export{U as T};
