import{o as m,p as d,h as D,m as P,i as T,Z as I,O as E,S as R,t as p,s as w,_ as C,ak as O}from"./PGufJ0Z3.js";import{p as j,g as k,a as V,m as L}from"./C1EDXMJI.js";function F({data:c,startAngle:s,endAngle:h}){return j().startAngle(s).endAngle(h).value(a=>a.value).sort((a,r)=>a.seq-r.seq)(c).map((a,r)=>{let n=a;return n.id=a.data.id,n})}function U({selection:c,pluginName:s,separateSeries$:h,seriesLabels$:o}){const l=k(s,"series");return m({seriesLabels:o,separateSeries:h}).pipe(d(async a=>a),P((a,r)=>{const n=a.separateSeries?a.seriesLabels:[a.seriesLabels.join("")];return c.selectAll(`g.${l}`).data(n,u=>u).join(u=>u.append("g").classed(l,!0),u=>u,u=>u.remove())}),T(1))}const _=({selection:c,pluginName:s,separateSeries$:h,seriesLabels$:o,seriesContainerPosition$:l})=>{const a=U({selection:c,pluginName:s,separateSeries$:h,seriesLabels$:o});return m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async r=>r),D((r,n)=>r.seriesContainerPosition.length===n.seriesContainerPosition.length)).subscribe(r=>{r.seriesCenterSelection.attr("transform",(n,u)=>{const g=r.seriesContainerPosition[u]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async r=>r)).subscribe(r=>{r.seriesCenterSelection.transition().attr("transform",(n,u)=>{const g=r.seriesContainerPosition[u]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:a}},A="Pie";function q({enter:c,exit:s,data:h,lastTweenData:o,fullParams:l}){return!c.size()&&!s.size()?a=>{const r=h.map((n,u)=>{const g=o[u]??{startAngle:0,endAngle:0,value:0};return{...n,startAngle:n.startAngle*a+g.startAngle*(1-a),endAngle:n.endAngle*a+g.endAngle*(1-a),value:n.value*a+g.value*(1-a)}});return y(r,l.startAngle,l.endAngle,1)}:a=>y(h,l.startAngle,l.endAngle,a)}function y(c,s,h,o){return c.map((l,a)=>{const r=s+(l.startAngle-s)*o,n=r+(l.endAngle-l.startAngle)*o;return{...l,startAngle:r,endAngle:n}})}function v({selection:c,data:s,arc:h,pathClassName:o,fullParams:l,fullChartParams:a}){return c.selectAll("path").data(s,n=>n.id).join("path").classed(o,!0).style("cursor","pointer").attr("fill",(n,u)=>n.data.color).attr("stroke",(n,u)=>V({datum:n.data,colorType:l.strokeColorType,fullChartParams:a})).attr("stroke-width",l.strokeWidth).attr("d",(n,u)=>h(n))}function z({pathSelection:c,ids:s,fullChartParams:h,arc:o,arcHighlight:l}){if(c.interrupt("highlight"),!s.length){c.transition("highlight").style("opacity",1).attr("d",a=>o(a));return}c.each((a,r,n)=>{const u=w(n[r]);s.includes(a.data.id)?u.style("opacity",1).transition("highlight").ease(O).duration(500).attr("d",g=>l(g)):u.style("opacity",h.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>o(g))})}function X(c,s){const h=new R,o=k(c,"path");let l=[],a=[];const r=s.seriesContainerPosition$.pipe(p(h),P(t=>t.width<t.height?t.width:t.height),D()),n=new C(t=>{m({containerVisibleComputedLayoutData:s.containerVisibleComputedLayoutData$,fullParams:s.fullParams$}).pipe(p(h),d(async e=>e)).subscribe(e=>{const i=F({data:e.containerVisibleComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});t.next(i)})}),u=new C(t=>{m({shorterSideWith:r,fullParams:s.fullParams$}).pipe(p(h),d(async e=>e)).subscribe(e=>{const i=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});t.next(i)})}),g=new C(t=>{m({shorterSideWith:r,fullParams:s.fullParams$}).pipe(p(h),d(async e=>e)).subscribe(e=>{const i=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadiusWhileHighlight,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});t.next(i)})}),f=s.fullChartParams$.pipe(p(h),P(t=>t.highlightTarget),D()),$=new C(t=>{m({pieData:n,arc:u,computedData:s.computedData$,fullParams:s.fullParams$,fullChartParams:s.fullChartParams$,highlightTarget:f}).pipe(p(h),d(async e=>e)).subscribe(e=>{s.containerSelection.interrupt("graphicMove");const i=s.containerSelection.selectAll("path").data(e.pieData,S=>S.id),M=i.enter(),H=i.exit(),N=q({enter:M,exit:H,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});s.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",(S,W)=>b=>{a=N(b),v({selection:s.containerSelection,data:a,arc:e.arc,pathClassName:o,fullParams:e.fullParams,fullChartParams:e.fullChartParams})}).on("end",(S,W)=>{a=y(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const b=v({selection:s.containerSelection,data:a,arc:e.arc,pathClassName:o,fullParams:e.fullParams,fullChartParams:e.fullChartParams});t.next(b),l=Object.assign([],e.pieData),s.event$.next({type:"series",pluginName:c,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})})})}).pipe(T(1));return m({pathSelection:$,SeriesDataMap:s.SeriesDataMap$,computedData:s.computedData$,highlightTarget:f}).pipe(p(h),d(async t=>t)).subscribe(t=>{t.pathSelection.on("mouseover",(e,i)=>{e.stopPropagation(),s.event$.next({type:"series",eventName:"mouseover",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})}).on("mousemove",(e,i)=>{e.stopPropagation(),s.event$.next({type:"series",eventName:"mousemove",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})}).on("mouseout",(e,i)=>{e.stopPropagation(),s.event$.next({type:"series",eventName:"mouseout",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})}).on("click",(e,i)=>{e.stopPropagation(),s.event$.next({type:"series",eventName:"click",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})})}),m({pathSelection:$,highlight:s.seriesHighlight$.pipe(P(t=>t.map(e=>e.id))),fullChartParams:s.fullChartParams$,arc:u,arcHighlight:g}).pipe(p(h),d(async t=>t)).subscribe(t=>{z({pathSelection:t.pathSelection,ids:t.highlight,fullChartParams:t.fullChartParams,arc:t.arc,arcHighlight:t.arcHighlight})}),()=>{h.next(void 0)}}const x=I(A,E)(({selection:c,name:s,subject:h,observer:o})=>{const l=new R,{seriesCenterSelection$:a}=_({selection:c,pluginName:A,separateSeries$:o.separateSeries$,seriesLabels$:o.seriesLabels$,seriesContainerPosition$:o.seriesContainerPosition$}),r=[];return a.pipe(p(l)).subscribe(n=>{r.forEach(u=>u()),n.each((u,g,f)=>{const $=w(f[g]),t=o.visibleComputedLayoutData$.pipe(p(l),P(i=>i[g]??i[0])),e=o.seriesContainerPosition$.pipe(p(l),P(i=>i[g]??i[0]));r[g]=X(A,{containerSelection:$,computedData$:o.computedData$,containerVisibleComputedLayoutData$:t,SeriesDataMap$:o.SeriesDataMap$,fullParams$:o.fullParams$,fullChartParams$:o.fullChartParams$,seriesHighlight$:o.seriesHighlight$,seriesContainerPosition$:e,event$:h.event$})})}),()=>{l.next(void 0),r.forEach(n=>n())}});export{x as P,F as m,_ as s};
