import{S as U,t as g,d,e as L,f as $,s as S,O as W,g as T,x as ee,a8 as te}from"./DTMfjTug.js";import{f as Y,j as re,e as ie,g as v,s as ae}from"./D2FdcmjD.js";import{k as se}from"./b2J-cE12.js";const _=.3;function H({axisWidth:i,groupAmount:l,barAmountOfGroup:o,barPadding:a=0,barGroupPadding:s=0}){const u=(i/(l-1)-s)/o-a;return u>1?u:1}function ne(i,l,o){const a=i/2,s=i*l.length+o.barPadding*l.length;return re().domain(l).range([-s/2+a,s/2-a])}function oe(i,l){return i<=1?0:l/(i-1)*_}function pe(i,l){return i<=1?l:l*(1-_)}function le({graphicGSelection:i,pathGClassName:l,pathClassName:o,visibleComputedLayoutData:a,linearGradientIds:s,zeroYArr:p,groupLabels:u,barScale:x,params:O,chartParams:M,barWidth:b,delayGroup:D,transitionItem:w,isSeriesSeprate:G}){const I=b/2;return i.each((z,h,f)=>{T(f[h]).selectAll(`g.${l}`).data(a[h]??[]).join(n=>{const m=n.append("g").classed(l,!0).attr("cursor","pointer");return m.append("path").classed(o,!0).style("vector-effect","non-scaling-stroke").attr("d",P=>{const y=-I,B=p[h],A=p[h];return`M${y},${B} L${y+b/2},${A} ${y+b},${B}`}),m},n=>n,n=>n.remove()).attr("transform",n=>`translate(${G?0:x(n.seriesLabel)}, 0)`).select(`path.${o}`).attr("height",n=>Math.abs(n.axisYFromZero)).attr("y",n=>n.axisY<p[h]?n.axisY:p[h]).attr("x",n=>G?0:x(n.seriesLabel)).style("fill",n=>`url(#${s[n.seriesIndex]})`).attr("stroke",n=>n.color).attr("transform",n=>`translate(${n?n.axisX:0}, 0)`).transition().duration(w).ease(ie(M.transitionEase)).delay((n,m)=>n.groupIndex*D).attr("d",n=>{const m=-I,P=p[h],y=n.axisY;return`M${m},${P} L${m+b/2},${y} ${m+b},${P}`})}),i.selectAll(`path.${o}`)}function ce({defsSelection:i,computedData:l,linearGradientIds:o,params:a}){i.selectAll("linearGradient").data(l??[]).join(s=>s.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),s=>s,s=>s.remove()).attr("id",(s,p)=>s[0]?o[s[0].seriesIndex]:"").html((s,p)=>{const u=s[0]?s[0].color:"";return`
        <stop offset="0%"   stop-color="${u}" stop-opacity="${a.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${u}" stop-opacity="${a.linearGradientOpacity[1]}"/>
      `})}function ge({defsSelection:i,clipPathData:l}){i.selectAll("clipPath").data(l).join(o=>o.append("clipPath"),o=>o,o=>o.remove()).attr("id",o=>o.id).each((o,a,s)=>{T(s[a]).selectAll("rect").data([o]).join(p=>p.append("rect"),p=>p,p=>p.remove()).attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height)})}function ue({selection:i,ids:l,fullChartParams:o}){i.interrupt("highlight");const a=()=>{i.transition("highlight").duration(200).style("opacity",1)};if(!l.length){a();return}i.each((s,p,u)=>{l.includes(s.id)?T(u[p]).style("opacity",1):T(u[p]).style("opacity",o.styles.unhighlightedOpacity)})}const he=(i,{selection:l,computedData$:o,computedLayoutData$:a,visibleComputedData$:s,visibleComputedLayoutData$:p,fullDataFormatter$:u,seriesLabels$:x,SeriesDataMap$:O,GroupDataMap$:M,fullParams$:b,fullChartParams$:D,gridAxesTransform$:w,gridGraphicTransform$:G,gridAxesSize$:I,gridHighlight$:k,gridContainerPosition$:z,isSeriesSeprate$:h,event$:f})=>{const c=new U,n=Y(i,"clipPath-box"),m=v(i,"pathG"),P=v(i,"path"),{seriesSelection$:y,axesSelection$:B,defsSelection$:A,graphicGSelection$:Z}=se({selection:l,pluginName:i,clipPathID:n,seriesLabels$:x,gridContainerPosition$:z,gridAxesTransform$:w,gridGraphicTransform$:G});G.pipe(g(c),d(e=>-e.translate[1]/e.scale[1]));const X=p.pipe(d(e=>e.map(r=>r[0]?r[0].axisY-r[0].axisYFromZero:0)),L()),F=$({computedData:o,visibleComputedData:s,params:b,gridAxesSize:I,isSeriesSeprate:h}).pipe(g(c),S(async e=>e),d(e=>e.params.barWidth?e.params.barWidth:e.isSeriesSeprate?H({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):H({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}))),C=s.pipe(g(c),d(e=>{const r=new Set;return e.forEach(t=>{t.forEach(N=>{r.add(N.groupLabel)})}),Array.from(r)})),q=new W(e=>{$({seriesLabels:x,barWidth:F,params:b}).pipe(g(c),S(async r=>r)).subscribe(r=>{const t=ne(r.barWidth,r.seriesLabels,r.params);e.next(t)})}),j=D.pipe(g(c),d(e=>e.transitionDuration),L()),J=new W(e=>{$({groupLabels:C,transitionDuration:j}).pipe(S(async r=>r)).subscribe(r=>{const t=oe(r.groupLabels.length,r.transitionDuration);e.next(t)})}).pipe(g(c),L()),K=new W(e=>{$({groupLabels:C,transitionDuration:j}).pipe(S(async r=>r)).subscribe(r=>{const t=pe(r.groupLabels.length,r.transitionDuration);e.next(t)})}).pipe(g(c),L());$({defsSelection:A,gridAxesSize:I}).pipe(g(c),S(async e=>e)).subscribe(e=>{const r=[{id:n,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];ge({defsSelection:e.defsSelection,clipPathData:r})});const Q=D.pipe(g(c),d(e=>e.highlightTarget),L()),V=x.pipe(g(c),d(e=>e.map((r,t)=>Y(i,`lineargradient-${r}`)))),E=$({graphicGSelection:Z,defsSelection:A,computedData:o,visibleComputedLayoutData:p,linearGradientIds:V,zeroYArr:X,groupLabels:C,barScale:q,params:b,chartParams:D,barWidth:F,delayGroup:J,transitionItem:K,isSeriesSeprate:h}).pipe(g(c),S(async e=>e),d(e=>(ce({defsSelection:e.defsSelection,computedData:e.computedData,linearGradientIds:e.linearGradientIds,params:e.params}),le({graphicGSelection:e.graphicGSelection,pathGClassName:m,pathClassName:P,visibleComputedLayoutData:e.visibleComputedLayoutData,linearGradientIds:e.linearGradientIds,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesSeprate:e.isSeriesSeprate}))));return $({barSelection:E,computedData:o,highlightTarget:Q,SeriesDataMap:O,GroupDataMap:M}).subscribe(e=>{e.barSelection.on("mouseover",(r,t)=>{r.stopPropagation(),f.next({type:"grid",eventName:"mouseover",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:r,data:e.computedData})}).on("mousemove",(r,t)=>{r.stopPropagation(),f.next({type:"grid",eventName:"mousemove",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:r,data:e.computedData})}).on("mouseout",(r,t)=>{r.stopPropagation(),f.next({type:"grid",eventName:"mouseout",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:r,data:e.computedData})}).on("click",(r,t)=>{r.stopPropagation(),f.next({type:"grid",eventName:"click",pluginName:i,highlightTarget:e.highlightTarget,datum:t,gridIndex:t.gridIndex,series:e.SeriesDataMap.get(t.seriesLabel),seriesIndex:t.seriesIndex,seriesLabel:t.seriesLabel,groups:e.GroupDataMap.get(t.groupLabel),groupIndex:t.groupIndex,groupLabel:t.groupLabel,event:r,data:e.computedData})})}),$({barSelection:E,highlight:k.pipe(d(e=>e.map(r=>r.id))),fullChartParams:D}).pipe(g(c),S(async e=>e)).subscribe(e=>{ue({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}},R="BarsTriangle",xe=ee(R,te)(({selection:i,name:l,subject:o,observer:a})=>{const s=new U,p=a.fullDataFormatter$.pipe(g(s),d(x=>x.grid.separateSeries),L(),ae(1)),u=he(R,{selection:i,computedData$:a.computedData$,computedLayoutData$:a.computedLayoutData$,visibleComputedData$:a.visibleComputedData$,visibleComputedLayoutData$:a.visibleComputedLayoutData$,fullDataFormatter$:a.fullDataFormatter$,seriesLabels$:a.seriesLabels$,SeriesDataMap$:a.SeriesDataMap$,GroupDataMap$:a.GroupDataMap$,fullParams$:a.fullParams$,fullChartParams$:a.fullChartParams$,gridAxesTransform$:a.gridAxesTransform$,gridGraphicTransform$:a.gridGraphicTransform$,gridAxesSize$:a.gridAxesSize$,gridHighlight$:a.gridHighlight$,gridContainerPosition$:a.gridContainerPosition$,isSeriesSeprate$:p,event$:o.event$});return()=>{s.next(void 0),u()}});export{xe as B,he as c};
