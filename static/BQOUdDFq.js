import{a as z,p as N,t as d,l as P,m as D,d as B,k as R,s as L,bd as G,bp as F,g as v,bf as Y,bJ as J,bK as K,bc as q,b as _,C as M,a2 as Q,L as Z,a3 as tt,ap as et,a4 as at,j as nt}from"./Bh8imPUI.js";import{e as X,f as it,r as rt,g as ot,c as lt}from"./DE84yxv2.js";import{o as H}from"./D-AxHF1t.js";const st="end",ct="middle",ut="end",pt="auto";function gt({selection:n,textClassName:o,fullParams:t,containerSize:i,fullDataFormatter:l,fullChartParams:a,textReverseTransform:b}){const g=t.barLabel.padding-t.axisLabel.offset[0],x=-t.barLabel.padding-t.axisLabel.offset[1];let e=-g,c=-x;n.attr("transform",s=>`translate(0, ${i.height})`).selectAll("text").data([t]).join(s=>s.append("text").style("font-weight","bold"),s=>s,s=>s.remove()).attr("text-anchor",ut).attr("dominant-baseline",pt).attr("font-size",a.styles.textSize).style("fill",G(t.axisLabel.colorType,a)).attr("x",e).attr("y",c).text(s=>l.yAxis.label)}function ht({selection:n,fullParams:o,fullChartParams:t,rankingScale:i,valueScale:l,categoryData:a}){const b=o.barLabel.position==="none"?[]:a;return n.selectAll("text").data(b,x=>x.id).join(x=>x.append("text").style("font-weight","bold").attr("x",e=>l(e.value[e.xValueIndex]??0)-o.barLabel.padding).attr("y",e=>i(e.label)),x=>x.transition().duration(t.transitionDuration).ease(F).attr("x",e=>l(e.value[e.xValueIndex]??0)-o.barLabel.padding).attr("y",e=>i(e.label)),x=>x.remove()).attr("text-anchor",st).attr("dominant-baseline",ct).attr("font-size",t.styles.textSize).style("fill",G(o.barLabel.colorType,t)).text(x=>x.label)}function dt({defsSelection:n,clipPathData:o}){n.selectAll("clipPath").data(o).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,i,l)=>{L(l[i]).selectAll("rect").data([t]).join(a=>a.append("rect"),a=>a,a=>a.remove()).attr("x",a=>-a.width).attr("y",0).attr("width",a=>a.width*2).attr("height",a=>a.height)})}const bt=(n,{selection:o,computedData$:t,visibleComputedRankingData$:i,rankingScaleList$:l,xScale$:a,fullParams$:b,fullDataFormatter$:g,fullChartParams$:x,containerPosition$:e,containerSize$:c,isCategorySeprate$:s})=>{const f=new z,$=v(n,"box"),u=v(n,"text"),m=N(n,"clipPath-box"),S=X({selection:o,pluginName:n,clipPathID:null,computedData$:t,containerPosition$:e,isCategorySeprate$:s}).pipe(d(f)),k=e.pipe(d(f),P(async p=>p),D(p=>`${`scale(${1/p[0].scale[0]}, ${1/p[0].scale[1]})`}`),B()),C=b.pipe(D(p=>p.barLabel.position),B(),P(p=>Y(()=>p==="inside",a,H(()=>0))));return c.subscribe(p=>{const y=o.selectAll("defs").data([m]).join("defs"),A=[{id:m,width:p.width,height:p.height}];dt({defsSelection:y,clipPathData:A})}),R({containerSelection:S,fullParams:b,containerSize:c,fullDataFormatter:g,fullChartParams:x,visibleComputedRankingData:i,rankingScaleList:l,valueScale:C,textReverseTransform:k}).pipe(d(f),P(async p=>p)).subscribe(p=>{p.containerSelection.each((y,A,I)=>{const V=L(I[A]),r=p.rankingScaleList[A];if(!r)return;const T=V.selectAll(`g.${$}`).data([A]).join("g").attr("class",$).attr("clip-path",`url(#${m})`),h=V.selectAll(`g.${u}`).data([p.fullParams]).join("g").classed(u,!0);ht({selection:T,fullParams:p.fullParams,fullChartParams:p.fullChartParams,rankingScale:r,categoryData:p.visibleComputedRankingData[A],valueScale:p.valueScale}),gt({selection:h,textClassName:u,fullParams:p.fullParams,containerSize:p.containerSize,fullDataFormatter:p.fullDataFormatter,fullChartParams:p.fullChartParams,textReverseTransform:p.textReverseTransform})})}),()=>{f.next(void 0)}},xt="start",$t="middle";function mt({selection:n,fullParams:o,fullChartParams:t,rankingScale:i,xScale:l,categoryData:a,computedRankingAmount:b}){const g=a.slice(0,b+1);return n.selectAll("g").data(g,c=>c.id).join(c=>c.append("g").attr("transform",s=>`translate(${l(s.value[s.xValueIndex]??0)+o.padding}, ${i(s.label)})`),c=>c.transition().duration(t.transitionDuration).ease(F).attr("transform",s=>`translate(${l(s.value[s.xValueIndex]??0)+o.padding}, ${i(s.label)})`),c=>c.remove()).each((c,s,f)=>{L(f[s]).selectAll("text").data([c]).join(u=>u.append("text"),u=>u,u=>u.remove()).attr("text-anchor",xt).attr("dominant-baseline",$t).attr("font-size",t.styles.textSize).style("fill",G(o.colorType,t)).transition().duration(t.transitionDuration).ease(F).textTween(u=>{const m=u.xValueIndex,S=m===0?0:m-1,k=u.value[S],C=u.value[m];return p=>{const y=p===1?J(k,C)(p):K(k,C)(p);return q(y,o.format)}})}).selectAll("text")}function yt({defsSelection:n,clipPathData:o}){n.selectAll("clipPath").data(o).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,i,l)=>{L(l[i]).selectAll("rect").data([t]).join(a=>a.append("rect"),a=>a,a=>a.remove()).attr("x",a=>0).attr("y",0).attr("width",a=>a.width*1.5).attr("height",a=>a.height)})}const ft=(n,{selection:o,computedData$:t,visibleComputedRankingData$:i,rankingScaleList$:l,xScale$:a,computedRankingAmount$:b,fullParams$:g,fullChartParams$:x,containerPosition$:e,containerSize$:c,isCategorySeprate$:s})=>{const f=new z,$=v(n,"box"),u=N(n,"clipPath-box"),m=X({selection:o,pluginName:n,clipPathID:null,computedData$:t,containerPosition$:e,isCategorySeprate$:s}).pipe(d(f));return c.subscribe(S=>{const k=o.selectAll("defs").data([u]).join("defs"),C=[{id:u,width:S.width,height:S.height}];yt({defsSelection:k,clipPathData:C})}),R({containerSelection:m,fullParams:g,fullChartParams:x,visibleComputedRankingData:i,rankingScaleList:l,xScale:a,computedRankingAmount:b}).pipe(d(f),P(async S=>S)).subscribe(S=>{S.containerSelection.each((k,C,p)=>{const y=L(p[C]),A=S.rankingScaleList[C];if(!A)return;const I=y.selectAll(`g.${$}`).data([C]).join("g").attr("class",$).attr("clip-path",`url(#${u})`);mt({selection:I,fullParams:S.fullParams,fullChartParams:S.fullChartParams,rankingScale:A,categoryData:S.visibleComputedRankingData[C],xScale:S.xScale,computedRankingAmount:S.computedRankingAmount})})}),()=>{f.next(void 0)}};function St({containerSelection:n,visibleComputedRankingData:o,rankingScaleList:t,transitionDuration:i}){return n.each((a,b,g)=>{L(g[b]).selectAll("g").data(o[b]??[],e=>e.id).join(e=>e.append("g").attr("cursor","pointer").attr("transform",c=>`translate(0, ${t[b]&&t[b](c.label)})`),e=>e.transition().duration(i).ease(F).attr("transform",c=>`translate(0, ${t[b]&&t[b](c.label)})`),e=>e.remove())}),n.selectAll("g")}function Dt({graphicGSelection:n,rectClassName:o,xScale:t,fullParams:i,barWidth:l,transitionDuration:a}){return n.each((g,x,e)=>{const c=l/2,s=i.bar.barRadius===!0?c:i.bar.barRadius===!1?0:typeof i.bar.barRadius=="number"?i.bar.barRadius:0;L(e[x]).selectAll(`rect.${o}`).data([g],$=>$.id).join($=>$.append("rect").classed(o,!0).attr("cursor","pointer").attr("width",u=>t(u.value[u.xValueIndex])??1).attr("height",l),$=>$.transition().duration(a).ease(F).attr("width",u=>t(u.value[u.xValueIndex])??1).attr("height",l),$=>$.remove()).attr("transform",`translate(0, ${-c})`).attr("fill",$=>$.color).attr("rx",s).attr("ry",s)}),n.selectAll(`rect.${o}`)}function Ct({defsSelection:n,clipPathData:o}){n.selectAll("clipPath").data(o).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,i,l)=>{L(l[i]).selectAll("rect").data([t]).join(a=>a.append("rect"),a=>a,a=>a.remove()).attr("x",0).attr("y",0).attr("width",a=>a.width).attr("height",a=>a.height)})}function Pt({selection:n,ids:o,fullChartParams:t}){if(n.interrupt("highlight"),!o.length){n.transition("highlight").duration(200).style("opacity",1);return}n.each((i,l,a)=>{o.includes(i.id)?L(a[l]).style("opacity",1):L(a[l]).style("opacity",t.styles.unhighlightedOpacity)})}const At=(n,{selection:o,computedData$:t,visibleComputedRankingData$:i,CategoryDataMap$:l,fullParams$:a,fullChartParams$:b,highlight$:g,rankingItemHeight$:x,rankingScaleList$:e,containerPosition$:c,containerSize$:s,xScale$:f,isCategorySeprate$:$,event$:u})=>{const m=new z,S=N(n,"clipPath-box"),k=v(n,"rect"),C=X({selection:o,pluginName:n,clipPathID:S,computedData$:t,containerPosition$:c,isCategorySeprate$:$}).pipe(d(m));s.subscribe(r=>{const T=o.selectAll("defs").data([S]).join("defs"),h=[{id:S,width:r.width,height:r.height}];Ct({defsSelection:T,clipPathData:h})});const p=R({fullParams:a,rankingItemHeight:x}).pipe(d(m),P(async r=>r),D(r=>r.fullParams.bar.barWidth?r.fullParams.bar.barWidth:r.rankingItemHeight-r.fullParams.bar.barPadding),B()),y=b.pipe(d(m),D(r=>r.transitionDuration),B()),A=R({containerSelection:C,visibleComputedRankingData:i,rankingScaleList:e,transitionDuration:y}).pipe(d(m),P(async r=>r),D(r=>St({containerSelection:r.containerSelection,visibleComputedRankingData:r.visibleComputedRankingData,rankingScaleList:r.rankingScaleList,transitionDuration:r.transitionDuration}))),I=R({graphicGSelection:A,xScale:f,barWidth:p,transitionDuration:y,fullParams:a}).pipe(d(m),P(async r=>r),D(r=>Dt({graphicGSelection:r.graphicGSelection,rectClassName:k,xScale:r.xScale,fullParams:r.fullParams,barWidth:r.barWidth,transitionDuration:r.transitionDuration})),_(1)),V=b.pipe(d(m),D(r=>r.highlightTarget),B());return R({graphicSelection:I,computedData:t,CategoryDataMap:l,highlightTarget:V}).pipe(d(m),P(async r=>r)).subscribe(r=>{r.graphicSelection.on("mouseover",(T,h)=>{h._visibleValue=[h.value[h.xValueIndex]],u.next({type:"multiValue",eventName:"mouseover",pluginName:n,highlightTarget:r.highlightTarget,datum:h,category:r.CategoryDataMap.get(h.categoryLabel),categoryIndex:h.categoryIndex,categoryLabel:h.categoryLabel,data:r.computedData,event:T})}).on("mousemove",(T,h)=>{h._visibleValue=[h.value[h.xValueIndex]],u.next({type:"multiValue",eventName:"mousemove",pluginName:n,highlightTarget:r.highlightTarget,datum:h,category:r.CategoryDataMap.get(h.categoryLabel),categoryIndex:h.categoryIndex,categoryLabel:h.categoryLabel,data:r.computedData,event:T})}).on("mouseout",(T,h)=>{u.next({type:"multiValue",eventName:"mouseout",pluginName:n,highlightTarget:r.highlightTarget,datum:h,category:r.CategoryDataMap.get(h.categoryLabel),categoryIndex:h.categoryIndex,categoryLabel:h.categoryLabel,data:r.computedData,event:T})}).on("click",(T,h)=>{h._visibleValue=[h.value[h.xValueIndex]],u.next({type:"multiValue",eventName:"click",pluginName:n,highlightTarget:r.highlightTarget,datum:h,category:r.CategoryDataMap.get(h.categoryLabel),categoryIndex:h.categoryIndex,categoryLabel:h.categoryLabel,data:r.computedData,event:T})})}),R({graphicSelection:I,highlight:g.pipe(D(r=>r.map(T=>T.id))),fullChartParams:b}).pipe(d(m),P(async r=>r)).subscribe(r=>{Pt({selection:r.graphicSelection,ids:r.highlight,fullChartParams:r.fullChartParams})}),()=>{m.next(void 0)}},j="RacingBars",Tt={name:j,defaultParams:Q,layerIndex:Z,validator:(n,{validateColumns:o})=>{const t=o(n,{bar:{toBeTypes:["object"]},barLabel:{toBeTypes:["object"]},valueLabel:{toBeTypes:["object"]},rankingAmount:{toBe:'number | "auto"',test:i=>typeof i=="number"||i==="auto"},autorun:{toBeTypes:["boolean"]}});if(n.bar){const i=o(n.bar,{barWidth:{toBeTypes:["number"]},barPadding:{toBeTypes:["number"]},barRadius:{toBeTypes:["number","boolean"]}});if(i.status==="error")return i}if(n.barLabel){const i=o(n.barLabel,{position:{toBe:'"inside" | "outside" | "none"',test:l=>l==="inside"||l==="outside"||l==="none"},padding:{toBeTypes:["number"]},rotate:{toBeTypes:["number"]},colorType:{toBeOption:"ColorType"}});if(i.status==="error")return i}if(n.valueLabel){const i=o(n.valueLabel,{padding:{toBeTypes:["number"]},colorType:{toBeOption:"ColorType"},format:{toBeTypes:["Function"]}});if(i.status==="error")return i}return t}},zt=M(Tt)(({selection:n,name:o,observer:t,subject:i})=>{const l=n.append("g").attr("class",`${j}-bars`),a=n.append("g").attr("class",`${j}-labels`),b=n.append("g").attr("class",`${j}-valueLabels`),g=new z,x=t.fullParams$.pipe(d(g),D(y=>y.valueLabel)),e=t.fullParams$.pipe(d(g),D(y=>y.rankingAmount),B()),c=it({containerSize$:t.containerSize$,visibleComputedData$:t.visibleComputedData$,textSizePx$:t.textSizePx$,rankingAmount$:e}).pipe(d(g),_(1)),s=rt({containerSize$:t.containerSize$,textSizePx$:t.textSizePx$,computedRankingAmount$:c}).pipe(d(g),_(1)),f=ot({visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,rankingItemHeight$:s}).pipe(d(g),_(1)),$=bt(`${j}-labels`,{selection:a,computedData$:t.computedData$,visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,rankingScaleList$:f,xScale$:t.xScale$,fullParams$:t.fullParams$,fullDataFormatter$:t.fullDataFormatter$,fullChartParams$:t.fullChartParams$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,isCategorySeprate$:t.isCategorySeprate$}),u=ft(`${j}-valueLabels`,{selection:b,computedData$:t.computedData$,visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,rankingScaleList$:f,xScale$:t.xScale$,computedRankingAmount$:c,fullParams$:x,fullChartParams$:t.fullChartParams$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,isCategorySeprate$:t.isCategorySeprate$}),m=At(`${j}-bars`,{selection:l,computedData$:t.computedData$,visibleComputedRankingData$:t.visibleComputedRankingByIndexData$,CategoryDataMap$:t.CategoryDataMap$,fullParams$:t.fullParams$,fullChartParams$:t.fullChartParams$,highlight$:t.highlight$,rankingItemHeight$:s,rankingScaleList$:f,xScale$:t.xScale$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,isCategorySeprate$:t.isCategorySeprate$,event$:i.event$}),S=t.visibleComputedRankingByIndexData$.pipe(d(g),D(y=>(y[0]&&y[0][0]&&y[0][0].value.length)??0),B()),k=t.fullParams$.pipe(d(g),D(y=>y.autorun),B()),C=t.fullChartParams$.pipe(d(g),D(y=>y.transitionDuration),B());let p=!0;return R({autorun:k,valueAmount:S,tickDurationPeriod:C,fullDataFormatter:t.fullDataFormatter$}).pipe(d(g),P(async y=>y)).subscribe(({autorun:y,valueAmount:A,tickDurationPeriod:I,fullDataFormatter:V})=>{if(p!=!1&&y){const r=V.xAxis.valueIndex+1;r<A&&(p=!1,setTimeout(()=>{i.dataFormatter$.next({...V,xAxis:{...V.xAxis,valueIndex:r}}),p=!0},I))}}),()=>{g.next(void 0),$(),u(),m()}}),E="RacingCounterTexts",U=v(E,"container"),w=v(E,"box"),O=v(E,"text"),Rt={name:E,defaultParams:tt,layerIndex:et,validator:(n,{validateColumns:o})=>o(n,{renderFn:{toBeTypes:["Function"]},textAttrs:{toBeTypes:["object[]"]},textStyles:{toBeTypes:["object[]"]},paddingRight:{toBeTypes:["number"]},paddingBottom:{toBeTypes:["number"]}})};function Lt({selection:n,data:o,fullParams:t,containerSize:i}){const l=i.width-t.paddingRight,a=i.height-t.paddingBottom;return n.selectAll(`g.${w}`).data([w]).join("g").classed(w,!0).attr("transform",`translate(${l}, ${a})`).each((g,x,e)=>{L(e[x]).selectAll(`text.${O}`).data(o).join("text").classed(O,!0).each((s,f,$)=>{const u=L($[f]).text(s.text);Object.keys(s.attr).forEach(m=>{u.attr(m,s.attr[m])}),Object.keys(s.style).forEach(m=>{u.style(m,s.style[m])})})}).selectAll(`text.${O}`)}function Bt({computedData:n,valueLabel:o,valueIndex:t,renderFn:i,textAttrs:l,textStyles:a}){const b=o||String(t),g=i(b,t,n);return(Array.isArray(g)?g:[g]).map((e,c)=>({text:e,attr:l[c],style:a[c]}))}function kt(n,o){const t=new z;return R({textData:o.textData$,fullParams:o.fullParams$,containerSize:o.containerSize$}).pipe(d(t)).subscribe(i=>{Lt({selection:o.containerSelection,data:i.textData,fullParams:i.fullParams,containerSize:i.containerSize})}),()=>{t.next(void 0)}}const _t=M(Rt)(({selection:n,name:o,observer:t,subject:i})=>{const l=new z,a=R({computedData:t.computedData$.pipe(B((e,c)=>e.length===c.length)),isCategorySeprate:t.isCategorySeprate$}).pipe(d(l),P(async e=>e),D(e=>e.isCategorySeprate?e.computedData:[e.computedData[0]]),D((e,c)=>n.selectAll(`g.${U}`).data(e,s=>s[0]?s[0].categoryIndex:c).join("g").classed(U,!0)));a.pipe(d(l),D((e,c)=>e.selectAll(`g.${w}`).data([w]).join("g").classed(w,!0))),R({containerSelection:a,gridContainerPosition:t.containerPosition$}).pipe(d(l),P(async e=>e)).subscribe(e=>{e.containerSelection.attr("transform",(c,s)=>{const f=e.gridContainerPosition[s]??e.gridContainerPosition[0],$=f.translate;return f.scale,`translate(${$[0]}, ${$[1]})`})});const b=R({xyValueIndex:t.xyValueIndex$,fullDataFormatter:t.fullDataFormatter$}).pipe(d(l),P(async e=>e),D(e=>e.fullDataFormatter.valueLabels[e.xyValueIndex[0]]??""),B(),_(1)),g=R({xyValueIndex:t.xyValueIndex$,valueLabel:b,computedData:t.computedData$,fullParams:t.fullParams$}).pipe(d(l),P(async e=>e),D(e=>Bt({valueIndex:e.xyValueIndex[0],valueLabel:e.valueLabel,computedData:e.computedData,renderFn:e.fullParams.renderFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles})),_(1)),x=[];return a.pipe(d(l)).subscribe(e=>{x.forEach(c=>c()),e.each((c,s,f)=>{const $=L(f[s]);t.visibleComputedRankingByIndexData$.pipe(d(l),D(u=>u[s]??u[0])),t.containerPosition$.pipe(d(l),D(u=>u[s]??u[0])),x[s]=kt(E,{containerSelection:$,textData$:g,fullParams$:t.fullParams$,valueLabel$:b,xyValueIndex$:t.xyValueIndex$,containerSize$:t.containerSize$})})}),()=>{l.next(void 0),x.forEach(e=>e())}}),W="RacingValueAxis",It={name:W,defaultParams:at,layerIndex:nt,validator:(n,{validateColumns:o})=>{const t=o(n,{labelOffset:{toBe:"[number, number]",test:i=>Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"},labelColorType:{toBeOption:"ColorType"},axisLineVisible:{toBeTypes:["boolean"]},axisLineColorType:{toBeOption:"ColorType"},ticks:{toBeTypes:["number","null"]},tickFormat:{toBeTypes:["string","Function"]},tickLineVisible:{toBeTypes:["boolean"]},tickPadding:{toBeTypes:["number"]},tickFullLine:{toBeTypes:["boolean"]},tickFullLineDasharray:{toBeTypes:["string"]},tickColorType:{toBeOption:"ColorType"},tickTextColorType:{toBeOption:"ColorType"}});return t.status==="error",t}},wt=M(It)(({selection:n,name:o,observer:t,subject:i})=>{const l=new z,a=t.fullChartParams$.pipe(d(l),D(g=>g.transitionDuration),B()),b=lt(W,{selection:n,position$:H("top"),transitionDuration$:a,computedData$:t.computedData$,fullParams$:t.fullParams$,fullDataFormatter$:t.fullDataFormatter$,fullChartParams$:t.fullChartParams$,isCategorySeprate$:t.isCategorySeprate$,containerPosition$:t.containerPosition$,containerSize$:t.containerSize$,xScale$:t.xScale$});return()=>{l.next(void 0),b()}});export{zt as R,_t as a,wt as b};
