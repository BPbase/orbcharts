import{O as C,a as se,S as V,t as g,d as h,e as L,f as d,s as m,g as Y,x as ne,a7 as pe}from"./C-r1ajy-.js";import{e as ce,s as Z,f as ge,g as le}from"./BeiEZ8Ba.js";import{k as ue}from"./Cha9ElIW.js";function he(a){return new C(function(s){se(a()).subscribe(s)})}function de(a,s,o){return he(function(){return a()?s:o})}const K=.3;function me({axisWidth:a,groupAmount:s,barGroupPadding:o=0}){const l=a/(s-1)-o;return l>1?l:1}function be(a,s){return a<=1?0:s/(a-1)*K}function De(a,s){return a<=1?s:s*(1-K)}function xe({graphicGSelection:a,rectClassName:s,barData:o,zeroY:i,groupLabels:l,params:p,chartParams:G,barWidth:$,transformedBarRadius:P,delayGroup:M,transitionItem:B,isSeriesSeprate:R}){const W=$/2;return a.each((k,S,w)=>{Y(w[S]).selectAll(`rect.${s}`).data(o[S]??[],n=>n.id).join(n=>n.append("rect").classed(s,!0).attr("cursor","pointer").attr("height",I=>0),n=>n,n=>n.remove()).attr("transform",(n,I)=>`translate(${(n?n.axisX:0)-W}, 0)`).attr("fill",n=>n.color).attr("y",n=>i).attr("x",n=>0).attr("width",$).attr("rx",P[S][0]??1).attr("ry",P[S][1]??1).transition().duration(B).ease(ge(G.transitionEase)).delay((n,I)=>n.groupIndex*M).attr("y",n=>n._barStartY).attr("height",n=>Math.abs(n._barHeight))}),a.selectAll(`rect.${s}`)}function Se({defsSelection:a,clipPathData:s}){a.selectAll("clipPath").data(s).join(o=>o.append("clipPath"),o=>o,o=>o.remove()).attr("id",o=>o.id).each((o,i,l)=>{Y(l[i]).selectAll("rect").data([o]).join(p=>p.append("rect"),p=>p,p=>p.remove()).attr("x",0).attr("y",0).attr("width",p=>p.width).attr("height",p=>p.height)})}function fe({selection:a,ids:s,fullChartParams:o}){if(a.interrupt("highlight"),!s.length){a.transition("highlight").duration(200).style("opacity",1);return}a.each((i,l,p)=>{s.includes(i.id)?Y(p[l]).style("opacity",1):Y(p[l]).style("opacity",o.styles.unhighlightedOpacity)})}const ye=(a,{selection:s,computedData$:o,computedLayoutData$:i,visibleComputedData$:l,visibleComputedLayoutData$:p,seriesLabels$:G,SeriesDataMap$:$,GroupDataMap$:P,fullParams$:M,fullDataFormatter$:B,fullChartParams$:R,gridAxesTransform$:W,gridGraphicTransform$:v,gridGraphicReverseScale$:k,gridAxesSize$:S,gridHighlight$:w,gridContainerPosition$:n,isSeriesSeprate$:I,event$:T})=>{const c=new V,_=ce(a,"clipPath-box"),X=le(a,"rect"),{seriesSelection$:Le,axesSelection$:$e,defsSelection$:q,graphicGSelection$:J}=ue({selection:s,pluginName:a,clipPathID:_,seriesLabels$:G,gridContainerPosition$:n,gridAxesTransform$:W,gridGraphicTransform$:v}),z=p.pipe(g(c),h(e=>e[0]&&e[0][0]?e[0][0].axisY-e[0][0].axisYFromZero:0),L()),H=d({computedData:o,params:M,axisSize:S,isSeriesSeprate:I}).pipe(g(c),m(async e=>e),h(e=>e.params.barWidth?e.params.barWidth:me({axisWidth:e.axisSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barGroupPadding:e.params.barGroupPadding})),L()),Q=d({computedData:o,barWidth:H,params:M,gridGraphicReverseScale:k}).pipe(g(c),m(async e=>e),h(e=>{const t=e.barWidth/2,r=e.params.barRadius===!0?t:e.params.barRadius===!1?0:typeof e.params.barRadius=="number"?e.params.barRadius:0;return e.computedData.map((b,u)=>{const D=e.gridGraphicReverseScale[u]??e.gridGraphicReverseScale[0],A=r*D[0],f=r*D[1];return[A,f]})})),F=l.pipe(g(c),h(e=>{const t=new Set;return e.forEach(r=>{r.forEach(b=>{t.add(b.groupLabel)})}),Array.from(t)}),Z(1)),E=R.pipe(g(c),h(e=>e.transitionDuration),L()),N=new C(e=>{d({groupLabels:F,transitionDuration:E}).pipe(m(async t=>t)).subscribe(t=>{const r=be(t.groupLabels.length,t.transitionDuration);e.next(r)})}).pipe(g(c),L()),ee=new C(e=>{d({groupLabels:F,transitionDuration:E}).pipe(m(async t=>t)).subscribe(t=>{const r=De(t.groupLabels.length,t.transitionDuration);e.next(r)})}).pipe(g(c),L()),re=d({computedData:o,dataFormatter:B}).pipe(g(c),m(async e=>e),h(e=>{const r=e.computedData[0]?e.computedData[0].length-1:0,b=e.dataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0:e.dataFormatter.grid.groupAxis.scaleDomain[0],u=e.dataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?r:e.dataFormatter.grid.groupAxis.scaleDomain[1];return[b,u]})),te=d({visibleComputedLayoutData:p,groupScaleDomain:re}).pipe(g(c),m(async e=>e),h(e=>{const t=e.groupScaleDomain[0],r=e.groupScaleDomain[1],u=e.visibleComputedLayoutData.map(x=>x.filter((y,Ie)=>y.groupIndex>=t&&y.groupIndex<=r)).flat();if(u.length<=1)return 1;const D=u.reduce((x,y)=>y.value>x.value?y:x,u[0]),A=D.groupIndex,f=u.filter(x=>x.groupIndex===A).reduce((x,y)=>x+y.value,0);return D.value/f})),ae=d({computedLayoutData:i,yRatio:te,zeroY:z}).pipe(g(c),h(e=>{let t=e.computedLayoutData[0]?e.computedLayoutData[0].map(()=>e.zeroY):[];return e.computedLayoutData.map((r,b)=>r.map((u,D)=>{const A=t[D];let f=0;return u.visible&&(f=u.axisYFromZero*e.yRatio,t[D]=t[D]+f),{...u,_barStartY:A,_barHeight:f}}))})),ie=d({computedLayoutData:i,zeroY:z}).pipe(g(c),h(e=>e.computedLayoutData.map((t,r)=>t.map((b,u)=>({...b,_barStartY:e.zeroY,_barHeight:b.axisYFromZero}))))),oe=I.pipe(m(e=>de(()=>e,ie,ae)));d({defsSelection:q,gridAxesSize:S}).pipe(g(c),m(async e=>e)).subscribe(e=>{const t=[{id:_,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];Se({defsSelection:e.defsSelection,clipPathData:t})});const O=R.pipe(g(c),h(e=>e.highlightTarget),L()),j=d({graphicGSelection:J,graphicData:oe,zeroY:z,groupLabels:F,params:M,chartParams:R,highlightTarget:O,barWidth:H,transformedBarRadius:Q,delayGroup:N,transitionItem:ee,isSeriesSeprate:I}).pipe(g(c),m(async e=>e),h(e=>xe({graphicGSelection:e.graphicGSelection,rectClassName:X,barData:e.graphicData,zeroY:e.zeroY,groupLabels:e.groupLabels,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,transformedBarRadius:e.transformedBarRadius,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesSeprate:e.isSeriesSeprate})));return d({barSelection:j,computedData:o,highlightTarget:O,SeriesDataMap:$,GroupDataMap:P}).subscribe(e=>{e.barSelection.on("mouseover",(t,r)=>{t.stopPropagation(),T.next({type:"grid",eventName:"mouseover",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("mousemove",(t,r)=>{t.stopPropagation(),T.next({type:"grid",eventName:"mousemove",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("mouseout",(t,r)=>{t.stopPropagation(),T.next({type:"grid",eventName:"mouseout",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})}).on("click",(t,r)=>{t.stopPropagation(),T.next({type:"grid",eventName:"click",pluginName:a,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:t,data:e.computedData})})}),d({barSelection:j,highlight:w.pipe(h(e=>e.map(t=>t.id))),fullChartParams:R}).pipe(g(c),m(async e=>e)).subscribe(e=>{fe({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}},U="BarStack",Ae=ne(U,pe)(({selection:a,name:s,subject:o,observer:i})=>{const l=new V,p=i.fullDataFormatter$.pipe(g(l),h($=>$.grid.separateSeries),L(),Z(1)),G=ye(U,{selection:a,computedData$:i.computedData$,computedLayoutData$:i.computedLayoutData$,visibleComputedData$:i.visibleComputedData$,visibleComputedLayoutData$:i.visibleComputedLayoutData$,seriesLabels$:i.seriesLabels$,SeriesDataMap$:i.SeriesDataMap$,GroupDataMap$:i.GroupDataMap$,fullParams$:i.fullParams$,fullDataFormatter$:i.fullDataFormatter$,fullChartParams$:i.fullChartParams$,gridAxesTransform$:i.gridAxesTransform$,gridGraphicTransform$:i.gridGraphicTransform$,gridGraphicReverseScale$:i.gridGraphicReverseScale$,gridAxesSize$:i.gridAxesSize$,gridHighlight$:i.gridHighlight$,gridContainerPosition$:i.gridContainerPosition$,isSeriesSeprate$:p,event$:o.event$});return()=>{l.next(void 0),G()}});export{Ae as B,ye as c,de as i};
