import{Q as U,j as E,k as ie,m as $,P as re,R as ne,ab as se,ac as oe,ad as ae,S as G,f as b,e as O,t as d,s as T,c as _,O as I,r as le,n as ce,ae as ge}from"./Czm2CNpZ.js";import{c as z,k as ue,p as ee,g as P,n as pe,o as fe,q as xe,r as q}from"./CB2cfhTk.js";import{f as Q}from"./BbStV_Zy.js";import{E as de}from"./BKW2fktH.js";function me(s,l,g,r,a,x,u,S){var c=[],A=0,D=0,o=!1,y=function(){o&&!c.length&&!A&&l.complete()},h=function(v){return A<r?n(v):c.push(v)},n=function(v){A++;var k=!1;E(g(v,D++)).subscribe(U(l,function(m){l.next(m)},function(){k=!0},void 0,function(){if(k)try{A--;for(var m=function(){var F=c.shift();u||n(F)};c.length&&A<r;)m();y()}catch(F){l.error(F)}}))};return s.subscribe(U(l,h,function(){o=!0,y()})),function(){}}function te(s,l,g){return g===void 0&&(g=1/0),ie(l)?te(function(r,a){return $(function(x,u){return l(r,x,a,u)})(E(s(r,a)))},g):(typeof l=="number"&&(g=l),re(function(r,a){return me(r,a,s,g)}))}function Ae(s){return s===void 0&&(s=1/0),te(ne,s)}function J(){for(var s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];var g=se(s),r=oe(s,1/0),a=s;return a.length?a.length===1?E(a[0]):Ae(r)(ae(a,g)):de}const X=6;function he({selection:s,xAxisClassName:l,groupingLabelClassName:g,params:r,tickTextAlign:a,axisLabelAlign:x,gridAxesSize:u,fullDataFormatter:S,chartParams:c,groupScale:A,textTransform:D}){const o=s.selectAll(`g.${l}`).data([r]).join("g").classed(l,!0);s.selectAll(`g.${g}`).data([r]).join("g").classed(g,!0).each((n,v,k)=>{_(k[v]).selectAll("text").data([n]).join(m=>m.append("text").style("font-weight","bold"),m=>m,m=>m.remove()).attr("text-anchor",x.textAnchor).attr("dominant-baseline",x.dominantBaseline).style("font-size",`${c.styles.textSize}px`).style("fill",z(r.labelColorType,c)).style("transform",D).text(m=>S.grid.groupAxis.label)}).attr("transform",n=>`translate(${u.width+n.tickPadding+r.labelOffset[0]}, ${-n.tickPadding-X-r.labelOffset[1]})`);const y=ue(A).scale(A).tickSize(r.tickFullLine==!0?-u.height:X).tickSizeOuter(0).tickFormat(n=>ee(n,r.tickFormat)).tickPadding(r.tickPadding),h=o.transition().duration(100).call(y);return h.selectAll("line").style("fill","none").style("stroke",r.tickLineVisible==!0?z(r.tickColorType,c):"none").style("stroke-dasharray",r.tickFullLineDasharray).attr("pointer-events","none"),h.selectAll("path").style("fill","none").style("stroke",r.axisLineVisible==!0?z(r.axisLineColorType,c):"none").style("shape-rendering","crispEdges"),o.selectAll("text").style("font-family","sans-serif").style("font-size",`${c.styles.textSize}px`).style("color",z(r.tickTextColorType,c)).attr("text-anchor",a.textAnchor).attr("dominant-baseline",a.dominantBaseline).attr("transform-origin",`0 -${r.tickPadding+X}`).style("transform",D),o}const Re=(s,{selection:l,computedData$:g,fullParams$:r,fullDataFormatter$:a,fullChartParams$:x,gridAxesTransform$:u,gridAxesReverseTransform$:S,gridAxesSize$:c,gridContainer$:A,isSeriesPositionSeprate$:D})=>{const o=new G,y=P(s,"container"),h=P(s,"xAxisG"),n=P(s,"xAxis"),v=P(s,"groupingLabel"),k=b({computedData:g.pipe(O((t,e)=>t.length===e.length)),isSeriesPositionSeprate:D}).pipe(d(o),T(async t=>t),$(t=>t.isSeriesPositionSeprate?t.computedData:[t.computedData[0]]),$((t,e)=>l.selectAll(`g.${y}`).data(t,i=>i[0]?i[0].seriesIndex:e).join("g").classed(y,!0))),m=k.pipe(d(o),$((t,e)=>t.selectAll(`g.${h}`).data([h]).join("g").classed(h,!0)));b({containerSelection:k,gridContainer:A}).pipe(d(o),T(async t=>t)).subscribe(t=>{t.containerSelection.attr("transform",(e,i)=>{const f=t.gridContainer[i]??t.gridContainer[0],C=f.translate,R=f.scale;return`translate(${C[0]}, ${C[1]}) scale(${R[0]}, ${R[1]})`})}),b({axisSelection:m,gridAxesTransform:u}).pipe(d(o),T(async t=>t)).subscribe(t=>{t.axisSelection.style("transform",t.gridAxesTransform.value)});const F=b({fullParams:r,fullDataFormatter:a,gridAxesReverseTransform:S,gridContainer:A}).pipe(d(o),T(async t=>t),$(t=>{const e=`translate(${t.gridAxesReverseTransform.translate[0]}px, ${t.gridAxesReverseTransform.translate[1]}px)`,i=`rotate(${t.gridAxesReverseTransform.rotate}deg) rotateX(${t.gridAxesReverseTransform.rotateX}deg) rotateY(${t.gridAxesReverseTransform.rotateY}deg)`,f=`scale(${1/t.gridContainer[0].scale[0]}, ${1/t.gridContainer[0].scale[1]})`,R=`rotate(${t.fullDataFormatter.grid.groupAxis.position==="left"&&t.fullDataFormatter.grid.valueAxis.position==="top"||t.fullDataFormatter.grid.groupAxis.position==="right"&&t.fullDataFormatter.grid.valueAxis.position==="bottom"?t.fullParams.tickTextRotate+180:t.fullParams.tickTextRotate}deg)`;return`${e} ${i} ${f} ${R}`}),O()),L=new I(t=>{b({fullDataFormatter:a,gridAxesSize:c,computedData:g}).pipe(d(o),T(async e=>e)).subscribe(e=>{const f=e.computedData[0]?e.computedData[0].length-1:0,C=e.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-e.fullDataFormatter.grid.groupAxis.scalePadding:e.fullDataFormatter.grid.groupAxis.scaleDomain[0]-e.fullDataFormatter.grid.groupAxis.scalePadding,R=e.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?f+e.fullDataFormatter.grid.groupAxis.scalePadding:e.fullDataFormatter.grid.groupAxis.scaleDomain[1]+e.fullDataFormatter.grid.groupAxis.scalePadding,w=e.computedData[0]?e.computedData[0].length:0;let V=(e.computedData[0]??[]).map(j=>j.groupLabel);const Y=new Array(w).fill(0).map((j,M)=>V[M]!=null?V[M]:String(M)).filter((j,M)=>M>=C&&M<=R),N=e.fullDataFormatter.grid.groupAxis.scalePadding,H=le({axisLabels:Y,axisWidth:e.gridAxesSize.width,padding:N});t.next(H)})}),p=b({fullDataFormatter:a,fullParams:r}).pipe(d(o),T(async t=>t),$(t=>{let e="middle",i="hanging";return t.fullDataFormatter.grid.groupAxis.position==="bottom"?(e=t.fullParams.tickTextRotate?"end":"middle",i="hanging"):t.fullDataFormatter.grid.groupAxis.position==="top"?(e=t.fullParams.tickTextRotate?"end":"middle",i="auto"):t.fullDataFormatter.grid.groupAxis.position==="left"?(e="end",i="middle"):t.fullDataFormatter.grid.groupAxis.position==="right"&&(e="start",i="middle"),{textAnchor:e,dominantBaseline:i}})),B=a.pipe(d(o),$(t=>{let e="start",i="hanging";return t.grid.groupAxis.position==="bottom"?i="hanging":t.grid.groupAxis.position==="top"?i="auto":t.grid.groupAxis.position==="left"?e="end":t.grid.groupAxis.position==="right"&&(e="start"),t.grid.valueAxis.position==="left"?e="start":t.grid.valueAxis.position==="right"?e="end":t.grid.valueAxis.position==="bottom"?i="auto":t.grid.valueAxis.position==="top"&&(i="hanging"),{textAnchor:e,dominantBaseline:i}}));return b({axisSelection:m,params:r,tickTextAlign:p,axisLabelAlign:B,gridAxesSize:c,fullDataFormatter:a,chartParams:x,groupScale:L,textTransform:F}).pipe(d(o),T(async t=>t)).subscribe(t=>{he({selection:t.axisSelection,xAxisClassName:n,groupingLabelClassName:v,params:t.params,tickTextAlign:t.tickTextAlign,axisLabelAlign:t.axisLabelAlign,gridAxesSize:t.gridAxesSize,fullDataFormatter:t.fullDataFormatter,chartParams:t.chartParams,groupScale:t.groupScale,textTransform:t.textTransform})}),()=>{o.next(void 0)}},K=6;function ye({selection:s,yAxisClassName:l,textClassName:g,fullParams:r,tickTextAlign:a,axisLabelAlign:x,gridAxesSize:u,fullDataFormatter:S,fullChartParams:c,valueScale:A,textTransform:D,minAndMax:o}){const y=s.selectAll(`g.${l}`).data([r]).join("g").classed(l,!0);s.selectAll(`g.${g}`).data([r]).join("g").classed(g,!0).each((m,F,L)=>{_(L[F]).selectAll("text").data([m]).join(p=>p.append("text").style("font-weight","bold"),p=>p,p=>p.remove()).attr("text-anchor",x.textAnchor).attr("dominant-baseline",x.dominantBaseline).style("font-size",`${c.styles.textSize}px`).style("fill",z(r.labelColorType,c)).style("transform",D).text(p=>S.grid.valueAxis.label)}).attr("transform",m=>`translate(${-m.tickPadding+r.labelOffset[0]}, ${u.height+m.tickPadding+r.labelOffset[1]})`);const h=o[1]-o[0],n=pe(A).scale(A).ticks(h>r.ticks?r.ticks:o[0]===0&&o[1]===0?1:Math.ceil(h)).tickFormat(m=>ee(m,r.tickFormat)).tickSize(r.tickFullLine==!0?-u.width:K).tickPadding(r.tickPadding),v=y.transition().duration(100).call(n);return v.selectAll("line").style("fill","none").style("stroke",r.tickLineVisible==!0?z(r.tickColorType,c):"none").style("stroke-dasharray",r.tickFullLineDasharray).attr("pointer-events","none"),v.selectAll("path").style("fill","none").style("stroke",r.axisLineVisible==!0?z(r.axisLineColorType,c):"none").style("shape-rendering","crispEdges"),y.selectAll("text").style("font-family","sans-serif").style("font-size",`${c.styles.textSize}px`).style("color",z(r.tickTextColorType,c)).attr("text-anchor",a.textAnchor).attr("dominant-baseline",a.dominantBaseline).attr("transform-origin",`-${r.tickPadding+K} 0`).style("transform",D),y}const Pe=(s,{selection:l,computedData$:g,fullParams$:r,fullDataFormatter$:a,fullChartParams$:x,gridAxesTransform$:u,gridAxesReverseTransform$:S,gridAxesSize$:c,gridContainer$:A,isSeriesPositionSeprate$:D})=>{const o=new G,y=P(s,"container"),h=P(s,"yAxisG"),n=P(s,"yAxis"),v=P(s,"text"),k=b({computedData:g.pipe(O((e,i)=>e.length===i.length)),isSeriesPositionSeprate:D}).pipe(d(o),T(async e=>e),$(e=>e.isSeriesPositionSeprate?e.computedData:[e.computedData[0]]),$((e,i)=>l.selectAll(`g.${y}`).data(e,f=>f[0]?f[0].seriesIndex:i).join("g").classed(y,!0))),m=k.pipe(d(o),$((e,i)=>e.selectAll(`g.${h}`).data([h]).join("g").classed(h,!0)));b({containerSelection:k,gridContainer:A}).pipe(d(o),T(async e=>e)).subscribe(e=>{e.containerSelection.attr("transform",(i,f)=>{const C=e.gridContainer[f]??e.gridContainer[0],R=C.translate,w=C.scale;return`translate(${R[0]}, ${R[1]}) scale(${w[0]}, ${w[1]})`})}),b({axisSelection:m,gridAxesTransform:u}).pipe(d(o),T(async e=>e)).subscribe(e=>{e.axisSelection.style("transform",e.gridAxesTransform.value)});const F=b({fullParams:r,fullDataFormatter:a,gridAxesReverseTransform:S,gridContainer:A}).pipe(d(o),T(async e=>e),$(e=>{const i=`translate(${e.gridAxesReverseTransform.translate[0]}px, ${e.gridAxesReverseTransform.translate[1]}px)`,f=`rotate(${e.gridAxesReverseTransform.rotate}deg) rotateX(${e.gridAxesReverseTransform.rotateX}deg) rotateY(${e.gridAxesReverseTransform.rotateY}deg)`,C=`scale(${1/e.gridContainer[0].scale[0]}, ${1/e.gridContainer[0].scale[1]})`,w=`rotate(${e.fullDataFormatter.grid.groupAxis.position==="left"&&e.fullDataFormatter.grid.valueAxis.position==="top"||e.fullDataFormatter.grid.groupAxis.position==="right"&&e.fullDataFormatter.grid.valueAxis.position==="bottom"?e.fullParams.tickTextRotate+180:e.fullParams.tickTextRotate}deg)`;return`${i} ${f} ${C} ${w}`}),O()),L=new I(e=>{b({fullDataFormatter:a,gridAxesSize:c,computedData:g}).pipe(d(o),T(async i=>i)).subscribe(i=>{const C=i.computedData[0]?i.computedData[0].length-1:0,R=i.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-i.fullDataFormatter.grid.groupAxis.scalePadding:i.fullDataFormatter.grid.groupAxis.scaleDomain[0]-i.fullDataFormatter.grid.groupAxis.scalePadding,w=i.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?C+i.fullDataFormatter.grid.groupAxis.scalePadding:i.fullDataFormatter.grid.groupAxis.scaleDomain[1]+i.fullDataFormatter.grid.groupAxis.scalePadding,V=i.computedData.map((N,H)=>N.filter((j,M)=>M>=R&&M<=w)),Y=fe(V.flat());e.next(Y)})}),p=new I(e=>{b({fullDataFormatter:a,gridAxesSize:c,minAndMax:L}).pipe(d(o),T(async i=>i)).subscribe(i=>{console.log(i);const f=ce({maxValue:i.minAndMax[1],minValue:i.minAndMax[0],axisWidth:i.gridAxesSize.height,scaleDomain:i.fullDataFormatter.grid.valueAxis.scaleDomain,scaleRange:i.fullDataFormatter.grid.valueAxis.scaleRange});e.next(f)})}),B=a.pipe(d(o),$(e=>{let i="start",f="hanging";return e.grid.valueAxis.position==="left"?(i="end",f="middle"):e.grid.valueAxis.position==="right"?(i="start",f="middle"):e.grid.valueAxis.position==="bottom"?(i="middle",f="hanging"):e.grid.valueAxis.position==="top"&&(i="middle",f="auto"),{textAnchor:i,dominantBaseline:f}})),t=a.pipe(d(o),$(e=>{let i="start",f="hanging";return e.grid.groupAxis.position==="bottom"?f="auto":e.grid.groupAxis.position==="top"?f="hanging":e.grid.groupAxis.position==="left"?i="start":e.grid.groupAxis.position==="right"&&(i="end"),e.grid.valueAxis.position==="left"?i="end":e.grid.valueAxis.position==="right"?i="start":e.grid.valueAxis.position==="bottom"?f="hanging":e.grid.valueAxis.position==="top"&&(f="auto"),{textAnchor:i,dominantBaseline:f}}));return b({axisSelection:m,fullParams:r,tickTextAlign:B,axisLabelAlign:t,computedData:g,gridAxesSize:c,fullDataFormatter:a,fullChartParams:x,valueScale:p,textTransform:F,minAndMax:L}).pipe(d(o),T(async e=>e)).subscribe(e=>{ye({selection:e.axisSelection,yAxisClassName:n,textClassName:v,fullParams:e.fullParams,tickTextAlign:e.tickTextAlign,axisLabelAlign:e.axisLabelAlign,gridAxesSize:e.gridAxesSize,fullDataFormatter:e.fullDataFormatter,fullChartParams:e.fullChartParams,valueScale:e.valueScale,textTransform:e.textTransform,minAndMax:e.minAndMax})}),()=>{o.next(void 0)}},ve={backgroundColorType:"background",strokeColorType:"primary",backgroundOpacity:.8,textColorType:"primary",offset:[20,5],padding:10,textRenderFn:s=>{if(s.highlightTarget==="datum"&&s.datum)return[`${s.datum.label}: ${s.datum.value}`];if(s.highlightTarget==="series"){const l=s.seriesLabel,g=s.series.map(r=>r.value).join(",");return[l,g]}else if(s.highlightTarget==="group"){const l=s.groupLabel,g=s.groups.map(r=>r.value).join(",");return[l,g]}return[]},svgRenderFn:null},W="Tooltip",Z=P(W,"g"),be=P(W,"box");function Te(s,l){const g=l.textSize*1.5;return s.filter(r=>r!="").map((r,a)=>{const x=a*g;return`<text font-size="${l.textSize}" fill="${l.textColor}" x="0" y="${x}" style="dominant-baseline:text-before-edge">${r}</text>`}).join()}function $e({rootSelection:s,pluginName:l,rootWidth:g,rootHeight:r,svgString:a,tooltipStyle:x,event:u}){s.interrupt("fadeout");const S=5,c=a?[a]:[],A=a?[x]:[],o=s.selectAll(`g.${Z}`).data(c).join(p=>p.append("g").classed(Z,!0).attr("pointer-events","none"),p=>p,p=>p.style("opacity",0).remove()).attr("transform",()=>`translate(${u.offsetX}, ${u.offsetY})`).selectAll(`g.${be}`).data(A).join(p=>p.append("g").classed(P(l,"box"),!0)),y=o.selectAll("rect").data(A).join(p=>p.append("rect").attr("rx",S).attr("ry",S)).attr("fill",p=>p.backgroundColor).attr("stroke",p=>p.strokeColor).attr("opacity",p=>p.backgroundOpacity),h=o.selectAll("g").data(c).join(p=>p.append("g").classed(P(l,"content"),!0).attr("transform",()=>`translate(${x.padding}, ${x.padding})`));c.length&&xe(h,c[0]);const n=h!=null&&h.node()?q(h):{width:0,height:0};y.attr("width",n.width+x.padding*2).attr("height",n.height+x.padding*2);const v=o!=null&&o.node()?q(o):{width:0,height:0},k=g-v.width,m=r-v.height,F=u.offsetX+x.offset[0]>k?k-u.offsetX:x.offset[0],L=u.offsetY+x.offset[1]>m?m-u.offsetY:x.offset[1];o.attr("transform",p=>`translate(${F}, ${L})`),o.attr("transform",p=>`translate(${F}, ${L})`)}const ze=ge(W,ve)(({selection:s,rootSelection:l,name:g,chartType:r,observer:a,subject:x})=>{const u=new G,S=x.event$.pipe(d(u),Q(n=>n.eventName==="mouseover"||n.eventName==="mousemove")),c=x.event$.pipe(d(u),Q(n=>n.eventName==="mouseout")),A=b({fullChartParams:a.fullChartParams$,fullParams:a.fullParams$}).pipe(d(u),T(async n=>n),$(n=>({backgroundColor:z(n.fullParams.backgroundColorType,n.fullChartParams),backgroundOpacity:n.fullParams.backgroundOpacity,strokeColor:z(n.fullParams.strokeColorType,n.fullChartParams),offset:n.fullParams.offset,padding:n.fullParams.padding,textSize:n.fullChartParams.styles.textSize,textColor:z(n.fullParams.textColorType,n.fullChartParams)}))),D=b({fullParams:a.fullParams$,tooltipStyle:A}).pipe(d(u),T(async n=>n),$(n=>n.fullParams.svgRenderFn?n.fullParams.svgRenderFn:v=>{const k=n.fullParams.textRenderFn(v);return Te(k,n.tooltipStyle)})),o=b({event:S,contentRenderFn:D}).pipe(d(u),T(async n=>n),$(n=>n.contentRenderFn(n.event))),y=c.pipe(d(u),$(n=>"")),h=J(S,c).pipe(d(u),$(n=>n.event));return b({svgString:J(o,y),event:h,layout:a.layout$,tooltipStyle:A}).pipe(d(u),T(async n=>n)).subscribe(n=>{$e({rootSelection:l,pluginName:g,rootWidth:n.layout.rootWidth,rootHeight:n.layout.rootHeight,svgString:n.svgString,tooltipStyle:n.tooltipStyle,event:n.event})}),function(){u.next(void 0)}});export{ze as T,J as a,Re as b,Pe as c,te as m};
