import{S as _,t as g,m as h,d as y,n as u,o as b,at as E,s as I}from"./D0O9ZvbE.js";import{c as N,k as ee,d as re,g as ie}from"./CLAZhRXT.js";import{m as te}from"./CFQBDtsv.js";const H=.3;function $({axisWidth:t,groupAmount:s,barAmountOfGroup:o,barPadding:l=0,barGroupPadding:c=0}){const x=((s>1?t/(s-1):t)-c)/o-l;return x>1?x:1}function ae(t,s,o){const l=t/2,c=t*s.length+o.barPadding*s.length;return ee().domain(s).range([-c/2+l,c/2-l])}function se(t,s){return t<=1?0:s/(t-1)*H}function oe(t,s){return t<=1?s:s*(1-H)}function ne({graphicGSelection:t,rectClassName:s,visibleComputedLayoutData:o,zeroYArr:l,groupLabels:c,barScale:n,params:x,chartParams:G,barWidth:D,transformedBarRadius:S,delayGroup:m,transitionItem:P,isSeriesSeprate:W}){const A=D/2;return t.each((M,d,f)=>{I(f[d]).selectAll(`rect.${s}`).data(o[d]??[],a=>a.id).join(a=>a.append("rect").classed(s,!0).attr("cursor","pointer").attr("height",p=>0),a=>a,a=>a.remove()).attr("transform",(a,p)=>`translate(${(a?a.axisX:0)-A}, 0)`).attr("fill",a=>a.color).attr("y",a=>a.axisY<l[d]?a.axisY:l[d]).attr("x",a=>W?0:n(a.seriesLabel)).attr("width",D).attr("rx",S[d][0]??1).attr("ry",S[d][1]??1).transition().duration(P).ease(re(G.transitionEase)).delay((a,p)=>a.groupIndex*m).attr("height",a=>Math.abs(a.axisYFromZero))}),t.selectAll(`rect.${s}`)}function pe({defsSelection:t,clipPathData:s}){t.selectAll("clipPath").data(s).join(o=>o.append("clipPath"),o=>o,o=>o.remove()).attr("id",o=>o.id).each((o,l,c)=>{I(c[l]).selectAll("rect").data([o]).join(n=>n.append("rect"),n=>n,n=>n.remove()).attr("x",0).attr("y",0).attr("width",n=>n.width).attr("height",n=>n.height)})}function ce({selection:t,ids:s,fullChartParams:o}){if(t.interrupt("highlight"),!s.length){t.transition("highlight").duration(200).style("opacity",1);return}t.each((l,c,n)=>{s.includes(l.id)?I(n[c]).style("opacity",1):I(n[c]).style("opacity",o.styles.unhighlightedOpacity)})}const de=(t,{selection:s,computedData$:o,computedLayoutData$:l,visibleComputedData$:c,visibleComputedLayoutData$:n,seriesLabels$:x,SeriesDataMap$:G,GroupDataMap$:D,fullParams$:S,fullChartParams$:m,gridAxesTransform$:P,gridGraphicTransform$:W,gridGraphicReverseScale$:A,gridAxesSize$:v,gridHighlight$:M,gridContainerPosition$:d,isSeriesSeprate$:f,event$:a})=>{const p=new _,B=N(t,"clipPath-box"),U=ie(t,"rect"),{seriesSelection$:ge,axesSelection$:le,defsSelection$:F,graphicGSelection$:Z}=te({selection:s,pluginName:t,clipPathID:B,seriesLabels$:x,gridContainerPosition$:d,gridAxesTransform$:P,gridGraphicTransform$:W}),X=n.pipe(g(p),h(e=>e.map(i=>i[0]?i[0].axisY-i[0].axisYFromZero:0)),y()),R=u({computedData:o,visibleComputedData:c,params:S,gridAxesSize:v,isSeriesSeprate:f}).pipe(g(p),b(async e=>e),h(e=>e.params.barWidth?e.params.barWidth:e.isSeriesSeprate?$({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):$({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding})),y()),q=u({computedData:o,barWidth:R,params:S,gridGraphicReverseScale:A}).pipe(g(p),b(async e=>e),h(e=>{const i=e.barWidth/2,r=e.params.barRadius===!0?i:e.params.barRadius===!1?0:typeof e.params.barRadius=="number"?e.params.barRadius:0;return e.computedData.map((k,V)=>{const C=e.gridGraphicReverseScale[V]??e.gridGraphicReverseScale[0];let L=r*C[0],T=r*C[1];if(L>i){const j=i/L;L=L*j,T=T*j}return[L,T]})})),w=c.pipe(g(p),h(e=>{const i=new Set;return e.forEach(r=>{r.forEach(k=>{i.add(k.groupLabel)})}),Array.from(i)})),J=u({seriesLabels:x,barWidth:R,params:S}).pipe(g(p),b(async e=>e),h(e=>ae(e.barWidth,e.seriesLabels,e.params))),z=m.pipe(g(p),h(e=>e.transitionDuration),y()),K=new E(e=>{u({groupLabels:w,transitionDuration:z}).pipe(b(async i=>i)).subscribe(i=>{const r=se(i.groupLabels.length,i.transitionDuration);e.next(r)})}).pipe(g(p),y()),Q=new E(e=>{u({groupLabels:w,transitionDuration:z}).pipe(b(async i=>i)).subscribe(i=>{const r=oe(i.groupLabels.length,i.transitionDuration);e.next(r)})}).pipe(g(p),y());u({defsSelection:F,gridAxesSize:v}).pipe(g(p),b(async e=>e)).subscribe(e=>{const i=[{id:B,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];pe({defsSelection:e.defsSelection,clipPathData:i})});const Y=m.pipe(g(p),h(e=>e.highlightTarget),y()),O=u({graphicGSelection:Z,visibleComputedLayoutData:n,zeroYArr:X,groupLabels:w,barScale:J,params:S,chartParams:m,highlightTarget:Y,barWidth:R,transformedBarRadius:q,delayGroup:K,transitionItem:Q,isSeriesSeprate:f}).pipe(g(p),b(async e=>e),h(e=>ne({graphicGSelection:e.graphicGSelection,rectClassName:U,visibleComputedLayoutData:e.visibleComputedLayoutData,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,transformedBarRadius:e.transformedBarRadius,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesSeprate:e.isSeriesSeprate})));return u({barSelection:O,computedData:o,highlightTarget:Y,SeriesDataMap:G,GroupDataMap:D}).pipe(g(p),b(async e=>e)).subscribe(e=>{e.barSelection.on("mouseover",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"mouseover",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})}).on("mousemove",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"mousemove",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})}).on("mouseout",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"mouseout",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})}).on("click",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"click",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})})}),u({barSelection:O,highlight:M.pipe(h(e=>e.map(i=>i.id))),fullChartParams:m}).pipe(g(p),b(async e=>e)).subscribe(e=>{ce({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{p.next(void 0)}};export{de as c};
