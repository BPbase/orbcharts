import{f as R,_ as O,i as _,g as H,O as G,h as v,v as W,j as q,S as J,t as $,m as E,d as C,e as T,s as S,c as w,u as Q}from"./Bt7wG3zu.js";import{g as N,c as F,p as V,d as X}from"./vANVmeqg.js";import{m as B,a as K}from"./BjeewK-R.js";import{g as Y}from"./8OeFB8vA.js";import{f as Z}from"./0jurvOgS.js";var j=["addListener","removeListener"],ee=["addEventListener","removeEventListener"],te=["on","off"];function b(t,s,n,o){if(v(n)&&(o=n,n=void 0),o)return b(t,s,n).pipe(R(o));var a=O(ae(t)?ee.map(function(l){return function(h){return t[l](s,h,n)}}):re(t)?j.map(z(t,s)):ne(t)?te.map(z(t,s)):[],2),u=a[0],x=a[1];if(!u&&_(t))return B(function(l){return b(l,s,n)})(H(t));if(!u)throw new TypeError("Invalid event target");return new G(function(l){var h=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];return l.next(1<i.length?i:i[0])};return u(h),function(){return x(h)}})}function z(t,s){return function(n){return function(o){return t[n](s,o)}}}function re(t){return v(t.addListener)&&v(t.removeListener)}function ne(t){return v(t.on)&&v(t.off)}function ae(t){return v(t.addEventListener)&&v(t.removeEventListener)}function ie(t,s){let n=new G(()=>{});return t.each(function(){const o=b(this,s);n=K(n,o)}),n}const I="GroupAux",M=N(I,"label-box");function oe({groupLabel:t,axisX:s,axisHeight:n,fullParams:o}){return o.showLine&&t?[{id:t,x1:s,x2:s,y1:0,y2:n}]:[]}function se({selection:t,pluginName:s,lineData:n,fullParams:o,fullChartParams:a}){const u=N(s,"auxline"),x=t.selectAll(`line.${u}`).data(n),l=x.enter().append("line").classed(u,!0).style("stroke",i=>F(o.lineColorType,a)).style("stroke-width",1).style("stroke-dasharray",o.lineDashArray??"none").style("pointer-events","none"),h=x.merge(l);return x.exit().remove(),l.attr("x1",i=>i.x1).attr("y1",i=>i.y1).attr("x2",i=>i.x2).attr("y2",i=>i.y2),x.transition().duration(50).attr("x1",i=>i.x1).attr("y1",i=>i.y1).attr("x2",i=>i.x2).attr("y2",i=>i.y2),h}function le(t){t.selectAll("line").data([]).exit().remove()}function ue({groupLabel:t,axisX:s,fullParams:n}){return n.showLabel&&t?[{id:t,x:s,y:-n.labelPadding,text:V(t,n.labelTextFormat)}]:[]}function ge({selection:t,labelData:s,fullParams:n,fullChartParams:o,gridAxesReverseTransformValue:a,textSizePx:u}){const x=u+4,l=t.selectAll(`g.${M}`).data(s),h=l.enter().append("g").classed(M,!0).style("cursor","pointer"),i=h.merge(l);return h.attr("transform",(g,P)=>`translate(${g.x}, ${g.y})`),l.transition().duration(50).attr("transform",(g,P)=>`translate(${g.x}, ${g.y})`),l.exit().remove(),i.each((g,P,e)=>{const r=X(g.text,u)+12,f=-r/2,c=w(e[P]).selectAll("rect").data([g]),m=c.enter().append("rect").attr("height",`${x}px`).attr("fill",d=>F(n.labelColorType,o)).attr("x",f).attr("y",-2).attr("rx",5).attr("ry",5).style("cursor","pointer");c.merge(m).attr("width",d=>`${r}px`).style("transform",a),c.exit().remove();const p=w(e[P]).selectAll("text").data([g]),y=p.enter().append("text").style("dominant-baseline","hanging").style("cursor","pointer");p.merge(y).text(d=>d.text).style("transform",a).attr("fill",d=>F(n.labelTextColorType,o)).attr("font-size",o.styles.textSize).attr("x",f+6),p.exit().remove()}),i}function pe(t){t.selectAll(`g.${M}`).data([]).exit().remove()}const fe=W(I,q)(({selection:t,rootSelection:s,name:n,subject:o,observer:a})=>{const u=new J,x=s.insert("rect","g").classed(N(I,"rect"),!0).attr("opacity",0),l=t.append("g");a.layout$.pipe($(u)).subscribe(e=>{x.attr("width",e.rootWidth).attr("height",e.rootHeight)}),a.gridAxesTransform$.pipe($(u),E(e=>e.value),C()).subscribe(e=>{l.style("transform",e)});const h=new G(e=>{T({fullDataFormatter:a.fullDataFormatter$,gridAxesSize:a.gridAxesSize$,computedData:a.computedData$}).pipe($(u),S(async r=>r)).subscribe(r=>{const c=r.computedData[0]?r.computedData[0].length-1:0,m=r.fullDataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-r.fullDataFormatter.grid.groupAxis.scalePadding:r.fullDataFormatter.grid.groupAxis.scaleDomain[0]-r.fullDataFormatter.grid.groupAxis.scalePadding,p=r.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?c+r.fullDataFormatter.grid.groupAxis.scalePadding:r.fullDataFormatter.grid.groupAxis.scaleDomain[1]+r.fullDataFormatter.grid.groupAxis.scalePadding,y=r.computedData[0]?r.computedData[0].length:0;let d=r.fullDataFormatter.grid.gridData.seriesDirection==="row"?(r.computedData[0]??[]).map(A=>A.groupLabel):r.computedData.map(A=>A[0].groupLabel);const D=new Array(y).fill(0).map((A,L)=>d[L]!=null?d[L]:String(L)).filter((A,L)=>L>=m&&L<=p),k=r.fullDataFormatter.grid.groupAxis.scalePadding,U=Q({axisLabels:D,axisWidth:r.gridAxesSize.width,padding:k});e.next(U)})}),i=Y({fullDataFormatter$:a.fullDataFormatter$,gridAxesSize$:a.gridAxesSize$,computedData$:a.computedData$,fullChartParams$:a.fullChartParams$}),g=a.fullChartParams$.pipe($(u),E(e=>e.highlightTarget),C());return T({computedData:a.computedData$,gridAxesSize:a.gridAxesSize$,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,highlightTarget:g,SeriesDataMap:a.SeriesDataMap$,GroupDataMap:a.GroupDataMap$,gridGroupPositionFn:i,groupScale:h}).pipe($(u),S(async e=>e)).subscribe(e=>{s.on("mouseover",(r,f)=>{const{groupIndex:c,groupLabel:m}=e.gridGroupPositionFn(r);o.event$.next({type:"grid",pluginName:n,eventName:"mouseover",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(m)??[],groupIndex:c,groupLabel:m,event:r,data:e.computedData})}).on("mousemove",(r,f)=>{const{groupIndex:c,groupLabel:m}=e.gridGroupPositionFn(r);o.event$.next({type:"grid",pluginName:n,eventName:"mousemove",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(m)??[],groupIndex:c,groupLabel:m,event:r,data:e.computedData})}).on("mouseout",(r,f)=>{const{groupIndex:c,groupLabel:m}=e.gridGroupPositionFn(r);o.event$.next({type:"grid",pluginName:n,eventName:"mouseout",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(m)??[],groupIndex:c,groupLabel:m,event:r,data:e.computedData})}).on("click",(r,f)=>{r.stopPropagation();const{groupIndex:c,groupLabel:m}=e.gridGroupPositionFn(r);o.event$.next({type:"grid",pluginName:n,eventName:"click",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.GroupDataMap.get(m)??[],groupIndex:c,groupLabel:m,event:r,data:e.computedData})})}),T({event:o.event$.pipe(Z(e=>e.eventName==="mouseover"||e.eventName==="mousemove")),computedData:a.computedData$,groupScale:h,gridAxesSize:a.gridAxesSize$,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,highlightTarget:g,gridAxesReverseTransform:a.gridAxesReverseTransform$,GroupDataMap:a.GroupDataMap$,gridGroupPositionFn:i,textSizePx:a.textSizePx$}).pipe($(u),S(async e=>e)).subscribe(e=>{const r=e.groupScale(e.event.groupLabel)??0,f=oe({groupLabel:e.event.groupLabel,axisX:r,axisHeight:e.gridAxesSize.height,fullParams:e.fullParams});se({selection:l,pluginName:n,lineData:f,fullParams:e.fullParams,fullChartParams:e.fullChartParams});const c=ue({groupLabel:e.event.groupLabel,axisX:r,fullParams:e.fullParams});ge({selection:l,labelData:c,fullParams:e.fullParams,fullChartParams:e.fullChartParams,gridAxesReverseTransformValue:e.gridAxesReverseTransform.value,textSizePx:e.textSizePx}).on("mouseover",(p,y)=>{const{groupIndex:d,groupLabel:D}=e.gridGroupPositionFn(p);o.event$.next({type:"grid",pluginName:n,eventName:"mouseover",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:d,groupLabel:D,event:p,data:e.computedData})}).on("mousemove",(p,y)=>{const{groupIndex:d,groupLabel:D}=e.gridGroupPositionFn(p);o.event$.next({type:"grid",pluginName:n,eventName:"mousemove",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:d,groupLabel:D,event:p,data:e.computedData})}).on("mouseout",(p,y)=>{const{groupIndex:d,groupLabel:D}=e.gridGroupPositionFn(p);o.event$.next({type:"grid",pluginName:n,eventName:"mouseout",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:d,groupLabel:D,event:p,data:e.computedData})}).on("click",(p,y)=>{const{groupIndex:d,groupLabel:D}=e.gridGroupPositionFn(p);o.event$.next({type:"grid",pluginName:n,eventName:"click",highlightTarget:e.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:e.event.groups,groupIndex:d,groupLabel:D,event:p,data:e.computedData})})}),ie(x,"mouseout").pipe($(u)).subscribe(e=>{console.log("rootMouseout"),le(l),pe(l)}),()=>{u.next(void 0),x.remove()}}),De=[[55,80,50,11,150],[35,40,15,65,120],[75,90,600,50,120],[50,60,445,80,110]];export{fe as G,De as g};
