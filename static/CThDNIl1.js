import{O as w,f as oe,S as B,t as l,m as b,b as $,c as u,s as x,a as G,d as ne}from"./B0ZHf31c.js";import{h as pe}from"./DktEquOg.js";import{e as ce,a as ge,g as le}from"./DTR3OuCX.js";import{a as he}from"./Scc6E3Yy.js";function ue(t){return new w(function(p){oe(t()).subscribe(p)})}function me(t,p,i){return ue(function(){return t()?p:i})}const j=.3;function de({axisWidth:t,groupAmount:p,barGroupPadding:i=0}){const h=t/(p-1)-i;return h>1?h:1}function be(t,p){return t<=1?0:p/(t-1)*j}function xe(t,p){return t<=1?p:p*(1-j)}function De({graphicGSelection:t,rectClassName:p,barData:i,zeroY:s,groupLabels:h,params:g,chartParams:M,barWidth:f,transformedBarRadius:A,delayGroup:y,transitionItem:I,isSeriesPositionSeprate:W}){const R=f/2;return t.each((z,L,P)=>{G(P[L]).selectAll(`rect.${p}`).data(i[L]??[],o=>o.id).join(o=>o.append("rect").classed(p,!0).attr("cursor","pointer").attr("height",c=>0),o=>o,o=>o.remove()).attr("transform",(o,c)=>`translate(${(o?o.axisX:0)-R}, 0)`).attr("fill",o=>o.color).attr("y",o=>s).attr("x",o=>0).attr("width",f).attr("rx",A[L][0]??1).attr("ry",A[L][1]??1).transition().duration(I).ease(ge(M.transitionEase)).delay((o,c)=>o.groupIndex*y).attr("y",o=>o._barStartY).attr("height",o=>Math.abs(o._barHeight))}),t.selectAll(`rect.${p}`)}function Se({defsSelection:t,clipPathData:p}){t.selectAll("clipPath").data(p).join(i=>i.append("clipPath"),i=>i,i=>i.remove()).attr("id",i=>i.id).each((i,s,h)=>{G(h[s]).selectAll("rect").data([i]).join(g=>g.append("rect"),g=>g,g=>g.remove()).attr("x",0).attr("y",0).attr("width",g=>g.width).attr("height",g=>g.height)})}function fe({selection:t,ids:p,fullChartParams:i}){if(t.interrupt("highlight"),!p.length){t.transition("highlight").duration(200).style("opacity",1);return}t.each((s,h,g)=>{p.includes(s.id)?G(g[h]).style("opacity",1):G(g[h]).style("opacity",i.styles.unhighlightedOpacity)})}const ye=(t,{selection:p,computedData$:i,visibleComputedData$:s,existedSeriesLabels$:h,SeriesDataMap$:g,GroupDataMap$:M,fullParams$:f,fullDataFormatter$:A,fullChartParams$:y,gridAxesTransform$:I,gridGraphicTransform$:W,gridGraphicReverseScale$:R,gridAxesSize$:Y,gridHighlight$:z,gridContainer$:L,isSeriesPositionSeprate$:P,event$:o})=>{const c=new B,k=ce(t,"clipPath-box"),U=le(t,"rect"),{seriesSelection$:Le,axesSelection$:$e,defsSelection$:v,graphicGSelection$:K}=he({selection:p,pluginName:t,clipPathID:k,existedSeriesLabels$:h,gridContainer$:L,gridAxesTransform$:I,gridGraphicTransform$:W}),F=s.pipe(l(c),b(e=>e[0]&&e[0][0]?e[0][0].axisY-e[0][0].axisYFromZero:0),$()),_=u({computedData:i,params:f,axisSize:Y,isSeriesPositionSeprate:P}).pipe(l(c),x(async e=>e),b(e=>e.params.barWidth?e.params.barWidth:de({axisWidth:e.axisSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barGroupPadding:e.params.barGroupPadding})),$()),X=u({computedData:i,barWidth:_,params:f,gridGraphicReverseScale:R}).pipe(l(c),x(async e=>e),b(e=>{const a=e.barWidth/2,n=e.params.barRadius===!0?a:e.params.barRadius===!1?0:typeof e.params.barRadius=="number"?e.params.barRadius:0;return e.computedData.map((r,D)=>{const m=e.gridGraphicReverseScale[D]??e.gridGraphicReverseScale[0],S=n*m[0],d=n*m[1];return[S,d]})})),T=s.pipe(l(c),b(e=>{const a=new Set;return e.forEach(n=>{n.forEach(r=>{a.add(r.groupLabel)})}),Array.from(a)})),C=y.pipe(l(c),b(e=>e.transitionDuration),$()),q=new w(e=>{u({groupLabels:T,transitionDuration:C}).pipe(x(async a=>a)).subscribe(a=>{const n=be(a.groupLabels.length,a.transitionDuration);e.next(n)})}).pipe(l(c),$()),J=new w(e=>{u({groupLabels:T,transitionDuration:C}).pipe(x(async a=>a)).subscribe(a=>{const n=xe(a.groupLabels.length,a.transitionDuration);e.next(n)})}).pipe(l(c),$()),Q=u({computedData:i,dataFormatter:A}).pipe(l(c),x(async e=>e),b(e=>{const n=e.computedData[0]?e.computedData[0].length-1:0,r=e.dataFormatter.grid.groupAxis.scaleDomain[0]==="auto"?0-e.dataFormatter.grid.groupAxis.scalePadding:e.dataFormatter.grid.groupAxis.scaleDomain[0]-e.dataFormatter.grid.groupAxis.scalePadding,D=e.dataFormatter.grid.groupAxis.scaleDomain[1]==="auto"?n+e.dataFormatter.grid.groupAxis.scalePadding:e.dataFormatter.grid.groupAxis.scaleDomain[1]+e.dataFormatter.grid.groupAxis.scalePadding,m=e.computedData.map(S=>S.filter((d,E)=>d.groupIndex>=r&&d.groupIndex<=D));if(m.length<=1)return 1;{const S=m.flat().map(O=>O.axisYFromZero),d=Math.max(...S),E=e.computedData[0]?e.computedData[0].map((O,ae)=>e.computedData.reduce((ie,se)=>ie+se[ae].axisYFromZero,0)):[],te=Math.max(...E);return d/te}})),V=u({computedData:i,yRatio:Q,zeroY:F}).pipe(l(c),b(e=>{let a=e.computedData[0]?e.computedData[0].map(()=>e.zeroY):[];return e.computedData.map((n,r)=>n.map((D,m)=>{const S=a[m],d=D.axisYFromZero*e.yRatio;return a[m]=a[m]+d,{...D,_barStartY:S,_barHeight:d}}))})),N=u({computedData:i,zeroY:F}).pipe(l(c),b(e=>e.computedData.map((a,n)=>a.map((r,D)=>({...r,_barStartY:e.zeroY,_barHeight:r.axisYFromZero}))))),ee=P.pipe(x(e=>me(()=>e,N,V)));u({defsSelection:v,gridAxesSize:Y}).pipe(l(c),x(async e=>e)).subscribe(e=>{const a=[{id:k,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];Se({defsSelection:e.defsSelection,clipPathData:a})});const re=y.pipe(l(c),b(e=>e.highlightTarget),$()),H=new B;return u({graphicGSelection:K,graphicData:ee,zeroY:F,groupLabels:T,params:f,chartParams:y,highlightTarget:re,barWidth:_,transformedBarRadius:X,delayGroup:q,transitionItem:J,SeriesDataMap:g,GroupDataMap:M,isSeriesPositionSeprate:P}).pipe(l(c),x(async e=>e)).subscribe(e=>{const a=De({graphicGSelection:e.graphicGSelection,rectClassName:U,barData:e.graphicData,zeroY:e.zeroY,groupLabels:e.groupLabels,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,transformedBarRadius:e.transformedBarRadius,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesPositionSeprate:e.isSeriesPositionSeprate});a.on("mouseover",(n,r)=>{n.stopPropagation(),o.next({type:"grid",eventName:"mouseover",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:n,data:e.graphicData})}).on("mousemove",(n,r)=>{n.stopPropagation(),o.next({type:"grid",eventName:"mousemove",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:n,data:e.graphicData})}).on("mouseout",(n,r)=>{n.stopPropagation(),o.next({type:"grid",eventName:"mouseout",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:n,data:e.graphicData})}).on("click",(n,r)=>{n.stopPropagation(),o.next({type:"grid",eventName:"click",pluginName:t,highlightTarget:e.highlightTarget,datum:r,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,groups:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:n,data:e.graphicData})}),H.next(a)}),u({barSelection:H,highlight:z,fullChartParams:y}).pipe(l(c),x(async e=>e)).subscribe(e=>{fe({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{c.next(void 0)}},Z="BarStack",Ie=ne(Z,pe)(({selection:t,name:p,subject:i,observer:s})=>{const h=new B,g=ye(Z,{selection:t,computedData$:s.computedData$,visibleComputedData$:s.visibleComputedData$,existedSeriesLabels$:s.existedSeriesLabels$,SeriesDataMap$:s.SeriesDataMap$,GroupDataMap$:s.GroupDataMap$,fullParams$:s.fullParams$,fullDataFormatter$:s.fullDataFormatter$,fullChartParams$:s.fullChartParams$,gridAxesTransform$:s.gridAxesTransform$,gridGraphicTransform$:s.gridGraphicTransform$,gridGraphicReverseScale$:s.gridGraphicReverseScale$,gridAxesSize$:s.gridAxesSize$,gridHighlight$:s.gridHighlight$,gridContainer$:s.gridContainer$,isSeriesPositionSeprate$:s.isSeriesPositionSeprate$,event$:i.event$});return()=>{h.next(void 0),g()}});export{Ie as B,ye as c,me as i};
