import{O as Y,X as w,L as z,M as I,m as P,W as X,Y as j,ac as E,af as H,ad as L,ag as W,ah as D,S as G,t as g,ai as U,c as C,b}from"./Bj-Bl9V3.js";import{g as S,u as V,v as F,h as T}from"./wVpfmAyl.js";import{f as A}from"./CLcyYSDM.js";var q=new Y(function(r){return r.complete()});function B(r,e,l,i,n,s,a,v){var u=[],c=0,y=0,f=!1,x=function(){f&&!u.length&&!c&&e.complete()},p=function(t){return c<i?d(t):u.push(t)},d=function(t){c++;var h=!1;z(l(t,y++)).subscribe(w(e,function(m){e.next(m)},function(){h=!0},void 0,function(){if(h)try{c--;for(var m=function(){var $=u.shift();a||d($)};u.length&&c<i;)m();x()}catch($){e.error($)}}))};return r.subscribe(w(e,p,function(){f=!0,x()})),function(){}}function R(r,e,l){return l===void 0&&(l=1/0),I(e)?R(function(i,n){return P(function(s,a){return e(i,s,n,a)})(z(r(i,n)))},l):(typeof e=="number"&&(l=e),X(function(i,n){return B(i,n,r,l)}))}function J(r){return r===void 0&&(r=1/0),R(j,r)}function O(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var l=E(r),i=H(r,1/0),n=r;return n.length?n.length===1?z(n[0]):J(i)(L(n,l)):q}const k="Tooltip",M=S(k,"g"),K=S(k,"box");function Q(r,e){const l=e.textSizePx*1.5;return r.filter(i=>i!="").map((i,n)=>{const s=n*l;return`<text font-size="${e.textSize}" fill="${e.textColor}" x="0" y="${s}" style="dominant-baseline:text-before-edge">${i}</text>`}).join()}function Z({rootSelection:r,pluginName:e,rootWidth:l,rootHeight:i,svgString:n,tooltipStyle:s,event:a}){r.interrupt("fadeout");const v=5,u=n?[n]:[],c=n?[s]:[],f=r.selectAll(`g.${M}`).data(u).join(o=>o.append("g").classed(M,!0).attr("pointer-events","none"),o=>o,o=>o.style("opacity",0).remove()).attr("transform",()=>`translate(${a.offsetX}, ${a.offsetY})`).selectAll(`g.${K}`).data(c).join(o=>o.append("g").classed(S(e,"box"),!0)),x=f.selectAll("rect").data(c).join(o=>o.append("rect").attr("rx",v).attr("ry",v)).attr("fill",o=>o.backgroundColor).attr("stroke",o=>o.strokeColor).attr("opacity",o=>o.backgroundOpacity),p=f.selectAll("g").data(u).join(o=>o.append("g").classed(S(e,"content"),!0).attr("transform",()=>`translate(${s.padding}, ${s.padding})`));u.length&&V(p,u[0]);const d=p!=null&&p.node()?F(p):{width:0,height:0};x.attr("width",d.width+s.padding*2).attr("height",d.height+s.padding*2);const t=f!=null&&f.node()?F(f):{width:0,height:0},h=l-t.width,m=i-t.height,$=a.offsetX+s.offset[0]>h?h-a.offsetX:s.offset[0],N=a.offsetY+s.offset[1]>m?m-a.offsetY:s.offset[1];f.attr("transform",o=>`translate(${$}, ${N})`),f.attr("transform",o=>`translate(${$}, ${N})`)}const rt=W(k,D)(({selection:r,rootSelection:e,name:l,chartType:i,observer:n,subject:s})=>{const a=new G,v=s.event$.pipe(g(a),A(t=>t.eventName==="mouseover"||t.eventName==="mousemove")),u=s.event$.pipe(g(a),A(t=>t.eventName==="mouseout")),c=U(n.fullChartParams$),y=C({fullChartParams:n.fullChartParams$,fullParams:n.fullParams$,textSizePx:c}).pipe(g(a),b(async t=>t),P(t=>({backgroundColor:T(t.fullParams.backgroundColorType,t.fullChartParams),backgroundOpacity:t.fullParams.backgroundOpacity,strokeColor:T(t.fullParams.strokeColorType,t.fullChartParams),offset:t.fullParams.offset,padding:t.fullParams.padding,textSize:t.fullChartParams.styles.textSize,textSizePx:t.textSizePx,textColor:T(t.fullParams.textColorType,t.fullChartParams)}))),f=C({fullParams:n.fullParams$,tooltipStyle:y}).pipe(g(a),b(async t=>t),P(t=>t.fullParams.svgRenderFn?t.fullParams.svgRenderFn:h=>{const m=t.fullParams.textRenderFn(h);return Q(m,t.tooltipStyle)})),x=C({event:v,contentRenderFn:f}).pipe(g(a),b(async t=>t),P(t=>t.contentRenderFn(t.event))),p=u.pipe(g(a),P(t=>"")),d=O(v,u).pipe(g(a),P(t=>t.event));return C({svgString:O(x,p),event:d,layout:n.layout$,tooltipStyle:y}).pipe(g(a),b(async t=>t)).subscribe(t=>{Z({rootSelection:e,pluginName:l,rootWidth:t.layout.rootWidth,rootHeight:t.layout.rootHeight,svgString:t.svgString,tooltipStyle:t.tooltipStyle,event:t.event})}),function(){a.next(void 0)}});export{q as E,rt as T,O as a,R as m};
