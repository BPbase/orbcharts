import{at as k,az as re,aS as se,ax as ne,aE as R,aH as F,aC as H,aD as q,aT as le,aL as oe,aB as A,aN as ue,aI as ce,aO as he,aU as pe,ap as O,S as x,t as S,m as y,d as D,a as L,j as C,k as P,aV as ge,x as me,L as z,aW as fe,s as T,aX as j,aY as G,aZ as de,a_ as be,a$ as Se,b0 as $e,b1 as ye,b2 as Pe,r as B,b3 as Ce,b4 as De,b5 as xe,g as w,a2 as Te,ar as N,b6 as X,a1 as Ae,aq as K,b7 as ee,a9 as Le,b8 as ve,b9 as Re,ba as we,bb as te,a8 as Be,ab as Me,aQ as Ye}from"./CUAujy1K.js";import{o as Oe}from"./DXMUCJyL.js";import{c as Ne}from"./CiHcmOf_.js";const Xe=u=>{const e=k(u,{visibleFilter:{toBeTypes:["Function"]},sort:{toBeTypes:["Function","null"]},seriesLabels:{toBeTypes:["string[]"]},container:{toBeTypes:["object"]},separateSeries:{toBeTypes:["boolean"]},sumSeries:{toBeTypes:["boolean"]}});if(u.container){const i=k(u.container,{columnAmount:{toBeTypes:["number"]},rowAmount:{toBeTypes:["number"]},columnGap:{toBe:'"auto" | number',test:o=>o==="auto"||typeof o=="number"},rowGap:{toBe:'"auto" | number',test:o=>o==="auto"||typeof o=="number"}});if(i.status==="error")return i}return e},Fe=u=>{const{data:e=[],dataFormatter:i,chartParams:o}=u;if(!e.length)return[];let r=[];try{const a=(t,n,l,c)=>{const g=re(i.type,n,l),h=i.seriesLabels[n]||se("series",n),f=ne(n,o);return typeof t=="number"?{id:g,index:c,seq:0,label:g,description:"",data:{},value:t,seriesIndex:n,seriesLabel:h,color:f,visible:!0}:{id:t.id?t.id:g,index:c,seq:0,label:t.label?t.label:g,description:t.description,data:t.data??{},value:t.value,seriesIndex:n,seriesLabel:h,color:f,visible:!0}};r=e.map((t,n)=>Array.isArray(t)?t.map((l,c)=>a(l,n,c,r.length+c)):a(t,n,0,r.length)).flat().sort(i.sort??void 0).map((t,n)=>(t.seq=n,t)).map(t=>(t.visible=i.visibleFilter(t,u),t)).sort((t,n)=>t.index-n.index).reduce((t,n)=>(t[n.seriesIndex]||(t[n.seriesIndex]=[]),t[n.seriesIndex].push(n),t),[])}catch(a){throw Error(a)}return r},Ee=u=>k({data:u},{data:{toBe:"(DataSeriesDatum | DataSeriesValue)[][] | (DataSeriesDatum | DataSeriesValue)[]",test:i=>Array.isArray(i)}}),We=({computedData$:u})=>{const e=new Set;return u.pipe(R(i=>(i.forEach(o=>{o.forEach(r=>{e.add(r.label)})}),Array.from(e))))},ke=({fullDataFormatter$:u})=>u.pipe(R(e=>e.separateSeries),F()),Ie=({fullDataFormatter$:u})=>u.pipe(R(e=>e.separateLabel),F()),Ve=({fullDataFormatter$:u})=>u.pipe(R(e=>e.sumSeries),F()),_e=({computedData$:u})=>u.pipe(R(e=>e.filter(i=>i.length).map(i=>i[0].seriesLabel)),F((e,i)=>JSON.stringify(e)===JSON.stringify(i))),He=({computedData$:u})=>u.pipe(R(e=>e.map(i=>i.filter(o=>o.visible!=!1)))),qe=({computedData$:u,separateSeries$:e,separateLabel$:i,sumSeries$:o,datumLabels$:r})=>H({computedData:u,separateSeries:e,separateLabel:i,sumSeries:o,datumLabels:r}).pipe(q(async a=>a),R(a=>{const t=a.sumSeries==!0?a.computedData.map(c=>[c.reduce((g,h)=>g==null?h:(g.value=g.value+h.value,g),null)]):a.computedData,n=a.separateSeries==!0?t:[t.flat()],l=a.separateLabel==!0?(()=>{const c=a.datumLabels.reduce((g,h,f)=>(g[h]=f,g),{});return n.map(g=>g.reduce((h,f)=>{const s=c[f.label];return h[s]==null&&(h[s]=[]),h[s].push(f),h},[])).flat()})():n;return a.separateSeries==!0&&a.separateLabel==!0?l.sort((c,g)=>c[0].seq-g[0].seq):l.map(c=>c.sort((g,h)=>g.seq-h.seq))})),ze=({computedSortedData$:u,fullDataFormatter$:e,layout$:i})=>H({computedSortedData:u,fullDataFormatter:e,layout:i}).pipe(q(async r=>r),R(r=>{const a=r.computedSortedData.length;return le(r.layout,r.fullDataFormatter.container,a)})),je=({seriesContainerPosition$:u,computedSortedData$:e})=>H({seriesContainerPosition:u,computedSortedData:e}).pipe(q(async i=>i),R(i=>new Map(i.computedSortedData.map((o,r)=>o.map(a=>[a.id,i.seriesContainerPosition[r]])).flat()))),Ge=({subject:u,observer:e})=>{const i=oe(e.fullChartParams$).pipe(A(1)),o=We({computedData$:e.computedData$}).pipe(A(1)),r=ke({fullDataFormatter$:e.fullDataFormatter$}).pipe(A(1)),a=Ie({fullDataFormatter$:e.fullDataFormatter$}).pipe(A(1)),t=Ve({fullDataFormatter$:e.fullDataFormatter$}).pipe(A(1)),n=qe({computedData$:e.computedData$,separateSeries$:r,separateLabel$:a,sumSeries$:t,datumLabels$:o}).pipe(A(1)),l=He({computedData$:n}).pipe(A(1)),c=e.computedData$.pipe(R(b=>b.flat())).pipe(A(1)),g=ue({datumList$:c,fullChartParams$:e.fullChartParams$,event$:u.event$}).pipe(A(1)),h=_e({computedData$:e.computedData$}).pipe(A(1)),f=ce({datumList$:c}).pipe(A(1)),s=ze({computedSortedData$:n,fullDataFormatter$:e.fullDataFormatter$,layout$:e.layout$}).pipe(A(1)),p=je({seriesContainerPosition$:s,computedSortedData$:n}).pipe(A(1));return{fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,fullDataFormatter$:e.fullDataFormatter$,computedData$:e.computedData$,layout$:e.layout$,textSizePx$:i,visibleComputedSortedData$:l,separateSeries$:r,separateLabel$:a,sumSeries$:t,computedSortedData$:n,seriesHighlight$:g,seriesLabels$:h,SeriesDataMap$:f,seriesContainerPosition$:s,DatumContainerPositionMap$:p}};class Xt extends he{constructor(e,i){super({defaultDataFormatter:pe,dataFormatterValidator:Xe,computedDataFn:Fe,dataValidator:Ee,contextObserverCallback:Ge},e,i)}}const Je="Bubbles",J=12,Ue={name:Je,defaultParams:me,layerIndex:z,validator:(u,{validateColumns:e})=>{const i=e(u,{force:{toBeTypes:["object"]},bubbleLabel:{toBeTypes:["object"]},arcScaleType:{toBe:'"area" | "radius"',test:o=>o==="area"||o==="radius"}});if(u.force){const o=e(u.force,{velocityDecay:{toBeTypes:["number"]},collisionSpacing:{toBeTypes:["number"]},strength:{toBeTypes:["number"]}});if(o.status==="error")return o}if(u.bubbleLabel){const o=e(u.bubbleLabel,{labelFn:{toBeTypes:["Function"]},colorType:{toBeOption:"ColorType"},fillRate:{toBeTypes:["number"]},lineHeight:{toBeTypes:["number"]},maxLineLength:{toBeTypes:["number"]}});if(o.status==="error")return o}return i}};function Qe(u,e){return Se().velocityDecay(e.force.velocityDecay).force("collision",$e().radius(i=>i.r+e.force.collisionSpacing)).force("charge",ye().strength(i=>-Math.pow(i.r,2)*e.force.strength)).on("tick",()=>{u.attr("transform",i=>`translate(${i.x},${i.y})`)})}function Ze({selection:u,bubblesData:e,fullParams:i,fullChartParams:o}){const r=u.selectAll("g").data(e,a=>a.id).join(a=>{const t=a.append("g").attr("cursor","pointer").attr("font-size",J).style("fill","#ffffff").attr("text-anchor","middle");return t.append("circle").attr("class","node").attr("cx",0).attr("cy",0).attr("fill",n=>n.color),t.append("text").style("opacity",.8).attr("pointer-events","none"),t},a=>a,a=>a.remove()).attr("transform",a=>`translate(${a.x},${a.y})`);return r.select("circle").transition().duration(200).attr("r",a=>a.r).attr("fill",a=>a.color),r.each((a,t,n)=>{const l=T(n[t]),c=a.renderLabel;l.call(Pe,{text:c,radius:a.r*i.bubbleLabel.fillRate,lineHeight:J*i.bubbleLabel.lineHeight,isBreakAll:c.length<=i.bubbleLabel.maxLineLength?!1:i.bubbleLabel.wordBreakAll}),l.select("text").attr("fill",g=>B({datum:a,colorType:i.bubbleLabel.colorType,fullChartParams:o}))}),r}function Ke(u){return fe().on("start",(e,i)=>{e.active||u.alpha(1).restart(),i.fx=i.x,i.fy=i.y}).on("drag",(e,i)=>{e.active||u.alphaTarget(0),i.fx=e.x,i.fy=e.y}).on("end",(e,i)=>{i.fx=null,i.fy=null,u.alpha(1).restart()})}function et({_simulation:u,fullParams:e,DatumContainerPositionMap:i}){u.force("x",Ce().strength(e.force.strength).x(o=>{let r=i.get(o.id);return r||(r=i.get(Array.from(i.keys())[0])),(r==null?void 0:r.centerX)??null})).force("y",De().strength(e.force.strength).y(o=>{let r=i.get(o.id);return r||(r=i.get(Array.from(i.keys())[0])),(r==null?void 0:r.centerY)??null}))}function tt({bubblesSelection:u,highlightIds:e,fullChartParams:i}){if(u.interrupt("highlight"),!e.length){u.transition("highlight").style("opacity",1);return}u.each((o,r,a)=>{const t=T(a[r]);e.includes(o.id)?t.style("opacity",1).transition("highlight").ease(j).duration(500):t.style("opacity",i.styles.unhighlightedOpacity)})}const Ft=O(Ue)(({selection:u,name:e,observer:i,subject:o})=>{const r=new x;let a;const t=i.fullParams$.pipe(S(r),y(m=>m.arcScaleType),D(),L(1)),n=i.layout$.pipe(S(r),y(m=>Math.min(m.width,m.height)/2),D(),L(1)),l=i.visibleComputedSortedData$.pipe(S(r),y(m=>m.flat().reduce(($,d)=>$+d.value,0)),D(),L(1)),c=C({totalR:n,totalValue:l,scaleType:t}).pipe(S(r),P(async m=>m),y(m=>G().domain([0,m.totalValue]).range([0,m.totalR]).exponent(m.scaleType==="area"?.5:1)),L(1)),g=t.pipe(S(r),P(m=>de(()=>m==="area",Oe(1),C({totalR:n,radiusScale:c,visibleComputedSortedData:i.visibleComputedSortedData$}).pipe(P(async $=>$),y($=>{const d=$.totalR*$.totalR*Math.PI;return Math.sqrt(d/be($.visibleComputedSortedData.flat(),v=>Math.PI*Math.pow($.radiusScale(v.value),2)))}))))),h=C({visibleComputedSortedData:i.visibleComputedSortedData$,radiusScale:c,scaleFactor:g}).pipe(S(r),P(async m=>m),y(m=>new Map(m.visibleComputedSortedData.flat().map(d=>[d.id,m.radiusScale(d.value??0)*m.scaleFactor*.9]))),L(1)),f=i.DatumContainerPositionMap$.pipe(S(r),y(m=>new Map(Array.from(m).map(([$,d])=>[$,{x:d.startX+d.width*Math.random(),y:d.startY+d.height*Math.random()}]))),ge(),L(1)),s=C({visibleComputedSortedData:i.visibleComputedSortedData$,DatumRMap:h,DatumInitXYMap:f,fullParams:i.fullParams$}).pipe(S(r),P(async m=>m),y(m=>m.visibleComputedSortedData.flat().map($=>{const d=$;if(d.x===void 0||d.y===void 0){let v=m.DatumInitXYMap.get(d.id);v||(v=m.DatumInitXYMap.get(Array.from(m.DatumInitXYMap.keys())[0])),d.x=v.x,d.y=v.y}return d.r=m.DatumRMap.get(d.id),d._originR=d.r,d.renderLabel=m.fullParams.bubbleLabel.labelFn(d),d})),L(1)),p=i.fullChartParams$.pipe(S(r),y(m=>m.highlightTarget),D()),b=C({bubblesData:s,fullParams:i.fullParams$,fullChartParams:i.fullChartParams$,DatumContainerPositionMap:i.DatumContainerPositionMap$}).pipe(S(r),P(async m=>m),y(m=>{a&&a.stop();const $=Ze({selection:u,bubblesData:m.bubblesData,fullParams:m.fullParams,fullChartParams:m.fullChartParams});return a=Qe($,m.fullParams),a.nodes(m.bubblesData),et({_simulation:a,fullParams:m.fullParams,DatumContainerPositionMap:m.DatumContainerPositionMap}),a.alpha(1).restart(),$}),L(1));return C({bubblesSelection:b,computedData:i.computedData$,SeriesDataMap:i.SeriesDataMap$,highlightTarget:p}).pipe(S(r),P(async m=>m)).subscribe(m=>{m.bubblesSelection.on("mouseover",($,d)=>{o.event$.next({type:"series",eventName:"mouseover",pluginName:e,highlightTarget:m.highlightTarget,datum:d,series:m.SeriesDataMap.get(d.seriesLabel),seriesIndex:d.seriesIndex,seriesLabel:d.seriesLabel,event:$,data:m.computedData})}).on("mousemove",($,d)=>{o.event$.next({type:"series",eventName:"mousemove",pluginName:e,highlightTarget:m.highlightTarget,datum:d,series:m.SeriesDataMap.get(d.seriesLabel),seriesIndex:d.seriesIndex,seriesLabel:d.seriesLabel,event:$,data:m.computedData})}).on("mouseout",($,d)=>{o.event$.next({type:"series",eventName:"mouseout",pluginName:e,highlightTarget:m.highlightTarget,datum:d,series:m.SeriesDataMap.get(d.seriesLabel),seriesIndex:d.seriesIndex,seriesLabel:d.seriesLabel,event:$,data:m.computedData})}).on("click",($,d)=>{o.event$.next({type:"series",eventName:"click",pluginName:e,highlightTarget:m.highlightTarget,datum:d,series:m.SeriesDataMap.get(d.seriesLabel),seriesIndex:d.seriesIndex,seriesLabel:d.seriesLabel,event:$,data:m.computedData})}).call(Ke(a))}),C({bubblesSelection:b,highlight:i.seriesHighlight$.pipe(y(m=>m.map($=>$.id))),fullChartParams:i.fullChartParams$}).pipe(S(r),P(async m=>m)).subscribe(m=>{tt({bubblesSelection:m.bubblesSelection,highlightIds:m.highlight,fullChartParams:m.fullChartParams})}),()=>{r.next(void 0),a&&(a.stop(),a=void 0)}});function ie({data:u,startAngle:e,endAngle:i}){return xe().startAngle(e).endAngle(i).value(a=>a.value).sort((a,t)=>a.seq-t.seq)(u).map((a,t)=>{let n=a;return n.id=a.data.id,n})}function it({selection:u,pluginName:e,visibleComputedSortedData$:i}){const o=w(e,"series");return i.pipe(y(r=>r.map(a=>a[0]?`${a[0].seriesLabel}_${a[0].label}`:"")),D((r,a)=>JSON.stringify(r)===JSON.stringify(a)),y(r=>u.selectAll(`g.${o}`).data(r,a=>a).join(a=>a.append("g").classed(o,!0),a=>a,a=>a.remove())),L(1))}const E=({selection:u,pluginName:e,visibleComputedSortedData$:i,seriesContainerPosition$:o})=>{const r=it({selection:u,pluginName:e,visibleComputedSortedData$:i});return C({seriesCenterSelection:r,seriesContainerPosition:o}).pipe(P(async a=>a),D((a,t)=>a.seriesContainerPosition.length===t.seriesContainerPosition.length)).subscribe(a=>{a.seriesCenterSelection.attr("transform",(t,n)=>{const l=a.seriesContainerPosition[n]??a.seriesContainerPosition[0];return`translate(${l.centerX}, ${l.centerY})`})}),C({seriesCenterSelection:r,seriesContainerPosition:o}).pipe(P(async a=>a)).subscribe(a=>{a.seriesCenterSelection.transition().attr("transform",(t,n)=>{const l=a.seriesContainerPosition[n]??a.seriesContainerPosition[0];return`translate(${l.centerX}, ${l.centerY})`})}),{seriesCenterSelection$:r}},I="Pie",at={name:I,defaultParams:Te,layerIndex:z,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},innerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeTypes:["string"]},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]}})};function rt({enter:u,exit:e,data:i,lastTweenData:o,fullParams:r}){return!u.size()&&!e.size()?a=>{const t=i.map((n,l)=>{const c=o[l]??{startAngle:0,endAngle:0,value:0};return{...n,startAngle:n.startAngle*a+c.startAngle*(1-a),endAngle:n.endAngle*a+c.endAngle*(1-a),value:n.value*a+c.value*(1-a)}});return V(t,r.startAngle,r.endAngle,1)}:a=>V(i,r.startAngle,r.endAngle,a)}function V(u,e,i,o){return u.map((r,a)=>{const t=e+(r.startAngle-e)*o,n=t+(r.endAngle-r.startAngle)*o;return{...r,startAngle:t,endAngle:n}})}function U({selection:u,data:e,arc:i,pathClassName:o,fullParams:r,fullChartParams:a}){return u.selectAll("path").data(e,n=>n.id).join("path").classed(o,!0).style("cursor","pointer").attr("fill",(n,l)=>n.data.color).attr("stroke",(n,l)=>B({datum:n.data,colorType:r.strokeColorType,fullChartParams:a})).attr("stroke-width",r.strokeWidth).attr("d",(n,l)=>i(n))}function st({pathSelection:u,ids:e,fullChartParams:i,arc:o,arcHighlight:r}){if(u.interrupt("highlight"),!e.length){u.transition("highlight").style("opacity",1).attr("d",a=>o(a));return}u.each((a,t,n)=>{const l=T(n[t]);e.includes(a.data.id)?l.style("opacity",1).transition("highlight").ease(j).duration(500).attr("d",c=>r(c)):l.style("opacity",i.styles.unhighlightedOpacity).transition("highlight").attr("d",c=>o(c))})}function nt(u,e){const i=new x,o=w(u,"path");let r=[],a=[];const t=e.seriesContainerPosition$.pipe(S(i),y(f=>f.width<f.height?f.width:f.height),D()),n=new N(f=>{C({containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$}).pipe(S(i),P(async s=>s)).subscribe(s=>{const p=ie({data:s.containerVisibleComputedSortedData,startAngle:s.fullParams.startAngle,endAngle:s.fullParams.endAngle});f.next(p)})}),l=new N(f=>{C({shorterSideWith:t,fullParams:e.fullParams$}).pipe(S(i),P(async s=>s)).subscribe(s=>{const p=X({axisWidth:s.shorterSideWith,innerRadius:s.fullParams.innerRadius,outerRadius:s.fullParams.outerRadius,padAngle:s.fullParams.padAngle,cornerRadius:s.fullParams.cornerRadius});f.next(p)})}),c=new N(f=>{C({shorterSideWith:t,fullParams:e.fullParams$}).pipe(S(i),P(async s=>s)).subscribe(s=>{const p=X({axisWidth:s.shorterSideWith,innerRadius:s.fullParams.innerRadius,outerRadius:s.fullParams.outerRadiusWhileHighlight,padAngle:s.fullParams.padAngle,cornerRadius:s.fullParams.cornerRadius});f.next(p)})}),g=e.fullChartParams$.pipe(S(i),y(f=>f.highlightTarget),D()),h=new N(f=>{C({pieData:n,arc:l,computedData:e.computedData$,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,highlightTarget:g}).pipe(S(i),P(async s=>s)).subscribe(s=>{e.containerSelection.interrupt("graphicMove");const p=e.containerSelection.selectAll("path").data(s.pieData,d=>d.id),b=p.enter(),m=p.exit(),$=rt({enter:b,exit:m,data:s.pieData,lastTweenData:r,fullParams:s.fullParams});e.containerSelection.transition("graphicMove").duration(s.fullChartParams.transitionDuration).tween("move",(d,v)=>W=>{a=$(W),U({selection:e.containerSelection,data:a,arc:s.arc,pathClassName:o,fullParams:s.fullParams,fullChartParams:s.fullChartParams})}).on("end",(d,v)=>{a=V(s.pieData,s.fullParams.startAngle,s.fullParams.endAngle,1);const W=U({selection:e.containerSelection,data:a,arc:s.arc,pathClassName:o,fullParams:s.fullParams,fullChartParams:s.fullChartParams});f.next(W),r=Object.assign([],s.pieData),e.event$.next({type:"series",pluginName:u,eventName:"transitionEnd",event:void 0,highlightTarget:s.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:s.computedData})})})}).pipe(L(1));return C({pathSelection:h,SeriesDataMap:e.SeriesDataMap$,computedData:e.computedData$,highlightTarget:g}).pipe(S(i),P(async f=>f)).subscribe(f=>{f.pathSelection.on("mouseover",(s,p)=>{s.stopPropagation(),e.event$.next({type:"series",eventName:"mouseover",pluginName:u,highlightTarget:f.highlightTarget,datum:p.data,series:f.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:s,data:f.computedData})}).on("mousemove",(s,p)=>{s.stopPropagation(),e.event$.next({type:"series",eventName:"mousemove",pluginName:u,highlightTarget:f.highlightTarget,datum:p.data,series:f.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:s,data:f.computedData})}).on("mouseout",(s,p)=>{s.stopPropagation(),e.event$.next({type:"series",eventName:"mouseout",pluginName:u,highlightTarget:f.highlightTarget,datum:p.data,series:f.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:s,data:f.computedData})}).on("click",(s,p)=>{s.stopPropagation(),e.event$.next({type:"series",eventName:"click",pluginName:u,highlightTarget:f.highlightTarget,datum:p.data,series:f.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:s,data:f.computedData})})}),C({pathSelection:h,highlight:e.seriesHighlight$.pipe(y(f=>f.map(s=>s.id))),fullChartParams:e.fullChartParams$,arc:l,arcHighlight:c}).pipe(S(i),P(async f=>f)).subscribe(f=>{st({pathSelection:f.pathSelection,ids:f.highlight,fullChartParams:f.fullChartParams,arc:f.arc,arcHighlight:f.arcHighlight})}),()=>{i.next(void 0)}}const Et=O(at)(({selection:u,name:e,subject:i,observer:o})=>{const r=new x,{seriesCenterSelection$:a}=E({selection:u,pluginName:I,visibleComputedSortedData$:o.visibleComputedSortedData$,seriesContainerPosition$:o.seriesContainerPosition$}),t=[];return a.pipe(S(r)).subscribe(n=>{t.forEach(l=>l()),n.each((l,c,g)=>{const h=T(g[c]),f=o.visibleComputedSortedData$.pipe(S(r),y(p=>p[c]??p[0])),s=o.seriesContainerPosition$.pipe(S(r),y(p=>p[c]??p[0]));t[c]=nt(I,{containerSelection:h,computedData$:o.computedData$,containerVisibleComputedSortedData$:f,SeriesDataMap$:o.SeriesDataMap$,fullParams$:o.fullParams$,fullChartParams$:o.fullChartParams$,seriesHighlight$:o.seriesHighlight$,seriesContainerPosition$:s,event$:i.event$})})}),()=>{r.next(void 0),t.forEach(n=>n())}}),M="PieLabels",lt=w(M,"label-g"),ot=w(M,"line-g"),ut=w(M,"text"),Q=2,ct={name:M,defaultParams:Ae,layerIndex:K,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},labelCentroid:{toBeTypes:["number"]},labelFn:{toBeTypes:["Function"]},labelColorType:{toBeOption:"ColorType"}})};function ht({pieData:u,arc:e,arcMouseover:i,labelCentroid:o,lineStartCentroid:r,fullParams:a}){return u.map((t,n)=>{const[l,c]=e.centroid(t),[g,h]=i.centroid(t),f=a.labelFn(t.data);return{pieDatum:t,arcIndex:n,arcLabels:f.split(`
`),lineStartX:l*r,lineStartY:c*r,lineStartMouseoverX:g*r,lineStartMouseoverY:h*r,x:l*o,y:c*o,mouseoverX:g*o,mouseoverY:h*o,textWidth:0,collisionShiftX:0,collisionShiftY:0,quadrant:l>=0&&c<=0?1:l<0&&c<=0?2:l<0&&c>0?3:4}}).filter(t=>t.pieDatum.data.visible)}function pt({labelGSelection:u,data:e,fullParams:i,fullChartParams:o,textSizePx:r}){const a=u.selectAll("text").data(e,t=>t.pieDatum.id).join("text").classed(ut,!0).attr("font-weight","bold").attr("text-anchor",t=>t.quadrant==1||t.quadrant==4?"start":"end").style("dominant-baseline",t=>t.quadrant==1||t.quadrant==2?"auto":"hanging").style("cursor",t=>o.highlightTarget&&o.highlightTarget!="none"?"pointer":"none").attr("font-size",o.styles.textSize).attr("x",0).attr("y",0).attr("fill",(t,n)=>B({datum:t.pieDatum.data,colorType:i.labelColorType,fullChartParams:o})).each((t,n,l)=>{ee(T(l[n]),{textArr:t.arcLabels,textSizePx:r,quadrant:t.quadrant})});return a.transition().attr("transform",t=>"translate("+t.x+","+t.y+")"),a}function gt(u,e,i){const o=u.nodes(),r=i,a=o.map((t,n)=>{const l=t.getBBox(),c=[e[n].x,e[n].y];return{node:t,x:c[0],y:c[1],width:l.width,height:l.height}});for(let t=0;t<a.length;t++){const n=a[t];for(let l=t+1;l<a.length;l++){const c=a[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,f=c.x+e[l].collisionShiftX,s=c.y+e[l].collisionShiftY;if(!(g+n.width/2<f-c.width/2||g-n.width/2>f+c.width/2||h+n.height/2<s-c.height/2||h-n.height/2>s+c.height/2)){if(e[l].quadrant==2){const p=s>h?-r*2:-r;e[l].collisionShiftY+=p}else if(e[l].quadrant==4){const p=s>h?r:r*2;e[l].collisionShiftY+=p}}}}for(let t=a.length-1;t>=0;t--){const n=a[t];for(let l=t-1;l>=0;l--){const c=a[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,f=c.x+e[l].collisionShiftX,s=c.y+e[l].collisionShiftY;if(!(g+n.width/2<f-c.width/2||g-n.width/2>f+c.width/2||h+n.height/2<s-c.height/2||h-n.height/2>s+c.height/2)){if(e[l].quadrant==1){const p=s>h?-r*2:-r;e[l].collisionShiftY+=p}else if(e[l].quadrant==3){const p=s>h?r:r*2;e[l].collisionShiftY+=p}}}}u.data(e).transition().attr("transform",t=>`translate(${t.x+t.collisionShiftX},${t.y+t.collisionShiftY})`)}function mt({lineGSelection:u,data:e,fullParams:i,fullChartParams:o}){const r=e.filter(t=>t.collisionShiftX||t.collisionShiftY),a=u.selectAll("polyline").data(r,t=>t.pieDatum.id).join("polyline").attr("stroke",t=>B({datum:t.pieDatum.data,colorType:i.labelColorType,fullChartParams:o})).attr("stroke-width",1).attr("fill","none").attr("points",t=>[[t.lineStartX,t.lineStartY],[t.lineStartX,t.lineStartY]]);return a.transition().attr("points",t=>{let n=t.x+t.collisionShiftX,l=t.y+t.collisionShiftY;return[[n,l],[t.lineStartX,t.lineStartY]]}),a}function ft({textSelection:u,lineSelection:e,ids:i,fullChartParams:o}){if(u.interrupt("highlight"),e.interrupt("highlight"),!i.length){u.transition("highlight").duration(200).attr("transform",r=>`translate(${r.x+r.collisionShiftX},${r.y+r.collisionShiftY})`).style("opacity",1),e.transition("highlight").duration(200).style("opacity",1);return}u.each((r,a,t)=>{const n=T(t[a]);i.includes(r.pieDatum.id)?n.style("opacity",1).transition("highlight").duration(200).attr("transform",l=>l.collisionShiftX||l.collisionShiftY?`translate(${l.x+l.collisionShiftX},${l.y+l.collisionShiftY})`:`translate(${l.mouseoverX+l.collisionShiftX},${l.mouseoverY+l.collisionShiftY})`):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200).attr("transform",l=>`translate(${l.x+l.collisionShiftX},${l.y+l.collisionShiftY})`)}),e.each((r,a,t)=>{const n=T(t[a]);i.includes(r.pieDatum.data.id)?n.style("opacity",1).transition("highlight").duration(200):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function dt(u,e){const i=new x;e.containerSelection.selectAll("g").remove();const o=e.containerSelection.append("g");o.classed(ot,!0);const r=e.containerSelection.append("g");r.classed(lt,!0);const a=new x,t=new x;let n=[];const l=e.seriesContainerPosition$.pipe(S(i),y(g=>g.width<g.height?g.width:g.height),D()),c=e.fullParams$.pipe(S(i),y(g=>g.labelCentroid>=Q?Q:g.labelCentroid));return C({shorterSideWith:l,containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,textSizePx:e.textSizePx$,lineStartCentroid:c}).pipe(S(i),P(async g=>g)).subscribe(g=>{const h=X({axisWidth:g.shorterSideWith,innerRadius:0,outerRadius:g.fullParams.outerRadius,padAngle:0,cornerRadius:0}),f=X({axisWidth:g.shorterSideWith,innerRadius:0,outerRadius:g.fullParams.outerRadiusWhileHighlight,padAngle:0,cornerRadius:0}),s=ie({data:g.containerVisibleComputedSortedData,startAngle:g.fullParams.startAngle,endAngle:g.fullParams.endAngle});n=ht({pieData:s,arc:h,arcMouseover:f,labelCentroid:g.fullParams.labelCentroid,lineStartCentroid:g.lineStartCentroid,fullParams:g.fullParams}),o.selectAll("polyline").remove();const p=pt({labelGSelection:r,data:n,fullParams:g.fullParams,fullChartParams:g.fullChartParams,textSizePx:g.textSizePx});setTimeout(()=>{gt(p,n,g.textSizePx);const b=mt({lineGSelection:o,data:n,fullParams:g.fullParams,fullChartParams:g.fullChartParams});t.next(b)},1e3),a.next(p)}),C({textSelection:a,lineSelection:t,highlight:e.seriesHighlight$.pipe(y(g=>g.map(h=>h.id))),fullChartParams:e.fullChartParams$}).pipe(S(i),P(async g=>g)).subscribe(g=>{ft({textSelection:g.textSelection,lineSelection:g.lineSelection,ids:g.highlight,fullChartParams:g.fullChartParams})}),()=>{i.next(void 0)}}const Wt=O(ct)(({selection:u,observer:e,subject:i})=>{const o=new x,{seriesCenterSelection$:r}=E({selection:u,pluginName:M,visibleComputedSortedData$:e.visibleComputedSortedData$,seriesContainerPosition$:e.seriesContainerPosition$}),a=[];return r.pipe(S(o)).subscribe(t=>{a.forEach(n=>n()),t.each((n,l,c)=>{const g=T(c[l]),h=e.visibleComputedSortedData$.pipe(S(o),y(s=>s[l]??s[0])),f=e.seriesContainerPosition$.pipe(S(o),y(s=>s[l]??s[0]));a[l]=dt(M,{containerSelection:g,containerVisibleComputedSortedData$:h,fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,textSizePx$:e.textSizePx$,seriesHighlight$:e.seriesHighlight$,seriesContainerPosition$:f,event$:i.event$})})}),()=>{o.next(void 0)}}),_="Rose",bt=Math.PI*2,St={name:_,defaultParams:Le,layerIndex:z,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeOption:"ColorType"},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]},arcScaleType:{toBe:'"area" | "radius"',test:o=>o==="area"||o==="radius"},angleIncreaseWhileHighlight:{toBeTypes:["number"]}})};function $t({cornerRadius:u,outerRadius:e,axisWidth:i,maxValue:o,arcScaleType:r,fullParams:a}){const t=i/2*e,n=r==="area"?.5:1,l=G().domain([0,o]).range([0,t]).exponent(n);return c=>{const g=l(c.prevValue),h=l(c.value),f=we(g,h);return s=>{const p=f(s);return te().innerRadius(0).outerRadius(p).padAngle(a.padAngle).padRadius(p).cornerRadius(u)(c)}}}function yt({pathSelection:u,ids:e,fullParams:i,fullChartParams:o,tweenArc:r}){if(u.interrupt("highlight"),!e.length){u.transition("highlight").style("opacity",1).attr("d",a=>r(a)(1));return}u.each((a,t,n)=>{const l=T(n[t]);e.includes(a.data.id)?l.style("opacity",1).transition("highlight").ease(j).duration(500).attr("d",c=>r({...c,startAngle:c.startAngle-i.angleIncreaseWhileHighlight,endAngle:c.endAngle+i.angleIncreaseWhileHighlight})(1)):l.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").attr("d",c=>r(c)(1))})}function Pt(u,e){const i=new x,o=w(u,"path");let r=[];const a=e.seriesContainerPosition$.pipe(S(i),y(s=>s.width<s.height?s.width:s.height),D()),t=C({containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$}).pipe(S(i),P(async s=>s),y(s=>{const p=bt/s.containerVisibleComputedSortedData.length;return s.containerVisibleComputedSortedData.map((b,m)=>({id:b.id,data:b,index:m,value:b.value,startAngle:p*m,endAngle:p*(m+1),padAngle:s.fullParams.padAngle,prevValue:r[m]&&r[m].id===b.id?r[m].value:0}))})),n=e.fullChartParams$.pipe(S(i),y(s=>s.highlightTarget),D()),l=e.visibleComputedSortedData$.pipe(y(s=>Math.max(...s.flat().map(p=>p.value))),D()),c=C({fullParams:e.fullParams$,axisWidth:a,maxValue:l}).pipe(S(i),P(async s=>s),y(s=>$t({cornerRadius:s.fullParams.cornerRadius,outerRadius:s.fullParams.outerRadius,axisWidth:s.axisWidth,maxValue:s.maxValue,arcScaleType:s.fullParams.arcScaleType,fullParams:s.fullParams}))),g=e.fullChartParams$.pipe(S(i),y(s=>s.transitionDuration),D()),h=new ve(!1),f=new N(s=>{C({pieData:t,tweenArc:c,transitionDuration:g,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$}).pipe(S(i),P(async p=>p)).subscribe(p=>{const b=p.pieData.map(($,d)=>($.prevValue=r[d]&&r[d].id===$.id?r[d].value:0,$));h.next(!0);const m=e.containerSelection.selectAll("path").data(b,$=>$.id).join("path").classed(o,!0).style("cursor","pointer").attr("fill",($,d)=>$.data.color).attr("stroke",($,d)=>B({datum:$.data,colorType:p.fullParams.strokeColorType,fullChartParams:p.fullChartParams})).attr("stroke-width",p.fullParams.strokeWidth);m.interrupt("graphicMove"),m.transition("graphicMove").duration(p.transitionDuration).attrTween("d",p.tweenArc).on("end",()=>{s.next(m),h.next(!1)}),r=Object.assign([],b)})}).pipe(L(1));return C({pathSelection:f,SeriesDataMap:e.SeriesDataMap$,computedData:e.computedData$,highlightTarget:n}).pipe(S(i),P(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"mouseover",pluginName:u,highlightTarget:s.highlightTarget,datum:b.data,series:s.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:s.computedData})}).on("mousemove",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"mousemove",pluginName:u,highlightTarget:s.highlightTarget,datum:b.data,series:s.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:s.computedData})}).on("mouseout",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"mouseout",pluginName:u,highlightTarget:s.highlightTarget,datum:b.data,series:s.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:s.computedData})}).on("click",(p,b)=>{p.stopPropagation(),e.event$.next({type:"series",eventName:"click",pluginName:u,highlightTarget:s.highlightTarget,datum:b.data,series:s.SeriesDataMap.get(b.data.seriesLabel),seriesIndex:b.data.seriesIndex,seriesLabel:b.data.seriesLabel,event:p,data:s.computedData})})}),C({pathSelection:f,highlight:e.seriesHighlight$.pipe(y(s=>s.map(p=>p.id))),fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,tweenArc:c,isTransitionMoving:h}).pipe(S(i),P(async s=>s),Re(s=>!s.isTransitionMoving)).subscribe(s=>{yt({pathSelection:s.pathSelection,ids:s.highlight,fullParams:s.fullParams,fullChartParams:s.fullChartParams,tweenArc:s.tweenArc})}),()=>{i.next(void 0)}}const kt=O(St)(({selection:u,name:e,subject:i,observer:o})=>{const r=new x,{seriesCenterSelection$:a}=E({selection:u,pluginName:_,visibleComputedSortedData$:o.visibleComputedSortedData$,seriesContainerPosition$:o.seriesContainerPosition$}),t=[];return a.pipe(S(r)).subscribe(n=>{t.forEach(l=>l()),n.each((l,c,g)=>{const h=T(g[c]),f=o.visibleComputedSortedData$.pipe(S(r),y(p=>JSON.parse(JSON.stringify(p[c]??p[0])))),s=o.seriesContainerPosition$.pipe(S(r),y(p=>JSON.parse(JSON.stringify(p[c]??p[0]))));t[c]=Pt(_,{containerSelection:h,computedData$:o.computedData$,visibleComputedSortedData$:o.visibleComputedSortedData$,containerVisibleComputedSortedData$:f,SeriesDataMap$:o.SeriesDataMap$,fullParams$:o.fullParams$,fullChartParams$:o.fullChartParams$,seriesHighlight$:o.seriesHighlight$,seriesContainerPosition$:s,event$:i.event$})})}),()=>{r.next(void 0),t.forEach(n=>n())}}),Y="RoseLabels",Ct=w(Y,"label-g"),Dt=w(Y,"line-g"),xt=w(Y,"text"),Z=2,Tt={name:Y,defaultParams:Be,layerIndex:K,validator:(u,{validateColumns:e})=>e(u,{outerRadius:{toBeTypes:["number"]},labelCentroid:{toBeTypes:["number"]},labelFn:{toBeTypes:["Function"]},labelColorType:{toBeOption:"ColorType"},arcScaleType:{toBe:'"area" | "radius"',test:o=>o==="area"||o==="radius"}})};function At({pieData:u,labelCentroid:e,arcScaleType:i,maxValue:o,axisWidth:r,outerRadius:a,lineStartCentroid:t,fullParams:n}){const l=r/2*a,c=i==="area"?.5:1,g=G().domain([0,o]).range([0,l]).exponent(c);return u.map((h,f)=>{const s=g(h.value),p=te().innerRadius(0).outerRadius(s).padAngle(0).padRadius(s).cornerRadius(0),[b,m]=p.centroid(h),[$,d]=[b,m],v=n.labelFn(h.data);return{pieDatum:h,arcIndex:f,arcLabels:v.split(`
`),lineStartX:b*t,lineStartY:m*t,lineStartMouseoverX:$*t,lineStartMouseoverY:d*t,x:b*e,y:m*e,mouseoverX:$*e,mouseoverY:d*e,textWidth:0,collisionShiftX:0,collisionShiftY:0,quadrant:b>=0&&m<=0?1:b<0&&m<=0?2:b<0&&m>0?3:4}}).filter(h=>h.pieDatum.data.visible)}function Lt({labelGSelection:u,data:e,fullParams:i,fullChartParams:o,textSizePx:r}){const a=u.selectAll("text").data(e,t=>t.pieDatum.id).join("text").classed(xt,!0).attr("font-weight","bold").attr("text-anchor",t=>t.quadrant==1||t.quadrant==4?"start":"end").style("dominant-baseline",t=>t.quadrant==1||t.quadrant==2?"auto":"hanging").style("cursor",t=>o.highlightTarget&&o.highlightTarget!="none"?"pointer":"none").attr("font-size",o.styles.textSize).attr("fill",(t,n)=>B({datum:t.pieDatum.data,colorType:i.labelColorType,fullChartParams:o})).each((t,n,l)=>{ee(T(l[n]),{textArr:t.arcLabels,textSizePx:r,quadrant:t.quadrant})});return a.transition().attr("transform",t=>"translate("+t.x+","+t.y+")"),a}function vt(u,e,i){const o=u.nodes(),r=i,a=o.map((t,n)=>{const l=t.getBBox(),c=[e[n].x,e[n].y];return{node:t,x:c[0],y:c[1],width:l.width,height:l.height}});for(let t=0;t<a.length;t++){const n=a[t];for(let l=t+1;l<a.length;l++){const c=a[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,f=c.x+e[l].collisionShiftX,s=c.y+e[l].collisionShiftY;if(!(g+n.width/2<f-c.width/2||g-n.width/2>f+c.width/2||h+n.height/2<s-c.height/2||h-n.height/2>s+c.height/2)){if(e[l].quadrant==2){const p=s>h?-r*2:-r;e[l].collisionShiftY+=p}else if(e[l].quadrant==4){const p=s>h?r:r*2;e[l].collisionShiftY+=p}}}}for(let t=a.length-1;t>=0;t--){const n=a[t];for(let l=t-1;l>=0;l--){const c=a[l];e[t].textWidth=n.width;const g=n.x+e[t].collisionShiftX,h=n.y+e[t].collisionShiftY,f=c.x+e[l].collisionShiftX,s=c.y+e[l].collisionShiftY;if(!(g+n.width/2<f-c.width/2||g-n.width/2>f+c.width/2||h+n.height/2<s-c.height/2||h-n.height/2>s+c.height/2)){if(e[l].quadrant==1){const p=s>h?-r*2:-r;e[l].collisionShiftY+=p}else if(e[l].quadrant==3){const p=s>h?r:r*2;e[l].collisionShiftY+=p}}}}u.data(e).transition().attr("transform",t=>`translate(${t.x+t.collisionShiftX},${t.y+t.collisionShiftY})`)}function Rt({lineGSelection:u,data:e,fullParams:i,fullChartParams:o}){const r=e.filter(t=>t.collisionShiftX||t.collisionShiftY),a=u.selectAll("polyline").data(r,t=>t.pieDatum.id).join("polyline").attr("stroke",t=>B({datum:t.pieDatum.data,colorType:i.labelColorType,fullChartParams:o})).attr("stroke-width",1).attr("fill","none").attr("points",t=>[[t.lineStartX,t.lineStartY],[t.lineStartX,t.lineStartY]]);return a.transition().attr("points",t=>{let n=t.x+t.collisionShiftX,l=t.y+t.collisionShiftY;return[[n,l],[t.lineStartX,t.lineStartY]]}),a}function wt({textSelection:u,lineSelection:e,ids:i,fullChartParams:o}){if(u.interrupt("highlight"),e.interrupt("highlight"),!i.length){u.transition("highlight").duration(200).attr("transform",r=>`translate(${r.x+r.collisionShiftX},${r.y+r.collisionShiftY})`).style("opacity",1),e.transition("highlight").duration(200).style("opacity",1);return}u.each((r,a,t)=>{const n=T(t[a]);i.includes(r.pieDatum.data.id)?n.style("opacity",1).transition("highlight").duration(200).attr("transform",l=>`translate(${l.mouseoverX+l.collisionShiftX},${l.mouseoverY+l.collisionShiftY})`):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200).attr("transform",l=>`translate(${l.x+l.collisionShiftX},${l.y+l.collisionShiftY})`)}),e.each((r,a,t)=>{const n=T(t[a]);i.includes(r.pieDatum.data.id)?n.style("opacity",1).transition("highlight").duration(200):n.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").duration(200)})}function Bt(u,e){const i=new x;e.containerSelection.selectAll("g").remove();const o=e.containerSelection.append("g");o.classed(Dt,!0);const r=e.containerSelection.append("g");r.classed(Ct,!0);const a=new x,t=new x;let n=[];const l=e.seriesContainerPosition$.pipe(S(i),y(h=>h.width<h.height?h.width:h.height),D()),c=e.visibleComputedSortedData$.pipe(y(h=>Math.max(...h.flat().map(f=>f.value))),D()),g=e.fullParams$.pipe(S(i),y(h=>h.labelCentroid>=Z?Z:h.labelCentroid));return C({shorterSideWith:l,containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,maxValue:c,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,textSizePx:e.textSizePx$,lineStartCentroid:g}).pipe(S(i),P(async h=>h)).subscribe(h=>{const f=Math.PI*2/h.containerVisibleComputedSortedData.length,s=h.containerVisibleComputedSortedData.map((b,m)=>({id:b.id,data:b,index:m,value:b.value,startAngle:f*m,endAngle:f*(m+1),padAngle:0}));n=At({pieData:s,labelCentroid:h.fullParams.labelCentroid,arcScaleType:h.fullParams.arcScaleType,maxValue:h.maxValue,axisWidth:h.shorterSideWith,outerRadius:h.fullParams.outerRadius,lineStartCentroid:h.lineStartCentroid,fullParams:h.fullParams}),o.selectAll("polyline").remove();const p=Lt({labelGSelection:r,data:n,fullParams:h.fullParams,fullChartParams:h.fullChartParams,textSizePx:h.textSizePx});setTimeout(()=>{vt(p,n,h.textSizePx);const b=Rt({lineGSelection:o,data:n,fullParams:h.fullParams,fullChartParams:h.fullChartParams});t.next(b)},1e3),a.next(p)}),C({textSelection:a,lineSelection:t,highlight:e.seriesHighlight$.pipe(y(h=>h.map(f=>f.id))),fullChartParams:e.fullChartParams$}).pipe(S(i),P(async h=>h)).subscribe(h=>{wt({textSelection:h.textSelection,lineSelection:h.lineSelection,ids:h.highlight,fullChartParams:h.fullChartParams})}),()=>{i.next(void 0)}}const It=O(Tt)(({selection:u,observer:e,subject:i})=>{const o=new x,{seriesCenterSelection$:r}=E({selection:u,pluginName:Y,visibleComputedSortedData$:e.visibleComputedSortedData$,seriesContainerPosition$:e.seriesContainerPosition$}),a=[];return r.pipe(S(o)).subscribe(t=>{a.forEach(n=>n()),t.each((n,l,c)=>{const g=T(c[l]),h=e.visibleComputedSortedData$.pipe(S(o),y(s=>JSON.parse(JSON.stringify(s[l]??s[0])))),f=e.seriesContainerPosition$.pipe(S(o),y(s=>JSON.parse(JSON.stringify(s[l]??s[0]))));a[l]=Bt(Y,{containerSelection:g,visibleComputedSortedData$:e.visibleComputedSortedData$,containerVisibleComputedSortedData$:h,fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,textSizePx$:e.textSizePx$,seriesHighlight$:e.seriesHighlight$,seriesContainerPosition$:f,event$:i.event$})})}),()=>{o.next(void 0)}}),ae="SeriesLegend",Mt={name:ae,defaultParams:Me,layerIndex:Ye,validator:(u,{validateColumns:e})=>e(u,{placement:{toBe:'"top" | "top-start" | "top-end" | "bottom" | "bottom-start" | "bottom-end" | "left" | "left-start" | "left-end" | "right" | "right-start" | "right-end"',test:o=>["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"].includes(o)},padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},Vt=O(Mt)(({selection:u,rootSelection:e,observer:i,subject:o})=>{const r=new x,a=i.SeriesDataMap$.pipe(S(r),y(l=>Array.from(l.keys()))),t=i.fullParams$.pipe(S(r),y(l=>{const c=[{listRectWidth:l.listRectWidth,listRectHeight:l.listRectHeight,listRectRadius:l.listRectRadius}];return{...l,labelList:c}})),n=Ne(ae,{rootSelection:e,legendLabels$:a,fullParams$:t,layout$:i.layout$,fullChartParams$:i.fullChartParams$,textSizePx$:i.textSizePx$});return()=>{r.next(void 0),n()}});export{Ft as B,Et as P,kt as R,Vt as S,Wt as a,It as b,Xt as c,E as s};
