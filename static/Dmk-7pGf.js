import{O as M,ai as N,a9 as S,aa as I,m as $,ah as L,aj as Y,aL as X,aO as E,aM as H,aP as G,S as W,t as m,aQ as Q,i as P,j as C}from"./hQFDSd1w.js";import{g as T,u as U,v as A,h as k}from"./CrPrLvvz.js";import{f as F}from"./C3MF7qht.js";var V=new M(function(t){return t.complete()});function q(t,n,o,a,r,l,s,v){var f=[],c=0,b=0,u=!1,x=function(){u&&!f.length&&!c&&n.complete()},p=function(e){return c<a?d(e):f.push(e)},d=function(e){c++;var h=!1;S(o(e,b++)).subscribe(N(n,function(g){n.next(g)},function(){h=!0},void 0,function(){if(h)try{c--;for(var g=function(){var y=f.shift();s||d(y)};f.length&&c<a;)g();x()}catch(y){n.error(y)}}))};return t.subscribe(N(n,p,function(){u=!0,x()})),function(){}}function R(t,n,o){return o===void 0&&(o=1/0),I(n)?R(function(a,r){return $(function(l,s){return n(a,l,r,s)})(S(t(a,r)))},o):(typeof n=="number"&&(o=n),L(function(a,r){return q(a,r,t,o)}))}function B(t){return t===void 0&&(t=1/0),R(Y,t)}function O(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=X(t),a=E(t,1/0),r=t;return r.length?r.length===1?S(r[0]):B(a)(H(r,o)):V}const J={backgroundColorType:"background",strokeColorType:"primary",backgroundOpacity:.8,textColorType:"primary",offset:[20,5],padding:10,textRenderFn:t=>{if(t.highlightTarget==="datum"&&t.datum)return[`${t.datum.label}: ${t.datum.value}`];if(t.highlightTarget==="series"){const n=t.seriesLabel,o=t.series.filter(r=>r.visible==!0).map(r=>r.value),a=o.length>5?o.slice(0,5).join(",")+"...":o.join(",");return[n,a]}else if(t.highlightTarget==="group"){const n=t.groupLabel,o=t.series.filter(r=>r.visible==!0).map(r=>r.value),a=o.length>5?o.slice(0,5).join(",")+"...":o.join(",");return[n,a]}else if(t.highlightTarget==="category"){const n=t.categoryLabel,o=t.category.filter(r=>r.visible==!0).map(r=>r.value),a=o.length>5?o.slice(0,5).join(",")+"...":o.join(",");return[n,a]}return[]},svgRenderFn:null},z="Tooltip",w=T(z,"g"),K=T(z,"box");function Z(t,n){const o=n.textSizePx*1.5;return t.filter(a=>a!="").map((a,r)=>{const l=r*o;return`<text font-size="${n.textSize}" fill="${n.textColor}" x="0" y="${l}" style="dominant-baseline:text-before-edge">${a}</text>`}).join()}function _({rootSelection:t,pluginName:n,rootWidth:o,rootHeight:a,svgString:r,tooltipStyle:l,event:s}){t.interrupt("fadeout");const v=5,f=r?[r]:[],c=r?[l]:[],u=t.selectAll(`g.${w}`).data(f).join(i=>i.append("g").classed(w,!0).attr("pointer-events","none"),i=>i,i=>i.style("opacity",0).remove()).attr("transform",()=>`translate(${s.offsetX}, ${s.offsetY})`).selectAll(`g.${K}`).data(c).join(i=>i.append("g").classed(T(n,"box"),!0)),x=u.selectAll("rect").data(c).join(i=>i.append("rect").attr("rx",v).attr("ry",v)).attr("fill",i=>i.backgroundColor).attr("stroke",i=>i.strokeColor).attr("opacity",i=>i.backgroundOpacity),p=u.selectAll("g").data(f).join(i=>i.append("g").classed(T(n,"content"),!0).attr("transform",()=>`translate(${l.padding}, ${l.padding})`));f.length&&U(p,f[0]);const d=p!=null&&p.node()?A(p):{width:0,height:0};x.attr("width",d.width+l.padding*2).attr("height",d.height+l.padding*2);const e=u!=null&&u.node()?A(u):{width:0,height:0},h=o-e.width,g=a-e.height,y=s.offsetX+l.offset[0]>h?h-s.offsetX:l.offset[0],j=s.offsetY+l.offset[1]>g?g-s.offsetY:l.offset[1];u.attr("transform",i=>`translate(${y}, ${j})`),u.attr("transform",i=>`translate(${y}, ${j})`)}const ne=G(z,J)(({selection:t,rootSelection:n,name:o,chartType:a,observer:r,subject:l})=>{const s=new W,v=l.event$.pipe(m(s),F(e=>e.eventName==="mouseover"||e.eventName==="mousemove")),f=l.event$.pipe(m(s),F(e=>e.eventName==="mouseout")),c=Q(r.fullChartParams$),b=P({fullChartParams:r.fullChartParams$,fullParams:r.fullParams$,textSizePx:c}).pipe(m(s),C(async e=>e),$(e=>({backgroundColor:k(e.fullParams.backgroundColorType,e.fullChartParams),backgroundOpacity:e.fullParams.backgroundOpacity,strokeColor:k(e.fullParams.strokeColorType,e.fullChartParams),offset:e.fullParams.offset,padding:e.fullParams.padding,textSize:e.fullChartParams.styles.textSize,textSizePx:e.textSizePx,textColor:k(e.fullParams.textColorType,e.fullChartParams)}))),u=P({fullParams:r.fullParams$,tooltipStyle:b}).pipe(m(s),C(async e=>e),$(e=>e.fullParams.svgRenderFn?e.fullParams.svgRenderFn:h=>{const g=e.fullParams.textRenderFn(h);return Z(g,e.tooltipStyle)})),x=P({event:v,contentRenderFn:u}).pipe(m(s),C(async e=>e),$(e=>e.contentRenderFn(e.event))),p=f.pipe(m(s),$(e=>"")),d=O(v,f).pipe(m(s),$(e=>e.event));return P({svgString:O(x,p),event:d,layout:r.layout$,tooltipStyle:b}).pipe(m(s),C(async e=>e)).subscribe(e=>{_({rootSelection:n,pluginName:o,rootWidth:e.layout.rootWidth,rootHeight:e.layout.rootHeight,svgString:e.svgString,tooltipStyle:e.tooltipStyle,event:e.event})}),function(){s.next(void 0)}});export{V as E,ne as T,O as a,R as m};
