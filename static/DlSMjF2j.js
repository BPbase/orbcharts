import{S as te,e as h,t as u,s as g,m as f,c as Y}from"./BpcKryD-.js";import{s as I,d as le,c as H,g as X}from"./fnY6dSo8.js";const se={listRectWidth:14,listRectHeight:14,listRectRadius:0};function U(P,p){const C=P<p.colors[p.colorScheme].series.length?P:P%p.colors[p.colorScheme].series.length;return p.colors[p.colorScheme].series[C]}const ae=(P,{rootSelection:p,seriesLabels$:C,fullParams$:c,layout$:M,fullChartParams$:W})=>{const A=X(P,"root-position"),q=X(P,"legend-card"),G=X(P,"legend-list"),D=X(P,"legend-item"),o=new te,J=h({seriesLabels:C,fullChartParams:W}).pipe(u(o),g(async e=>e),f(e=>{const l=new Map;let t=0;return e.seriesLabels.forEach((s,i)=>{if(!l.has(s)){const a=U(t,e.fullChartParams);l.set(s,a),t++}}),l})),K=C.pipe(u(o),f(e=>{const l=new Set;let t=[];return e.forEach(s=>{l.has(s)?t.push(!1):t.push(!0),l.add(s)}),t})),k=c.pipe(u(o),f(e=>e.position==="bottom"||e.position==="top"?"row":"column")),O=h({fullParams:c,layout:M}).pipe(u(o),g(async e=>e),f(e=>{const l=e.fullParams.padding*2+e.fullParams.gap*2;return e.fullParams.position==="bottom"||e.fullParams.position==="top"?e.layout.rootWidth-l:e.layout.rootHeight-l})),Q=h({layout:M,fullParams:c}).pipe(u(o),g(async e=>e),f(e=>{let l=0,t=0;return e.fullParams.position==="bottom"?(t=e.layout.rootHeight,e.fullParams.justify==="start"?l=0:e.fullParams.justify==="center"?l=e.layout.rootWidth/2:e.fullParams.justify==="end"&&(l=e.layout.rootWidth)):e.fullParams.position==="right"?(l=e.layout.rootWidth,e.fullParams.justify==="start"?t=0:e.fullParams.justify==="center"?t=e.layout.rootHeight/2:e.fullParams.justify==="end"&&(t=e.layout.rootHeight)):e.fullParams.position==="top"?(t=0,e.fullParams.justify==="start"?l=0:e.fullParams.justify==="center"?l=e.layout.rootWidth/2:e.fullParams.justify==="end"&&(l=e.layout.rootWidth)):e.fullParams.position==="left"&&(l=0,e.fullParams.justify==="start"?t=0:e.fullParams.justify==="center"?t=e.layout.rootHeight/2:e.fullParams.justify==="end"&&(t=e.layout.rootHeight)),{x:l,y:t}})).pipe(u(o),f(e=>p.selectAll(`g.${A}`).data([e]).join(l=>l.append("g").classed(A,!0).attr("transform",t=>`translate(${t.x}, ${t.y})`),l=>l.transition().attr("transform",t=>`translate(${t.x}, ${t.y})`),l=>l.remove()))),V=c.pipe(u(o),f(e=>e.seriesList[0]?e.seriesList[0]:se)),T=h({visibleList:K,fullParams:c,fullChartParams:W,seriesLabels:C,lineDirection:k,lineMaxSize:O,defaultListStyle:V,SeriesLabelColorMap:J}).pipe(u(o),g(async e=>e),f(e=>e.seriesLabels.reduce((l,t,s)=>{if(!e.visibleList[s])return l;const i=le(t,e.fullChartParams.styles.textSize),a=e.fullChartParams.styles.textSize*1.5+i,y=e.SeriesLabelColorMap.get(t),x=l[0]&&l[0][0]?l[l.length-1][l[l.length-1].length-1]:null,{translateX:r,translateY:w,lineIndex:S,itemIndex:d}=((m,N,n)=>{let b=0,z=0,j=0,R=0;if(m.lineDirection==="column"){let $=n?n.translateY+m.fullChartParams.styles.textSize+m.fullParams.gap:0;if($+m.fullChartParams.styles.textSize>m.lineMaxSize){j=n.lineIndex+1,R=0,z=0;const ee=N[N.length-1].reduce((B,F)=>F.itemWidth>B?F.itemWidth:B,0);b=n.translateX+ee+m.fullParams.gap}else j=n?n.lineIndex:0,R=n?n.itemIndex+1:0,z=$,b=n?n.translateX:0}else{let $=n?n.translateX+n.itemWidth+m.fullParams.gap:0;$+a>m.lineMaxSize?(j=n.lineIndex+1,R=0,b=0):(j=n?n.lineIndex:0,R=n?n.itemIndex+1:0,b=$),z=(m.fullChartParams.styles.textSize+m.fullParams.gap)*j}return{translateX:b,translateY:z,lineIndex:j,itemIndex:R}})(e,l,x);l[S]||(l[S]=[]);const L=e.fullParams.seriesList[d]?e.fullParams.seriesList[d]:e.defaultListStyle;return l[S].push({id:t,seriesLabel:t,seriesIndex:s,lineIndex:S,itemIndex:d,text:t,itemWidth:a,translateX:r,translateY:w,color:y,listRectWidth:L.listRectWidth,listRectHeight:L.listRectHeight,listRectRadius:L.listRectRadius}),l},[])),I(1)),E=h({fullParams:c,fullChartParams:W,lineDirection:k,lengendItems:T}).pipe(u(o),g(async e=>e),f(e=>{const{width:l,height:t}=((s,i)=>{let a=0,y=0;if(!i.length||!i[0].length)return{width:a,height:y};const x=i[0][i[0].length-1];return s.lineDirection==="column"?(a=i.reduce((r,w)=>{const S=w.reduce((d,L)=>L.itemWidth>d?L.itemWidth:d,0);return r+S},0),a+=s.fullParams.gap*(i.length-1),y=x.translateY+s.fullChartParams.styles.textSize):(a=x.translateX+x.itemWidth,y=s.fullChartParams.styles.textSize*i.length+s.fullParams.gap*(i.length-1)),{width:a,height:y}})(e,e.lengendItems);return{direction:e.lineDirection,width:l,height:t,translateX:e.fullParams.gap,translateY:e.fullParams.gap}}),I(1)),Z=h({fullParams:c,lengendList:E}).pipe(u(o),g(async e=>e),f(e=>{const l=e.lengendList.width+e.fullParams.gap*2,t=e.lengendList.height+e.fullParams.gap*2;let s=0,i=0;return e.fullParams.position==="left"?e.fullParams.justify==="start"?(s=e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="center"?(s=e.fullParams.padding,i=-t/2):e.fullParams.justify==="end"&&(s=e.fullParams.padding,i=-t-e.fullParams.padding):e.fullParams.position==="right"?e.fullParams.justify==="start"?(s=-l-e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="center"?(s=-l-e.fullParams.padding,i=-t/2):e.fullParams.justify==="end"&&(s=-l-e.fullParams.padding,i=-t-e.fullParams.padding):e.fullParams.position==="top"?e.fullParams.justify==="start"?(s=e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="center"?(s=-l/2,i=e.fullParams.padding):e.fullParams.justify==="end"&&(s=-l-e.fullParams.padding,i=e.fullParams.padding):e.fullParams.justify==="start"?(s=e.fullParams.padding,i=-t-e.fullParams.padding):e.fullParams.justify==="center"?(s=-l/2,i=-t-e.fullParams.padding):e.fullParams.justify==="end"&&(s=-l-e.fullParams.padding,i=-t-e.fullParams.padding),{width:l,height:t,translateX:s,translateY:i}})),v=h({rootPositionSelection:Q,fullParams:c,fullChartParams:W,legendCard:Z}).pipe(u(o),g(async e=>e),f(e=>e.rootPositionSelection.selectAll("g").data([e.legendCard]).join(l=>l.append("g").classed(q,!0).attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.transition().attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.remove()).each((l,t,s)=>{Y(s[t]).selectAll("rect").data([l]).join("rect").attr("width",i=>i.width).attr("height",i=>i.height).attr("fill",H(e.fullParams.backgroundFill,e.fullChartParams)).attr("stroke",H(e.fullParams.backgroundStroke,e.fullChartParams))}))),_=h({lengendCardSelection:v,fullParams:c,lengendList:E}).pipe(u(o),g(async e=>e),f(e=>e.lengendCardSelection.selectAll("g").data([e.lengendList]).join(l=>l.append("g").classed(G,!0).attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.transition().attr("transform",t=>`translate(${t.translateX}, ${t.translateY})`),l=>l.remove())));return h({lengendListSelection:_,fullParams:c,fullChartParams:W,lengendItems:T}).pipe(u(o),g(async e=>e),f(e=>{const l=e.lengendItems[0]?e.lengendItems.flat():[];return e.lengendListSelection.selectAll(`g.${D}`).data(l).join(t=>t.append("g").classed(D,!0).attr("cursor","default"),t=>t,t=>t.remove()).attr("transform",(t,s)=>`translate(${t.translateX}, ${t.translateY})`).each((t,s,i)=>{const a=e.fullChartParams.styles.textSize/2,y=-t.listRectWidth/2,x=-t.listRectHeight/2;Y(i[s]).selectAll("rect").data([t]).join("rect").attr("x",a).attr("y",a).attr("width",r=>r.listRectWidth).attr("height",r=>r.listRectHeight).attr("transform",r=>`translate(${y}, ${x})`).attr("fill",r=>r.color).attr("rx",r=>r.listRectRadius),Y(i[s]).selectAll("text").data([t]).join(r=>r.append("text").attr("dominant-baseline","hanging"),r=>r,r=>r.remove()).attr("x",e.fullChartParams.styles.textSize*1.5).attr("font-size",e.fullChartParams.styles.textSize).attr("fill",r=>e.fullParams.textColorType==="series"?U(r.seriesIndex,e.fullChartParams):H(e.fullParams.textColorType,e.fullChartParams)).text(r=>r.text)})})).subscribe(),()=>{o.next(void 0)}};export{ae as c};
