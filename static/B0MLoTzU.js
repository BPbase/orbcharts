import{f as m,s as d,e as T,d as P,w as I,S as M,g as w,t as p,P as W,O as C}from"./DTMfjTug.js";import{d as O}from"./Bt5SAD7j.js";import{d as j,s as z,g as R,b as L,e as F}from"./D2FdcmjD.js";function H({data:o,startAngle:a,endAngle:u}){return j().startAngle(a).endAngle(u).value(t=>t.visible==!1?0:t.value).sort((t,r)=>t.seq-r.seq)(o).map((t,r)=>{let c=t;return c.id=t.data.id,c})}function U({selection:o,pluginName:a,separateSeries$:u,seriesLabels$:n}){const l=R(a,"series");return m({seriesLabels:n,separateSeries:u}).pipe(d(async t=>t),P((t,r)=>{const c=t.separateSeries?t.seriesLabels:[t.seriesLabels.join("")];return o.selectAll(`g.${l}`).data(c,h=>h).join(h=>h.append("g").classed(l,!0),h=>h,h=>h.remove())}),z(1))}const q=({selection:o,pluginName:a,separateSeries$:u,seriesLabels$:n,seriesContainerPosition$:l})=>{const t=U({selection:o,pluginName:a,separateSeries$:u,seriesLabels$:n});return m({seriesCenterSelection:t,seriesContainerPosition:l}).pipe(d(async r=>r),T((r,c)=>r.seriesContainerPosition.length===c.seriesContainerPosition.length)).subscribe(r=>{r.seriesCenterSelection.attr("transform",(c,h)=>{const g=r.seriesContainerPosition[h]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:t,seriesContainerPosition:l}).pipe(d(async r=>r)).subscribe(r=>{r.seriesCenterSelection.transition().attr("transform",(c,h)=>{const g=r.seriesContainerPosition[h]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:t}},D="Pie";function x({enter:o,exit:a,data:u,lastTweenData:n,fullParams:l}){return!o.size()&&!a.size()?t=>{const r=u.map((c,h)=>{const g=n[h]??{startAngle:0,endAngle:0,value:0};return{...c,startAngle:c.startAngle*t+g.startAngle*(1-t),endAngle:c.endAngle*t+g.endAngle*(1-t),value:c.value*t+g.value*(1-t)}});return v(r,l.startAngle,l.endAngle,1)}:t=>v(u,l.startAngle,l.endAngle,t)}function v(o,a,u,n){return o.map((l,t)=>{const r=a+(l.startAngle-a)*n,c=r+(l.endAngle-l.startAngle)*n;return{...l,startAngle:r,endAngle:c}})}function y({selection:o,data:a,arc:u,pathClassName:n}){return o.selectAll("path").data(a,t=>t.id).join("path").classed(n,!0).style("cursor","pointer").attr("fill",(t,r)=>t.data.color).attr("d",(t,r)=>u(t))}function X({pathSelection:o,ids:a,fullChartParams:u,arc:n,arcMouseover:l}){if(o.interrupt("highlight"),!a.length){o.transition("highlight").style("opacity",1).attr("d",t=>n(t));return}o.each((t,r,c)=>{const h=w(c[r]);a.includes(t.data.id)?h.style("opacity",1).transition("highlight").ease(W).duration(500).attr("d",g=>l(g)):h.style("opacity",u.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>n(g))})}function Y(o,a){const u=new M,n=R(o,"path");let l=[],t=[];const r=a.seriesContainerPosition$.pipe(p(u),P(s=>s.width<s.height?s.width:s.height)),c=new C(s=>{m({containerComputedLayoutData:a.containerComputedLayoutData$,fullParams:a.fullParams$}).pipe(p(u),d(async e=>e)).subscribe(e=>{const i=H({data:e.containerComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s.next(i)})}),h=new C(s=>{m({shorterSideWith:r,fullParams:a.fullParams$}).pipe(p(u),d(async e=>e)).subscribe(e=>{const i=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(i)})}),g=new C(s=>{m({shorterSideWith:r,fullParams:a.fullParams$}).pipe(p(u),d(async e=>e)).subscribe(e=>{const i=L({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerMouseoverRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(i)})}),f=a.fullChartParams$.pipe(p(u),P(s=>s.highlightTarget),T()),S=new C(s=>{m({pieData:c,arc:h,computedData:a.computedData$,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,highlightTarget:f}).pipe(p(u),d(async e=>e)).subscribe(e=>{a.containerSelection.interrupt("graphicMove");let i=a.containerSelection.selectAll("path").data(e.pieData,$=>$.id),A=i.enter(),N=i.exit();const k=x({enter:A,exit:N,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});if(A.transition("graphicMove").duration(e.fullChartParams.transitionDuration).ease(F(e.fullChartParams.transitionEase)).tween("move",($,E)=>b=>{t=k(b),y({selection:a.containerSelection,data:t,arc:e.arc,pathClassName:n}),a.event$.next({type:"series",pluginName:o,eventName:"transitionMove",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})}).on("end",($,E)=>{t=v(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const b=y({selection:a.containerSelection,data:t,arc:e.arc,pathClassName:n});s.next(b),l=Object.assign([],e.pieData),a.event$.next({type:"series",pluginName:o,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})}),!A.size()&&i.size()>0){const $=y({selection:a.containerSelection,data:e.pieData,arc:e.arc,pathClassName:n});s.next($)}})});return m({pathSelection:S,SeriesDataMap:a.SeriesDataMap$,computedData:a.computedData$,highlightTarget:f}).pipe(p(u),d(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mouseover",pluginName:o,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})}).on("mousemove",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mousemove",pluginName:o,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})}).on("mouseout",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mouseout",pluginName:o,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})}).on("click",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"click",pluginName:o,highlightTarget:s.highlightTarget,datum:i.data,series:s.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:s.computedData})})}),m({pathSelection:S,highlight:a.seriesHighlight$.pipe(P(s=>s.map(e=>e.id))),fullChartParams:a.fullChartParams$,arc:h,arcMouseover:g}).pipe(p(u),d(async s=>s)).subscribe(s=>{X({pathSelection:s.pathSelection,ids:s.highlight,fullChartParams:s.fullChartParams,arc:s.arc,arcMouseover:s.arcMouseover})}),()=>{u.next(void 0)}}const J=I(D,O)(({selection:o,name:a,subject:u,observer:n})=>{const l=new M,{seriesCenterSelection$:t}=q({selection:o,pluginName:D,separateSeries$:n.separateSeries$,seriesLabels$:n.seriesLabels$,seriesContainerPosition$:n.seriesContainerPosition$}),r=[];return n.fullParams$.subscribe(),t.subscribe(c=>{r.forEach(h=>h()),c.each((h,g,f)=>{const S=w(f[g]),s=n.computedLayoutData$.pipe(p(l),P(i=>i[g]??i[0])),e=n.seriesContainerPosition$.pipe(p(l),P(i=>i[g]??i[0]));r[g]=Y(D,{containerSelection:S,computedData$:n.computedData$,containerComputedLayoutData$:s,SeriesDataMap$:n.SeriesDataMap$,fullParams$:n.fullParams$,fullChartParams$:n.fullChartParams$,seriesHighlight$:n.seriesHighlight$,seriesContainerPosition$:e,event$:u.event$})})}),()=>{l.next(void 0),r.forEach(c=>c())}});export{J as P,H as m,q as s};
