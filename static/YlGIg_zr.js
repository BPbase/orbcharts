import{S as H,t as c,m as A,h as k,o as G,p as P,s as v,_ as pe,b as W,E as ge,w as ce,X as de,y as me,i as he,ax as xe}from"./N-S2_mvR.js";import{c as ee,d as $e,e as De,f as fe,g as X,h as J,i as Se,j as ye}from"./AiUH4IXV.js";import{l as se,m as Ae,n as te,o as Le}from"./C8CDykk9.js";import{f as Pe}from"./4FLfRXe2.js";import{c as Te}from"./DuNswa_8.js";import{c as Ge}from"./DF3pqf1L.js";import{i as Ie}from"./D_HE-i6-.js";function Ce(r="curveLinear",l){return De().x(i=>i.axisX).y0(i=>l).y1(i=>i.axisY).curve(fe[r])}function be(r){let l=[[]],i=0;for(let s in r){if(r[s].visible==!1||r[s].value===void 0||r[s].value===null){l[i].length&&(i++,l[i]=[]);continue}l[i].push(r[s])}return l}function Me({selection:r,pathClassName:l,segmentData:i,areaPath:s,linearGradientIds:t,params:n}){return r.selectAll("path").data(i,(o,x)=>o.length?`${o[0].id}_${o[o.length-1].id}`:x).join(o=>o.append("path").classed(l,!0).attr("fill","none").style("vector-effect","non-scaling-stroke").style("cursor","pointer"),o=>o,o=>o.remove()).attr("fill",(o,x)=>o[0]?`url(#${t[o[0].seriesIndex]})`:"").attr("d",o=>s(o))}function Re({selection:r,seriesLabel:l,fullChartParams:i}){if(r.interrupt("highlight"),!l){r.transition("highlight").duration(200).style("opacity",1);return}r.each((s,t,n)=>{s===l?v(n[t]).style("opacity",1):v(n[t]).style("opacity",i.styles.unhighlightedOpacity)})}function we({defsSelection:r,computedData:l,linearGradientIds:i,params:s}){r.selectAll("linearGradient").data(l??[]).join(t=>t.append("linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad"),t=>t,t=>t.remove()).attr("id",(t,n)=>t[0]?i[t[0].seriesIndex]:"").html((t,n)=>{const h=t[0]?t[0].color:"";return`
        <stop offset="0%"   stop-color="${h}" stop-opacity="${s.linearGradientOpacity[0]}"/>
        <stop offset="100%" stop-color="${h}" stop-opacity="${s.linearGradientOpacity[1]}"/>
      `})}function Fe({defsSelection:r,clipPathData:l,transitionDuration:i,transitionEase:s}){r.selectAll("clipPath").data(l).join(t=>t.append("clipPath"),t=>t,t=>t.remove()).attr("id",t=>t.id).each((t,n,h)=>{v(h[n]).selectAll("rect").data([t]).join(o=>{const x=o.append("rect");return x.transition().duration(i).ease($e(s)).tween("tween",(p,N,$)=>I=>{const M=p.width*I;x.attr("x",0).attr("y",0).attr("width",S=>M).attr("height",S=>S.height)}),x},o=>o.attr("x",0).attr("y",0).attr("width",x=>x.width).attr("height",x=>x.height),o=>o.remove())})}const ze=(r,{selection:l,computedData$:i,computedLayoutData$:s,visibleComputedData$:t,visibleComputedLayoutData$:n,seriesLabels$:h,SeriesDataMap$:o,GroupDataMap$:x,fullParams$:p,fullDataFormatter$:N,fullChartParams$:$,gridAxesTransform$:I,gridGraphicTransform$:M,gridAxesSize$:S,gridHighlight$:C,gridContainerPosition$:T,layout$:z,event$:w})=>{const D=new H,U=ee(r,"clipPath-box"),F=X(r,"path"),{seriesSelection$:a,axesSelection$:L,defsSelection$:d,graphicGSelection$:y}=se({selection:l,pluginName:r,clipPathID:U,seriesLabels$:h,gridContainerPosition$:T,gridAxesTransform$:I,gridGraphicTransform$:M}),j=M.pipe(c(D),A(e=>-e.translate[1]/e.scale[1])),Y=new pe(e=>{const f=G({fullParams:p,valueAxisStart:j}).pipe(c(D)).subscribe(m=>{const g=Ce(m.fullParams.lineCurve,m.valueAxisStart);e.next(g)});return()=>{f.unsubscribe()}}),Z=$.pipe(A(e=>e.transitionDuration),k()),b=$.pipe(A(e=>e.transitionEase),k());G({defsSelection:d,seriesLabels:h,axisSize:S,transitionDuration:Z,transitionEase:b}).pipe(c(D),P(async e=>e)).subscribe(e=>{const m=[{id:U,width:e.axisSize.width,height:e.axisSize.height}].concat(e.seriesLabels.map(g=>({id:`orbcharts__clipPath_${g}`,width:e.axisSize.width,height:e.axisSize.height})));Fe({defsSelection:e.defsSelection,clipPathData:m,transitionDuration:e.transitionDuration,transitionEase:e.transitionEase})});const V=i.pipe(A(e=>{const f=new Map;return e.flat().forEach(m=>f.set(m.id,m)),f})),oe=Ae({fullDataFormatter$:N,gridAxesSize$:S,computedData$:i,fullChartParams$:$,gridContainerPosition$:T,layout$:z}),ne=$.pipe(c(D),A(e=>e.highlightTarget),k()),le=h.pipe(c(D),A(e=>e.map((f,m)=>ee(r,`lineargradient-${f}`)))),ue=G({graphicGSelection:y,defsSelection:d,visibleComputedLayoutData:n,linearGradientIds:le,areaPath:Y,params:p}).pipe(c(D),P(async e=>e),A(e=>{let f=[];return e.graphicGSelection.each((m,g,R)=>{const B=be(e.visibleComputedLayoutData[g]??[]);f[g]=Me({selection:v(R[g]),pathClassName:F,areaPath:e.areaPath,segmentData:B,linearGradientIds:e.linearGradientIds,params:e.params}),we({defsSelection:e.defsSelection,computedData:e.visibleComputedLayoutData,linearGradientIds:e.linearGradientIds,params:e.params})}),f}));return G({pathSelectionArr:ue,computedData:i,SeriesDataMap:o,GroupDataMap:x,highlightTarget:ne,gridGroupPositionFn:oe}).pipe(c(D),P(async e=>e)).subscribe(e=>{e.pathSelectionArr.forEach(f=>{f.on("mouseover",(m,g)=>{const R=g[0]?g[0].seriesLabel:"",{groupIndex:B,groupLabel:_}=e.gridGroupPositionFn(m),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??g[0];w.next({type:"grid",eventName:"mouseover",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:m,data:e.computedData})}).on("mousemove",(m,g)=>{const R=g[0]?g[0].seriesLabel:"",{groupIndex:B,groupLabel:_}=e.gridGroupPositionFn(m),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??g[0];w.next({type:"grid",eventName:"mousemove",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:m,data:e.computedData})}).on("mouseout",(m,g)=>{const R=g[0]?g[0].seriesLabel:"",{groupIndex:B,groupLabel:_}=e.gridGroupPositionFn(m),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??g[0];w.next({type:"grid",eventName:"mouseout",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:m,data:e.computedData})}).on("click",(m,g)=>{const R=g[0]?g[0].seriesLabel:"",{groupIndex:B,groupLabel:_}=e.gridGroupPositionFn(m),u=e.GroupDataMap.get(_).find(E=>E.seriesLabel===R)??g[0];w.next({type:"grid",eventName:"click",pluginName:r,highlightTarget:e.highlightTarget,datum:u,gridIndex:u.gridIndex,series:e.SeriesDataMap.get(u.seriesLabel),seriesIndex:u.seriesIndex,seriesLabel:u.seriesLabel,groups:e.GroupDataMap.get(u.groupLabel),groupIndex:u.groupIndex,groupLabel:u.groupLabel,event:m,data:e.computedData})})})}),$.pipe(c(D),Pe(e=>e.highlightTarget==="series"),P(e=>G({graphicGSelection:y,gridHighlight:C,DataMap:V,fullChartParams:$}).pipe(c(D),P(async f=>f)))).subscribe(e=>{const f=e.gridHighlight[0]?e.gridHighlight[0].seriesLabel:null;Re({selection:e.graphicGSelection,seriesLabel:f,fullChartParams:e.fullChartParams})}),()=>{D.next(void 0)}},ae="LineAreas",Ye=W(ae,ge)(({selection:r,name:l,observer:i,subject:s})=>{const t=new H,n=ze(ae,{selection:r,computedData$:i.computedData$,visibleComputedData$:i.visibleComputedData$,computedLayoutData$:i.computedLayoutData$,visibleComputedLayoutData$:i.visibleComputedLayoutData$,seriesLabels$:i.seriesLabels$,SeriesDataMap$:i.SeriesDataMap$,GroupDataMap$:i.GroupDataMap$,fullParams$:i.fullParams$,fullDataFormatter$:i.fullDataFormatter$,fullChartParams$:i.fullChartParams$,gridAxesTransform$:i.gridAxesTransform$,gridGraphicTransform$:i.gridGraphicTransform$,gridAxesSize$:i.gridAxesSize$,gridHighlight$:i.gridHighlight$,gridContainerPosition$:i.gridContainerPosition$,allContainerPosition$:i.gridContainerPosition$,layout$:i.layout$,event$:s.event$});return()=>{t.next(void 0),n()}}),ie="Dots",Ke=W(ie,ce)(({selection:r,name:l,subject:i,observer:s})=>{const t=new H,n=Te(ie,{selection:r,computedData$:s.computedData$,computedLayoutData$:s.computedLayoutData$,visibleComputedData$:s.visibleComputedData$,visibleComputedLayoutData$:s.visibleComputedLayoutData$,seriesLabels$:s.seriesLabels$,SeriesDataMap$:s.SeriesDataMap$,GroupDataMap$:s.GroupDataMap$,fullParams$:s.fullParams$,fullChartParams$:s.fullChartParams$,gridAxesTransform$:s.gridAxesTransform$,gridGraphicTransform$:s.gridGraphicTransform$,gridGraphicReverseScale$:s.gridGraphicReverseScale$,gridAxesSize$:s.gridAxesSize$,gridHighlight$:s.gridHighlight$,gridContainerPosition$:s.gridContainerPosition$,event$:i.event$});return()=>{t.next(void 0),n()}}),re="ValueStackAxis",qe=W(re,de)(({selection:r,name:l,observer:i,subject:s})=>{const t=new H,n=Ge(re,{selection:r,computedData$:i.computedStackedData$,fullParams$:i.fullParams$,fullDataFormatter$:i.fullDataFormatter$,fullChartParams$:i.fullChartParams$,gridAxesTransform$:i.gridAxesTransform$,gridAxesReverseTransform$:i.gridAxesReverseTransform$,gridAxesSize$:i.gridAxesSize$,gridContainerPosition$:i.gridContainerPosition$,isSeriesSeprate$:i.isSeriesSeprate$});return()=>{t.next(void 0),n()}}),O="GroupAux",Q=X(O,"label-box");function _e({groupLabel:r,axisX:l,axisHeight:i,fullParams:s}){return s.showLine&&r?[{id:r,x1:l,x2:l,y1:0,y2:i}]:[]}function Ee({selection:r,pluginName:l,lineData:i,fullParams:s,fullChartParams:t}){const n=X(l,"auxline"),h=r.selectAll(`line.${n}`).data(i),o=h.enter().append("line").classed(n,!0).style("stroke",p=>J(s.lineColorType,t)).style("stroke-width",1).style("stroke-dasharray",s.lineDashArray??"none").style("pointer-events","none"),x=h.merge(o);return h.exit().remove(),o.attr("x1",p=>p.x1).attr("y1",p=>p.y1).attr("x2",p=>p.x2).attr("y2",p=>p.y2),h.transition().duration(50).attr("x1",p=>p.x1).attr("y1",p=>p.y1).attr("x2",p=>p.x2).attr("y2",p=>p.y2),x}function ke(r){r.selectAll("line").data([]).exit().remove()}function Ne({groupLabel:r,axisX:l,fullParams:i}){return i.showLabel&&r?[{id:r,x:l,y:-i.labelPadding,text:Se(r,i.labelTextFormat)}]:[]}function Ue({selection:r,labelData:l,fullParams:i,fullDataFormatter:s,fullChartParams:t,textReverseTransformWithRotate:n,textSizePx:h}){const o=h+6,x=r.selectAll(`g.${Q}`).data(l),p=x.enter().append("g").classed(Q,!0).style("cursor","pointer"),N=p.merge(x);return p.attr("transform",($,I)=>`translate(${$.x}, ${$.y})`),x.transition().duration(50).attr("transform",($,I)=>`translate(${$.x}, ${$.y})`),x.exit().remove(),N.each(($,I,M)=>{const S=ye($.text,h)+12;let C=-S/2,T=-2;s.grid.groupAxis.position==="bottom"?(C=i.labelRotate?-S+o:-S/2,T=2):s.grid.groupAxis.position==="left"?(C=-S+2,T=-o/2):s.grid.groupAxis.position==="right"?(C=-2,T=-o/2):s.grid.groupAxis.position==="top"&&(C=i.labelRotate?-S+o:-S/2,T=-o+2);const z=v(M[I]).selectAll("rect").data([$]),w=z.enter().append("rect").attr("height",`${o}px`).attr("fill",F=>J(i.labelColorType,t)).attr("x",C).attr("y",T-3).attr("rx",5).attr("ry",5).style("cursor","pointer");z.merge(w).attr("width",F=>`${S}px`).style("transform",n),z.exit().remove();const D=v(M[I]).selectAll("text").data([$]),U=D.enter().append("text").style("dominant-baseline","hanging").style("cursor","pointer");D.merge(U).text(F=>F.text).style("transform",n).attr("fill",F=>J(i.labelTextColorType,t)).attr("font-size",t.styles.textSize).attr("x",C+6).attr("y",T),D.exit().remove()}),N}function ve(r){r.selectAll(`g.${Q}`).data([]).exit().remove()}const Je=W(O,me)(({selection:r,rootSelection:l,name:i,subject:s,observer:t})=>{const n=new H;let h=!1;const o=l.insert("rect","g").classed(X(O,"rect"),!0).attr("opacity",0),{seriesSelection$:x,axesSelection$:p,defsSelection$:N,graphicGSelection$:$}=se({selection:r,pluginName:O,clipPathID:"test",seriesLabels$:t.isSeriesSeprate$.pipe(P(a=>Ie(()=>a,t.seriesLabels$,t.seriesLabels$.pipe(A(L=>[L[0]]))))),gridContainerPosition$:t.gridContainerPosition$,gridAxesTransform$:t.gridAxesTransform$,gridGraphicTransform$:t.gridGraphicTransform$});t.layout$.pipe(c(n)).subscribe(a=>{o.attr("width",a.rootWidth).attr("height",a.rootHeight)});const I=G({fullDataFormatter:t.fullDataFormatter$,gridAxesSize:t.gridAxesSize$,computedData:t.computedData$}).pipe(c(n),P(async a=>a),A(a=>{const L=a.computedData[0]?a.computedData[0].length-1:0,d=a.fullDataFormatter.grid.groupAxis.scaleDomain[0]-a.fullDataFormatter.grid.groupAxis.scalePadding,y=a.fullDataFormatter.grid.groupAxis.scaleDomain[1]==="max"?L+a.fullDataFormatter.grid.groupAxis.scalePadding:a.fullDataFormatter.grid.groupAxis.scaleDomain[1]+a.fullDataFormatter.grid.groupAxis.scalePadding;return[d,y]}),he(1)),M=G({groupScaleDomain:I,gridAxesSize:t.gridAxesSize$}).pipe(c(n),P(async a=>a),A(a=>xe().domain(a.groupScaleDomain).range([0,a.gridAxesSize.width]))),S=t.fullChartParams$.pipe(c(n),A(a=>a.highlightTarget),k()),C=te(l,"mousemove").pipe(c(n)),T=G({gridAxesReverseTransform:t.gridAxesReverseTransform$,gridContainerPosition:t.gridContainerPosition$}).pipe(c(n),P(async a=>a),A(a=>{const L=`rotateX(${a.gridAxesReverseTransform.rotateX}deg) rotateY(${a.gridAxesReverseTransform.rotateY}deg)`,d=`rotate(${a.gridAxesReverseTransform.rotate}deg)`,y=`scale(${1/a.gridContainerPosition[0].scale[0]}, ${1/a.gridContainerPosition[0].scale[1]})`;return`${L} ${d} ${y}`}),k()),z=G({textReverseTransform:T,fullParams:t.fullParams$}).pipe(c(n),P(async a=>a),A(a=>`${a.textReverseTransform} rotate(${a.fullParams.labelRotate}deg)`)),w=t.gridContainerPosition$.pipe(c(n),A(a=>a.reduce((d,y)=>y.columnIndex>d?y.columnIndex:d,0)+1),k()),D=t.gridContainerPosition$.pipe(c(n),A(a=>a.reduce((d,y)=>y.rowIndex>d?y.rowIndex:d,0)+1),k()),U=Le({rootSelection:l,fullDataFormatter$:t.fullDataFormatter$,gridAxesSize$:t.gridAxesSize$,computedData$:t.computedData$,fullChartParams$:t.fullChartParams$,gridContainerPosition$:t.gridContainerPosition$,layout$:t.layout$}).pipe(c(n));G({axesSelection:p,columnAmount:w,rowAmount:D,layout:t.layout$,rootMousemove:C,gridGroupPosition:U,computedData:t.computedData$,groupScale:M,gridAxesSize:t.gridAxesSize$,fullParams:t.fullParams$,fullDataFormatter:t.fullDataFormatter$,fullChartParams:t.fullChartParams$,highlightTarget:S,textReverseTransformWithRotate:z,GroupDataMap:t.GroupDataMap$,textSizePx:t.textSizePx$}).pipe(c(n),P(async a=>a)).subscribe(a=>{const{groupIndex:L,groupLabel:d}=a.gridGroupPosition,y=a.groupScale(L)??0,j=_e({groupLabel:d,axisX:y,axisHeight:a.gridAxesSize.height,fullParams:a.fullParams});Ee({selection:a.axesSelection,pluginName:i,lineData:j,fullParams:a.fullParams,fullChartParams:a.fullChartParams});const Y=Ne({groupLabel:d,axisX:y,fullParams:a.fullParams});Ue({selection:a.axesSelection,labelData:Y,fullParams:a.fullParams,fullDataFormatter:a.fullDataFormatter,fullChartParams:a.fullChartParams,textReverseTransformWithRotate:a.textReverseTransformWithRotate,textSizePx:a.textSizePx}).on("mouseover",(b,V)=>{b.stopPropagation(),h=!0,s.event$.next({type:"grid",pluginName:i,eventName:"mouseover",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:a.GroupDataMap.get(d)??[],groupIndex:L,groupLabel:d,event:b,data:a.computedData})}).on("mousemove",(b,V)=>{b.stopPropagation(),s.event$.next({type:"grid",pluginName:i,eventName:"mousemove",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:a.GroupDataMap.get(d)??[],groupIndex:L,groupLabel:d,event:b,data:a.computedData})}).on("click",(b,V)=>{b.stopPropagation(),s.event$.next({type:"grid",pluginName:i,eventName:"click",highlightTarget:a.highlightTarget,datum:null,gridIndex:0,series:[],seriesIndex:-1,seriesLabel:"",groups:a.GroupDataMap.get(d)??[],groupIndex:L,groupLabel:d,event:b,data:a.computedData})})});const F=te(o,"mouseout").pipe(c(n));return G({rootRectMouseout:F,axesSelection:p}).pipe(c(n),P(async a=>a)).subscribe(a=>{setTimeout(()=>{h!=!0&&(ke(a.axesSelection),ve(a.axesSelection))})}),()=>{n.next(void 0),o.remove()}});export{Ke as D,Je as G,Ye as L,qe as V,ze as c};
