import{S as P,O as b,f as I,t as g,s as F,d as p,j as v,g as L,e as w}from"./DTMfjTug.js";import{j as C,m as O}from"./DRIEcsPa.js";import{c as S}from"./BsvKXhGM.js";import{s as T,g as y}from"./D2FdcmjD.js";import{o as X}from"./DTFMiyPx.js";function R(n){let i=Math.floor(Math.sqrt(n)),a=Math.ceil(n/i);for(;i*a<n;)a++;return{rowAmount:i,columnAmount:a}}function G(n,i,a){const{gap:s}=i,{rowAmount:r,columnAmount:o}=i.rowAmount*i.columnAmount>=a?i:R(a);return new Array(a).fill(null).map((m,c)=>{const f=c%o,l=Math.floor(c/o),t=(n.width-s*(o-1))/o,e=(n.height-s*(r-1))/r,u=f*t+f*s,d=l*e+l*s,$=[u,d],x=[t/n.width,e/n.height];return{slotIndex:c,rowIndex:l,columnIndex:f,translate:$,scale:x}})}const Y=({fullDataFormatter$:n,layout$:i})=>{const a=new P;function s({xAxis:r,yAxis:o,width:m,height:c}){if(!r||!o)return{translate:[0,0],scale:[1,1],rotate:0,rotateX:0,rotateY:0,value:""};let f=0,l=0,t=0,e=0,u=0;return r.position==="bottom"?o.position==="left"?(e=180,l=c):o.position==="right"?(e=180,u=180,f=m,l=c):(e=180,l=c):r.position==="top"?o.position==="left"||(o.position==="right"?(u=180,f=m):(e=180,l=c)):r.position==="left"?o.position==="bottom"?(t=-90,l=c):o.position==="top"?(t=-90,u=180):(e=180,l=c):r.position==="right"&&(o.position==="bottom"?(t=-90,e=180,l=c,f=m):o.position==="top"?(t=-90,e=180,u=180,f=m):(e=180,l=c)),{translate:[f,l],scale:[1,1],rotate:t,rotateX:e,rotateY:u,value:`translate(${f}px, ${l}px) rotate(${t}deg) rotateX(${e}deg) rotateY(${u}deg)`}}return new b(r=>(I({fullDataFormatter:n,layout:i}).pipe(g(a),F(async o=>o)).subscribe(o=>{const m=s({xAxis:o.fullDataFormatter.grid.groupAxis,yAxis:o.fullDataFormatter.grid.valueAxis,width:o.layout.width,height:o.layout.height});r.next(m)}),function(){a.next(void 0)}))},j=({gridAxesTransform$:n})=>n.pipe(p(i=>{const a=[0,0],s=[1/i.scale[0],1/i.scale[1]],r=i.rotate*-1,o=i.rotateX*-1,m=i.rotateY*-1;return{translate:a,scale:s,rotate:r,rotateX:o,rotateY:m,value:`translate(${a[0]}px, ${a[1]}px) rotate(${r}deg) rotateX(${o}deg) rotateY(${m}deg)`}})),E=({computedData$:n,fullDataFormatter$:i,layout$:a})=>I({computedData:n,fullDataFormatter:i,layout:a}).pipe(F(async r=>r),p(r=>r.fullDataFormatter.grid.separateSeries?G(r.layout,r.fullDataFormatter.container,r.computedData.length):G(r.layout,r.fullDataFormatter.container,1))),A="OverlappingValueAxes",h=y(A,"grid"),z=v(A,C)(({selection:n,name:i,subject:a,observer:s})=>{const r=new P,o=[],m=s.fullParams$.pipe(g(r),p(t=>t.gridIndexes[0])),c=s.fullParams$.pipe(g(r),p(t=>t.gridIndexes[1])),f=I({firstGridIndex:m,secondGridIndex:c,fullDataFormatter:s.fullDataFormatter$}).pipe(g(r),F(async t=>t),p(t=>{t.fullDataFormatter.gridList[t.secondGridIndex]||(t.fullDataFormatter.gridList[t.secondGridIndex]=Object.assign({},t.fullDataFormatter.gridList[t.firstGridIndex]));let e="";return t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="left"?e="right":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="bottom"?e="top":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="top"?e="bottom":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="right"&&(e="left"),{type:"grid",visibleFilter:t.fullDataFormatter.visibleFilter,grid:{...t.fullDataFormatter.gridList[t.secondGridIndex],valueAxis:{...t.fullDataFormatter.gridList[t.secondGridIndex].valueAxis,position:e}},container:{...t.fullDataFormatter.container}}}));return X(s).pipe(g(r),p(t=>({...t,fullParams$:t.fullParams$.pipe(p(e=>(e.gridIndexes.length>2&&(e.gridIndexes.length=2),e)))})),F(t=>O(t)),p(t=>t.map((e,u)=>{if(u===0)return e;const d=Y({fullDataFormatter$:f,layout$:s.layout$}),$=j({gridAxesTransform$:d}),x=E({computedData$:e.computedData$,fullDataFormatter$:f,layout$:s.layout$});return{...e,gridAxesTransform$:d,gridAxesReverseTransform$:$,gridContainerPosition$:x}}))).subscribe(t=>{o.forEach(e=>e()),n.selectAll(`g.${h}`).data(t).join("g").attr("class",h).each((e,u,d)=>{if(u>1)return;const $=L(d[u]),x=e.dataFormatter$.pipe(g(r),p(D=>D.grid.separateSeries),w(),T(1));o[u]=S(A,{selection:$,computedData$:e.computedData$,fullParams$:s.fullParams$.pipe(p(D=>u===0?D.firstAxis:D.secondAxis)),fullDataFormatter$:e.dataFormatter$,fullChartParams$:s.fullChartParams$,gridAxesTransform$:e.gridAxesTransform$,gridAxesReverseTransform$:e.gridAxesReverseTransform$,gridAxesSize$:e.gridAxesSize$,gridContainerPosition$:e.gridContainerPosition$,isSeriesSeprate$:x})})}),()=>{r.next(void 0),o.forEach(t=>t())}});export{z as O};
