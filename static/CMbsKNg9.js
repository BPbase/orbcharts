import{ay as $,az as p,aA as m,aB as G,b as I,R as C,S as P,t as h,m as d,h as R,o as V,p as N,aC as _}from"./Cs0Bj4Sj.js";import{z as v,g as L}from"./T4xlXSKD.js";import{E as T}from"./BEkOBKHl.js";var A=$(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function U(e){return p(function(i,a){var n=!1;i.subscribe(m(a,function(s){n=!0,a.next(s)},function(){n||a.next(e),a.complete()}))})}function Y(e){return e<=0?function(){return T}:p(function(i,a){var n=0;i.subscribe(m(a,function(s){++n<=e&&(a.next(s),e<=n&&a.complete())}))})}function j(e){return e===void 0&&(e=q),p(function(i,a){var n=!1;i.subscribe(m(a,function(s){n=!0,a.next(s)},function(){return n?a.complete():a.error(e())}))})}function q(){return new A}function B(e,i){var a=arguments.length>=2;return function(n){return n.pipe(G,Y(1),a?U(i):j(function(){return new A}))}}const y="ScalingArea",O=L(y,"rect"),Z=I(y,C)(({selection:e,rootSelection:i,name:a,observer:n,subject:s})=>{const c=new P,f=i.insert("rect","g").classed(O,!0).attr("opacity",0);let r={k:1,x:0,y:0};n.layout$.pipe(h(c)).subscribe(t=>{f.attr("width",t.width).attr("height",t.height).attr("x",t.left).attr("y",t.top)});const D=n.computedData$.pipe(d(t=>t[0]?t[0].length-1:0),R());return V({initGroupAxis:n.fullDataFormatter$.pipe(d(t=>t.grid.groupAxis),B()),fullDataFormatter:n.fullDataFormatter$,groupMaxIndex:D,layout:n.layout$,axisSize:n.gridAxesSize$}).pipe(h(c),N(async t=>t)).subscribe(t=>{const l=t.groupMaxIndex,M=t.initGroupAxis.scaleDomain[0]-t.initGroupAxis.scalePadding,S=t.initGroupAxis.scaleDomain[1]==="max"?l+t.initGroupAxis.scalePadding:t.initGroupAxis.scaleDomain[1]+t.initGroupAxis.scalePadding,x=_({maxValue:t.groupMaxIndex,minValue:0,axisWidth:t.axisSize.width,scaleDomain:[M,S],scaleRange:[0,1]}).copy(),E=v().on("zoom",function(k){const o=k.transform,g=z=>{const F=Math.round(z);return Math.min(l,Math.max(0,F))},u=t.fullDataFormatter.grid.groupAxis.position==="bottom"||t.fullDataFormatter.grid.groupAxis.position==="top"?o.rescaleX(x).domain().map(g):o.rescaleY(x).domain().map(g);u[0]<=0&&u[1]>=l?o.k<r.k&&(o.k=r.k,o.x=r.x,o.y=r.y):u[1]-u[0]<=1&&o.k>r.k&&(o.k=r.k,o.x=r.x,o.y=r.y),r.k=o.k,r.x=o.x,r.y=o.y;const w={...t.fullDataFormatter,grid:{...t.fullDataFormatter.grid,groupAxis:{...t.fullDataFormatter.grid.groupAxis,scaleDomain:u}}};s.dataFormatter$.next(w)});i.call(E)}),()=>{c.next(void 0),f.remove()}});export{Z as S};
