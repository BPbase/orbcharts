import{o as m,p as d,e as S,m as P,f as v,a3 as B,S as D,d as p,s as k,V as W,L as O,at as y,au as _,Z as x,ap as F}from"./D7osWch-.js";import{p as j,g as w,a as V,m as R}from"./D_qe6Wwi.js";import{c as z}from"./CBpExooO.js";function U({data:c,startAngle:t,endAngle:n}){return j().startAngle(t).endAngle(n).value(a=>a.value).sort((a,i)=>a.seq-i.seq)(c).map((a,i)=>{let o=a;return o.id=a.data.id,o})}function X({selection:c,pluginName:t,separateSeries$:n,seriesLabels$:h}){const l=w(t,"series");return m({seriesLabels:h,separateSeries:n}).pipe(d(async a=>a),P((a,i)=>{const o=a.separateSeries?a.seriesLabels:[a.seriesLabels.join("")];return c.selectAll(`g.${l}`).data(o,u=>u).join(u=>u.append("g").classed(l,!0),u=>u,u=>u.remove())}),v(1))}const Y=({selection:c,pluginName:t,separateSeries$:n,seriesLabels$:h,seriesContainerPosition$:l})=>{const a=X({selection:c,pluginName:t,separateSeries$:n,seriesLabels$:h});return m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async i=>i),S((i,o)=>i.seriesContainerPosition.length===o.seriesContainerPosition.length)).subscribe(i=>{i.seriesCenterSelection.attr("transform",(o,u)=>{const g=i.seriesContainerPosition[u]??i.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async i=>i)).subscribe(i=>{i.seriesCenterSelection.transition().attr("transform",(o,u)=>{const g=i.seriesContainerPosition[u]??i.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:a}},A="Pie",q={name:A,defaultParams:W,layerIndex:O,validator:(c,{validateColumns:t})=>t(c,{outerRadius:{toBeTypes:["number"]},innerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeTypes:["string"]},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]}})};function G({enter:c,exit:t,data:n,lastTweenData:h,fullParams:l}){return!c.size()&&!t.size()?a=>{const i=n.map((o,u)=>{const g=h[u]??{startAngle:0,endAngle:0,value:0};return{...o,startAngle:o.startAngle*a+g.startAngle*(1-a),endAngle:o.endAngle*a+g.endAngle*(1-a),value:o.value*a+g.value*(1-a)}});return T(i,l.startAngle,l.endAngle,1)}:a=>T(n,l.startAngle,l.endAngle,a)}function T(c,t,n,h){return c.map((l,a)=>{const i=t+(l.startAngle-t)*h,o=i+(l.endAngle-l.startAngle)*h;return{...l,startAngle:i,endAngle:o}})}function L({selection:c,data:t,arc:n,pathClassName:h,fullParams:l,fullChartParams:a}){return c.selectAll("path").data(t,o=>o.id).join("path").classed(h,!0).style("cursor","pointer").attr("fill",(o,u)=>o.data.color).attr("stroke",(o,u)=>V({datum:o.data,colorType:l.strokeColorType,fullChartParams:a})).attr("stroke-width",l.strokeWidth).attr("d",(o,u)=>n(o))}function Z({pathSelection:c,ids:t,fullChartParams:n,arc:h,arcHighlight:l}){if(c.interrupt("highlight"),!t.length){c.transition("highlight").style("opacity",1).attr("d",a=>h(a));return}c.each((a,i,o)=>{const u=k(o[i]);t.includes(a.data.id)?u.style("opacity",1).transition("highlight").ease(_).duration(500).attr("d",g=>l(g)):u.style("opacity",n.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>h(g))})}function J(c,t){const n=new D,h=w(c,"path");let l=[],a=[];const i=t.seriesContainerPosition$.pipe(p(n),P(s=>s.width<s.height?s.width:s.height),S()),o=new y(s=>{m({containerVisibleComputedLayoutData:t.containerVisibleComputedLayoutData$,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=U({data:e.containerVisibleComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s.next(r)})}),u=new y(s=>{m({shorterSideWith:i,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=R({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(r)})}),g=new y(s=>{m({shorterSideWith:i,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=R({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadiusWhileHighlight,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(r)})}),$=t.fullChartParams$.pipe(p(n),P(s=>s.highlightTarget),S()),f=new y(s=>{m({pieData:o,arc:u,computedData:t.computedData$,fullParams:t.fullParams$,fullChartParams:t.fullChartParams$,highlightTarget:$}).pipe(p(n),d(async e=>e)).subscribe(e=>{t.containerSelection.interrupt("graphicMove");const r=t.containerSelection.selectAll("path").data(e.pieData,b=>b.id),N=r.enter(),H=r.exit(),I=G({enter:N,exit:H,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});t.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",(b,M)=>C=>{a=I(C),L({selection:t.containerSelection,data:a,arc:e.arc,pathClassName:h,fullParams:e.fullParams,fullChartParams:e.fullChartParams})}).on("end",(b,M)=>{a=T(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const C=L({selection:t.containerSelection,data:a,arc:e.arc,pathClassName:h,fullParams:e.fullParams,fullChartParams:e.fullChartParams});s.next(C),l=Object.assign([],e.pieData),t.event$.next({type:"series",pluginName:c,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})})})}).pipe(v(1));return m({pathSelection:f,SeriesDataMap:t.SeriesDataMap$,computedData:t.computedData$,highlightTarget:$}).pipe(p(n),d(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mouseover",pluginName:c,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("mousemove",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mousemove",pluginName:c,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("mouseout",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mouseout",pluginName:c,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("click",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"click",pluginName:c,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})})}),m({pathSelection:f,highlight:t.seriesHighlight$.pipe(P(s=>s.map(e=>e.id))),fullChartParams:t.fullChartParams$,arc:u,arcHighlight:g}).pipe(p(n),d(async s=>s)).subscribe(s=>{Z({pathSelection:s.pathSelection,ids:s.highlight,fullChartParams:s.fullChartParams,arc:s.arc,arcHighlight:s.arcHighlight})}),()=>{n.next(void 0)}}const se=B(q)(({selection:c,name:t,subject:n,observer:h})=>{const l=new D,{seriesCenterSelection$:a}=Y({selection:c,pluginName:A,separateSeries$:h.separateSeries$,seriesLabels$:h.seriesLabels$,seriesContainerPosition$:h.seriesContainerPosition$}),i=[];return a.pipe(p(l)).subscribe(o=>{i.forEach(u=>u()),o.each((u,g,$)=>{const f=k($[g]),s=h.visibleComputedLayoutData$.pipe(p(l),P(r=>r[g]??r[0])),e=h.seriesContainerPosition$.pipe(p(l),P(r=>r[g]??r[0]));i[g]=J(A,{containerSelection:f,computedData$:h.computedData$,containerVisibleComputedLayoutData$:s,SeriesDataMap$:h.SeriesDataMap$,fullParams$:h.fullParams$,fullChartParams$:h.fullChartParams$,seriesHighlight$:h.seriesHighlight$,seriesContainerPosition$:e,event$:n.event$})})}),()=>{l.next(void 0),i.forEach(o=>o())}}),E="SeriesLegend",K={name:E,defaultParams:x,layerIndex:F,validator:(c,{validateColumns:t})=>t(c,{padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},ae=B(K)(({selection:c,rootSelection:t,observer:n,subject:h})=>{const l=new D,a=n.SeriesDataMap$.pipe(p(l),P(u=>Array.from(u.keys()))),i=n.fullParams$.pipe(p(l),P(u=>{const g=[{listRectWidth:u.listRectWidth,listRectHeight:u.listRectHeight,listRectRadius:u.listRectRadius}];return{...u,seriesList:g}})),o=z(E,{rootSelection:t,seriesLabels$:a,fullParams$:i,layout$:n.layout$,fullChartParams$:n.fullChartParams$,textSizePx$:n.textSizePx$});return()=>{l.next(void 0),o()}});export{se as P,ae as S,U as m,Y as s};
