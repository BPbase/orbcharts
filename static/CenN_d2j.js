import{S as H,t as i,ca as M,k as P,l as b,m as v,d as O,g as T,cb as R,cc as j,be as w}from"./ZOIXw5Nq.js";import{t as W,m as D}from"./PF0ULQt1.js";import{f as A}from"./BbzAf_0F.js";import{a as X}from"./B9T9MwJ3.js";function Y(r,l){const p=l.textSizePx*1.5,d=(r==null?[]:Array.isArray(r)?r:typeof r=="string"?r.split(`
`):[r]).filter(c=>c!="").map((c,o)=>`<tspan x="0" y="${o*p}">${c}</tspan>`).join("");return d?`<text font-size="${l.textSize}" fill="${l.textColor}" x="0" y="0" style="dominant-baseline:text-before-edge">
    ${d}
  </text>`:""}function G({rootSelection:r,pluginName:l,gClassName:p,boxClassName:x,rootWidth:d,rootHeight:c,svgString:o,tooltipStyle:s,event:f}){r.interrupt("fadeout");const y=5,u=o?[o]:[],$=o?[s]:[],n=r.selectAll(`g.${p}`).data(u).join(e=>e.append("g").classed(p,!0).attr("pointer-events","none"),e=>e,e=>e.style("opacity",0).remove()).attr("transform",()=>`translate(${f.offsetX}, ${f.offsetY})`).selectAll(`g.${x}`).data($).join(e=>e.append("g").classed(T(l,"box"),!0)),z=n.selectAll("rect").data($).join(e=>e.append("rect").attr("rx",y).attr("ry",y)).attr("fill",e=>e.backgroundColor).attr("stroke",e=>e.strokeColor).attr("opacity",e=>e.backgroundOpacity),m=n.selectAll("g").data(u).join(e=>e.append("g").classed(T(l,"content"),!0).attr("transform",()=>`translate(${s.padding}, ${s.padding})`));u.length&&R(m,u[0]);const C=m!=null&&m.node()?j(m):{width:0,height:0};z.attr("width",C.width+s.padding*2).attr("height",C.height+s.padding*2);const S=n!=null&&n.node()?j(n):{width:0,height:0},t=d-S.width,h=c-S.height,a=f.offsetX+s.offset[0]>t?t-f.offsetX:s.offset[0],g=f.offsetY+s.offset[1]>h?h-f.offsetY:s.offset[1];n.attr("transform",e=>`translate(${a}, ${g})`),n.attr("transform",e=>`translate(${a}, ${g})`)}const q=(r,{rootSelection:l,fullParams$:p,fullChartParams$:x,layout$:d,event$:c})=>{const o=new H,s=T(r,"g"),f=T(r,"box"),y=c.pipe(i(o),A(t=>t.eventName==="mouseover"||t.eventName==="mousemove")),u=c.pipe(i(o),A(t=>t.eventName==="mouseout")),$=M(x),k=P({fullChartParams:x,fullParams:p,textSizePx:$}).pipe(i(o),b(async t=>t),v(t=>({backgroundColor:w(t.fullParams.backgroundColorType,t.fullChartParams),backgroundOpacity:t.fullParams.backgroundOpacity,strokeColor:w(t.fullParams.strokeColorType,t.fullChartParams),offset:t.fullParams.offset,padding:t.fullParams.padding,textSize:t.fullChartParams.styles.textSize,textSizePx:t.textSizePx,textColor:w(t.fullParams.textColorType,t.fullChartParams),seriesColors:t.fullChartParams.colors[t.fullChartParams.colorScheme].label}))),n=P({fullParams:p,tooltipStyle:k}).pipe(i(o),b(async t=>t),v(t=>h=>{const a=t.fullParams.renderFn(h,{utils:{toCurrency:W,measureTextWidth:D},styles:t.tooltipStyle});if(typeof a=="string"){const g=a.trim();if(g.slice(0,1)==="<"&&g.slice(g.length-1,g.length)===">")return a;{const F=a.split(`
`);return Y(F,t.tooltipStyle)}}else if(Array.isArray(a))return Y(a,t.tooltipStyle);return""})),z=P({event:y,contentRenderFn:n}).pipe(i(o),b(async t=>t),v(t=>t.contentRenderFn(t.event))),m=u.pipe(i(o),v(t=>"")),C=X(z,m).pipe(i(o),O((t,h)=>t===h)),S=X(y,u).pipe(i(o),v(t=>t.event));return P({svgString:C,eventTooltip:S,layout:d,tooltipStyle:k}).pipe(i(o),b(async t=>t)).subscribe(t=>{G({rootSelection:l,pluginName:r,gClassName:s,boxClassName:f,rootWidth:t.layout.rootWidth,rootHeight:t.layout.rootHeight,svgString:t.svgString,tooltipStyle:t.tooltipStyle,event:t.eventTooltip})}),()=>{o.next(void 0)}};export{q as c};
