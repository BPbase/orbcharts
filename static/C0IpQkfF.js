import{j as m,k as d,d as S,m as P,a as k,g as B,ak as v,S as D,t as p,s as w,a0 as W,L as O,aN as b,x as _,aO as x,a6 as F,aJ as j}from"./DXm0Mz1x.js";import{p as z,m as R}from"./goxUyvVz.js";import{c as U}from"./BR0pJPdU.js";function V({data:g,startAngle:t,endAngle:n}){return z().startAngle(t).endAngle(n).value(a=>a.value).sort((a,i)=>a.seq-i.seq)(g).map((a,i)=>{let o=a;return o.id=a.data.id,o})}function X({selection:g,pluginName:t,separateSeries$:n,seriesLabels$:c}){const l=B(t,"series");return m({seriesLabels:c,separateSeries:n}).pipe(d(async a=>a),P((a,i)=>{const o=a.separateSeries?a.seriesLabels:[a.seriesLabels.join("")];return g.selectAll(`g.${l}`).data(o,u=>u).join(u=>u.append("g").classed(l,!0),u=>u,u=>u.remove())}),k(1))}const Y=({selection:g,pluginName:t,separateSeries$:n,seriesLabels$:c,seriesContainerPosition$:l})=>{const a=X({selection:g,pluginName:t,separateSeries$:n,seriesLabels$:c});return m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async i=>i),S((i,o)=>i.seriesContainerPosition.length===o.seriesContainerPosition.length)).subscribe(i=>{i.seriesCenterSelection.attr("transform",(o,u)=>{const h=i.seriesContainerPosition[u]??i.seriesContainerPosition[0];return`translate(${h.centerX}, ${h.centerY})`})}),m({seriesCenterSelection:a,seriesContainerPosition:l}).pipe(d(async i=>i)).subscribe(i=>{i.seriesCenterSelection.transition().attr("transform",(o,u)=>{const h=i.seriesContainerPosition[u]??i.seriesContainerPosition[0];return`translate(${h.centerX}, ${h.centerY})`})}),{seriesCenterSelection$:a}},A="Pie",q={name:A,defaultParams:W,layerIndex:O,validator:(g,{validateColumns:t})=>t(g,{outerRadius:{toBeTypes:["number"]},innerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeTypes:["string"]},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]}})};function G({enter:g,exit:t,data:n,lastTweenData:c,fullParams:l}){return!g.size()&&!t.size()?a=>{const i=n.map((o,u)=>{const h=c[u]??{startAngle:0,endAngle:0,value:0};return{...o,startAngle:o.startAngle*a+h.startAngle*(1-a),endAngle:o.endAngle*a+h.endAngle*(1-a),value:o.value*a+h.value*(1-a)}});return T(i,l.startAngle,l.endAngle,1)}:a=>T(n,l.startAngle,l.endAngle,a)}function T(g,t,n,c){return g.map((l,a)=>{const i=t+(l.startAngle-t)*c,o=i+(l.endAngle-l.startAngle)*c;return{...l,startAngle:i,endAngle:o}})}function L({selection:g,data:t,arc:n,pathClassName:c,fullParams:l,fullChartParams:a}){return g.selectAll("path").data(t,o=>o.id).join("path").classed(c,!0).style("cursor","pointer").attr("fill",(o,u)=>o.data.color).attr("stroke",(o,u)=>_({datum:o.data,colorType:l.strokeColorType,fullChartParams:a})).attr("stroke-width",l.strokeWidth).attr("d",(o,u)=>n(o))}function J({pathSelection:g,ids:t,fullChartParams:n,arc:c,arcHighlight:l}){if(g.interrupt("highlight"),!t.length){g.transition("highlight").style("opacity",1).attr("d",a=>c(a));return}g.each((a,i,o)=>{const u=w(o[i]);t.includes(a.data.id)?u.style("opacity",1).transition("highlight").ease(x).duration(500).attr("d",h=>l(h)):u.style("opacity",n.styles.unhighlightedOpacity).transition("highlight").attr("d",h=>c(h))})}function K(g,t){const n=new D,c=B(g,"path");let l=[],a=[];const i=t.seriesContainerPosition$.pipe(p(n),P(s=>s.width<s.height?s.width:s.height),S()),o=new b(s=>{m({containerVisibleComputedLayoutData:t.containerVisibleComputedLayoutData$,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=V({data:e.containerVisibleComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s.next(r)})}),u=new b(s=>{m({shorterSideWith:i,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=R({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(r)})}),h=new b(s=>{m({shorterSideWith:i,fullParams:t.fullParams$}).pipe(p(n),d(async e=>e)).subscribe(e=>{const r=R({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadiusWhileHighlight,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});s.next(r)})}),f=t.fullChartParams$.pipe(p(n),P(s=>s.highlightTarget),S()),$=new b(s=>{m({pieData:o,arc:u,computedData:t.computedData$,fullParams:t.fullParams$,fullChartParams:t.fullChartParams$,highlightTarget:f}).pipe(p(n),d(async e=>e)).subscribe(e=>{t.containerSelection.interrupt("graphicMove");const r=t.containerSelection.selectAll("path").data(e.pieData,y=>y.id),E=r.enter(),H=r.exit(),I=G({enter:E,exit:H,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});t.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",(y,M)=>C=>{a=I(C),L({selection:t.containerSelection,data:a,arc:e.arc,pathClassName:c,fullParams:e.fullParams,fullChartParams:e.fullChartParams})}).on("end",(y,M)=>{a=T(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const C=L({selection:t.containerSelection,data:a,arc:e.arc,pathClassName:c,fullParams:e.fullParams,fullChartParams:e.fullChartParams});s.next(C),l=Object.assign([],e.pieData),t.event$.next({type:"series",pluginName:g,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})})})}).pipe(k(1));return m({pathSelection:$,SeriesDataMap:t.SeriesDataMap$,computedData:t.computedData$,highlightTarget:f}).pipe(p(n),d(async s=>s)).subscribe(s=>{s.pathSelection.on("mouseover",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mouseover",pluginName:g,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("mousemove",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mousemove",pluginName:g,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("mouseout",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"mouseout",pluginName:g,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})}).on("click",(e,r)=>{e.stopPropagation(),t.event$.next({type:"series",eventName:"click",pluginName:g,highlightTarget:s.highlightTarget,datum:r.data,series:s.SeriesDataMap.get(r.data.seriesLabel),seriesIndex:r.data.seriesIndex,seriesLabel:r.data.seriesLabel,event:e,data:s.computedData})})}),m({pathSelection:$,highlight:t.seriesHighlight$.pipe(P(s=>s.map(e=>e.id))),fullChartParams:t.fullChartParams$,arc:u,arcHighlight:h}).pipe(p(n),d(async s=>s)).subscribe(s=>{J({pathSelection:s.pathSelection,ids:s.highlight,fullChartParams:s.fullChartParams,arc:s.arc,arcHighlight:s.arcHighlight})}),()=>{n.next(void 0)}}const se=v(q)(({selection:g,name:t,subject:n,observer:c})=>{const l=new D,{seriesCenterSelection$:a}=Y({selection:g,pluginName:A,separateSeries$:c.separateSeries$,seriesLabels$:c.seriesLabels$,seriesContainerPosition$:c.seriesContainerPosition$}),i=[];return a.pipe(p(l)).subscribe(o=>{i.forEach(u=>u()),o.each((u,h,f)=>{const $=w(f[h]),s=c.visibleComputedLayoutData$.pipe(p(l),P(r=>r[h]??r[0])),e=c.seriesContainerPosition$.pipe(p(l),P(r=>r[h]??r[0]));i[h]=K(A,{containerSelection:$,computedData$:c.computedData$,containerVisibleComputedLayoutData$:s,SeriesDataMap$:c.SeriesDataMap$,fullParams$:c.fullParams$,fullChartParams$:c.fullChartParams$,seriesHighlight$:c.seriesHighlight$,seriesContainerPosition$:e,event$:n.event$})})}),()=>{l.next(void 0),i.forEach(o=>o())}}),N="SeriesLegend",Q={name:N,defaultParams:F,layerIndex:j,validator:(g,{validateColumns:t})=>t(g,{placement:{toBe:'"top" | "top-start" | "top-end" | "bottom" | "bottom-start" | "bottom-end" | "left" | "left-start" | "left-end" | "right" | "right-start" | "right-end"',test:c=>["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"].includes(c)},padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},ae=v(Q)(({selection:g,rootSelection:t,observer:n,subject:c})=>{const l=new D,a=n.SeriesDataMap$.pipe(p(l),P(u=>Array.from(u.keys()))),i=n.fullParams$.pipe(p(l),P(u=>{const h=[{listRectWidth:u.listRectWidth,listRectHeight:u.listRectHeight,listRectRadius:u.listRectRadius}];return{...u,labelList:h}})),o=U(N,{rootSelection:t,legendLabels$:a,fullParams$:i,layout$:n.layout$,fullChartParams$:n.fullChartParams$,textSizePx$:n.textSizePx$});return()=>{l.next(void 0),o()}});export{se as P,ae as S,V as m,Y as s};
