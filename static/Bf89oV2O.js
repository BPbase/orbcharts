import{aJ as w,aK as m,aL as f,aM as I,Q as P,S as _,m as p,e as C,o as d,d as y,p as M,Y as L,aN as N,aO as O}from"./BmSCDJil.js";import{z as S}from"./DQaJP6Gt.js";import{E as R}from"./BRZTqlJD.js";var h=w(function(o){return function(){o(this),this.name="EmptyError",this.message="no elements in sequence"}});function T(o){return m(function(i,n){var a=!1;i.subscribe(f(n,function(u){a=!0,n.next(u)},function(){a||n.next(o),n.complete()}))})}function V(o){return o<=0?function(){return R}:m(function(i,n){var a=0;i.subscribe(f(n,function(u){++a<=o&&(n.next(u),o<=a&&n.complete())}))})}function v(o){return o===void 0&&(o=Y),m(function(i,n){var a=!1;i.subscribe(f(n,function(u){a=!0,n.next(u)},function(){return a?n.complete():n.error(o())}))})}function Y(){return new h}function U(o,i){var n=arguments.length>=2;return function(a){return a.pipe(I,V(1),n?T(i):v(function(){return new h}))}}const Q="ScalingArea",X={name:Q,defaultParams:L,layerIndex:N,validator:(o,{validateColumns:i})=>({status:"success",columnName:"",expectToBe:""})},K=P(X)(({selection:o,rootSelection:i,name:n,observer:a,subject:u})=>{const c=new _;let r={k:1,x:0,y:0};const x=a.computedData$.pipe(p(t=>t[0]?t[0].length-1:0),C()),E=a.fullDataFormatter$.pipe(p(t=>t.grid.groupAxis),U()),k=d({initGroupAxis:E,fullDataFormatter:a.fullDataFormatter$,groupMax:x,layout:a.layout$,axisSize:a.gridAxesSize$}).pipe(y(c),M(async t=>t),p(t=>{const g=t.initGroupAxis.scaleDomain[0]-t.initGroupAxis.scalePadding,l=t.initGroupAxis.scaleDomain[1]==="max"?t.groupMax+t.initGroupAxis.scalePadding:t.initGroupAxis.scaleDomain[1]+t.initGroupAxis.scalePadding;return O({maxValue:t.groupMax,minValue:0,axisWidth:t.axisSize.width,scaleDomain:[g,l],scaleRange:[0,1]})}));return d({groupScale:k,fullDataFormatter:a.fullDataFormatter$,groupMax:x}).pipe(y(c),M(async t=>t)).subscribe(t=>{const l=t.groupScale.copy(),A=S().on("zoom",function(F){const e=F.transform,D=z=>{const G=Math.round(z);return Math.min(t.groupMax,Math.max(0,G))},s=t.fullDataFormatter.grid.groupAxis.position==="bottom"||t.fullDataFormatter.grid.groupAxis.position==="top"?e.rescaleX(l).domain().map(D):e.rescaleY(l).domain().map(D);s[0]<=0&&s[1]>=t.groupMax?e.k<r.k&&(e.k=r.k,e.x=r.x,e.y=r.y):s[1]-s[0]<=1&&e.k>r.k&&(e.k=r.k,e.x=r.x,e.y=r.y),r.k=e.k,r.x=e.x,r.y=e.y;const $={...t.fullDataFormatter,grid:{...t.fullDataFormatter.grid,groupAxis:{...t.fullDataFormatter.grid.groupAxis,scaleDomain:s}}};u.dataFormatter$.next($)});i.call(A)}),()=>{c.next(void 0),i.call(S().on("zoom",null))}});export{K as S};
