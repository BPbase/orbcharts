import{S as P,O as b,g as I,t as d,s as A,e as p,$ as v,h as L,f as C}from"./sHDoh0EE.js";import{j as w,m as O}from"./BpDohAhO.js";import{c as S}from"./DAvjtiml.js";import{s as T,g as y}from"./opDUeYou.js";import{o as X}from"./o2jJrSQb.js";function R(a){let i=Math.floor(Math.sqrt(a)),n=Math.ceil(a/i);for(;i*n<a;)n++;return{rowAmount:i,columnAmount:n}}function h(a,i,n){const{gap:s}=i,{rowAmount:r,columnAmount:o}=i.rowAmount*i.columnAmount>=n?i:R(n);return new Array(n).fill(null).map((f,l)=>{const m=l%o,u=Math.floor(l/o),t=(a.width-s*(o-1))/o,e=(a.height-s*(r-1))/r,c=m*t+m*s,g=u*e+u*s,$=[c,g],x=[t/a.width,e/a.height];return{slotIndex:l,rowIndex:u,columnIndex:m,translate:$,scale:x}})}const Y=({fullDataFormatter$:a,layout$:i})=>{const n=new P;function s({xAxis:r,yAxis:o,width:f,height:l}){if(!r||!o)return{translate:[0,0],scale:[1,1],rotate:0,rotateX:0,rotateY:0,value:""};let m=0,u=0,t=0,e=0,c=0;return r.position==="bottom"?o.position==="left"?(e=180,u=l):o.position==="right"?(e=180,c=180,m=f,u=l):(e=180,u=l):r.position==="top"?o.position==="left"||(o.position==="right"?(c=180,m=f):(e=180,u=l)):r.position==="left"?o.position==="bottom"?(t=-90,u=l):o.position==="top"?(t=-90,c=180):(e=180,u=l):r.position==="right"&&(o.position==="bottom"?(t=-90,e=180,u=l,m=f):o.position==="top"?(t=-90,e=180,c=180,m=f):(e=180,u=l)),{translate:[m,u],scale:[1,1],rotate:t,rotateX:e,rotateY:c,value:`translate(${m}px, ${u}px) rotate(${t}deg) rotateX(${e}deg) rotateY(${c}deg)`}}return new b(r=>(I({fullDataFormatter:a,layout:i}).pipe(d(n),A(async o=>o)).subscribe(o=>{const f=s({xAxis:o.fullDataFormatter.grid.groupAxis,yAxis:o.fullDataFormatter.grid.valueAxis,width:o.layout.width,height:o.layout.height});r.next(f)}),function(){n.next(void 0)}))},E=({gridAxesTransform$:a})=>a.pipe(p(i=>{const n=[0,0],s=[1/i.scale[0],1/i.scale[1]],r=i.rotate*-1,o=i.rotateX*-1,f=i.rotateY*-1;return{translate:n,scale:s,rotate:r,rotateX:o,rotateY:f,value:`translate(${n[0]}px, ${n[1]}px) rotate(${r}deg) rotateX(${o}deg) rotateY(${f}deg)`}})),M=({computedData$:a,fullDataFormatter$:i,layout$:n})=>I({computedData:a,fullDataFormatter:i,layout:n}).pipe(A(async r=>r),p(r=>{if(r.fullDataFormatter.grid.separateSeries)return h(r.layout,r.fullDataFormatter.container,r.computedData.length);{const o=h(r.layout,r.fullDataFormatter.container,1);return r.computedData.map((f,l)=>o[0])}})),F="OverlappingValueAxes",G=y(F,"grid"),z=v(F,w)(({selection:a,name:i,subject:n,observer:s})=>{const r=new P,o=[],f=s.fullParams$.pipe(d(r),p(t=>t.gridIndexes[0])),l=s.fullParams$.pipe(d(r),p(t=>t.gridIndexes[1])),m=I({firstGridIndex:f,secondGridIndex:l,fullDataFormatter:s.fullDataFormatter$}).pipe(d(r),A(async t=>t),p(t=>{t.fullDataFormatter.gridList[t.secondGridIndex]||(t.fullDataFormatter.gridList[t.secondGridIndex]=Object.assign({},t.fullDataFormatter.gridList[t.firstGridIndex]));let e="";return t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="left"?e="right":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="bottom"?e="top":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="top"?e="bottom":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="right"&&(e="left"),{type:"grid",visibleFilter:t.fullDataFormatter.visibleFilter,grid:{...t.fullDataFormatter.gridList[t.secondGridIndex],valueAxis:{...t.fullDataFormatter.gridList[t.secondGridIndex].valueAxis,position:e}},container:{...t.fullDataFormatter.container}}}));return X(s).pipe(d(r),p(t=>({...t,fullParams$:t.fullParams$.pipe(p(e=>(e.gridIndexes.length>2&&(e.gridIndexes.length=2),e)))})),A(t=>O(t)),p(t=>t.map((e,c)=>{if(c===0)return e;const g=Y({fullDataFormatter$:m,layout$:s.layout$}),$=E({gridAxesTransform$:g}),x=M({computedData$:e.computedData$,fullDataFormatter$:m,layout$:s.layout$});return{...e,gridAxesTransform$:g,gridAxesReverseTransform$:$,gridContainerPosition$:x}}))).pipe(d(r)).subscribe(t=>{o.forEach(e=>e()),a.selectAll(`g.${G}`).data(t).join("g").attr("class",G).each((e,c,g)=>{if(c>1)return;const $=L(g[c]),x=e.dataFormatter$.pipe(d(r),p(D=>D.grid.separateSeries),C(),T(1));o[c]=S(F,{selection:$,computedData$:e.computedData$,fullParams$:s.fullParams$.pipe(p(D=>c===0?D.firstAxis:D.secondAxis)),fullDataFormatter$:e.dataFormatter$,fullChartParams$:s.fullChartParams$,gridAxesTransform$:e.gridAxesTransform$,gridAxesReverseTransform$:e.gridAxesReverseTransform$,gridAxesSize$:e.gridAxesSize$,gridContainerPosition$:e.gridContainerPosition$,isSeriesSeprate$:x})})}),()=>{r.next(void 0),o.forEach(t=>t())}});export{z as O};
