import{a as _,p as N,t as g,m as h,d as D,k as u,l as b,aT as E,s as I,bl as ee,b8 as re,g as ie}from"./Bh8imPUI.js";import{o as te}from"./CorttYm4.js";const H=.3;function $({axisWidth:t,groupAmount:s,barAmountOfGroup:o,barPadding:l=0,barGroupPadding:c=0}){const S=((s>1?t/(s-1):t)-c)/o-l;return S>1?S:1}function ae(t,s,o){const l=t/2,c=t*s.length+o.barPadding*s.length;return ee().domain(s).range([-c/2+l,c/2-l])}function se(t,s){return t<=1?0:s/(t-1)*H}function oe(t,s){return t<=1?s:s*(1-H)}function ne({graphicGSelection:t,rectClassName:s,visibleComputedAxesData:o,zeroYArr:l,groupLabels:c,barScale:n,params:S,chartParams:G,barWidth:L,transformedBarRadius:x,delayGroup:m,transitionItem:P,isSeriesSeprate:A}){const W=L/2;return t.each((M,d,f)=>{I(f[d]).selectAll(`rect.${s}`).data(o[d]??[],a=>a.id).join(a=>a.append("rect").classed(s,!0).attr("cursor","pointer").attr("height",p=>1),a=>a,a=>a.remove()).attr("transform",(a,p)=>`translate(${(a?a.axisX:0)-W}, 0)`).attr("fill",a=>a.color).attr("y",a=>a.axisY<l[d]?a.axisY:l[d]).attr("x",a=>A?0:n(a.seriesLabel)).attr("width",L).attr("rx",x[d][0]??1).attr("ry",x[d][1]??1).transition().duration(P).ease(re(G.transitionEase)).delay((a,p)=>a.groupIndex*m).attr("height",a=>Math.abs(a.axisYFromZero)||1)}),t.selectAll(`rect.${s}`)}function pe({defsSelection:t,clipPathData:s}){t.selectAll("clipPath").data(s).join(o=>o.append("clipPath"),o=>o,o=>o.remove()).attr("id",o=>o.id).each((o,l,c)=>{I(c[l]).selectAll("rect").data([o]).join(n=>n.append("rect"),n=>n,n=>n.remove()).attr("x",0).attr("y",0).attr("width",n=>n.width).attr("height",n=>n.height)})}function ce({selection:t,ids:s,fullChartParams:o}){if(t.interrupt("highlight"),!s.length){t.transition("highlight").duration(200).style("opacity",1);return}t.each((l,c,n)=>{s.includes(l.id)?I(n[c]).style("opacity",1):I(n[c]).style("opacity",o.styles.unhighlightedOpacity)})}const be=(t,{selection:s,computedData$:o,computedAxesData$:l,visibleComputedData$:c,visibleComputedAxesData$:n,seriesLabels$:S,SeriesDataMap$:G,GroupDataMap$:L,fullParams$:x,fullChartParams$:m,gridAxesTransform$:P,gridGraphicTransform$:A,gridGraphicReverseScale$:W,gridAxesSize$:v,gridHighlight$:M,gridContainerPosition$:d,isSeriesSeprate$:f,event$:a})=>{const p=new _,B=N(t,"clipPath-box"),U=ie(t,"rect"),{seriesSelection$:ge,axesSelection$:le,defsSelection$:F,graphicGSelection$:Z}=te({selection:s,pluginName:t,clipPathID:B,seriesLabels$:S,gridContainerPosition$:d,gridAxesTransform$:P,gridGraphicTransform$:A}),X=n.pipe(g(p),h(e=>e.map(i=>i[0]?i[0].axisY-i[0].axisYFromZero:0)),D()),R=u({computedData:o,visibleComputedData:c,params:x,gridAxesSize:v,isSeriesSeprate:f}).pipe(g(p),b(async e=>e),h(e=>e.params.barWidth?e.params.barWidth:e.isSeriesSeprate?$({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:1,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding}):$({axisWidth:e.gridAxesSize.width,groupAmount:e.computedData[0]?e.computedData[0].length:0,barAmountOfGroup:e.visibleComputedData.length,barPadding:e.params.barPadding,barGroupPadding:e.params.barGroupPadding})),D()),q=u({computedData:o,barWidth:R,params:x,gridGraphicReverseScale:W}).pipe(g(p),b(async e=>e),h(e=>{const i=e.barWidth/2,r=e.params.barRadius===!0?i:e.params.barRadius===!1?0:typeof e.params.barRadius=="number"?e.params.barRadius:0;return e.computedData.map((k,V)=>{const C=e.gridGraphicReverseScale[V]??e.gridGraphicReverseScale[0];let y=r*C[0],w=r*C[1];if(y>i){const j=i/y;y=y*j,w=w*j}return[y,w]})})),T=c.pipe(g(p),h(e=>{const i=new Set;return e.forEach(r=>{r.forEach(k=>{i.add(k.groupLabel)})}),Array.from(i)})),J=u({seriesLabels:S,barWidth:R,params:x}).pipe(g(p),b(async e=>e),h(e=>ae(e.barWidth,e.seriesLabels,e.params))),z=m.pipe(g(p),h(e=>e.transitionDuration),D()),K=new E(e=>{u({groupLabels:T,transitionDuration:z}).pipe(b(async i=>i)).subscribe(i=>{const r=se(i.groupLabels.length,i.transitionDuration);e.next(r)})}).pipe(g(p),D()),Q=new E(e=>{u({groupLabels:T,transitionDuration:z}).pipe(b(async i=>i)).subscribe(i=>{const r=oe(i.groupLabels.length,i.transitionDuration);e.next(r)})}).pipe(g(p),D());u({defsSelection:F,gridAxesSize:v}).pipe(g(p),b(async e=>e)).subscribe(e=>{const i=[{id:B,width:e.gridAxesSize.width,height:e.gridAxesSize.height}];pe({defsSelection:e.defsSelection,clipPathData:i})});const Y=m.pipe(g(p),h(e=>e.highlightTarget),D()),O=u({graphicGSelection:Z,visibleComputedAxesData:n,zeroYArr:X,groupLabels:T,barScale:J,params:x,chartParams:m,highlightTarget:Y,barWidth:R,transformedBarRadius:q,delayGroup:K,transitionItem:Q,isSeriesSeprate:f}).pipe(g(p),b(async e=>e),h(e=>ne({graphicGSelection:e.graphicGSelection,rectClassName:U,visibleComputedAxesData:e.visibleComputedAxesData,zeroYArr:e.zeroYArr,groupLabels:e.groupLabels,barScale:e.barScale,params:e.params,chartParams:e.chartParams,barWidth:e.barWidth,transformedBarRadius:e.transformedBarRadius,delayGroup:e.delayGroup,transitionItem:e.transitionItem,isSeriesSeprate:e.isSeriesSeprate})));return u({barSelection:O,computedData:o,highlightTarget:Y,SeriesDataMap:G,GroupDataMap:L}).pipe(g(p),b(async e=>e)).subscribe(e=>{e.barSelection.on("mouseover",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"mouseover",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})}).on("mousemove",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"mousemove",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})}).on("mouseout",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"mouseout",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})}).on("click",(i,r)=>{i.stopPropagation(),a.next({type:"grid",eventName:"click",pluginName:t,highlightTarget:e.highlightTarget,datum:r,gridIndex:r.gridIndex,series:e.SeriesDataMap.get(r.seriesLabel),seriesIndex:r.seriesIndex,seriesLabel:r.seriesLabel,group:e.GroupDataMap.get(r.groupLabel),groupIndex:r.groupIndex,groupLabel:r.groupLabel,event:i,data:e.computedData})})}),u({barSelection:O,highlight:M.pipe(h(e=>e.map(i=>i.id))),fullChartParams:m}).pipe(g(p),b(async e=>e)).subscribe(e=>{ce({selection:e.barSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{p.next(void 0)}};export{be as c};
