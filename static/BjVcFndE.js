import{w as D,S as g,g as P,t as h,d as f,f as d,s as y}from"./CKVrw-ui.js";import{b as L}from"./Do0D4Nqc.js";import{s as S,m as x}from"./B73wNtKf.js";import{b as $,c as A,g as R}from"./CvclR5B5.js";const c="PieLabels",w=R(c,"text");function v(o,t,l,a){return o.map((s,e)=>{const[n,r]=t.centroid(s),[i,u]=l.centroid(s);return{pieDatum:s,arcIndex:e,arcLabel:s.data.label,x:n*a,y:r*a,mouseoverX:i*a,mouseoverY:u*a}}).filter(s=>s.pieDatum.data.visible)}function _(o,t,l,a){let s=o.selectAll("text").data(t,i=>i.pieDatum.id),e=s.enter().append("text").classed(w,!0),n=s.exit();e.append("text");const r=s.merge(e);return r.attr("font-weight","bold").attr("text-anchor","middle").style("dominant-baseline","middle").style("cursor",i=>a.highlightTarget&&a.highlightTarget!="none"?"pointer":"none").text(i=>l.labelFn(i.pieDatum.data)).attr("font-size",a.styles.textSize).attr("fill",(i,u)=>A({datum:i.pieDatum.data,colorType:l.labelColorType,fullChartParams:a})).transition().attr("transform",i=>"translate("+i.x+","+i.y+")"),n.remove(),r}function E({labelSelection:o,ids:t,fullChartParams:l}){if(o.interrupt("highlight"),!t.length){o.transition().duration(200).attr("transform",a=>"translate("+a.x+","+a.y+")").style("opacity",1);return}o.each((a,s,e)=>{const n=P(e[s]);t.includes(a.pieDatum.id)?n.style("opacity",1).transition().duration(200).attr("transform",r=>"translate("+r.mouseoverX+","+r.mouseoverY+")"):n.style("opacity",l.styles.unhighlightedOpacity).transition().duration(200).attr("transform",r=>"translate("+r.x+","+r.y+")")})}function T(o,t){const l=new g;let a=new g,s=[];return d({layout:t.seriesContainerPosition$,containerComputedLayoutData:t.containerComputedLayoutData$,fullParams:t.fullParams$,fullChartParams:t.fullChartParams$}).pipe(h(l),y(async e=>e)).subscribe(e=>{const n=e.layout.width<e.layout.height?e.layout.width:e.layout.height,r=$({axisWidth:n,innerRadius:0,outerRadius:e.fullParams.outerRadius,padAngle:0,cornerRadius:0}),i=$({axisWidth:n,innerRadius:0,outerRadius:e.fullParams.outerMouseoverRadius,padAngle:0,cornerRadius:0}),u=x({data:e.containerComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});s=v(u,r,i,e.fullParams.labelCentroid);const p=_(t.containerSelection,s,e.fullParams,e.fullChartParams);a.next(p)}),d({labelSelection:a,highlight:t.seriesHighlight$.pipe(f(e=>e.map(n=>n.id))),fullChartParams:t.fullChartParams$}).pipe(h(l),y(async e=>e)).subscribe(e=>{E({labelSelection:e.labelSelection,ids:e.highlight,fullChartParams:e.fullChartParams})}),()=>{l.next(void 0)}}const H=D(c,L)(({selection:o,observer:t,subject:l})=>{const a=new g,{seriesCenterSelection$:s}=S({selection:o,pluginName:c,seriesSeparate$:t.seriesSeparate$,seriesLabels$:t.seriesLabels$,seriesContainerPosition$:t.seriesContainerPosition$}),e=[];return s.subscribe(n=>{e.forEach(r=>r()),n.each((r,i,u)=>{const p=P(u[i]),b=t.computedLayoutData$.pipe(h(a),f(m=>m[i]??m[0])),C=t.seriesContainerPosition$.pipe(h(a),f(m=>m[i]??m[0]));e[i]=T(c,{containerSelection:p,containerComputedLayoutData$:b,fullParams$:t.fullParams$,fullChartParams$:t.fullChartParams$,seriesHighlight$:t.seriesHighlight$,seriesContainerPosition$:C,event$:l.event$})})}),()=>{a.next(void 0)}});export{H as P};
