import{S as P,O as b,f as F,t as $,s as D,d as p,j as h,p as v,g as L}from"./_HanNZE-.js";import{c as S}from"./C92z20-z.js";import{m as w}from"./DIH9tb3c.js";import{g as C}from"./InbBT3x0.js";import{o as O}from"./OyNKowgb.js";function T(n){let o=Math.floor(Math.sqrt(n)),a=Math.ceil(n/o);for(;o*a<n;)a++;return{rowAmount:o,columnAmount:a}}function I(n,o,a){const{gap:s}=o,{rowAmount:i,columnAmount:r}=o.rowAmount*o.columnAmount>=a?o:T(a);return new Array(a).fill(null).map((f,l)=>{const m=l%r,u=Math.floor(l/r),t=(n.width-s*(r-1))/r,e=(n.height-s*(i-1))/i,c=m*t+m*s,d=u*e+u*s,x=[c,d],g=[t/n.width,e/n.height];return{slotIndex:l,rowIndex:u,columnIndex:m,translate:x,scale:g}})}const y=({fullDataFormatter$:n,layout$:o})=>{const a=new P;function s({xAxis:i,yAxis:r,width:f,height:l}){if(!i||!r)return{translate:[0,0],scale:[1,1],rotate:0,rotateX:0,rotateY:0,value:""};let m=0,u=0,t=0,e=0,c=0;return i.position==="bottom"?r.position==="left"?(e=180,u=l):r.position==="right"?(e=180,c=180,m=f,u=l):(e=180,u=l):i.position==="top"?r.position==="left"||(r.position==="right"?(c=180,m=f):(e=180,u=l)):i.position==="left"?r.position==="bottom"?(t=-90,u=l):r.position==="top"?(t=-90,c=180):(e=180,u=l):i.position==="right"&&(r.position==="bottom"?(t=-90,e=180,u=l,m=f):r.position==="top"?(t=-90,e=180,c=180,m=f):(e=180,u=l)),{translate:[m,u],scale:[1,1],rotate:t,rotateX:e,rotateY:c,value:`translate(${m}px, ${u}px) rotate(${t}deg) rotateX(${e}deg) rotateY(${c}deg)`}}return new b(i=>(F({fullDataFormatter:n,layout:o}).pipe($(a),D(async r=>r)).subscribe(r=>{const f=s({xAxis:r.fullDataFormatter.grid.groupAxis,yAxis:r.fullDataFormatter.grid.valueAxis,width:r.layout.width,height:r.layout.height});i.next(f)}),function(){a.next(void 0)}))},X=({gridAxesTransform$:n})=>n.pipe(p(o=>{const a=[0,0],s=[1/o.scale[0],1/o.scale[1]],i=o.rotate*-1,r=o.rotateX*-1,f=o.rotateY*-1;return{translate:a,scale:s,rotate:i,rotateX:r,rotateY:f,value:`translate(${a[0]}px, ${a[1]}px) rotate(${i}deg) rotateX(${r}deg) rotateY(${f}deg)`}})),Y=({computedData$:n,fullDataFormatter$:o,layout$:a})=>F({computedData:n,fullDataFormatter:o,layout:a}).pipe(D(async i=>i),p(i=>{if(i.fullDataFormatter.grid.separateSeries)return I(i.layout,i.fullDataFormatter.container,i.computedData.length);{const r=I(i.layout,i.fullDataFormatter.container,1);return i.computedData.map((f,l)=>r[0])}})),A="OverlappingValueAxes",G=C(A,"grid"),_=h(A,v)(({selection:n,name:o,subject:a,observer:s})=>{const i=new P,r=[],f=s.fullParams$.pipe($(i),p(t=>t.gridIndexes[0])),l=s.fullParams$.pipe($(i),p(t=>t.gridIndexes[1])),m=F({firstGridIndex:f,secondGridIndex:l,fullDataFormatter:s.fullDataFormatter$}).pipe($(i),D(async t=>t),p(t=>{t.fullDataFormatter.gridList[t.secondGridIndex]||(t.fullDataFormatter.gridList[t.secondGridIndex]=Object.assign({},t.fullDataFormatter.gridList[t.firstGridIndex]));let e="";return t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="left"?e="right":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="bottom"?e="top":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="top"?e="bottom":t.fullDataFormatter.gridList[t.firstGridIndex].valueAxis.position==="right"&&(e="left"),{type:"grid",visibleFilter:t.fullDataFormatter.visibleFilter,grid:{...t.fullDataFormatter.gridList[t.secondGridIndex],valueAxis:{...t.fullDataFormatter.gridList[t.secondGridIndex].valueAxis,position:e}},container:{...t.fullDataFormatter.container}}}));return O(s).pipe($(i),p(t=>({...t,fullParams$:t.fullParams$.pipe(p(e=>(e.gridIndexes.length>2&&(e.gridIndexes.length=2),e)))})),D(t=>w(t)),p(t=>t.map((e,c)=>{if(c===0)return e;const d=y({fullDataFormatter$:m,layout$:s.layout$}),x=X({gridAxesTransform$:d}),g=Y({computedData$:e.computedData$,fullDataFormatter$:m,layout$:s.layout$});return{...e,gridAxesTransform$:d,gridAxesReverseTransform$:x,gridContainerPosition$:g}}))).pipe($(i)).subscribe(t=>{r.forEach(e=>e()),n.selectAll(`g.${G}`).data(t).join("g").attr("class",G).each((e,c,d)=>{if(c>1)return;const x=L(d[c]);r[c]=S(A,{selection:x,computedData$:e.computedData$,fullParams$:s.fullParams$.pipe(p(g=>c===0?g.firstAxis:g.secondAxis)),fullDataFormatter$:e.dataFormatter$,fullChartParams$:s.fullChartParams$,gridAxesTransform$:e.gridAxesTransform$,gridAxesReverseTransform$:e.gridAxesReverseTransform$,gridAxesSize$:e.gridAxesSize$,gridContainerPosition$:e.gridContainerPosition$,isSeriesSeprate$:e.isSeriesSeprate$})})}),()=>{i.next(void 0),r.forEach(t=>t())}});export{_ as O,X as a,Y as b,y as g};
