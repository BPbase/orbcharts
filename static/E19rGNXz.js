import{S as re,k as h,t as c,l as y,m as f,b as k,c as $,s as D}from"./Dh2HIxf9.js";import{g as w,i as oe,j as E}from"./2zdWaanV.js";const ce=" - ",fe={listRectWidth:14,listRectHeight:14,listRectRadius:0};function O(x,g){const b=x<g.colors[g.colorScheme].series.length?x:x%g.colors[g.colorScheme].series.length;return g.colors[g.colorScheme].series[b]}const me=(x,{rootSelection:g,legendLabels$:b,fullParams$:p,layout$:N,fullChartParams$:d,textSizePx$:Y})=>{const H=w(x,"root-position"),Q=w(x,"legend-card"),V=w(x,"legend-list"),U=w(x,"legend-item"),o=new re,Z=h({legendLabels:b,fullChartParams:d}).pipe(c(o),y(async e=>e),f(e=>{const t=new Map;let i=0;return e.legendLabels.forEach((l,n)=>{if(!t.has(l)){const u=O(i,e.fullChartParams);t.set(l,u),i++}}),t})),v=b.pipe(c(o),f(e=>{const t=new Set;let i=[];return e.forEach(l=>{t.has(l)?i.push(!1):i.push(!0),t.add(l)}),i})),z=p.pipe(c(o),f(e=>e.placement==="top"||e.placement==="top-start"||e.placement==="top-end"?"top":e.placement==="bottom"||e.placement==="bottom-start"||e.placement==="bottom-end"?"bottom":e.placement==="left"||e.placement==="left-start"||e.placement==="left-end"?"left":"right"),k((e,t)=>e===t),$(1)),B=p.pipe(c(o),f(e=>e.placement==="top-start"||e.placement==="bottom-start"||e.placement==="left-start"||e.placement==="right-start"?"start":e.placement==="top-end"||e.placement==="bottom-end"||e.placement==="left-end"||e.placement==="right-end"?"end":(e.placement==="top"||e.placement==="bottom"||e.placement==="left"||e.placement==="right","center")),k((e,t)=>e===t),$(1)),F=z.pipe(c(o),f(e=>e==="bottom"||e==="top"?"row":"column"),k((e,t)=>e===t),$(1)),_=h({fullParams:p,position:z,layout:N}).pipe(c(o),y(async e=>e),f(e=>{const t=e.fullParams.padding*2+e.fullParams.gap*2;return e.position==="bottom"||e.position==="top"?e.layout.rootWidth-t:e.layout.rootHeight-t})),ee=h({layout:N,position:z,justify:B}).pipe(c(o),y(async e=>e),f(e=>{let t=0,i=0;return e.position==="bottom"?(i=e.layout.rootHeight,e.justify==="start"?t=0:e.justify==="center"?t=e.layout.rootWidth/2:e.justify==="end"&&(t=e.layout.rootWidth)):e.position==="right"?(t=e.layout.rootWidth,e.justify==="start"?i=0:e.justify==="center"?i=e.layout.rootHeight/2:e.justify==="end"&&(i=e.layout.rootHeight)):e.position==="top"?(i=0,e.justify==="start"?t=0:e.justify==="center"?t=e.layout.rootWidth/2:e.justify==="end"&&(t=e.layout.rootWidth)):e.position==="left"&&(t=0,e.justify==="start"?i=0:e.justify==="center"?i=e.layout.rootHeight/2:e.justify==="end"&&(i=e.layout.rootHeight)),{x:t,y:i}})).pipe(c(o),f(e=>g.selectAll(`g.${H}`).data([e]).join(t=>t.append("g").classed(H,!0).attr("transform",i=>`translate(${i.x}, ${i.y})`),t=>t.transition().attr("transform",i=>`translate(${i.x}, ${i.y})`),t=>t.remove()))),te=p.pipe(c(o),f(e=>e.labelList[0]?e.labelList[0]:fe)),I=h({visibleList:v,fullParams:p,fullChartParams:d,legendLabels:b,lineDirection:F,lineMaxSize:_,defaultListStyle:te,SeriesLabelColorMap:Z,textSizePx:Y}).pipe(c(o),y(async e=>e),f(e=>e.legendLabels.reduce((t,i,l)=>{if(!e.visibleList[l])return t;const n=i!==""?i:ce,u=oe(n,e.textSizePx),m=e.textSizePx*1.5+u,P=e.SeriesLabelColorMap.get(i),s=t[0]&&t[0][0]?t[t.length-1][t[t.length-1].length-1]:null,{translateX:M,translateY:A,lineIndex:S,itemIndex:j}=((a,G,r)=>{let C=0,X=0,L=0,W=0;if(a.lineDirection==="column"){let R=r?r.translateY+a.textSizePx+a.fullParams.gap:0;if(R+a.textSizePx>a.lineMaxSize){L=r.lineIndex+1,W=0,X=0;const se=G[G.length-1].reduce((J,K)=>K.itemWidth>J?K.itemWidth:J,0);C=r.translateX+se+a.fullParams.gap}else L=r?r.lineIndex:0,W=r?r.itemIndex+1:0,X=R,C=r?r.translateX:0}else{let R=r?r.translateX+r.itemWidth+a.fullParams.gap:0;R+m>a.lineMaxSize?(L=r.lineIndex+1,W=0,C=0):(L=r?r.lineIndex:0,W=r?r.itemIndex+1:0,C=R),X=(a.textSizePx+a.fullParams.gap)*L}return{translateX:C,translateY:X,lineIndex:L,itemIndex:W}})(e,t,s);t[S]||(t[S]=[]);const T=e.fullParams.labelList[j]?e.fullParams.labelList[j]:e.defaultListStyle;return t[S].push({id:n,seriesLabel:n,seriesIndex:l,lineIndex:S,itemIndex:j,text:n,itemWidth:m,translateX:M,translateY:A,color:P,listRectWidth:T.listRectWidth,listRectHeight:T.listRectHeight,listRectRadius:T.listRectRadius}),t},[])),$(1)),q=h({fullParams:p,fullChartParams:d,lineDirection:F,lengendItems:I,textSizePx:Y}).pipe(c(o),y(async e=>e),f(e=>{const{width:t,height:i}=((l,n)=>{let u=0,m=0;if(!n.length||!n[0].length)return{width:u,height:m};const P=n[0][n[0].length-1];return l.lineDirection==="column"?(u=n.reduce((s,M)=>{const A=M.reduce((S,j)=>j.itemWidth>S?j.itemWidth:S,0);return s+A},0),u+=l.fullParams.gap*(n.length-1),m=P.translateY+l.textSizePx):(u=P.translateX+P.itemWidth,m=l.textSizePx*n.length+l.fullParams.gap*(n.length-1)),{width:u,height:m}})(e,e.lengendItems);return{direction:e.lineDirection,width:t,height:i,translateX:e.fullParams.gap,translateY:e.fullParams.gap}}),$(1)),ie=h({fullParams:p,position:z,justify:B,lengendList:q}).pipe(c(o),y(async e=>e),f(e=>{const t=e.lengendList.width+e.fullParams.gap*2,i=e.lengendList.height+e.fullParams.gap*2;let l=0,n=0;return e.position==="left"?e.justify==="start"?(l=e.fullParams.padding,n=e.fullParams.padding):e.justify==="center"?(l=e.fullParams.padding,n=-i/2):e.justify==="end"&&(l=e.fullParams.padding,n=-i-e.fullParams.padding):e.position==="right"?e.justify==="start"?(l=-t-e.fullParams.padding,n=e.fullParams.padding):e.justify==="center"?(l=-t-e.fullParams.padding,n=-i/2):e.justify==="end"&&(l=-t-e.fullParams.padding,n=-i-e.fullParams.padding):e.position==="top"?e.justify==="start"?(l=e.fullParams.padding,n=e.fullParams.padding):e.justify==="center"?(l=-t/2,n=e.fullParams.padding):e.justify==="end"&&(l=-t-e.fullParams.padding,n=e.fullParams.padding):e.justify==="start"?(l=e.fullParams.padding,n=-i-e.fullParams.padding):e.justify==="center"?(l=-t/2,n=-i-e.fullParams.padding):e.justify==="end"&&(l=-t-e.fullParams.padding,n=-i-e.fullParams.padding),{width:t,height:i,translateX:l,translateY:n}})),ne=h({rootPositionSelection:ee,fullParams:p,fullChartParams:d,legendCard:ie}).pipe(c(o),y(async e=>e),f(e=>e.rootPositionSelection.selectAll("g").data([e.legendCard]).join(t=>t.append("g").classed(Q,!0).attr("transform",i=>`translate(${i.translateX}, ${i.translateY})`),t=>t.transition().attr("transform",i=>`translate(${i.translateX}, ${i.translateY})`),t=>t.remove()).each((t,i,l)=>{D(l[i]).selectAll("rect").data([t]).join("rect").attr("width",n=>n.width).attr("height",n=>n.height).attr("fill",E(e.fullParams.backgroundFill,e.fullChartParams)).attr("stroke",E(e.fullParams.backgroundStroke,e.fullChartParams))}))),le=h({lengendCardSelection:ne,fullParams:p,lengendList:q}).pipe(c(o),y(async e=>e),f(e=>e.lengendCardSelection.selectAll("g").data([e.lengendList]).join(t=>t.append("g").classed(V,!0).attr("transform",i=>`translate(${i.translateX}, ${i.translateY})`),t=>t.transition().attr("transform",i=>`translate(${i.translateX}, ${i.translateY})`),t=>t.remove())));return h({lengendListSelection:le,fullParams:p,fullChartParams:d,lengendItems:I,textSizePx:Y}).pipe(c(o),y(async e=>e),f(e=>{const t=e.lengendItems[0]?e.lengendItems.flat():[];return e.lengendListSelection.selectAll(`g.${U}`).data(t).join(i=>i.append("g").classed(U,!0).attr("cursor","default"),i=>i,i=>i.remove()).attr("transform",(i,l)=>`translate(${i.translateX}, ${i.translateY})`).each((i,l,n)=>{const u=e.textSizePx/2,m=-i.listRectWidth/2,P=-i.listRectHeight/2;D(n[l]).selectAll("rect").data([i]).join("rect").attr("x",u).attr("y",u).attr("width",s=>s.listRectWidth).attr("height",s=>s.listRectHeight).attr("transform",s=>`translate(${m}, ${P})`).attr("fill",s=>s.color).attr("rx",s=>s.listRectRadius),D(n[l]).selectAll("text").data([i]).join(s=>s.append("text").attr("dominant-baseline","hanging"),s=>s,s=>s.remove()).attr("x",e.textSizePx*1.5).attr("font-size",e.fullChartParams.styles.textSize).attr("fill",s=>e.fullParams.textColorType==="series"?O(s.seriesIndex,e.fullChartParams):E(e.fullParams.textColorType,e.fullChartParams)).text(s=>s.text)})})).subscribe(),()=>{g.select(`g.${H}`).remove(),o.next(void 0)}};export{me as c};
