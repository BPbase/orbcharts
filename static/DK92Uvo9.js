import{g as m,s as d,f as D,e as P,x as W,S as T,t as p,h as M,O as b,L as E}from"./sHDoh0EE.js";import{f as j}from"./BgwK5sb6.js";import{e as V,s as R,g as w,b as v}from"./opDUeYou.js";function F({data:c,startAngle:a,endAngle:o}){return V().startAngle(a).endAngle(o).value(s=>s.value).sort((s,r)=>s.seq-r.seq)(c).map((s,r)=>{let u=s;return u.id=s.data.id,u})}function H({selection:c,pluginName:a,separateSeries$:o,seriesLabels$:n}){const l=w(a,"series");return m({seriesLabels:n,separateSeries:o}).pipe(d(async s=>s),P((s,r)=>{const u=s.separateSeries?s.seriesLabels:[s.seriesLabels.join("")];return c.selectAll(`g.${l}`).data(u,h=>h).join(h=>h.append("g").classed(l,!0),h=>h,h=>h.remove())}),R(1))}const U=({selection:c,pluginName:a,separateSeries$:o,seriesLabels$:n,seriesContainerPosition$:l})=>{const s=H({selection:c,pluginName:a,separateSeries$:o,seriesLabels$:n});return m({seriesCenterSelection:s,seriesContainerPosition:l}).pipe(d(async r=>r),D((r,u)=>r.seriesContainerPosition.length===u.seriesContainerPosition.length)).subscribe(r=>{r.seriesCenterSelection.attr("transform",(u,h)=>{const g=r.seriesContainerPosition[h]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),m({seriesCenterSelection:s,seriesContainerPosition:l}).pipe(d(async r=>r)).subscribe(r=>{r.seriesCenterSelection.transition().attr("transform",(u,h)=>{const g=r.seriesContainerPosition[h]??r.seriesContainerPosition[0];return`translate(${g.centerX}, ${g.centerY})`})}),{seriesCenterSelection$:s}},A="Pie";function q({enter:c,exit:a,data:o,lastTweenData:n,fullParams:l}){return!c.size()&&!a.size()?s=>{const r=o.map((u,h)=>{const g=n[h]??{startAngle:0,endAngle:0,value:0};return{...u,startAngle:u.startAngle*s+g.startAngle*(1-s),endAngle:u.endAngle*s+g.endAngle*(1-s),value:u.value*s+g.value*(1-s)}});return y(r,l.startAngle,l.endAngle,1)}:s=>y(o,l.startAngle,l.endAngle,s)}function y(c,a,o,n){return c.map((l,s)=>{const r=a+(l.startAngle-a)*n,u=r+(l.endAngle-l.startAngle)*n;return{...l,startAngle:r,endAngle:u}})}function L({selection:c,data:a,arc:o,pathClassName:n}){return c.selectAll("path").data(a,s=>s.id).join("path").classed(n,!0).style("cursor","pointer").attr("fill",(s,r)=>s.data.color).attr("d",(s,r)=>o(s))}function x({pathSelection:c,ids:a,fullChartParams:o,arc:n,arcMouseover:l}){if(c.interrupt("highlight"),!a.length){c.transition("highlight").style("opacity",1).attr("d",s=>n(s));return}c.each((s,r,u)=>{const h=M(u[r]);a.includes(s.data.id)?h.style("opacity",1).transition("highlight").ease(E).duration(500).attr("d",g=>l(g)):h.style("opacity",o.styles.unhighlightedOpacity).transition("highlight").attr("d",g=>n(g))})}function z(c,a){const o=new T,n=w(c,"path");let l=[],s=[];const r=a.seriesContainerPosition$.pipe(p(o),P(t=>t.width<t.height?t.width:t.height),D()),u=new b(t=>{m({containerVisibleComputedLayoutData:a.containerVisibleComputedLayoutData$,fullParams:a.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const i=F({data:e.containerVisibleComputedLayoutData,startAngle:e.fullParams.startAngle,endAngle:e.fullParams.endAngle});t.next(i)})}),h=new b(t=>{m({shorterSideWith:r,fullParams:a.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const i=v({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.outerRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});t.next(i)})}),g=new b(t=>{m({shorterSideWith:r,fullParams:a.fullParams$}).pipe(p(o),d(async e=>e)).subscribe(e=>{const i=v({axisWidth:e.shorterSideWith,innerRadius:e.fullParams.innerRadius,outerRadius:e.fullParams.mouseoverOuterRadius,padAngle:e.fullParams.padAngle,cornerRadius:e.fullParams.cornerRadius});t.next(i)})}),$=a.fullChartParams$.pipe(p(o),P(t=>t.highlightTarget),D()),f=new b(t=>{m({pieData:u,arc:h,computedData:a.computedData$,fullParams:a.fullParams$,fullChartParams:a.fullChartParams$,highlightTarget:$}).pipe(p(o),d(async e=>e)).subscribe(e=>{a.containerSelection.interrupt("graphicMove");const i=a.containerSelection.selectAll("path").data(e.pieData,S=>S.id),N=i.enter(),k=i.exit(),I=q({enter:N,exit:k,data:e.pieData,lastTweenData:l,fullParams:e.fullParams});a.containerSelection.transition("graphicMove").duration(e.fullChartParams.transitionDuration).tween("move",(S,O)=>C=>{s=I(C),L({selection:a.containerSelection,data:s,arc:e.arc,pathClassName:n})}).on("end",(S,O)=>{s=y(e.pieData,e.fullParams.startAngle,e.fullParams.endAngle,1);const C=L({selection:a.containerSelection,data:s,arc:e.arc,pathClassName:n});t.next(C),l=Object.assign([],e.pieData),a.event$.next({type:"series",pluginName:c,eventName:"transitionEnd",event:void 0,highlightTarget:e.highlightTarget,datum:null,series:[],seriesIndex:-1,seriesLabel:"",data:e.computedData})})})}).pipe(R(1));return m({pathSelection:f,SeriesDataMap:a.SeriesDataMap$,computedData:a.computedData$,highlightTarget:$}).pipe(p(o),d(async t=>t)).subscribe(t=>{t.pathSelection.on("mouseover",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mouseover",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})}).on("mousemove",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mousemove",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})}).on("mouseout",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"mouseout",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})}).on("click",(e,i)=>{e.stopPropagation(),a.event$.next({type:"series",eventName:"click",pluginName:c,highlightTarget:t.highlightTarget,datum:i.data,series:t.SeriesDataMap.get(i.data.seriesLabel),seriesIndex:i.data.seriesIndex,seriesLabel:i.data.seriesLabel,event:e,data:t.computedData})})}),m({pathSelection:f,highlight:a.seriesHighlight$.pipe(P(t=>t.map(e=>e.id))),fullChartParams:a.fullChartParams$,arc:h,arcMouseover:g}).pipe(p(o),d(async t=>t)).subscribe(t=>{x({pathSelection:t.pathSelection,ids:t.highlight,fullChartParams:t.fullChartParams,arc:t.arc,arcMouseover:t.arcMouseover})}),()=>{o.next(void 0)}}const B=W(A,j)(({selection:c,name:a,subject:o,observer:n})=>{const l=new T,{seriesCenterSelection$:s}=U({selection:c,pluginName:A,separateSeries$:n.separateSeries$,seriesLabels$:n.seriesLabels$,seriesContainerPosition$:n.seriesContainerPosition$}),r=[];return s.pipe(p(l)).subscribe(u=>{r.forEach(h=>h()),u.each((h,g,$)=>{const f=M($[g]),t=n.visibleComputedLayoutData$.pipe(p(l),P(i=>i[g]??i[0])),e=n.seriesContainerPosition$.pipe(p(l),P(i=>i[g]??i[0]));r[g]=z(A,{containerSelection:f,computedData$:n.computedData$,containerVisibleComputedLayoutData$:t,SeriesDataMap$:n.SeriesDataMap$,fullParams$:n.fullParams$,fullChartParams$:n.fullChartParams$,seriesHighlight$:n.seriesHighlight$,seriesContainerPosition$:e,event$:o.event$})})}),()=>{l.next(void 0),r.forEach(u=>u())}});export{B as P,F as m,U as s};
