import{S as j,o as U,t as x,k as C,l as T,s as B,bq as E,be as Y,bK as q,bL as K,bd as J,g as z,m as d,d as I,b as V,O as G,a3 as Q,L as Z,a4 as ee,aq as te,a5 as ae,j as ne}from"./ZOIXw5Nq.js";import{c as ie}from"./DPNcz-vG.js";import{d as X,e as re,r as oe,f as le}from"./GYQj1fsP.js";import{o as H}from"./DOdCuVOe.js";import{c as se}from"./D3mhDFC8.js";const ce="start",ue="middle";function pe({selection:n,fullParams:o,fullChartParams:e,rankingScale:i,xScale:r,categoryData:l,computedRankingAmount:y}){const p=l.slice(0,y+1);return n.selectAll("g").data(p,c=>c.id).join(c=>c.append("g").attr("transform",u=>`translate(${r(u.value[u.xValueIndex]??0)+o.padding}, ${i(u.label)})`),c=>c.transition().duration(e.transitionDuration).ease(E).attr("transform",u=>`translate(${r(u.value[u.xValueIndex]??0)+o.padding}, ${i(u.label)})`),c=>c.remove()).each((c,u,b)=>{B(b[u]).selectAll("text").data([c]).join(g=>g.append("text"),g=>g,g=>g.remove()).attr("text-anchor",ce).attr("dominant-baseline",ue).attr("font-size",e.styles.textSize).style("fill",Y(o.colorType,e)).transition().duration(e.transitionDuration).ease(E).textTween(g=>{const f=g.xValueIndex,h=f===0?0:f-1,A=g.value[h],P=g.value[f];return R=>{const L=R===1?q(A,P)(R):K(A,P)(R);return J(L,o.format)}})}).selectAll("text")}function ge({defsSelection:n,clipPathData:o}){n.selectAll("clipPath").data(o).join(e=>e.append("clipPath"),e=>e,e=>e.remove()).attr("id",e=>e.id).each((e,i,r)=>{B(r[i]).selectAll("rect").data([e]).join(l=>l.append("rect"),l=>l,l=>l.remove()).attr("x",l=>0).attr("y",0).attr("width",l=>l.width*1.5).attr("height",l=>l.height)})}const xe=(n,{selection:o,computedData$:e,visibleComputedRankingData$:i,rankingScaleList$:r,xScale$:l,computedRankingAmount$:y,fullParams$:p,fullChartParams$:S,containerPosition$:a,containerSize$:c,isCategorySeprate$:u})=>{const b=new j,$=z(n,"box"),g=U(n,"clipPath-box"),f=X({selection:o,pluginName:n,clipPathID:null,computedData$:e,containerPosition$:a,isCategorySeprate$:u}).pipe(x(b));return c.subscribe(h=>{const A=o.selectAll("defs").data([g]).join("defs"),P=[{id:g,width:h.width,height:h.height}];ge({defsSelection:A,clipPathData:P})}),C({containerSelection:f,fullParams:p,fullChartParams:S,visibleComputedRankingData:i,rankingScaleList:r,xScale:l,computedRankingAmount:y}).pipe(x(b),T(async h=>h)).subscribe(h=>{h.containerSelection.each((A,P,R)=>{const L=B(R[P]),m=h.rankingScaleList[P];if(!m)return;const _=L.selectAll(`g.${$}`).data([P]).join("g").attr("class",$).attr("clip-path",`url(#${g})`);pe({selection:_,fullParams:h.fullParams,fullChartParams:h.fullChartParams,rankingScale:m,categoryData:h.visibleComputedRankingData[P],xScale:h.xScale,computedRankingAmount:h.computedRankingAmount})})}),()=>{b.next(void 0)}};function he({containerSelection:n,visibleComputedRankingData:o,rankingScaleList:e,transitionDuration:i}){return n.each((l,y,p)=>{B(p[y]).selectAll("g").data(o[y]??[],a=>a.id).join(a=>a.append("g").attr("cursor","pointer").attr("transform",c=>`translate(0, ${e[y]&&e[y](c.label)})`),a=>a.transition().duration(i).ease(E).attr("transform",c=>`translate(0, ${e[y]&&e[y](c.label)})`),a=>a.remove())}),n.selectAll("g")}function $e({graphicGSelection:n,rectClassName:o,xScale:e,fullParams:i,barWidth:r,transitionDuration:l}){return n.each((p,S,a)=>{const c=r/2,u=i.bar.barRadius===!0?c:i.bar.barRadius===!1?0:typeof i.bar.barRadius=="number"?i.bar.barRadius:0;B(a[S]).selectAll(`rect.${o}`).data([p],$=>$.id).join($=>$.append("rect").classed(o,!0).attr("cursor","pointer").attr("width",g=>e(g.value[g.xValueIndex])??1).attr("height",r),$=>$.transition().duration(l).ease(E).attr("width",g=>e(g.value[g.xValueIndex])??1).attr("height",r),$=>$.remove()).attr("transform",`translate(0, ${-c})`).attr("fill",$=>$.color).attr("rx",u).attr("ry",u)}),n.selectAll(`rect.${o}`)}function ye({defsSelection:n,clipPathData:o}){n.selectAll("clipPath").data(o).join(e=>e.append("clipPath"),e=>e,e=>e.remove()).attr("id",e=>e.id).each((e,i,r)=>{B(r[i]).selectAll("rect").data([e]).join(l=>l.append("rect"),l=>l,l=>l.remove()).attr("x",0).attr("y",0).attr("width",l=>l.width).attr("height",l=>l.height)})}function me({selection:n,ids:o,fullChartParams:e}){if(n.interrupt("highlight"),!o.length){n.transition("highlight").duration(200).style("opacity",1);return}n.each((i,r,l)=>{o.includes(i.id)?B(l[r]).style("opacity",1):B(l[r]).style("opacity",e.styles.unhighlightedOpacity)})}const de=(n,{selection:o,computedData$:e,visibleComputedRankingData$:i,CategoryDataMap$:r,fullParams$:l,fullDataFormatter$:y,fullChartParams$:p,highlight$:S,rankingItemHeight$:a,rankingScaleList$:c,containerPosition$:u,containerSize$:b,xScale$:$,isCategorySeprate$:g,event$:f})=>{const h=new j,A=U(n,"clipPath-box"),P=z(n,"rect"),R=X({selection:o,pluginName:n,clipPathID:A,computedData$:e,containerPosition$:u,isCategorySeprate$:g}).pipe(x(h));b.subscribe(t=>{const D=o.selectAll("defs").data([A]).join("defs"),s=[{id:A,width:t.width,height:t.height}];ye({defsSelection:D,clipPathData:s})});const L=C({fullParams:l,rankingItemHeight:a}).pipe(x(h),T(async t=>t),d(t=>t.fullParams.bar.barWidth?t.fullParams.bar.barWidth:t.rankingItemHeight-t.fullParams.bar.barPadding),I()),m=p.pipe(x(h),d(t=>t.transitionDuration),I()),_=C({containerSelection:R,visibleComputedRankingData:i,rankingScaleList:c,transitionDuration:m}).pipe(x(h),T(async t=>t),d(t=>he({containerSelection:t.containerSelection,visibleComputedRankingData:t.visibleComputedRankingData,rankingScaleList:t.rankingScaleList,transitionDuration:t.transitionDuration}))),v=C({graphicGSelection:_,xScale:$,barWidth:L,transitionDuration:m,fullParams:l}).pipe(x(h),T(async t=>t),d(t=>$e({graphicGSelection:t.graphicGSelection,rectClassName:P,xScale:t.xScale,fullParams:t.fullParams,barWidth:t.barWidth,transitionDuration:t.transitionDuration})),V(1)),w=p.pipe(x(h),d(t=>t.highlightTarget),I());return C({graphicSelection:v,computedData:e,CategoryDataMap:r,highlightTarget:w,fullDataFormatter:y}).pipe(x(h),T(async t=>t)).subscribe(t=>{t.graphicSelection.on("mouseover",(D,s)=>{f.next({type:"multiValue",eventName:"mouseover",pluginName:n,highlightTarget:t.highlightTarget,valueDetail:[{value:s.value[s.xValueIndex],valueIndex:s.xValueIndex,valueLabel:t.fullDataFormatter.valueLabels[s.xValueIndex]??String(s.xValueIndex)}],datum:s,category:t.CategoryDataMap.get(s.categoryLabel),categoryIndex:s.categoryIndex,categoryLabel:s.categoryLabel,data:t.computedData,event:D})}).on("mousemove",(D,s)=>{f.next({type:"multiValue",eventName:"mousemove",pluginName:n,highlightTarget:t.highlightTarget,valueDetail:[{value:s.value[s.xValueIndex],valueIndex:s.xValueIndex,valueLabel:t.fullDataFormatter.valueLabels[s.xValueIndex]??String(s.xValueIndex)}],datum:s,category:t.CategoryDataMap.get(s.categoryLabel),categoryIndex:s.categoryIndex,categoryLabel:s.categoryLabel,data:t.computedData,event:D})}).on("mouseout",(D,s)=>{f.next({type:"multiValue",eventName:"mouseout",pluginName:n,highlightTarget:t.highlightTarget,valueDetail:[{value:s.value[s.xValueIndex],valueIndex:s.xValueIndex,valueLabel:t.fullDataFormatter.valueLabels[s.xValueIndex]??String(s.xValueIndex)}],datum:s,category:t.CategoryDataMap.get(s.categoryLabel),categoryIndex:s.categoryIndex,categoryLabel:s.categoryLabel,data:t.computedData,event:D})}).on("click",(D,s)=>{f.next({type:"multiValue",eventName:"click",pluginName:n,highlightTarget:t.highlightTarget,valueDetail:[{value:s.value[s.xValueIndex],valueIndex:s.xValueIndex,valueLabel:t.fullDataFormatter.valueLabels[s.xValueIndex]??String(s.xValueIndex)}],datum:s,category:t.CategoryDataMap.get(s.categoryLabel),categoryIndex:s.categoryIndex,categoryLabel:s.categoryLabel,data:t.computedData,event:D})})}),C({graphicSelection:v,highlight:S.pipe(d(t=>t.map(D=>D.id))),fullChartParams:p}).pipe(x(h),T(async t=>t)).subscribe(t=>{me({selection:t.graphicSelection,ids:t.highlight,fullChartParams:t.fullChartParams})}),()=>{h.next(void 0)}},k="RacingBars",be={name:k,defaultParams:Q,layerIndex:Z,validator:(n,{validateColumns:o})=>{const e=o(n,{bar:{toBeTypes:["object"]},barLabel:{toBeTypes:["object"]},valueLabel:{toBeTypes:["object"]},axisLabel:{toBeTypes:["object"]},rankingAmount:{toBe:'number | "auto"',test:i=>typeof i=="number"||i==="auto"},autorun:{toBeTypes:["boolean"]},loop:{toBeTypes:["boolean"]}});if(n.bar){const i=o(n.bar,{barWidth:{toBeTypes:["number"]},barPadding:{toBeTypes:["number"]},barRadius:{toBeTypes:["number","boolean"]}});if(i.status==="error")return i}if(n.barLabel){const i=o(n.barLabel,{position:{toBe:'"inside" | "outside" | "none"',test:r=>r==="inside"||r==="outside"||r==="none"},padding:{toBeTypes:["number"]},colorType:{toBeOption:"ColorType"}});if(i.status==="error")return i}if(n.valueLabel){const i=o(n.valueLabel,{padding:{toBeTypes:["number"]},colorType:{toBeOption:"ColorType"},format:{toBeTypes:["Function"]}});if(i.status==="error")return i}if(n.axisLabel){const i=o(n.axisLabel,{offset:{toBe:"[number, number]",test:r=>Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"},colorType:{toBeOption:"ColorType"}});if(i.status==="error")return i}return e}},Re=G(be)(({selection:n,name:o,observer:e,subject:i})=>{const r=n.append("g").attr("class",`${k}-bars`),l=n.append("g").attr("class",`${k}-labels`),y=n.append("g").attr("class",`${k}-valueLabels`),p=new j,S=e.fullParams$.pipe(x(p),d(m=>m.valueLabel)),a=e.fullParams$.pipe(x(p),d(m=>m.rankingAmount),I()),c=re({containerSize$:e.containerSize$,visibleComputedData$:e.visibleComputedData$,textSizePx$:e.textSizePx$,rankingAmount$:a}).pipe(x(p),V(1)),u=oe({containerSize$:e.containerSize$,textSizePx$:e.textSizePx$,computedRankingAmount$:c}).pipe(x(p),V(1)),b=le({visibleComputedRankingData$:e.visibleComputedRankingByIndexData$,rankingItemHeight$:u}).pipe(x(p),V(1)),$=ie(`${k}-labels`,{selection:l,computedData$:e.computedData$,visibleComputedRankingData$:e.visibleComputedRankingByIndexData$,rankingScaleList$:b,xScale$:e.xScale$,fullParams$:e.fullParams$,fullDataFormatter$:e.fullDataFormatter$,fullChartParams$:e.fullChartParams$,transitionEase$:H("easeLinear"),containerPosition$:e.containerPosition$,containerSize$:e.containerSize$,isCategorySeprate$:e.isCategorySeprate$}),g=xe(`${k}-valueLabels`,{selection:y,computedData$:e.computedData$,visibleComputedRankingData$:e.visibleComputedRankingByIndexData$,rankingScaleList$:b,xScale$:e.xScale$,computedRankingAmount$:c,fullParams$:S,fullChartParams$:e.fullChartParams$,containerPosition$:e.containerPosition$,containerSize$:e.containerSize$,isCategorySeprate$:e.isCategorySeprate$}),f=de(`${k}-bars`,{selection:r,computedData$:e.computedData$,visibleComputedRankingData$:e.visibleComputedRankingByIndexData$,CategoryDataMap$:e.CategoryDataMap$,fullParams$:e.fullParams$,fullDataFormatter$:e.fullDataFormatter$,fullChartParams$:e.fullChartParams$,highlight$:e.highlight$,rankingItemHeight$:u,rankingScaleList$:b,xScale$:e.xScale$,containerPosition$:e.containerPosition$,containerSize$:e.containerSize$,isCategorySeprate$:e.isCategorySeprate$,event$:i.event$}),h=e.visibleComputedRankingByIndexData$.pipe(x(p),d(m=>(m[0]&&m[0][0]&&m[0][0].value.length)??0),I()),A=e.fullParams$.pipe(x(p),d(m=>m.autorun),I()),P=e.fullParams$.pipe(x(p),d(m=>m.loop),I()),R=e.fullChartParams$.pipe(x(p),d(m=>m.transitionDuration),I());let L=!0;return C({autorun:A,loop:P,valueAmount:h,tickDurationPeriod:R,fullDataFormatter:e.fullDataFormatter$}).pipe(x(p),T(async m=>m)).subscribe(({autorun:m,loop:_,valueAmount:v,tickDurationPeriod:w,fullDataFormatter:t})=>{if(L!=!1&&m){const D=t.xAxis.valueIndex+1;D<v?(L=!1,setTimeout(()=>{i.dataFormatter$.next({...t,xAxis:{...t.xAxis,valueIndex:D}}),L=!0},w)):D>=v&&_&&(L=!1,setTimeout(()=>{i.dataFormatter$.next({...t,xAxis:{...t.xAxis,valueIndex:0}}),L=!0},w))}}),()=>{p.next(void 0),$(),g(),f()}}),O="RacingCounterTexts",M=z(O,"container"),F=z(O,"box"),N=z(O,"text"),fe={name:O,defaultParams:ee,layerIndex:te,validator:(n,{validateColumns:o})=>o(n,{renderFn:{toBeTypes:["Function"]},textAttrs:{toBeTypes:["object[]"]},textStyles:{toBeTypes:["object[]"]},paddingRight:{toBeTypes:["number"]},paddingBottom:{toBeTypes:["number"]}})};function Se({selection:n,data:o,fullParams:e,containerSize:i}){const r=i.width-e.paddingRight,l=i.height-e.paddingBottom;return n.selectAll(`g.${F}`).data([F]).join("g").classed(F,!0).attr("transform",`translate(${r}, ${l})`).each((p,S,a)=>{B(a[S]).selectAll(`text.${N}`).data(o).join("text").classed(N,!0).each((u,b,$)=>{const g=B($[b]).text(u.text);Object.keys(u.attr).forEach(f=>{g.attr(f,u.attr[f])}),Object.keys(u.style).forEach(f=>{g.style(f,u.style[f])})})}).selectAll(`text.${N}`)}function De({computedData:n,valueLabel:o,valueIndex:e,renderFn:i,textAttrs:r,textStyles:l}){const y=o||String(e),p=i(y,e,n);return(Array.isArray(p)?p:[p]).map((a,c)=>({text:a,attr:r[c],style:l[c]}))}function Pe(n,o){const e=new j;return C({textData:o.textData$,fullParams:o.fullParams$,containerSize:o.containerSize$}).pipe(x(e)).subscribe(i=>{Se({selection:o.containerSelection,data:i.textData,fullParams:i.fullParams,containerSize:i.containerSize})}),()=>{e.next(void 0)}}const ke=G(fe)(({selection:n,name:o,observer:e,subject:i})=>{const r=new j,l=C({computedData:e.computedData$.pipe(I((a,c)=>a.length===c.length)),isCategorySeprate:e.isCategorySeprate$}).pipe(x(r),T(async a=>a),d(a=>a.isCategorySeprate?a.computedData:[a.computedData[0]]),d((a,c)=>n.selectAll(`g.${M}`).data(a,u=>u&&u[0]?u[0].categoryIndex:c).join("g").classed(M,!0)));l.pipe(x(r),d((a,c)=>a.selectAll(`g.${F}`).data([F]).join("g").classed(F,!0))),C({containerSelection:l,gridContainerPosition:e.containerPosition$}).pipe(x(r),T(async a=>a)).subscribe(a=>{a.containerSelection.attr("transform",(c,u)=>{const b=a.gridContainerPosition[u]??a.gridContainerPosition[0],$=b.translate;return b.scale,`translate(${$[0]}, ${$[1]})`})});const y=C({xyValueIndex:e.xyValueIndex$,fullDataFormatter:e.fullDataFormatter$}).pipe(x(r),T(async a=>a),d(a=>a.fullDataFormatter.valueLabels[a.xyValueIndex[0]]??""),I(),V(1)),p=C({xyValueIndex:e.xyValueIndex$,valueLabel:y,computedData:e.computedData$,fullParams:e.fullParams$}).pipe(x(r),T(async a=>a),d(a=>De({valueIndex:a.xyValueIndex[0],valueLabel:a.valueLabel,computedData:a.computedData,renderFn:a.fullParams.renderFn,textAttrs:a.fullParams.textAttrs,textStyles:a.fullParams.textStyles})),V(1)),S=[];return l.pipe(x(r)).subscribe(a=>{S.forEach(c=>c()),a.each((c,u,b)=>{const $=B(b[u]);e.visibleComputedRankingByIndexData$.pipe(x(r),d(g=>g[u]??g[0])),e.containerPosition$.pipe(x(r),d(g=>g[u]??g[0])),S[u]=Pe(O,{containerSelection:$,textData$:p,fullParams$:e.fullParams$,valueLabel$:y,xyValueIndex$:e.xyValueIndex$,containerSize$:e.containerSize$})})}),()=>{r.next(void 0),S.forEach(a=>a())}}),W="RacingValueAxis",Ce={name:W,defaultParams:ae,layerIndex:ne,validator:(n,{validateColumns:o})=>{const e=o(n,{labelOffset:{toBe:"[number, number]",test:i=>Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"},labelColorType:{toBeOption:"ColorType"},axisLineVisible:{toBeTypes:["boolean"]},axisLineColorType:{toBeOption:"ColorType"},ticks:{toBeTypes:["number","null"]},tickFormat:{toBeTypes:["string","Function"]},tickLineVisible:{toBeTypes:["boolean"]},tickPadding:{toBeTypes:["number"]},tickFullLine:{toBeTypes:["boolean"]},tickFullLineDasharray:{toBeTypes:["string"]},tickColorType:{toBeOption:"ColorType"},tickTextColorType:{toBeOption:"ColorType"}});return e.status==="error",e}},Ve=G(Ce)(({selection:n,name:o,observer:e,subject:i})=>{const r=new j,l=e.fullChartParams$.pipe(x(r),d(p=>p.transitionDuration),I()),y=se(W,{selection:n,position$:H("top"),transitionDuration$:l,computedData$:e.computedData$,fullParams$:e.fullParams$,fullDataFormatter$:e.fullDataFormatter$,fullChartParams$:e.fullChartParams$,isCategorySeprate$:e.isCategorySeprate$,containerPosition$:e.containerPosition$,containerSize$:e.containerSize$,xScale$:e.xScale$});return()=>{r.next(void 0),y()}});export{Re as R,ke as a,Ve as b};
